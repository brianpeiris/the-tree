(()=>{var n_=Object.create;var tc=Object.defineProperty;var i_=Object.getOwnPropertyDescriptor;var r_=Object.getOwnPropertyNames;var s_=Object.getPrototypeOf,o_=Object.prototype.hasOwnProperty;var zm=a=>tc(a,"__esModule",{value:!0});var La=(a,e)=>()=>(e||a((e={exports:{}}).exports,e),e.exports),Um=(a,e)=>{zm(a);for(var t in e)tc(a,t,{get:e[t],enumerable:!0})},a_=(a,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of r_(e))!o_.call(a,n)&&n!=="default"&&tc(a,n,{get:()=>e[n],enumerable:!(t=i_(e,n))||t.enumerable});return a},mr=a=>a_(zm(tc(a!=null?n_(s_(a)):{},"default",a&&a.__esModule&&"default"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var Ky=La(Yh=>{"use strict";Object.defineProperty(Yh,"__esModule",{value:!0});Yh.VERSION=void 0;Yh.VERSION="0.0.5"});var Gs=La(da=>{"use strict";var e1=da&&da.__spreadArray||function(a,e){for(var t=0,n=e.length,i=a.length;t<n;t++,i++)a[i]=e[t];return a};Object.defineProperty(da,"__esModule",{value:!0});da.Events=void 0;var O2=Ky(),k2=function(){function a(e,t,n){n===void 0&&(n=!1),this.fn=e,this.context=t,this.once=n}return a}(),t1=function(a,e,t,n,i){if(typeof t!="function")throw new TypeError("The listener must be a function");var r=new k2(t,n||a,i);return a._events.has(e)?a._events.get(e).fn?a._events.set(e,[a._events.get(e),r]):a._events.get(e).push(r):(a._events.set(e,r),a._eventsCount++),a},Zh=function(a,e){--a._eventsCount==0?a._events=new Map:a._events.delete(e)},z2=function(){function a(){this._events=new Map,this._eventsCount=0}return Object.defineProperty(a,"VERSION",{get:function(){return O2.VERSION},enumerable:!1,configurable:!0}),a.prototype.eventNames=function(){return Array.from(this._events.keys())},a.prototype.listeners=function(e){var t=this._events.get(e);if(!t)return[];if(t.fn)return[t.fn];for(var n=0,i=t.length,r=new Array(i);n<i;n++)r[n]=t[n].fn;return r},a.prototype.listenerCount=function(e){var t=this._events.get(e);return t?t.fn?1:t.length:0},a.prototype.emit=function(e){for(var t,n,i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];if(!this._events.has(e))return!1;var s=this._events.get(e),o;if(s.fn)return s.once&&this.removeListener(e,s.fn,void 0,!0),(t=s.fn).call.apply(t,e1([s.context],i)),!0;var l=s.length;for(o=0;o<l;o++)s[o].once&&this.removeListener(e,s[o].fn,void 0,!0),(n=s[o].fn).call.apply(n,e1([s[o].context],i));return!0},a.prototype.on=function(e,t,n){return t1(this,e,t,n,!1)},a.prototype.once=function(e,t,n){return t1(this,e,t,n,!0)},a.prototype.removeListener=function(e,t,n,i){if(!this._events.has(e))return this;if(!t)return Zh(this,e),this;var r=this._events.get(e);if(r.fn)r.fn===t&&(!i||r.once)&&(!n||r.context===n)&&Zh(this,e);else{for(var s=0,o=[],l=r.length;s<l;s++)(r[s].fn!==t||i&&!r[s].once||n&&r[s].context!==n)&&o.push(r[s]);o.length?this._events.set(e,o.length===1?o[0]:o):Zh(this,e)}return this},a.prototype.removeAllListeners=function(e){return e?this._events.delete(e)&&Zh(this,e):(this._events=new Map,this._eventsCount=0),this},Object.defineProperty(a.prototype,"off",{get:function(){return this.removeListener},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"addListener",{get:function(){return this.on},enumerable:!1,configurable:!0}),a}();da.Events=z2});var E1=La((zl,kp)=>{(function(e,t){typeof zl=="object"&&typeof kp=="object"?kp.exports=t():typeof define=="function"&&define.amd?define("Matter",[],t):typeof zl=="object"?zl.Matter=t():e.Matter=t()})(zl,function(){return function(a){var e={};function t(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return a[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}return t.m=a,t.c=e,t.d=function(n,i,r){t.o(n,i)||Object.defineProperty(n,i,{enumerable:!0,get:r})},t.r=function(n){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},t.t=function(n,i){if(i&1&&(n=t(n)),i&8||i&4&&typeof n=="object"&&n&&n.__esModule)return n;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:n}),i&2&&typeof n!="string")for(var s in n)t.d(r,s,function(o){return n[o]}.bind(null,s));return r},t.n=function(n){var i=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(i,"a",i),i},t.o=function(n,i){return Object.prototype.hasOwnProperty.call(n,i)},t.p="",t(t.s=22)}([function(a,e){var t={};a.exports=t,function(){t._nextId=0,t._seed=0,t._nowStartTime=+new Date,t._warnedOnce={},t._decomp=null,t.extend=function(i,r){var s,o,l;typeof r=="boolean"?(s=2,l=r):(s=1,l=!0);for(var c=s;c<arguments.length;c++){var u=arguments[c];if(u)for(var f in u)l&&u[f]&&u[f].constructor===Object&&(!i[f]||i[f].constructor===Object)?(i[f]=i[f]||{},t.extend(i[f],l,u[f])):i[f]=u[f]}return i},t.clone=function(i,r){return t.extend({},r,i)},t.keys=function(i){if(Object.keys)return Object.keys(i);var r=[];for(var s in i)r.push(s);return r},t.values=function(i){var r=[];if(Object.keys){for(var s=Object.keys(i),o=0;o<s.length;o++)r.push(i[s[o]]);return r}for(var l in i)r.push(i[l]);return r},t.get=function(i,r,s,o){r=r.split(".").slice(s,o);for(var l=0;l<r.length;l+=1)i=i[r[l]];return i},t.set=function(i,r,s,o,l){var c=r.split(".").slice(o,l);return t.get(i,r,0,-1)[c[c.length-1]]=s,s},t.shuffle=function(i){for(var r=i.length-1;r>0;r--){var s=Math.floor(t.random()*(r+1)),o=i[r];i[r]=i[s],i[s]=o}return i},t.choose=function(i){return i[Math.floor(t.random()*i.length)]},t.isElement=function(i){return typeof HTMLElement!="undefined"?i instanceof HTMLElement:!!(i&&i.nodeType&&i.nodeName)},t.isArray=function(i){return Object.prototype.toString.call(i)==="[object Array]"},t.isFunction=function(i){return typeof i=="function"},t.isPlainObject=function(i){return typeof i=="object"&&i.constructor===Object},t.isString=function(i){return toString.call(i)==="[object String]"},t.clamp=function(i,r,s){return i<r?r:i>s?s:i},t.sign=function(i){return i<0?-1:1},t.now=function(){if(typeof window!="undefined"&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-t._nowStartTime},t.random=function(i,r){return i=typeof i!="undefined"?i:0,r=typeof r!="undefined"?r:1,i+n()*(r-i)};var n=function(){return t._seed=(t._seed*9301+49297)%233280,t._seed/233280};t.colorToNumber=function(i){return i=i.replace("#",""),i.length==3&&(i=i.charAt(0)+i.charAt(0)+i.charAt(1)+i.charAt(1)+i.charAt(2)+i.charAt(2)),parseInt(i,16)},t.logLevel=1,t.log=function(){console&&t.logLevel>0&&t.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},t.info=function(){console&&t.logLevel>0&&t.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},t.warn=function(){console&&t.logLevel>0&&t.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},t.warnOnce=function(){var i=Array.prototype.slice.call(arguments).join(" ");t._warnedOnce[i]||(t.warn(i),t._warnedOnce[i]=!0)},t.deprecated=function(i,r,s){i[r]=t.chain(function(){t.warnOnce("\u{1F505} deprecated \u{1F505}",s)},i[r])},t.nextId=function(){return t._nextId++},t.indexOf=function(i,r){if(i.indexOf)return i.indexOf(r);for(var s=0;s<i.length;s++)if(i[s]===r)return s;return-1},t.map=function(i,r){if(i.map)return i.map(r);for(var s=[],o=0;o<i.length;o+=1)s.push(r(i[o]));return s},t.topologicalSort=function(i){var r=[],s=[],o=[];for(var l in i)!s[l]&&!o[l]&&t._topologicalSort(l,s,o,i,r);return r},t._topologicalSort=function(i,r,s,o,l){var c=o[i]||[];s[i]=!0;for(var u=0;u<c.length;u+=1){var f=c[u];s[f]||r[f]||t._topologicalSort(f,r,s,o,l)}s[i]=!1,r[i]=!0,l.push(i)},t.chain=function(){for(var i=[],r=0;r<arguments.length;r+=1){var s=arguments[r];s._chained?i.push.apply(i,s._chained):i.push(s)}var o=function(){for(var l,c=new Array(arguments.length),u=0,f=arguments.length;u<f;u++)c[u]=arguments[u];for(u=0;u<i.length;u+=1){var h=i[u].apply(l,c);typeof h!="undefined"&&(l=h)}return l};return o._chained=i,o},t.chainPathBefore=function(i,r,s){return t.set(i,r,t.chain(s,t.get(i,r)))},t.chainPathAfter=function(i,r,s){return t.set(i,r,t.chain(t.get(i,r),s))},t.setDecomp=function(i){t._decomp=i},t.getDecomp=function(){var i=t._decomp;try{!i&&typeof window!="undefined"&&(i=window.decomp),!i&&typeof global!="undefined"&&(i=global.decomp)}catch(r){i=null}return i}}()},function(a,e){var t={};a.exports=t,function(){t.create=function(n){var i={min:{x:0,y:0},max:{x:0,y:0}};return n&&t.update(i,n),i},t.update=function(n,i,r){n.min.x=1/0,n.max.x=-1/0,n.min.y=1/0,n.max.y=-1/0;for(var s=0;s<i.length;s++){var o=i[s];o.x>n.max.x&&(n.max.x=o.x),o.x<n.min.x&&(n.min.x=o.x),o.y>n.max.y&&(n.max.y=o.y),o.y<n.min.y&&(n.min.y=o.y)}r&&(r.x>0?n.max.x+=r.x:n.min.x+=r.x,r.y>0?n.max.y+=r.y:n.min.y+=r.y)},t.contains=function(n,i){return i.x>=n.min.x&&i.x<=n.max.x&&i.y>=n.min.y&&i.y<=n.max.y},t.overlaps=function(n,i){return n.min.x<=i.max.x&&n.max.x>=i.min.x&&n.max.y>=i.min.y&&n.min.y<=i.max.y},t.translate=function(n,i){n.min.x+=i.x,n.max.x+=i.x,n.min.y+=i.y,n.max.y+=i.y},t.shift=function(n,i){var r=n.max.x-n.min.x,s=n.max.y-n.min.y;n.min.x=i.x,n.max.x=i.x+r,n.min.y=i.y,n.max.y=i.y+s}}()},function(a,e){var t={};a.exports=t,function(){t.create=function(n,i){return{x:n||0,y:i||0}},t.clone=function(n){return{x:n.x,y:n.y}},t.magnitude=function(n){return Math.sqrt(n.x*n.x+n.y*n.y)},t.magnitudeSquared=function(n){return n.x*n.x+n.y*n.y},t.rotate=function(n,i,r){var s=Math.cos(i),o=Math.sin(i);r||(r={});var l=n.x*s-n.y*o;return r.y=n.x*o+n.y*s,r.x=l,r},t.rotateAbout=function(n,i,r,s){var o=Math.cos(i),l=Math.sin(i);s||(s={});var c=r.x+((n.x-r.x)*o-(n.y-r.y)*l);return s.y=r.y+((n.x-r.x)*l+(n.y-r.y)*o),s.x=c,s},t.normalise=function(n){var i=t.magnitude(n);return i===0?{x:0,y:0}:{x:n.x/i,y:n.y/i}},t.dot=function(n,i){return n.x*i.x+n.y*i.y},t.cross=function(n,i){return n.x*i.y-n.y*i.x},t.cross3=function(n,i,r){return(i.x-n.x)*(r.y-n.y)-(i.y-n.y)*(r.x-n.x)},t.add=function(n,i,r){return r||(r={}),r.x=n.x+i.x,r.y=n.y+i.y,r},t.sub=function(n,i,r){return r||(r={}),r.x=n.x-i.x,r.y=n.y-i.y,r},t.mult=function(n,i){return{x:n.x*i,y:n.y*i}},t.div=function(n,i){return{x:n.x/i,y:n.y/i}},t.perp=function(n,i){return i=i===!0?-1:1,{x:i*-n.y,y:i*n.x}},t.neg=function(n){return{x:-n.x,y:-n.y}},t.angle=function(n,i){return Math.atan2(i.y-n.y,i.x-n.x)},t._temp=[t.create(),t.create(),t.create(),t.create(),t.create(),t.create()]}()},function(a,e,t){var n={};a.exports=n;var i=t(2),r=t(0);(function(){n.create=function(s,o){for(var l=[],c=0;c<s.length;c++){var u=s[c],f={x:u.x,y:u.y,index:c,body:o,isInternal:!1};l.push(f)}return l},n.fromPath=function(s,o){var l=/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/ig,c=[];return s.replace(l,function(u,f,h){c.push({x:parseFloat(f),y:parseFloat(h)})}),n.create(c,o)},n.centre=function(s){for(var o=n.area(s,!0),l={x:0,y:0},c,u,f,h=0;h<s.length;h++)f=(h+1)%s.length,c=i.cross(s[h],s[f]),u=i.mult(i.add(s[h],s[f]),c),l=i.add(l,u);return i.div(l,6*o)},n.mean=function(s){for(var o={x:0,y:0},l=0;l<s.length;l++)o.x+=s[l].x,o.y+=s[l].y;return i.div(o,s.length)},n.area=function(s,o){for(var l=0,c=s.length-1,u=0;u<s.length;u++)l+=(s[c].x-s[u].x)*(s[c].y+s[u].y),c=u;return o?l/2:Math.abs(l)/2},n.inertia=function(s,o){for(var l=0,c=0,u=s,f,h,d=0;d<u.length;d++)h=(d+1)%u.length,f=Math.abs(i.cross(u[h],u[d])),l+=f*(i.dot(u[h],u[h])+i.dot(u[h],u[d])+i.dot(u[d],u[d])),c+=f;return o/6*(l/c)},n.translate=function(s,o,l){var c;if(l)for(c=0;c<s.length;c++)s[c].x+=o.x*l,s[c].y+=o.y*l;else for(c=0;c<s.length;c++)s[c].x+=o.x,s[c].y+=o.y;return s},n.rotate=function(s,o,l){if(o!==0){for(var c=Math.cos(o),u=Math.sin(o),f=0;f<s.length;f++){var h=s[f],d=h.x-l.x,p=h.y-l.y;h.x=l.x+(d*c-p*u),h.y=l.y+(d*u+p*c)}return s}},n.contains=function(s,o){for(var l=0;l<s.length;l++){var c=s[l],u=s[(l+1)%s.length];if((o.x-c.x)*(u.y-c.y)+(o.y-c.y)*(c.x-u.x)>0)return!1}return!0},n.scale=function(s,o,l,c){if(o===1&&l===1)return s;c=c||n.centre(s);for(var u,f,h=0;h<s.length;h++)u=s[h],f=i.sub(u,c),s[h].x=c.x+f.x*o,s[h].y=c.y+f.y*l;return s},n.chamfer=function(s,o,l,c,u){typeof o=="number"?o=[o]:o=o||[8],l=typeof l!="undefined"?l:-1,c=c||2,u=u||14;for(var f=[],h=0;h<s.length;h++){var d=s[h-1>=0?h-1:s.length-1],p=s[h],m=s[(h+1)%s.length],v=o[h<o.length?h:o.length-1];if(v===0){f.push(p);continue}var x=i.normalise({x:p.y-d.y,y:d.x-p.x}),g=i.normalise({x:m.y-p.y,y:p.x-m.x}),y=Math.sqrt(2*Math.pow(v,2)),_=i.mult(r.clone(x),v),w=i.normalise(i.mult(i.add(x,g),.5)),b=i.sub(p,i.mult(w,y)),S=l;l===-1&&(S=Math.pow(v,.32)*1.75),S=r.clamp(S,c,u),S%2==1&&(S+=1);for(var M=Math.acos(i.dot(x,g)),T=M/S,E=0;E<S;E++)f.push(i.add(i.rotate(_,T*E),b))}return f},n.clockwiseSort=function(s){var o=n.mean(s);return s.sort(function(l,c){return i.angle(o,l)-i.angle(o,c)}),s},n.isConvex=function(s){var o=0,l=s.length,c,u,f,h;if(l<3)return null;for(c=0;c<l;c++)if(u=(c+1)%l,f=(c+2)%l,h=(s[u].x-s[c].x)*(s[f].y-s[u].y),h-=(s[u].y-s[c].y)*(s[f].x-s[u].x),h<0?o|=1:h>0&&(o|=2),o===3)return!1;return o!==0?!0:null},n.hull=function(s){var o=[],l=[],c,u;for(s=s.slice(0),s.sort(function(f,h){var d=f.x-h.x;return d!==0?d:f.y-h.y}),u=0;u<s.length;u+=1){for(c=s[u];l.length>=2&&i.cross3(l[l.length-2],l[l.length-1],c)<=0;)l.pop();l.push(c)}for(u=s.length-1;u>=0;u-=1){for(c=s[u];o.length>=2&&i.cross3(o[o.length-2],o[o.length-1],c)<=0;)o.pop();o.push(c)}return o.pop(),l.pop(),o.concat(l)}})()},function(a,e,t){var n={};a.exports=n;var i=t(0);(function(){n.on=function(r,s,o){for(var l=s.split(" "),c,u=0;u<l.length;u++)c=l[u],r.events=r.events||{},r.events[c]=r.events[c]||[],r.events[c].push(o);return o},n.off=function(r,s,o){if(!s){r.events={};return}typeof s=="function"&&(o=s,s=i.keys(r.events).join(" "));for(var l=s.split(" "),c=0;c<l.length;c++){var u=r.events[l[c]],f=[];if(o&&u)for(var h=0;h<u.length;h++)u[h]!==o&&f.push(u[h]);r.events[l[c]]=f}},n.trigger=function(r,s,o){var l,c,u,f,h=r.events;if(h&&i.keys(h).length>0){o||(o={}),l=s.split(" ");for(var d=0;d<l.length;d++)if(c=l[d],u=h[c],u){f=i.clone(o,!1),f.name=c,f.source=r;for(var p=0;p<u.length;p++)u[p].apply(r,[f])}}}})()},function(a,e,t){var n={};a.exports=n;var i=t(4),r=t(0),s=t(1),o=t(6);(function(){n.create=function(l){return r.extend({id:r.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{}},l)},n.setModified=function(l,c,u,f){if(l.isModified=c,u&&l.parent&&n.setModified(l.parent,c,u,f),f)for(var h=0;h<l.composites.length;h++){var d=l.composites[h];n.setModified(d,c,u,f)}},n.add=function(l,c){var u=[].concat(c);i.trigger(l,"beforeAdd",{object:c});for(var f=0;f<u.length;f++){var h=u[f];switch(h.type){case"body":if(h.parent!==h){r.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}n.addBody(l,h);break;case"constraint":n.addConstraint(l,h);break;case"composite":n.addComposite(l,h);break;case"mouseConstraint":n.addConstraint(l,h.constraint);break}}return i.trigger(l,"afterAdd",{object:c}),l},n.remove=function(l,c,u){var f=[].concat(c);i.trigger(l,"beforeRemove",{object:c});for(var h=0;h<f.length;h++){var d=f[h];switch(d.type){case"body":n.removeBody(l,d,u);break;case"constraint":n.removeConstraint(l,d,u);break;case"composite":n.removeComposite(l,d,u);break;case"mouseConstraint":n.removeConstraint(l,d.constraint);break}}return i.trigger(l,"afterRemove",{object:c}),l},n.addComposite=function(l,c){return l.composites.push(c),c.parent=l,n.setModified(l,!0,!0,!1),l},n.removeComposite=function(l,c,u){var f=r.indexOf(l.composites,c);if(f!==-1&&(n.removeCompositeAt(l,f),n.setModified(l,!0,!0,!1)),u)for(var h=0;h<l.composites.length;h++)n.removeComposite(l.composites[h],c,!0);return l},n.removeCompositeAt=function(l,c){return l.composites.splice(c,1),n.setModified(l,!0,!0,!1),l},n.addBody=function(l,c){return l.bodies.push(c),n.setModified(l,!0,!0,!1),l},n.removeBody=function(l,c,u){var f=r.indexOf(l.bodies,c);if(f!==-1&&(n.removeBodyAt(l,f),n.setModified(l,!0,!0,!1)),u)for(var h=0;h<l.composites.length;h++)n.removeBody(l.composites[h],c,!0);return l},n.removeBodyAt=function(l,c){return l.bodies.splice(c,1),n.setModified(l,!0,!0,!1),l},n.addConstraint=function(l,c){return l.constraints.push(c),n.setModified(l,!0,!0,!1),l},n.removeConstraint=function(l,c,u){var f=r.indexOf(l.constraints,c);if(f!==-1&&n.removeConstraintAt(l,f),u)for(var h=0;h<l.composites.length;h++)n.removeConstraint(l.composites[h],c,!0);return l},n.removeConstraintAt=function(l,c){return l.constraints.splice(c,1),n.setModified(l,!0,!0,!1),l},n.clear=function(l,c,u){if(u)for(var f=0;f<l.composites.length;f++)n.clear(l.composites[f],c,!0);return c?l.bodies=l.bodies.filter(function(h){return h.isStatic}):l.bodies.length=0,l.constraints.length=0,l.composites.length=0,n.setModified(l,!0,!0,!1),l},n.allBodies=function(l){for(var c=[].concat(l.bodies),u=0;u<l.composites.length;u++)c=c.concat(n.allBodies(l.composites[u]));return c},n.allConstraints=function(l){for(var c=[].concat(l.constraints),u=0;u<l.composites.length;u++)c=c.concat(n.allConstraints(l.composites[u]));return c},n.allComposites=function(l){for(var c=[].concat(l.composites),u=0;u<l.composites.length;u++)c=c.concat(n.allComposites(l.composites[u]));return c},n.get=function(l,c,u){var f,h;switch(u){case"body":f=n.allBodies(l);break;case"constraint":f=n.allConstraints(l);break;case"composite":f=n.allComposites(l).concat(l);break}return f?(h=f.filter(function(d){return d.id.toString()===c.toString()}),h.length===0?null:h[0]):null},n.move=function(l,c,u){return n.remove(l,c),n.add(u,c),l},n.rebase=function(l){for(var c=n.allBodies(l).concat(n.allConstraints(l)).concat(n.allComposites(l)),u=0;u<c.length;u++)c[u].id=r.nextId();return n.setModified(l,!0,!0,!1),l},n.translate=function(l,c,u){for(var f=u?n.allBodies(l):l.bodies,h=0;h<f.length;h++)o.translate(f[h],c);return n.setModified(l,!0,!0,!1),l},n.rotate=function(l,c,u,f){for(var h=Math.cos(c),d=Math.sin(c),p=f?n.allBodies(l):l.bodies,m=0;m<p.length;m++){var v=p[m],x=v.position.x-u.x,g=v.position.y-u.y;o.setPosition(v,{x:u.x+(x*h-g*d),y:u.y+(x*d+g*h)}),o.rotate(v,c)}return n.setModified(l,!0,!0,!1),l},n.scale=function(l,c,u,f,h){for(var d=h?n.allBodies(l):l.bodies,p=0;p<d.length;p++){var m=d[p],v=m.position.x-f.x,x=m.position.y-f.y;o.setPosition(m,{x:f.x+v*c,y:f.y+x*u}),o.scale(m,c,u)}return n.setModified(l,!0,!0,!1),l},n.bounds=function(l){for(var c=n.allBodies(l),u=[],f=0;f<c.length;f+=1){var h=c[f];u.push(h.bounds.min,h.bounds.max)}return s.create(u)}})()},function(a,e,t){var n={};a.exports=n;var i=t(3),r=t(2),s=t(7),o=t(16),l=t(0),c=t(1),u=t(10);(function(){n._inertiaScale=4,n._nextCollidingGroupId=1,n._nextNonCollidingGroupId=-1,n._nextCategory=1,n.create=function(h){var d={id:l.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:i.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,_original:null},p=l.extend(d,h);return f(p,h),p},n.nextGroup=function(h){return h?n._nextNonCollidingGroupId--:n._nextCollidingGroupId++},n.nextCategory=function(){return n._nextCategory=n._nextCategory<<1,n._nextCategory};var f=function(h,d){d=d||{},n.set(h,{bounds:h.bounds||c.create(h.vertices),positionPrev:h.positionPrev||r.clone(h.position),anglePrev:h.anglePrev||h.angle,vertices:h.vertices,parts:h.parts||[h],isStatic:h.isStatic,isSleeping:h.isSleeping,parent:h.parent||h}),i.rotate(h.vertices,h.angle,h.position),u.rotate(h.axes,h.angle),c.update(h.bounds,h.vertices,h.velocity),n.set(h,{axes:d.axes||h.axes,area:d.area||h.area,mass:d.mass||h.mass,inertia:d.inertia||h.inertia});var p=h.isStatic?"#14151f":l.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),m=h.isStatic?"#555":"#ccc",v=h.isStatic&&h.render.fillStyle===null?1:0;h.render.fillStyle=h.render.fillStyle||p,h.render.strokeStyle=h.render.strokeStyle||m,h.render.lineWidth=h.render.lineWidth||v,h.render.sprite.xOffset+=-(h.bounds.min.x-h.position.x)/(h.bounds.max.x-h.bounds.min.x),h.render.sprite.yOffset+=-(h.bounds.min.y-h.position.y)/(h.bounds.max.y-h.bounds.min.y)};n.set=function(h,d,p){var m;typeof d=="string"&&(m=d,d={},d[m]=p);for(m in d)if(!!Object.prototype.hasOwnProperty.call(d,m))switch(p=d[m],m){case"isStatic":n.setStatic(h,p);break;case"isSleeping":s.set(h,p);break;case"mass":n.setMass(h,p);break;case"density":n.setDensity(h,p);break;case"inertia":n.setInertia(h,p);break;case"vertices":n.setVertices(h,p);break;case"position":n.setPosition(h,p);break;case"angle":n.setAngle(h,p);break;case"velocity":n.setVelocity(h,p);break;case"angularVelocity":n.setAngularVelocity(h,p);break;case"parts":n.setParts(h,p);break;case"centre":n.setCentre(h,p);break;default:h[m]=p}},n.setStatic=function(h,d){for(var p=0;p<h.parts.length;p++){var m=h.parts[p];m.isStatic=d,d?(m._original={restitution:m.restitution,friction:m.friction,mass:m.mass,inertia:m.inertia,density:m.density,inverseMass:m.inverseMass,inverseInertia:m.inverseInertia},m.restitution=0,m.friction=1,m.mass=m.inertia=m.density=1/0,m.inverseMass=m.inverseInertia=0,m.positionPrev.x=m.position.x,m.positionPrev.y=m.position.y,m.anglePrev=m.angle,m.angularVelocity=0,m.speed=0,m.angularSpeed=0,m.motion=0):m._original&&(m.restitution=m._original.restitution,m.friction=m._original.friction,m.mass=m._original.mass,m.inertia=m._original.inertia,m.density=m._original.density,m.inverseMass=m._original.inverseMass,m.inverseInertia=m._original.inverseInertia,m._original=null)}},n.setMass=function(h,d){var p=h.inertia/(h.mass/6);h.inertia=p*(d/6),h.inverseInertia=1/h.inertia,h.mass=d,h.inverseMass=1/h.mass,h.density=h.mass/h.area},n.setDensity=function(h,d){n.setMass(h,d*h.area),h.density=d},n.setInertia=function(h,d){h.inertia=d,h.inverseInertia=1/h.inertia},n.setVertices=function(h,d){d[0].body===h?h.vertices=d:h.vertices=i.create(d,h),h.axes=u.fromVertices(h.vertices),h.area=i.area(h.vertices),n.setMass(h,h.density*h.area);var p=i.centre(h.vertices);i.translate(h.vertices,p,-1),n.setInertia(h,n._inertiaScale*i.inertia(h.vertices,h.mass)),i.translate(h.vertices,h.position),c.update(h.bounds,h.vertices,h.velocity)},n.setParts=function(h,d,p){var m;for(d=d.slice(0),h.parts.length=0,h.parts.push(h),h.parent=h,m=0;m<d.length;m++){var v=d[m];v!==h&&(v.parent=h,h.parts.push(v))}if(h.parts.length!==1){if(p=typeof p!="undefined"?p:!0,p){var x=[];for(m=0;m<d.length;m++)x=x.concat(d[m].vertices);i.clockwiseSort(x);var g=i.hull(x),y=i.centre(g);n.setVertices(h,g),i.translate(h.vertices,y)}var _=n._totalProperties(h);h.area=_.area,h.parent=h,h.position.x=_.centre.x,h.position.y=_.centre.y,h.positionPrev.x=_.centre.x,h.positionPrev.y=_.centre.y,n.setMass(h,_.mass),n.setInertia(h,_.inertia),n.setPosition(h,_.centre)}},n.setCentre=function(h,d,p){p?(h.positionPrev.x+=d.x,h.positionPrev.y+=d.y,h.position.x+=d.x,h.position.y+=d.y):(h.positionPrev.x=d.x-(h.position.x-h.positionPrev.x),h.positionPrev.y=d.y-(h.position.y-h.positionPrev.y),h.position.x=d.x,h.position.y=d.y)},n.setPosition=function(h,d){var p=r.sub(d,h.position);h.positionPrev.x+=p.x,h.positionPrev.y+=p.y;for(var m=0;m<h.parts.length;m++){var v=h.parts[m];v.position.x+=p.x,v.position.y+=p.y,i.translate(v.vertices,p),c.update(v.bounds,v.vertices,h.velocity)}},n.setAngle=function(h,d){var p=d-h.angle;h.anglePrev+=p;for(var m=0;m<h.parts.length;m++){var v=h.parts[m];v.angle+=p,i.rotate(v.vertices,p,h.position),u.rotate(v.axes,p),c.update(v.bounds,v.vertices,h.velocity),m>0&&r.rotateAbout(v.position,p,h.position,v.position)}},n.setVelocity=function(h,d){h.positionPrev.x=h.position.x-d.x,h.positionPrev.y=h.position.y-d.y,h.velocity.x=d.x,h.velocity.y=d.y,h.speed=r.magnitude(h.velocity)},n.setAngularVelocity=function(h,d){h.anglePrev=h.angle-d,h.angularVelocity=d,h.angularSpeed=Math.abs(h.angularVelocity)},n.translate=function(h,d){n.setPosition(h,r.add(h.position,d))},n.rotate=function(h,d,p){if(!p)n.setAngle(h,h.angle+d);else{var m=Math.cos(d),v=Math.sin(d),x=h.position.x-p.x,g=h.position.y-p.y;n.setPosition(h,{x:p.x+(x*m-g*v),y:p.y+(x*v+g*m)}),n.setAngle(h,h.angle+d)}},n.scale=function(h,d,p,m){var v=0,x=0;m=m||h.position;for(var g=0;g<h.parts.length;g++){var y=h.parts[g];i.scale(y.vertices,d,p,m),y.axes=u.fromVertices(y.vertices),y.area=i.area(y.vertices),n.setMass(y,h.density*y.area),i.translate(y.vertices,{x:-y.position.x,y:-y.position.y}),n.setInertia(y,n._inertiaScale*i.inertia(y.vertices,y.mass)),i.translate(y.vertices,{x:y.position.x,y:y.position.y}),g>0&&(v+=y.area,x+=y.inertia),y.position.x=m.x+(y.position.x-m.x)*d,y.position.y=m.y+(y.position.y-m.y)*p,c.update(y.bounds,y.vertices,h.velocity)}h.parts.length>1&&(h.area=v,h.isStatic||(n.setMass(h,h.density*v),n.setInertia(h,x))),h.circleRadius&&(d===p?h.circleRadius*=d:h.circleRadius=null)},n.update=function(h,d,p,m){var v=Math.pow(d*p*h.timeScale,2),x=1-h.frictionAir*p*h.timeScale,g=h.position.x-h.positionPrev.x,y=h.position.y-h.positionPrev.y;h.velocity.x=g*x*m+h.force.x/h.mass*v,h.velocity.y=y*x*m+h.force.y/h.mass*v,h.positionPrev.x=h.position.x,h.positionPrev.y=h.position.y,h.position.x+=h.velocity.x,h.position.y+=h.velocity.y,h.angularVelocity=(h.angle-h.anglePrev)*x*m+h.torque/h.inertia*v,h.anglePrev=h.angle,h.angle+=h.angularVelocity,h.speed=r.magnitude(h.velocity),h.angularSpeed=Math.abs(h.angularVelocity);for(var _=0;_<h.parts.length;_++){var w=h.parts[_];i.translate(w.vertices,h.velocity),_>0&&(w.position.x+=h.velocity.x,w.position.y+=h.velocity.y),h.angularVelocity!==0&&(i.rotate(w.vertices,h.angularVelocity,h.position),u.rotate(w.axes,h.angularVelocity),_>0&&r.rotateAbout(w.position,h.angularVelocity,h.position,w.position)),c.update(w.bounds,w.vertices,h.velocity)}},n.applyForce=function(h,d,p){h.force.x+=p.x,h.force.y+=p.y;var m={x:d.x-h.position.x,y:d.y-h.position.y};h.torque+=m.x*p.y-m.y*p.x},n._totalProperties=function(h){for(var d={mass:0,area:0,inertia:0,centre:{x:0,y:0}},p=h.parts.length===1?0:1;p<h.parts.length;p++){var m=h.parts[p],v=m.mass!==1/0?m.mass:1;d.mass+=v,d.area+=m.area,d.inertia+=m.inertia,d.centre=r.add(d.centre,r.mult(m.position,v))}return d.centre=r.div(d.centre,d.mass),d}})()},function(a,e,t){var n={};a.exports=n;var i=t(4);(function(){n._motionWakeThreshold=.18,n._motionSleepThreshold=.08,n._minBias=.9,n.update=function(r,s){for(var o=s*s*s,l=0;l<r.length;l++){var c=r[l],u=c.speed*c.speed+c.angularSpeed*c.angularSpeed;if(c.force.x!==0||c.force.y!==0){n.set(c,!1);continue}var f=Math.min(c.motion,u),h=Math.max(c.motion,u);c.motion=n._minBias*f+(1-n._minBias)*h,c.sleepThreshold>0&&c.motion<n._motionSleepThreshold*o?(c.sleepCounter+=1,c.sleepCounter>=c.sleepThreshold&&n.set(c,!0)):c.sleepCounter>0&&(c.sleepCounter-=1)}},n.afterCollisions=function(r,s){for(var o=s*s*s,l=0;l<r.length;l++){var c=r[l];if(!!c.isActive){var u=c.collision,f=u.bodyA.parent,h=u.bodyB.parent;if(!(f.isSleeping&&h.isSleeping||f.isStatic||h.isStatic)&&(f.isSleeping||h.isSleeping)){var d=f.isSleeping&&!f.isStatic?f:h,p=d===f?h:f;!d.isStatic&&p.motion>n._motionWakeThreshold*o&&n.set(d,!1)}}}},n.set=function(r,s){var o=r.isSleeping;s?(r.isSleeping=!0,r.sleepCounter=r.sleepThreshold,r.positionImpulse.x=0,r.positionImpulse.y=0,r.positionPrev.x=r.position.x,r.positionPrev.y=r.position.y,r.anglePrev=r.angle,r.speed=0,r.angularSpeed=0,r.motion=0,o||i.trigger(r,"sleepStart")):(r.isSleeping=!1,r.sleepCounter=0,o&&i.trigger(r,"sleepEnd"))}})()},function(a,e,t){var n={};a.exports=n;var i=t(3),r=t(2),s=t(7),o=t(1),l=t(10),c=t(0);(function(){n._warming=.4,n._torqueDampen=1,n._minLength=1e-6,n.create=function(u){var f=u;f.bodyA&&!f.pointA&&(f.pointA={x:0,y:0}),f.bodyB&&!f.pointB&&(f.pointB={x:0,y:0});var h=f.bodyA?r.add(f.bodyA.position,f.pointA):f.pointA,d=f.bodyB?r.add(f.bodyB.position,f.pointB):f.pointB,p=r.magnitude(r.sub(h,d));f.length=typeof f.length!="undefined"?f.length:p,f.id=f.id||c.nextId(),f.label=f.label||"Constraint",f.type="constraint",f.stiffness=f.stiffness||(f.length>0?1:.7),f.damping=f.damping||0,f.angularStiffness=f.angularStiffness||0,f.angleA=f.bodyA?f.bodyA.angle:f.angleA,f.angleB=f.bodyB?f.bodyB.angle:f.angleB,f.plugin={};var m={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return f.length===0&&f.stiffness>.1?(m.type="pin",m.anchors=!1):f.stiffness<.9&&(m.type="spring"),f.render=c.extend(m,f.render),f},n.preSolveAll=function(u){for(var f=0;f<u.length;f+=1){var h=u[f],d=h.constraintImpulse;h.isStatic||d.x===0&&d.y===0&&d.angle===0||(h.position.x+=d.x,h.position.y+=d.y,h.angle+=d.angle)}},n.solveAll=function(u,f){for(var h=0;h<u.length;h+=1){var d=u[h],p=!d.bodyA||d.bodyA&&d.bodyA.isStatic,m=!d.bodyB||d.bodyB&&d.bodyB.isStatic;(p||m)&&n.solve(u[h],f)}for(h=0;h<u.length;h+=1)d=u[h],p=!d.bodyA||d.bodyA&&d.bodyA.isStatic,m=!d.bodyB||d.bodyB&&d.bodyB.isStatic,!p&&!m&&n.solve(u[h],f)},n.solve=function(u,f){var h=u.bodyA,d=u.bodyB,p=u.pointA,m=u.pointB;if(!(!h&&!d)){h&&!h.isStatic&&(r.rotate(p,h.angle-u.angleA,p),u.angleA=h.angle),d&&!d.isStatic&&(r.rotate(m,d.angle-u.angleB,m),u.angleB=d.angle);var v=p,x=m;if(h&&(v=r.add(h.position,p)),d&&(x=r.add(d.position,m)),!(!v||!x)){var g=r.sub(v,x),y=r.magnitude(g);y<n._minLength&&(y=n._minLength);var _=(y-u.length)/y,w=u.stiffness<1?u.stiffness*f:u.stiffness,b=r.mult(g,_*w),S=(h?h.inverseMass:0)+(d?d.inverseMass:0),M=(h?h.inverseInertia:0)+(d?d.inverseInertia:0),T=S+M,E,A,I,C,R;if(u.damping){var D=r.create();I=r.div(g,y),R=r.sub(d&&r.sub(d.position,d.positionPrev)||D,h&&r.sub(h.position,h.positionPrev)||D),C=r.dot(I,R)}h&&!h.isStatic&&(A=h.inverseMass/S,h.constraintImpulse.x-=b.x*A,h.constraintImpulse.y-=b.y*A,h.position.x-=b.x*A,h.position.y-=b.y*A,u.damping&&(h.positionPrev.x-=u.damping*I.x*C*A,h.positionPrev.y-=u.damping*I.y*C*A),E=r.cross(p,b)/T*n._torqueDampen*h.inverseInertia*(1-u.angularStiffness),h.constraintImpulse.angle-=E,h.angle-=E),d&&!d.isStatic&&(A=d.inverseMass/S,d.constraintImpulse.x+=b.x*A,d.constraintImpulse.y+=b.y*A,d.position.x+=b.x*A,d.position.y+=b.y*A,u.damping&&(d.positionPrev.x+=u.damping*I.x*C*A,d.positionPrev.y+=u.damping*I.y*C*A),E=r.cross(m,b)/T*n._torqueDampen*d.inverseInertia*(1-u.angularStiffness),d.constraintImpulse.angle+=E,d.angle+=E)}}},n.postSolveAll=function(u){for(var f=0;f<u.length;f++){var h=u[f],d=h.constraintImpulse;if(!(h.isStatic||d.x===0&&d.y===0&&d.angle===0)){s.set(h,!1);for(var p=0;p<h.parts.length;p++){var m=h.parts[p];i.translate(m.vertices,d),p>0&&(m.position.x+=d.x,m.position.y+=d.y),d.angle!==0&&(i.rotate(m.vertices,d.angle,h.position),l.rotate(m.axes,d.angle),p>0&&r.rotateAbout(m.position,d.angle,h.position,m.position)),o.update(m.bounds,m.vertices,h.velocity)}d.angle*=n._warming,d.x*=n._warming,d.y*=n._warming}}},n.pointAWorld=function(u){return{x:(u.bodyA?u.bodyA.position.x:0)+u.pointA.x,y:(u.bodyA?u.bodyA.position.y:0)+u.pointA.y}},n.pointBWorld=function(u){return{x:(u.bodyB?u.bodyB.position.x:0)+u.pointB.x,y:(u.bodyB?u.bodyB.position.y:0)+u.pointB.y}}})()},function(a,e,t){var n={};a.exports=n;var i=t(17);(function(){n.create=function(r,s){var o=r.bodyA,l=r.bodyB,c=r.parentA,u=r.parentB,f={id:n.id(o,l),bodyA:o,bodyB:l,contacts:{},activeContacts:[],separation:0,isActive:!0,confirmedActive:!0,isSensor:o.isSensor||l.isSensor,timeCreated:s,timeUpdated:s,inverseMass:c.inverseMass+u.inverseMass,friction:Math.min(c.friction,u.friction),frictionStatic:Math.max(c.frictionStatic,u.frictionStatic),restitution:Math.max(c.restitution,u.restitution),slop:Math.max(c.slop,u.slop)};return n.update(f,r,s),f},n.update=function(r,s,o){var l=r.contacts,c=s.supports,u=r.activeContacts,f=s.parentA,h=s.parentB;if(r.collision=s,r.inverseMass=f.inverseMass+h.inverseMass,r.friction=Math.min(f.friction,h.friction),r.frictionStatic=Math.max(f.frictionStatic,h.frictionStatic),r.restitution=Math.max(f.restitution,h.restitution),r.slop=Math.max(f.slop,h.slop),u.length=0,s.collided){for(var d=0;d<c.length;d++){var p=c[d],m=i.id(p),v=l[m];v?u.push(v):u.push(l[m]=i.create(p))}r.separation=s.depth,n.setActive(r,!0,o)}else r.isActive===!0&&n.setActive(r,!1,o)},n.setActive=function(r,s,o){s?(r.isActive=!0,r.timeUpdated=o):(r.isActive=!1,r.activeContacts.length=0)},n.id=function(r,s){return r.id<s.id?"A"+r.id+"B"+s.id:"A"+s.id+"B"+r.id}})()},function(a,e,t){var n={};a.exports=n;var i=t(2),r=t(0);(function(){n.fromVertices=function(s){for(var o={},l=0;l<s.length;l++){var c=(l+1)%s.length,u=i.normalise({x:s[c].y-s[l].y,y:s[l].x-s[c].x}),f=u.y===0?1/0:u.x/u.y;f=f.toFixed(3).toString(),o[f]=u}return r.values(o)},n.rotate=function(s,o){if(o!==0)for(var l=Math.cos(o),c=Math.sin(o),u=0;u<s.length;u++){var f=s[u],h;h=f.x*l-f.y*c,f.y=f.x*c+f.y*l,f.x=h}}})()},function(a,e,t){var n={};a.exports=n;var i=t(3),r=t(0),s=t(6),o=t(1),l=t(2);(function(){n.rectangle=function(c,u,f,h,d){d=d||{};var p={label:"Rectangle Body",position:{x:c,y:u},vertices:i.fromPath("L 0 0 L "+f+" 0 L "+f+" "+h+" L 0 "+h)};if(d.chamfer){var m=d.chamfer;p.vertices=i.chamfer(p.vertices,m.radius,m.quality,m.qualityMin,m.qualityMax),delete d.chamfer}return s.create(r.extend({},p,d))},n.trapezoid=function(c,u,f,h,d,p){p=p||{},d*=.5;var m=(1-d*2)*f,v=f*d,x=v+m,g=x+v,y;d<.5?y="L 0 0 L "+v+" "+-h+" L "+x+" "+-h+" L "+g+" 0":y="L 0 0 L "+x+" "+-h+" L "+g+" 0";var _={label:"Trapezoid Body",position:{x:c,y:u},vertices:i.fromPath(y)};if(p.chamfer){var w=p.chamfer;_.vertices=i.chamfer(_.vertices,w.radius,w.quality,w.qualityMin,w.qualityMax),delete p.chamfer}return s.create(r.extend({},_,p))},n.circle=function(c,u,f,h,d){h=h||{};var p={label:"Circle Body",circleRadius:f};d=d||25;var m=Math.ceil(Math.max(10,Math.min(d,f)));return m%2==1&&(m+=1),n.polygon(c,u,m,f,r.extend({},p,h))},n.polygon=function(c,u,f,h,d){if(d=d||{},f<3)return n.circle(c,u,h,d);for(var p=2*Math.PI/f,m="",v=p*.5,x=0;x<f;x+=1){var g=v+x*p,y=Math.cos(g)*h,_=Math.sin(g)*h;m+="L "+y.toFixed(3)+" "+_.toFixed(3)+" "}var w={label:"Polygon Body",position:{x:c,y:u},vertices:i.fromPath(m)};if(d.chamfer){var b=d.chamfer;w.vertices=i.chamfer(w.vertices,b.radius,b.quality,b.qualityMin,b.qualityMax),delete d.chamfer}return s.create(r.extend({},w,d))},n.fromVertices=function(c,u,f,h,d,p,m,v){var x=r.getDecomp(),g,y,_,w,b,S,M,T,E,A,I;for(g=Boolean(x&&x.quickDecomp),h=h||{},_=[],d=typeof d!="undefined"?d:!1,p=typeof p!="undefined"?p:.01,m=typeof m!="undefined"?m:10,v=typeof v!="undefined"?v:.01,r.isArray(f[0])||(f=[f]),A=0;A<f.length;A+=1)if(S=f[A],w=i.isConvex(S),b=!w,b&&!g&&r.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),w||!g)w?S=i.clockwiseSort(S):S=i.hull(S),_.push({position:{x:c,y:u},vertices:S});else{var C=S.map(function(B){return[B.x,B.y]});x.makeCCW(C),p!==!1&&x.removeCollinearPoints(C,p),v!==!1&&x.removeDuplicatePoints&&x.removeDuplicatePoints(C,v);var R=x.quickDecomp(C);for(M=0;M<R.length;M++){var D=R[M],F=D.map(function(B){return{x:B[0],y:B[1]}});m>0&&i.area(F)<m||_.push({position:i.centre(F),vertices:F})}}for(M=0;M<_.length;M++)_[M]=s.create(r.extend(_[M],h));if(d){var O=5;for(M=0;M<_.length;M++){var U=_[M];for(T=M+1;T<_.length;T++){var j=_[T];if(o.overlaps(U.bounds,j.bounds)){var Z=U.vertices,K=j.vertices;for(E=0;E<U.vertices.length;E++)for(I=0;I<j.vertices.length;I++){var G=l.magnitudeSquared(l.sub(Z[(E+1)%Z.length],K[I])),k=l.magnitudeSquared(l.sub(Z[E],K[(I+1)%K.length]));G<O&&k<O&&(Z[E].isInternal=!0,K[I].isInternal=!0)}}}}}return _.length>1?(y=s.create(r.extend({parts:_.slice(0)},h)),s.setPosition(y,{x:c,y:u}),y):_[0]}})()},function(a,e,t){var n={};a.exports=n;var i=t(0);(function(){n.create=function(r){var s={};return r||i.log("Mouse.create: element was undefined, defaulting to document.body","warn"),s.element=r||document.body,s.absolute={x:0,y:0},s.position={x:0,y:0},s.mousedownPosition={x:0,y:0},s.mouseupPosition={x:0,y:0},s.offset={x:0,y:0},s.scale={x:1,y:1},s.wheelDelta=0,s.button=-1,s.pixelRatio=parseInt(s.element.getAttribute("data-pixel-ratio"),10)||1,s.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},s.mousemove=function(o){var l=n._getRelativeMousePosition(o,s.element,s.pixelRatio),c=o.changedTouches;c&&(s.button=0,o.preventDefault()),s.absolute.x=l.x,s.absolute.y=l.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y,s.sourceEvents.mousemove=o},s.mousedown=function(o){var l=n._getRelativeMousePosition(o,s.element,s.pixelRatio),c=o.changedTouches;c?(s.button=0,o.preventDefault()):s.button=o.button,s.absolute.x=l.x,s.absolute.y=l.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y,s.mousedownPosition.x=s.position.x,s.mousedownPosition.y=s.position.y,s.sourceEvents.mousedown=o},s.mouseup=function(o){var l=n._getRelativeMousePosition(o,s.element,s.pixelRatio),c=o.changedTouches;c&&o.preventDefault(),s.button=-1,s.absolute.x=l.x,s.absolute.y=l.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y,s.mouseupPosition.x=s.position.x,s.mouseupPosition.y=s.position.y,s.sourceEvents.mouseup=o},s.mousewheel=function(o){s.wheelDelta=Math.max(-1,Math.min(1,o.wheelDelta||-o.detail)),o.preventDefault()},n.setElement(s,s.element),s},n.setElement=function(r,s){r.element=s,s.addEventListener("mousemove",r.mousemove),s.addEventListener("mousedown",r.mousedown),s.addEventListener("mouseup",r.mouseup),s.addEventListener("mousewheel",r.mousewheel),s.addEventListener("DOMMouseScroll",r.mousewheel),s.addEventListener("touchmove",r.mousemove),s.addEventListener("touchstart",r.mousedown),s.addEventListener("touchend",r.mouseup)},n.clearSourceEvents=function(r){r.sourceEvents.mousemove=null,r.sourceEvents.mousedown=null,r.sourceEvents.mouseup=null,r.sourceEvents.mousewheel=null,r.wheelDelta=0},n.setOffset=function(r,s){r.offset.x=s.x,r.offset.y=s.y,r.position.x=r.absolute.x*r.scale.x+r.offset.x,r.position.y=r.absolute.y*r.scale.y+r.offset.y},n.setScale=function(r,s){r.scale.x=s.x,r.scale.y=s.y,r.position.x=r.absolute.x*r.scale.x+r.offset.x,r.position.y=r.absolute.y*r.scale.y+r.offset.y},n._getRelativeMousePosition=function(r,s,o){var l=s.getBoundingClientRect(),c=document.documentElement||document.body.parentNode||document.body,u=window.pageXOffset!==void 0?window.pageXOffset:c.scrollLeft,f=window.pageYOffset!==void 0?window.pageYOffset:c.scrollTop,h=r.changedTouches,d,p;return h?(d=h[0].pageX-l.left-u,p=h[0].pageY-l.top-f):(d=r.pageX-l.left-u,p=r.pageY-l.top-f),{x:d/(s.clientWidth/(s.width||s.clientWidth)*o),y:p/(s.clientHeight/(s.height||s.clientHeight)*o)}}})()},function(a,e,t){var n={};a.exports=n;var i=t(14),r=t(9),s=t(1);(function(){n.collisions=function(o,l){for(var c=[],u=l.pairs.table,f=0;f<o.length;f++){var h=o[f][0],d=o[f][1];if(!((h.isStatic||h.isSleeping)&&(d.isStatic||d.isSleeping))&&!!n.canCollide(h.collisionFilter,d.collisionFilter)&&s.overlaps(h.bounds,d.bounds))for(var p=h.parts.length>1?1:0;p<h.parts.length;p++)for(var m=h.parts[p],v=d.parts.length>1?1:0;v<d.parts.length;v++){var x=d.parts[v];if(m===h&&x===d||s.overlaps(m.bounds,x.bounds)){var g=r.id(m,x),y=u[g],_;y&&y.isActive?_=y.collision:_=null;var w=i.collides(m,x,_);w.collided&&c.push(w)}}}return c},n.canCollide=function(o,l){return o.group===l.group&&o.group!==0?o.group>0:(o.mask&l.category)!=0&&(l.mask&o.category)!=0}})()},function(a,e,t){var n={};a.exports=n;var i=t(3),r=t(2);(function(){n.collides=function(s,o,l){var c,u,f,h,d=!1;if(l){var p=s.parent,m=o.parent,v=p.speed*p.speed+p.angularSpeed*p.angularSpeed+m.speed*m.speed+m.angularSpeed*m.angularSpeed;d=l&&l.collided&&v<.2,h=l}else h={collided:!1,bodyA:s,bodyB:o};if(l&&d){var x=h.axisBody,g=x===s?o:s,y=[x.axes[l.axisNumber]];if(f=n._overlapAxes(x.vertices,g.vertices,y),h.reused=!0,f.overlap<=0)return h.collided=!1,h}else{if(c=n._overlapAxes(s.vertices,o.vertices,s.axes),c.overlap<=0||(u=n._overlapAxes(o.vertices,s.vertices,o.axes),u.overlap<=0))return h.collided=!1,h;c.overlap<u.overlap?(f=c,h.axisBody=s):(f=u,h.axisBody=o),h.axisNumber=f.axisNumber}h.bodyA=s.id<o.id?s:o,h.bodyB=s.id<o.id?o:s,h.collided=!0,h.depth=f.overlap,h.parentA=h.bodyA.parent,h.parentB=h.bodyB.parent,s=h.bodyA,o=h.bodyB,r.dot(f.axis,r.sub(o.position,s.position))<0?h.normal={x:f.axis.x,y:f.axis.y}:h.normal={x:-f.axis.x,y:-f.axis.y},h.tangent=r.perp(h.normal),h.penetration=h.penetration||{},h.penetration.x=h.normal.x*h.depth,h.penetration.y=h.normal.y*h.depth;var _=n._findSupports(s,o,h.normal),w=[];if(i.contains(s.vertices,_[0])&&w.push(_[0]),i.contains(s.vertices,_[1])&&w.push(_[1]),w.length<2){var b=n._findSupports(o,s,r.neg(h.normal));i.contains(o.vertices,b[0])&&w.push(b[0]),w.length<2&&i.contains(o.vertices,b[1])&&w.push(b[1])}return w.length<1&&(w=[_[0]]),h.supports=w,h},n._overlapAxes=function(s,o,l){for(var c=r._temp[0],u=r._temp[1],f={overlap:Number.MAX_VALUE},h,d,p=0;p<l.length;p++){if(d=l[p],n._projectToAxis(c,s,d),n._projectToAxis(u,o,d),h=Math.min(c.max-u.min,u.max-c.min),h<=0)return f.overlap=h,f;h<f.overlap&&(f.overlap=h,f.axis=d,f.axisNumber=p)}return f},n._projectToAxis=function(s,o,l){for(var c=r.dot(o[0],l),u=c,f=1;f<o.length;f+=1){var h=r.dot(o[f],l);h>u?u=h:h<c&&(c=h)}s.min=c,s.max=u},n._findSupports=function(s,o,l){for(var c=Number.MAX_VALUE,u=r._temp[0],f=o.vertices,h=s.position,d,p,m,v,x=0;x<f.length;x++)p=f[x],u.x=p.x-h.x,u.y=p.y-h.y,d=-r.dot(l,u),d<c&&(c=d,m=p);var g=m.index-1>=0?m.index-1:f.length-1;p=f[g],u.x=p.x-h.x,u.y=p.y-h.y,c=-r.dot(l,u),v=p;var y=(m.index+1)%f.length;return p=f[y],u.x=p.x-h.x,u.y=p.y-h.y,d=-r.dot(l,u),d<c&&(v=p),[m,v]}})()},function(a,e,t){var n={};a.exports=n;var i=t(0);(function(){n._registry={},n.register=function(r){if(n.isPlugin(r)||i.warn("Plugin.register:",n.toString(r),"does not implement all required fields."),r.name in n._registry){var s=n._registry[r.name],o=n.versionParse(r.version).number,l=n.versionParse(s.version).number;o>l?(i.warn("Plugin.register:",n.toString(s),"was upgraded to",n.toString(r)),n._registry[r.name]=r):o<l?i.warn("Plugin.register:",n.toString(s),"can not be downgraded to",n.toString(r)):r!==s&&i.warn("Plugin.register:",n.toString(r),"is already registered to different plugin object")}else n._registry[r.name]=r;return r},n.resolve=function(r){return n._registry[n.dependencyParse(r).name]},n.toString=function(r){return typeof r=="string"?r:(r.name||"anonymous")+"@"+(r.version||r.range||"0.0.0")},n.isPlugin=function(r){return r&&r.name&&r.version&&r.install},n.isUsed=function(r,s){return r.used.indexOf(s)>-1},n.isFor=function(r,s){var o=r.for&&n.dependencyParse(r.for);return!r.for||s.name===o.name&&n.versionSatisfies(s.version,o.range)},n.use=function(r,s){if(r.uses=(r.uses||[]).concat(s||[]),r.uses.length===0){i.warn("Plugin.use:",n.toString(r),"does not specify any dependencies to install.");return}for(var o=n.dependencies(r),l=i.topologicalSort(o),c=[],u=0;u<l.length;u+=1)if(l[u]!==r.name){var f=n.resolve(l[u]);if(!f){c.push("\u274C "+l[u]);continue}n.isUsed(r,f.name)||(n.isFor(f,r)||(i.warn("Plugin.use:",n.toString(f),"is for",f.for,"but installed on",n.toString(r)+"."),f._warned=!0),f.install?f.install(r):(i.warn("Plugin.use:",n.toString(f),"does not specify an install function."),f._warned=!0),f._warned?(c.push("\u{1F536} "+n.toString(f)),delete f._warned):c.push("\u2705 "+n.toString(f)),r.used.push(f.name))}c.length>0&&i.info(c.join("  "))},n.dependencies=function(r,s){var o=n.dependencyParse(r),l=o.name;if(s=s||{},!(l in s)){r=n.resolve(r)||r,s[l]=i.map(r.uses||[],function(u){n.isPlugin(u)&&n.register(u);var f=n.dependencyParse(u),h=n.resolve(u);return h&&!n.versionSatisfies(h.version,f.range)?(i.warn("Plugin.dependencies:",n.toString(h),"does not satisfy",n.toString(f),"used by",n.toString(o)+"."),h._warned=!0,r._warned=!0):h||(i.warn("Plugin.dependencies:",n.toString(u),"used by",n.toString(o),"could not be resolved."),r._warned=!0),f.name});for(var c=0;c<s[l].length;c+=1)n.dependencies(s[l][c],s);return s}},n.dependencyParse=function(r){if(i.isString(r)){var s=/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-]+)?))?$/;return s.test(r)||i.warn("Plugin.dependencyParse:",r,"is not a valid dependency string."),{name:r.split("@")[0],range:r.split("@")[1]||"*"}}return{name:r.name,range:r.range||r.version}},n.versionParse=function(r){var s=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-]+)?$/;s.test(r)||i.warn("Plugin.versionParse:",r,"is not a valid version or range.");var o=s.exec(r),l=Number(o[4]),c=Number(o[5]),u=Number(o[6]);return{isRange:Boolean(o[1]||o[2]),version:o[3],range:r,operator:o[1]||o[2]||"",major:l,minor:c,patch:u,parts:[l,c,u],prerelease:o[7],number:l*1e8+c*1e4+u}},n.versionSatisfies=function(r,s){s=s||"*";var o=n.versionParse(s),l=n.versionParse(r);if(o.isRange){if(o.operator==="*"||r==="*")return!0;if(o.operator===">")return l.number>o.number;if(o.operator===">=")return l.number>=o.number;if(o.operator==="~")return l.major===o.major&&l.minor===o.minor&&l.patch>=o.patch;if(o.operator==="^")return o.major>0?l.major===o.major&&l.number>=o.number:o.minor>0?l.minor===o.minor&&l.patch>=o.patch:l.patch===o.patch}return r===s||r==="*"}})()},function(a,e,t){var n={};a.exports=n;var i=t(0),r=t(5),s=t(1),o=t(4),l=t(2),c=t(12);(function(){var u,f;typeof window!="undefined"&&(u=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(g){window.setTimeout(function(){g(i.now())},1e3/60)},f=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),n._goodFps=30,n._goodDelta=1e3/60,n.create=function(g){var y={controller:n,engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",hasBounds:!!g.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},_=i.extend(y,g);return _.canvas&&(_.canvas.width=_.options.width||_.canvas.width,_.canvas.height=_.options.height||_.canvas.height),_.mouse=g.mouse,_.engine=g.engine,_.canvas=_.canvas||p(_.options.width,_.options.height),_.context=_.canvas.getContext("2d"),_.textures={},_.bounds=_.bounds||{min:{x:0,y:0},max:{x:_.canvas.width,y:_.canvas.height}},_.options.pixelRatio!==1&&n.setPixelRatio(_,_.options.pixelRatio),i.isElement(_.element)?_.element.appendChild(_.canvas):_.canvas.parentNode||i.log("Render.create: options.element was undefined, render.canvas was created but not appended","warn"),_},n.run=function(g){(function y(_){g.frameRequestId=u(y),h(g,_),n.world(g,_),(g.options.showStats||g.options.showDebug)&&n.stats(g,g.context,_),(g.options.showPerformance||g.options.showDebug)&&n.performance(g,g.context,_)})()},n.stop=function(g){f(g.frameRequestId)},n.setPixelRatio=function(g,y){var _=g.options,w=g.canvas;y==="auto"&&(y=m(w)),_.pixelRatio=y,w.setAttribute("data-pixel-ratio",y),w.width=_.width*y,w.height=_.height*y,w.style.width=_.width+"px",w.style.height=_.height+"px"},n.lookAt=function(g,y,_,w){w=typeof w!="undefined"?w:!0,y=i.isArray(y)?y:[y],_=_||{x:0,y:0};for(var b={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},S=0;S<y.length;S+=1){var M=y[S],T=M.bounds?M.bounds.min:M.min||M.position||M,E=M.bounds?M.bounds.max:M.max||M.position||M;T&&E&&(T.x<b.min.x&&(b.min.x=T.x),E.x>b.max.x&&(b.max.x=E.x),T.y<b.min.y&&(b.min.y=T.y),E.y>b.max.y&&(b.max.y=E.y))}var A=b.max.x-b.min.x+2*_.x,I=b.max.y-b.min.y+2*_.y,C=g.canvas.height,R=g.canvas.width,D=R/C,F=A/I,O=1,U=1;F>D?U=F/D:O=D/F,g.options.hasBounds=!0,g.bounds.min.x=b.min.x,g.bounds.max.x=b.min.x+A*O,g.bounds.min.y=b.min.y,g.bounds.max.y=b.min.y+I*U,w&&(g.bounds.min.x+=A*.5-A*O*.5,g.bounds.max.x+=A*.5-A*O*.5,g.bounds.min.y+=I*.5-I*U*.5,g.bounds.max.y+=I*.5-I*U*.5),g.bounds.min.x-=_.x,g.bounds.max.x-=_.x,g.bounds.min.y-=_.y,g.bounds.max.y-=_.y,g.mouse&&(c.setScale(g.mouse,{x:(g.bounds.max.x-g.bounds.min.x)/g.canvas.width,y:(g.bounds.max.y-g.bounds.min.y)/g.canvas.height}),c.setOffset(g.mouse,g.bounds.min))},n.startViewTransform=function(g){var y=g.bounds.max.x-g.bounds.min.x,_=g.bounds.max.y-g.bounds.min.y,w=y/g.options.width,b=_/g.options.height;g.context.setTransform(g.options.pixelRatio/w,0,0,g.options.pixelRatio/b,0,0),g.context.translate(-g.bounds.min.x,-g.bounds.min.y)},n.endViewTransform=function(g){g.context.setTransform(g.options.pixelRatio,0,0,g.options.pixelRatio,0,0)},n.world=function(g,y){var _=i.now(),w=g.engine,b=w.world,S=g.canvas,M=g.context,T=g.options,E=g.timing,A=r.allBodies(b),I=r.allConstraints(b),C=T.wireframes?T.wireframeBackground:T.background,R=[],D=[],F,O={timestamp:w.timing.timestamp};if(o.trigger(g,"beforeRender",O),g.currentBackground!==C&&x(g,C),M.globalCompositeOperation="source-in",M.fillStyle="transparent",M.fillRect(0,0,S.width,S.height),M.globalCompositeOperation="source-over",T.hasBounds){for(F=0;F<A.length;F++){var U=A[F];s.overlaps(U.bounds,g.bounds)&&R.push(U)}for(F=0;F<I.length;F++){var j=I[F],Z=j.bodyA,K=j.bodyB,G=j.pointA,k=j.pointB;Z&&(G=l.add(Z.position,j.pointA)),K&&(k=l.add(K.position,j.pointB)),!(!G||!k)&&(s.contains(g.bounds,G)||s.contains(g.bounds,k))&&D.push(j)}n.startViewTransform(g),g.mouse&&(c.setScale(g.mouse,{x:(g.bounds.max.x-g.bounds.min.x)/g.options.width,y:(g.bounds.max.y-g.bounds.min.y)/g.options.height}),c.setOffset(g.mouse,g.bounds.min))}else D=I,R=A,g.options.pixelRatio!==1&&g.context.setTransform(g.options.pixelRatio,0,0,g.options.pixelRatio,0,0);!T.wireframes||w.enableSleeping&&T.showSleeping?n.bodies(g,R,M):(T.showConvexHulls&&n.bodyConvexHulls(g,R,M),n.bodyWireframes(g,R,M)),T.showBounds&&n.bodyBounds(g,R,M),(T.showAxes||T.showAngleIndicator)&&n.bodyAxes(g,R,M),T.showPositions&&n.bodyPositions(g,R,M),T.showVelocity&&n.bodyVelocity(g,R,M),T.showIds&&n.bodyIds(g,R,M),T.showSeparations&&n.separations(g,w.pairs.list,M),T.showCollisions&&n.collisions(g,w.pairs.list,M),T.showVertexNumbers&&n.vertexNumbers(g,R,M),T.showMousePosition&&n.mousePosition(g,g.mouse,M),n.constraints(D,M),T.showBroadphase&&n.grid(g,w.grid,M),T.hasBounds&&n.endViewTransform(g),o.trigger(g,"afterRender",O),E.lastElapsed=i.now()-_},n.stats=function(g,y,_){for(var w=g.engine,b=w.world,S=r.allBodies(b),M=0,T=55,E=44,A=0,I=0,C=0;C<S.length;C+=1)M+=S[C].parts.length;var R={Part:M,Body:S.length,Cons:r.allConstraints(b).length,Comp:r.allComposites(b).length,Pair:w.pairs.list.length};y.fillStyle="#0e0f19",y.fillRect(A,I,T*5.5,E),y.font="12px Arial",y.textBaseline="top",y.textAlign="right";for(var D in R){var F=R[D];y.fillStyle="#aaa",y.fillText(D,A+T,I+8),y.fillStyle="#eee",y.fillText(F,A+T,I+26),A+=T}},n.performance=function(g,y){var _=g.engine,w=g.timing,b=w.deltaHistory,S=w.elapsedHistory,M=w.timestampElapsedHistory,T=w.engineDeltaHistory,E=w.engineElapsedHistory,A=_.timing.lastDelta,I=d(b),C=d(S),R=d(T),D=d(E),F=d(M),O=F/I||0,U=1e3/I||0,j=4,Z=12,K=60,G=34,k=10,B=69;y.fillStyle="#0e0f19",y.fillRect(0,50,Z*4+K*5+22,G),n.status(y,k,B,K,j,b.length,Math.round(U)+" fps",U/n._goodFps,function(H){return b[H]/I-1}),n.status(y,k+Z+K,B,K,j,T.length,A.toFixed(2)+" dt",n._goodDelta/A,function(H){return T[H]/R-1}),n.status(y,k+(Z+K)*2,B,K,j,E.length,D.toFixed(2)+" ut",1-D/n._goodFps,function(H){return E[H]/D-1}),n.status(y,k+(Z+K)*3,B,K,j,S.length,C.toFixed(2)+" rt",1-C/n._goodFps,function(H){return S[H]/C-1}),n.status(y,k+(Z+K)*4,B,K,j,M.length,O.toFixed(2)+" x",O*O*O,function(H){return(M[H]/b[H]/O||0)-1})},n.status=function(g,y,_,w,b,S,M,T,E){g.strokeStyle="#888",g.fillStyle="#444",g.lineWidth=1,g.fillRect(y,_+7,w,1),g.beginPath(),g.moveTo(y,_+7-b*i.clamp(.4*E(0),-2,2));for(var A=0;A<w;A+=1)g.lineTo(y+A,_+7-(A<S?b*i.clamp(.4*E(A),-2,2):0));g.stroke(),g.fillStyle="hsl("+i.clamp(25+95*T,0,120)+",100%,60%)",g.fillRect(y,_-7,4,4),g.font="12px Arial",g.textBaseline="middle",g.textAlign="right",g.fillStyle="#eee",g.fillText(M,y+w,_-5)},n.constraints=function(g,y){for(var _=y,w=0;w<g.length;w++){var b=g[w];if(!(!b.render.visible||!b.pointA||!b.pointB)){var S=b.bodyA,M=b.bodyB,T,E;if(S?T=l.add(S.position,b.pointA):T=b.pointA,b.render.type==="pin")_.beginPath(),_.arc(T.x,T.y,3,0,2*Math.PI),_.closePath();else{if(M?E=l.add(M.position,b.pointB):E=b.pointB,_.beginPath(),_.moveTo(T.x,T.y),b.render.type==="spring")for(var A=l.sub(E,T),I=l.perp(l.normalise(A)),C=Math.ceil(i.clamp(b.length/5,12,20)),R,D=1;D<C;D+=1)R=D%2==0?1:-1,_.lineTo(T.x+A.x*(D/C)+I.x*R*4,T.y+A.y*(D/C)+I.y*R*4);_.lineTo(E.x,E.y)}b.render.lineWidth&&(_.lineWidth=b.render.lineWidth,_.strokeStyle=b.render.strokeStyle,_.stroke()),b.render.anchors&&(_.fillStyle=b.render.strokeStyle,_.beginPath(),_.arc(T.x,T.y,3,0,2*Math.PI),_.arc(E.x,E.y,3,0,2*Math.PI),_.closePath(),_.fill())}}},n.bodies=function(g,y,_){var w=_,b=g.engine,S=g.options,M=S.showInternalEdges||!S.wireframes,T,E,A,I;for(A=0;A<y.length;A++)if(T=y[A],!!T.render.visible){for(I=T.parts.length>1?1:0;I<T.parts.length;I++)if(E=T.parts[I],!!E.render.visible){if(S.showSleeping&&T.isSleeping?w.globalAlpha=.5*E.render.opacity:E.render.opacity!==1&&(w.globalAlpha=E.render.opacity),E.render.sprite&&E.render.sprite.texture&&!S.wireframes){var C=E.render.sprite,R=v(g,C.texture);w.translate(E.position.x,E.position.y),w.rotate(E.angle),w.drawImage(R,R.width*-C.xOffset*C.xScale,R.height*-C.yOffset*C.yScale,R.width*C.xScale,R.height*C.yScale),w.rotate(-E.angle),w.translate(-E.position.x,-E.position.y)}else{if(E.circleRadius)w.beginPath(),w.arc(E.position.x,E.position.y,E.circleRadius,0,2*Math.PI);else{w.beginPath(),w.moveTo(E.vertices[0].x,E.vertices[0].y);for(var D=1;D<E.vertices.length;D++)!E.vertices[D-1].isInternal||M?w.lineTo(E.vertices[D].x,E.vertices[D].y):w.moveTo(E.vertices[D].x,E.vertices[D].y),E.vertices[D].isInternal&&!M&&w.moveTo(E.vertices[(D+1)%E.vertices.length].x,E.vertices[(D+1)%E.vertices.length].y);w.lineTo(E.vertices[0].x,E.vertices[0].y),w.closePath()}S.wireframes?(w.lineWidth=1,w.strokeStyle="#bbb",w.stroke()):(w.fillStyle=E.render.fillStyle,E.render.lineWidth&&(w.lineWidth=E.render.lineWidth,w.strokeStyle=E.render.strokeStyle,w.stroke()),w.fill())}w.globalAlpha=1}}},n.bodyWireframes=function(g,y,_){var w=_,b=g.options.showInternalEdges,S,M,T,E,A;for(w.beginPath(),T=0;T<y.length;T++)if(S=y[T],!!S.render.visible)for(A=S.parts.length>1?1:0;A<S.parts.length;A++){for(M=S.parts[A],w.moveTo(M.vertices[0].x,M.vertices[0].y),E=1;E<M.vertices.length;E++)!M.vertices[E-1].isInternal||b?w.lineTo(M.vertices[E].x,M.vertices[E].y):w.moveTo(M.vertices[E].x,M.vertices[E].y),M.vertices[E].isInternal&&!b&&w.moveTo(M.vertices[(E+1)%M.vertices.length].x,M.vertices[(E+1)%M.vertices.length].y);w.lineTo(M.vertices[0].x,M.vertices[0].y)}w.lineWidth=1,w.strokeStyle="#bbb",w.stroke()},n.bodyConvexHulls=function(g,y,_){var w=_,b,S,M,T,E;for(w.beginPath(),M=0;M<y.length;M++)if(b=y[M],!(!b.render.visible||b.parts.length===1)){for(w.moveTo(b.vertices[0].x,b.vertices[0].y),T=1;T<b.vertices.length;T++)w.lineTo(b.vertices[T].x,b.vertices[T].y);w.lineTo(b.vertices[0].x,b.vertices[0].y)}w.lineWidth=1,w.strokeStyle="rgba(255,255,255,0.2)",w.stroke()},n.vertexNumbers=function(g,y,_){var w=_,b,S,M;for(b=0;b<y.length;b++){var T=y[b].parts;for(M=T.length>1?1:0;M<T.length;M++){var E=T[M];for(S=0;S<E.vertices.length;S++)w.fillStyle="rgba(255,255,255,0.2)",w.fillText(b+"_"+S,E.position.x+(E.vertices[S].x-E.position.x)*.8,E.position.y+(E.vertices[S].y-E.position.y)*.8)}}},n.mousePosition=function(g,y,_){var w=_;w.fillStyle="rgba(255,255,255,0.8)",w.fillText(y.position.x+"  "+y.position.y,y.position.x+5,y.position.y-5)},n.bodyBounds=function(g,y,_){var w=_,b=g.engine,S=g.options;w.beginPath();for(var M=0;M<y.length;M++){var T=y[M];if(T.render.visible)for(var E=y[M].parts,A=E.length>1?1:0;A<E.length;A++){var I=E[A];w.rect(I.bounds.min.x,I.bounds.min.y,I.bounds.max.x-I.bounds.min.x,I.bounds.max.y-I.bounds.min.y)}}S.wireframes?w.strokeStyle="rgba(255,255,255,0.08)":w.strokeStyle="rgba(0,0,0,0.1)",w.lineWidth=1,w.stroke()},n.bodyAxes=function(g,y,_){var w=_,b=g.engine,S=g.options,M,T,E,A;for(w.beginPath(),T=0;T<y.length;T++){var I=y[T],C=I.parts;if(!!I.render.visible)if(S.showAxes)for(E=C.length>1?1:0;E<C.length;E++)for(M=C[E],A=0;A<M.axes.length;A++){var R=M.axes[A];w.moveTo(M.position.x,M.position.y),w.lineTo(M.position.x+R.x*20,M.position.y+R.y*20)}else for(E=C.length>1?1:0;E<C.length;E++)for(M=C[E],A=0;A<M.axes.length;A++)w.moveTo(M.position.x,M.position.y),w.lineTo((M.vertices[0].x+M.vertices[M.vertices.length-1].x)/2,(M.vertices[0].y+M.vertices[M.vertices.length-1].y)/2)}S.wireframes?(w.strokeStyle="indianred",w.lineWidth=1):(w.strokeStyle="rgba(255, 255, 255, 0.4)",w.globalCompositeOperation="overlay",w.lineWidth=2),w.stroke(),w.globalCompositeOperation="source-over"},n.bodyPositions=function(g,y,_){var w=_,b=g.engine,S=g.options,M,T,E,A;for(w.beginPath(),E=0;E<y.length;E++)if(M=y[E],!!M.render.visible)for(A=0;A<M.parts.length;A++)T=M.parts[A],w.arc(T.position.x,T.position.y,3,0,2*Math.PI,!1),w.closePath();for(S.wireframes?w.fillStyle="indianred":w.fillStyle="rgba(0,0,0,0.5)",w.fill(),w.beginPath(),E=0;E<y.length;E++)M=y[E],M.render.visible&&(w.arc(M.positionPrev.x,M.positionPrev.y,2,0,2*Math.PI,!1),w.closePath());w.fillStyle="rgba(255,165,0,0.8)",w.fill()},n.bodyVelocity=function(g,y,_){var w=_;w.beginPath();for(var b=0;b<y.length;b++){var S=y[b];!S.render.visible||(w.moveTo(S.position.x,S.position.y),w.lineTo(S.position.x+(S.position.x-S.positionPrev.x)*2,S.position.y+(S.position.y-S.positionPrev.y)*2))}w.lineWidth=3,w.strokeStyle="cornflowerblue",w.stroke()},n.bodyIds=function(g,y,_){var w=_,b,S;for(b=0;b<y.length;b++)if(!!y[b].render.visible){var M=y[b].parts;for(S=M.length>1?1:0;S<M.length;S++){var T=M[S];w.font="12px Arial",w.fillStyle="rgba(255,255,255,0.5)",w.fillText(T.id,T.position.x+10,T.position.y-10)}}},n.collisions=function(g,y,_){var w=_,b=g.options,S,M,T,E,A,I,C;for(w.beginPath(),I=0;I<y.length;I++)if(S=y[I],!!S.isActive)for(M=S.collision,C=0;C<S.activeContacts.length;C++){var R=S.activeContacts[C],D=R.vertex;w.rect(D.x-1.5,D.y-1.5,3.5,3.5)}for(b.wireframes?w.fillStyle="rgba(255,255,255,0.7)":w.fillStyle="orange",w.fill(),w.beginPath(),I=0;I<y.length;I++)if(S=y[I],!!S.isActive&&(M=S.collision,S.activeContacts.length>0)){var F=S.activeContacts[0].vertex.x,O=S.activeContacts[0].vertex.y;S.activeContacts.length===2&&(F=(S.activeContacts[0].vertex.x+S.activeContacts[1].vertex.x)/2,O=(S.activeContacts[0].vertex.y+S.activeContacts[1].vertex.y)/2),M.bodyB===M.supports[0].body||M.bodyA.isStatic===!0?w.moveTo(F-M.normal.x*8,O-M.normal.y*8):w.moveTo(F+M.normal.x*8,O+M.normal.y*8),w.lineTo(F,O)}b.wireframes?w.strokeStyle="rgba(255,165,0,0.7)":w.strokeStyle="orange",w.lineWidth=1,w.stroke()},n.separations=function(g,y,_){var w=_,b=g.options,S,M,T,E,A,I,C;for(w.beginPath(),I=0;I<y.length;I++)if(S=y[I],!!S.isActive){M=S.collision,E=M.bodyA,A=M.bodyB;var R=1;!A.isStatic&&!E.isStatic&&(R=.5),A.isStatic&&(R=0),w.moveTo(A.position.x,A.position.y),w.lineTo(A.position.x-M.penetration.x*R,A.position.y-M.penetration.y*R),R=1,!A.isStatic&&!E.isStatic&&(R=.5),E.isStatic&&(R=0),w.moveTo(E.position.x,E.position.y),w.lineTo(E.position.x+M.penetration.x*R,E.position.y+M.penetration.y*R)}b.wireframes?w.strokeStyle="rgba(255,165,0,0.5)":w.strokeStyle="orange",w.stroke()},n.grid=function(g,y,_){var w=_,b=g.options;b.wireframes?w.strokeStyle="rgba(255,180,0,0.1)":w.strokeStyle="rgba(255,180,0,0.5)",w.beginPath();for(var S=i.keys(y.buckets),M=0;M<S.length;M++){var T=S[M];if(!(y.buckets[T].length<2)){var E=T.split(/C|R/);w.rect(.5+parseInt(E[1],10)*y.bucketWidth,.5+parseInt(E[2],10)*y.bucketHeight,y.bucketWidth,y.bucketHeight)}}w.lineWidth=1,w.stroke()},n.inspector=function(g,y){var _=g.engine,w=g.selected,b=g.render,S=b.options,M;if(S.hasBounds){var T=b.bounds.max.x-b.bounds.min.x,E=b.bounds.max.y-b.bounds.min.y,A=T/b.options.width,I=E/b.options.height;y.scale(1/A,1/I),y.translate(-b.bounds.min.x,-b.bounds.min.y)}for(var C=0;C<w.length;C++){var R=w[C].data;switch(y.translate(.5,.5),y.lineWidth=1,y.strokeStyle="rgba(255,165,0,0.9)",y.setLineDash([1,2]),R.type){case"body":M=R.bounds,y.beginPath(),y.rect(Math.floor(M.min.x-3),Math.floor(M.min.y-3),Math.floor(M.max.x-M.min.x+6),Math.floor(M.max.y-M.min.y+6)),y.closePath(),y.stroke();break;case"constraint":var D=R.pointA;R.bodyA&&(D=R.pointB),y.beginPath(),y.arc(D.x,D.y,10,0,2*Math.PI),y.closePath(),y.stroke();break}y.setLineDash([]),y.translate(-.5,-.5)}g.selectStart!==null&&(y.translate(.5,.5),y.lineWidth=1,y.strokeStyle="rgba(255,165,0,0.6)",y.fillStyle="rgba(255,165,0,0.1)",M=g.selectBounds,y.beginPath(),y.rect(Math.floor(M.min.x),Math.floor(M.min.y),Math.floor(M.max.x-M.min.x),Math.floor(M.max.y-M.min.y)),y.closePath(),y.stroke(),y.fill(),y.translate(-.5,-.5)),S.hasBounds&&y.setTransform(1,0,0,1,0,0)};var h=function(g,y){var _=g.engine,w=g.timing,b=w.historySize,S=_.timing.timestamp;w.delta=y-w.lastTime||n._goodDelta,w.lastTime=y,w.timestampElapsed=S-w.lastTimestamp||0,w.lastTimestamp=S,w.deltaHistory.unshift(w.delta),w.deltaHistory.length=Math.min(w.deltaHistory.length,b),w.engineDeltaHistory.unshift(_.timing.lastDelta),w.engineDeltaHistory.length=Math.min(w.engineDeltaHistory.length,b),w.timestampElapsedHistory.unshift(w.timestampElapsed),w.timestampElapsedHistory.length=Math.min(w.timestampElapsedHistory.length,b),w.engineElapsedHistory.unshift(_.timing.lastElapsed),w.engineElapsedHistory.length=Math.min(w.engineElapsedHistory.length,b),w.elapsedHistory.unshift(w.lastElapsed),w.elapsedHistory.length=Math.min(w.elapsedHistory.length,b)},d=function(g){for(var y=0,_=0;_<g.length;_+=1)y+=g[_];return y/g.length||0},p=function(g,y){var _=document.createElement("canvas");return _.width=g,_.height=y,_.oncontextmenu=function(){return!1},_.onselectstart=function(){return!1},_},m=function(g){var y=g.getContext("2d"),_=window.devicePixelRatio||1,w=y.webkitBackingStorePixelRatio||y.mozBackingStorePixelRatio||y.msBackingStorePixelRatio||y.oBackingStorePixelRatio||y.backingStorePixelRatio||1;return _/w},v=function(g,y){var _=g.textures[y];return _||(_=g.textures[y]=new Image,_.src=y,_)},x=function(g,y){var _=y;/(jpg|gif|png)$/.test(y)&&(_="url("+y+")"),g.canvas.style.background=_,g.canvas.style.backgroundSize="contain",g.currentBackground=y}})()},function(a,e){var t={};a.exports=t,function(){t.create=function(n){return{id:t.id(n),vertex:n,normalImpulse:0,tangentImpulse:0}},t.id=function(n){return n.body.id+"_"+n.index}}()},function(a,e,t){var n={};a.exports=n;var i=t(7),r=t(19),s=t(13),o=t(20),l=t(21),c=t(4),u=t(5),f=t(8),h=t(0),d=t(6);(function(){n.create=function(p){p=p||{};var m={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},grid:null,gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0}},v=h.extend(m,p);return v.world=p.world||u.create({label:"World"}),v.grid=l.create(p.grid||p.broadphase),v.pairs=o.create(),v.world.gravity=v.gravity,v.broadphase=v.grid,v.metrics={},v},n.update=function(p,m,v){var x=h.now();m=m||1e3/60,v=v||1;var g=p.world,y=p.timing,_=p.grid,w=[],b;y.timestamp+=m*y.timeScale,y.lastDelta=m*y.timeScale;var S={timestamp:y.timestamp};c.trigger(p,"beforeUpdate",S);var M=u.allBodies(g),T=u.allConstraints(g);for(p.enableSleeping&&i.update(M,y.timeScale),n._bodiesApplyGravity(M,p.gravity),n._bodiesUpdate(M,m,y.timeScale,v,g.bounds),f.preSolveAll(M),b=0;b<p.constraintIterations;b++)f.solveAll(T,y.timeScale);f.postSolveAll(M),g.isModified&&l.clear(_),l.update(_,M,p,g.isModified),w=_.pairsList,g.isModified&&u.setModified(g,!1,!1,!0);var E=s.collisions(w,p),A=p.pairs,I=y.timestamp;for(o.update(A,E,I),o.removeOld(A,I),p.enableSleeping&&i.afterCollisions(A.list,y.timeScale),A.collisionStart.length>0&&c.trigger(p,"collisionStart",{pairs:A.collisionStart}),r.preSolvePosition(A.list),b=0;b<p.positionIterations;b++)r.solvePosition(A.list,y.timeScale);for(r.postSolvePosition(M),f.preSolveAll(M),b=0;b<p.constraintIterations;b++)f.solveAll(T,y.timeScale);for(f.postSolveAll(M),r.preSolveVelocity(A.list),b=0;b<p.velocityIterations;b++)r.solveVelocity(A.list,y.timeScale);return A.collisionActive.length>0&&c.trigger(p,"collisionActive",{pairs:A.collisionActive}),A.collisionEnd.length>0&&c.trigger(p,"collisionEnd",{pairs:A.collisionEnd}),n._bodiesClearForces(M),c.trigger(p,"afterUpdate",S),p.timing.lastElapsed=h.now()-x,p},n.merge=function(p,m){if(h.extend(p,m),m.world){p.world=m.world,n.clear(p);for(var v=u.allBodies(p.world),x=0;x<v.length;x++){var g=v[x];i.set(g,!1),g.id=h.nextId()}}},n.clear=function(p){var m=p.world,v=u.allBodies(m);o.clear(p.pairs),l.clear(p.grid),l.update(p.grid,v,p,!0)},n._bodiesClearForces=function(p){for(var m=0;m<p.length;m++){var v=p[m];v.force.x=0,v.force.y=0,v.torque=0}},n._bodiesApplyGravity=function(p,m){var v=typeof m.scale!="undefined"?m.scale:.001;if(!(m.x===0&&m.y===0||v===0))for(var x=0;x<p.length;x++){var g=p[x];g.isStatic||g.isSleeping||(g.force.y+=g.mass*m.y*v,g.force.x+=g.mass*m.x*v)}},n._bodiesUpdate=function(p,m,v,x,g){for(var y=0;y<p.length;y++){var _=p[y];_.isStatic||_.isSleeping||d.update(_,m,v,x)}}})()},function(a,e,t){var n={};a.exports=n;var i=t(3),r=t(2),s=t(0),o=t(1);(function(){n._restingThresh=4,n._restingThreshTangent=6,n._positionDampen=.9,n._positionWarming=.8,n._frictionNormalMultiplier=5,n.preSolvePosition=function(l){var c,u,f;for(c=0;c<l.length;c++)u=l[c],!!u.isActive&&(f=u.activeContacts.length,u.collision.parentA.totalContacts+=f,u.collision.parentB.totalContacts+=f)},n.solvePosition=function(l,c){var u,f,h,d,p,m,v,x,g,y={},_=r._temp[0],w=r._temp[1],b=r._temp[2],S=r._temp[3];for(u=0;u<l.length;u++)f=l[u],!(!f.isActive||f.isSensor)&&(h=f.collision,d=h.parentA,p=h.parentB,m=h.normal,v=r.sub(r.add(p.positionImpulse,p.position,_),r.add(d.positionImpulse,r.sub(p.position,h.penetration,w),b),S),f.separation=r.dot(m,v));for(u=0;u<l.length;u++)f=l[u],!(!f.isActive||f.isSensor)&&(h=f.collision,d=h.parentA,p=h.parentB,m=h.normal,g=(f.separation-f.slop)*c,(d.isStatic||p.isStatic)&&(g*=2),d.isStatic||d.isSleeping||(x=n._positionDampen/d.totalContacts,d.positionImpulse.x+=m.x*g*x,d.positionImpulse.y+=m.y*g*x),p.isStatic||p.isSleeping||(x=n._positionDampen/p.totalContacts,p.positionImpulse.x-=m.x*g*x,p.positionImpulse.y-=m.y*g*x))},n.postSolvePosition=function(l){for(var c=0;c<l.length;c++){var u=l[c];if(u.totalContacts=0,u.positionImpulse.x!==0||u.positionImpulse.y!==0){for(var f=0;f<u.parts.length;f++){var h=u.parts[f];i.translate(h.vertices,u.positionImpulse),o.update(h.bounds,h.vertices,u.velocity),h.position.x+=u.positionImpulse.x,h.position.y+=u.positionImpulse.y}u.positionPrev.x+=u.positionImpulse.x,u.positionPrev.y+=u.positionImpulse.y,r.dot(u.positionImpulse,u.velocity)<0?(u.positionImpulse.x=0,u.positionImpulse.y=0):(u.positionImpulse.x*=n._positionWarming,u.positionImpulse.y*=n._positionWarming)}}},n.preSolveVelocity=function(l){var c,u,f,h,d,p,m,v,x,g,y,_,w,b,S=r._temp[0],M=r._temp[1];for(c=0;c<l.length;c++)if(f=l[c],!(!f.isActive||f.isSensor))for(h=f.activeContacts,d=f.collision,p=d.parentA,m=d.parentB,v=d.normal,x=d.tangent,u=0;u<h.length;u++)g=h[u],y=g.vertex,_=g.normalImpulse,w=g.tangentImpulse,(_!==0||w!==0)&&(S.x=v.x*_+x.x*w,S.y=v.y*_+x.y*w,p.isStatic||p.isSleeping||(b=r.sub(y,p.position,M),p.positionPrev.x+=S.x*p.inverseMass,p.positionPrev.y+=S.y*p.inverseMass,p.anglePrev+=r.cross(b,S)*p.inverseInertia),m.isStatic||m.isSleeping||(b=r.sub(y,m.position,M),m.positionPrev.x-=S.x*m.inverseMass,m.positionPrev.y-=S.y*m.inverseMass,m.anglePrev-=r.cross(b,S)*m.inverseInertia))},n.solveVelocity=function(l,c){for(var u=c*c,f=r._temp[0],h=r._temp[1],d=r._temp[2],p=r._temp[3],m=r._temp[4],v=r._temp[5],x=0;x<l.length;x++){var g=l[x];if(!(!g.isActive||g.isSensor)){var y=g.collision,_=y.parentA,w=y.parentB,b=y.normal,S=y.tangent,M=g.activeContacts,T=1/M.length;_.velocity.x=_.position.x-_.positionPrev.x,_.velocity.y=_.position.y-_.positionPrev.y,w.velocity.x=w.position.x-w.positionPrev.x,w.velocity.y=w.position.y-w.positionPrev.y,_.angularVelocity=_.angle-_.anglePrev,w.angularVelocity=w.angle-w.anglePrev;for(var E=0;E<M.length;E++){var A=M[E],I=A.vertex,C=r.sub(I,_.position,h),R=r.sub(I,w.position,d),D=r.add(_.velocity,r.mult(r.perp(C),_.angularVelocity),p),F=r.add(w.velocity,r.mult(r.perp(R),w.angularVelocity),m),O=r.sub(D,F,v),U=r.dot(b,O),j=r.dot(S,O),Z=Math.abs(j),K=s.sign(j),G=(1+g.restitution)*U,k=s.clamp(g.separation+U,0,1)*n._frictionNormalMultiplier,B=j,H=1/0;Z>g.friction*g.frictionStatic*k*u&&(H=Z,B=s.clamp(g.friction*K*u,-H,H));var W=r.cross(C,b),X=r.cross(R,b),te=T/(_.inverseMass+w.inverseMass+_.inverseInertia*W*W+w.inverseInertia*X*X);if(G*=te,B*=te,U<0&&U*U>n._restingThresh*u)A.normalImpulse=0;else{var he=A.normalImpulse;A.normalImpulse=Math.min(A.normalImpulse+G,0),G=A.normalImpulse-he}if(j*j>n._restingThreshTangent*u)A.tangentImpulse=0;else{var ae=A.tangentImpulse;A.tangentImpulse=s.clamp(A.tangentImpulse+B,-H,H),B=A.tangentImpulse-ae}f.x=b.x*G+S.x*B,f.y=b.y*G+S.y*B,_.isStatic||_.isSleeping||(_.positionPrev.x+=f.x*_.inverseMass,_.positionPrev.y+=f.y*_.inverseMass,_.anglePrev+=r.cross(C,f)*_.inverseInertia),w.isStatic||w.isSleeping||(w.positionPrev.x-=f.x*w.inverseMass,w.positionPrev.y-=f.y*w.inverseMass,w.anglePrev-=r.cross(R,f)*w.inverseInertia)}}}}})()},function(a,e,t){var n={};a.exports=n;var i=t(9),r=t(0);(function(){n._pairMaxIdleLife=1e3,n.create=function(s){return r.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},s)},n.update=function(s,o,l){var c=s.list,u=s.table,f=s.collisionStart,h=s.collisionEnd,d=s.collisionActive,p,m,v,x;for(f.length=0,h.length=0,d.length=0,x=0;x<c.length;x++)c[x].confirmedActive=!1;for(x=0;x<o.length;x++)p=o[x],p.collided&&(m=i.id(p.bodyA,p.bodyB),v=u[m],v?(v.isActive?d.push(v):f.push(v),i.update(v,p,l),v.confirmedActive=!0):(v=i.create(p,l),u[m]=v,f.push(v),c.push(v)));for(x=0;x<c.length;x++)v=c[x],v.isActive&&!v.confirmedActive&&(i.setActive(v,!1,l),h.push(v))},n.removeOld=function(s,o){var l=s.list,c=s.table,u=[],f,h,d,p;for(p=0;p<l.length;p++){if(f=l[p],h=f.collision,h.bodyA.isSleeping||h.bodyB.isSleeping){f.timeUpdated=o;continue}o-f.timeUpdated>n._pairMaxIdleLife&&u.push(p)}for(p=0;p<u.length;p++)d=u[p]-p,f=l[d],delete c[f.id],l.splice(d,1)},n.clear=function(s){return s.table={},s.list.length=0,s.collisionStart.length=0,s.collisionActive.length=0,s.collisionEnd.length=0,s}})()},function(a,e,t){var n={};a.exports=n;var i=t(9),r=t(0);(function(){n.create=function(s){var o={buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return r.extend(o,s)},n.update=function(s,o,l,c){var u,f,h,d=l.world,p=s.buckets,m,v,x=!1;for(u=0;u<o.length;u++){var g=o[u];if(!(g.isSleeping&&!c)&&!(d.bounds&&(g.bounds.max.x<d.bounds.min.x||g.bounds.min.x>d.bounds.max.x||g.bounds.max.y<d.bounds.min.y||g.bounds.min.y>d.bounds.max.y))){var y=n._getRegion(s,g);if(!g.region||y.id!==g.region.id||c){(!g.region||c)&&(g.region=y);var _=n._regionUnion(y,g.region);for(f=_.startCol;f<=_.endCol;f++)for(h=_.startRow;h<=_.endRow;h++){v=n._getBucketId(f,h),m=p[v];var w=f>=y.startCol&&f<=y.endCol&&h>=y.startRow&&h<=y.endRow,b=f>=g.region.startCol&&f<=g.region.endCol&&h>=g.region.startRow&&h<=g.region.endRow;!w&&b&&b&&m&&n._bucketRemoveBody(s,m,g),(g.region===y||w&&!b||c)&&(m||(m=n._createBucket(p,v)),n._bucketAddBody(s,m,g))}g.region=y,x=!0}}}x&&(s.pairsList=n._createActivePairsList(s))},n.clear=function(s){s.buckets={},s.pairs={},s.pairsList=[]},n._regionUnion=function(s,o){var l=Math.min(s.startCol,o.startCol),c=Math.max(s.endCol,o.endCol),u=Math.min(s.startRow,o.startRow),f=Math.max(s.endRow,o.endRow);return n._createRegion(l,c,u,f)},n._getRegion=function(s,o){var l=o.bounds,c=Math.floor(l.min.x/s.bucketWidth),u=Math.floor(l.max.x/s.bucketWidth),f=Math.floor(l.min.y/s.bucketHeight),h=Math.floor(l.max.y/s.bucketHeight);return n._createRegion(c,u,f,h)},n._createRegion=function(s,o,l,c){return{id:s+","+o+","+l+","+c,startCol:s,endCol:o,startRow:l,endRow:c}},n._getBucketId=function(s,o){return"C"+s+"R"+o},n._createBucket=function(s,o){var l=s[o]=[];return l},n._bucketAddBody=function(s,o,l){for(var c=0;c<o.length;c++){var u=o[c];if(!(l.id===u.id||l.isStatic&&u.isStatic)){var f=i.id(l,u),h=s.pairs[f];h?h[2]+=1:s.pairs[f]=[l,u,1]}}o.push(l)},n._bucketRemoveBody=function(s,o,l){o.splice(r.indexOf(o,l),1);for(var c=0;c<o.length;c++){var u=o[c],f=i.id(l,u),h=s.pairs[f];h&&(h[2]-=1)}},n._createActivePairsList=function(s){var o,l,c=[];o=r.keys(s.pairs);for(var u=0;u<o.length;u++)l=s.pairs[o[u]],l[2]>0?c.push(l):delete s.pairs[o[u]];return c}})()},function(a,e,t){var n=a.exports=t(23);n.Axes=t(10),n.Bodies=t(11),n.Body=t(6),n.Bounds=t(1),n.Common=t(0),n.Composite=t(5),n.Composites=t(24),n.Constraint=t(8),n.Contact=t(17),n.Detector=t(13),n.Engine=t(18),n.Events=t(4),n.Grid=t(21),n.Mouse=t(12),n.MouseConstraint=t(25),n.Pair=t(9),n.Pairs=t(20),n.Plugin=t(15),n.Query=t(26),n.Render=t(16),n.Resolver=t(19),n.Runner=t(27),n.SAT=t(14),n.Sleeping=t(7),n.Svg=t(28),n.Vector=t(2),n.Vertices=t(3),n.World=t(29),n.Engine.run=n.Runner.run,n.Common.deprecated(n.Engine,"run","Engine.run \u27A4 use Matter.Runner.run(engine) instead")},function(a,e,t){var n={};a.exports=n;var i=t(15),r=t(0);(function(){n.name="matter-js",n.version="0.17.1",n.uses=[],n.used=[],n.use=function(){i.use(n,Array.prototype.slice.call(arguments))},n.before=function(s,o){return s=s.replace(/^Matter./,""),r.chainPathBefore(n,s,o)},n.after=function(s,o){return s=s.replace(/^Matter./,""),r.chainPathAfter(n,s,o)}})()},function(a,e,t){var n={};a.exports=n;var i=t(5),r=t(8),s=t(0),o=t(6),l=t(11),c=s.deprecated;(function(){n.stack=function(u,f,h,d,p,m,v){for(var x=i.create({label:"Stack"}),g=u,y=f,_,w=0,b=0;b<d;b++){for(var S=0,M=0;M<h;M++){var T=v(g,y,M,b,_,w);if(T){var E=T.bounds.max.y-T.bounds.min.y,A=T.bounds.max.x-T.bounds.min.x;E>S&&(S=E),o.translate(T,{x:A*.5,y:E*.5}),g=T.bounds.max.x+p,i.addBody(x,T),_=T,w+=1}else g+=p}y+=S+m,g=u}return x},n.chain=function(u,f,h,d,p,m){for(var v=u.bodies,x=1;x<v.length;x++){var g=v[x-1],y=v[x],_=g.bounds.max.y-g.bounds.min.y,w=g.bounds.max.x-g.bounds.min.x,b=y.bounds.max.y-y.bounds.min.y,S=y.bounds.max.x-y.bounds.min.x,M={bodyA:g,pointA:{x:w*f,y:_*h},bodyB:y,pointB:{x:S*d,y:b*p}},T=s.extend(M,m);i.addConstraint(u,r.create(T))}return u.label+=" Chain",u},n.mesh=function(u,f,h,d,p){var m=u.bodies,v,x,g,y,_;for(v=0;v<h;v++){for(x=1;x<f;x++)g=m[x-1+v*f],y=m[x+v*f],i.addConstraint(u,r.create(s.extend({bodyA:g,bodyB:y},p)));if(v>0)for(x=0;x<f;x++)g=m[x+(v-1)*f],y=m[x+v*f],i.addConstraint(u,r.create(s.extend({bodyA:g,bodyB:y},p))),d&&x>0&&(_=m[x-1+(v-1)*f],i.addConstraint(u,r.create(s.extend({bodyA:_,bodyB:y},p)))),d&&x<f-1&&(_=m[x+1+(v-1)*f],i.addConstraint(u,r.create(s.extend({bodyA:_,bodyB:y},p))))}return u.label+=" Mesh",u},n.pyramid=function(u,f,h,d,p,m,v){return n.stack(u,f,h,d,p,m,function(x,g,y,_,w,b){var S=Math.min(d,Math.ceil(h/2)),M=w?w.bounds.max.x-w.bounds.min.x:0;if(!(_>S)){_=S-_;var T=_,E=h-1-_;if(!(y<T||y>E)){b===1&&o.translate(w,{x:(y+(h%2==1?1:-1))*M,y:0});var A=w?y*M:0;return v(u+A+y*p,g,y,_,w,b)}}})},n.newtonsCradle=function(u,f,h,d,p){for(var m=i.create({label:"Newtons Cradle"}),v=0;v<h;v++){var x=1.9,g=l.circle(u+v*(d*x),f+p,d,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),y=r.create({pointA:{x:u+v*(d*x),y:f},bodyB:g});i.addBody(m,g),i.addConstraint(m,y)}return m},c(n,"newtonsCradle","Composites.newtonsCradle \u27A4 moved to newtonsCradle example"),n.car=function(u,f,h,d,p){var m=o.nextGroup(!0),v=20,x=-h*.5+v,g=h*.5-v,y=0,_=i.create({label:"Car"}),w=l.rectangle(u,f,h,d,{collisionFilter:{group:m},chamfer:{radius:d*.5},density:2e-4}),b=l.circle(u+x,f+y,p,{collisionFilter:{group:m},friction:.8}),S=l.circle(u+g,f+y,p,{collisionFilter:{group:m},friction:.8}),M=r.create({bodyB:w,pointB:{x,y},bodyA:b,stiffness:1,length:0}),T=r.create({bodyB:w,pointB:{x:g,y},bodyA:S,stiffness:1,length:0});return i.addBody(_,w),i.addBody(_,b),i.addBody(_,S),i.addConstraint(_,M),i.addConstraint(_,T),_},c(n,"car","Composites.car \u27A4 moved to car example"),n.softBody=function(u,f,h,d,p,m,v,x,g,y){g=s.extend({inertia:1/0},g),y=s.extend({stiffness:.2,render:{type:"line",anchors:!1}},y);var _=n.stack(u,f,h,d,p,m,function(w,b){return l.circle(w,b,x,g)});return n.mesh(_,h,d,v,y),_.label="Soft Body",_},c(n,"softBody","Composites.softBody \u27A4 moved to softBody and cloth examples")})()},function(a,e,t){var n={};a.exports=n;var i=t(3),r=t(7),s=t(12),o=t(4),l=t(13),c=t(8),u=t(5),f=t(0),h=t(1);(function(){n.create=function(d,p){var m=(d?d.mouse:null)||(p?p.mouse:null);m||(d&&d.render&&d.render.canvas?m=s.create(d.render.canvas):p&&p.element?m=s.create(p.element):(m=s.create(),f.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var v=c.create({label:"Mouse Constraint",pointA:m.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),x={type:"mouseConstraint",mouse:m,element:null,body:null,constraint:v,collisionFilter:{category:1,mask:4294967295,group:0}},g=f.extend(x,p);return o.on(d,"beforeUpdate",function(){var y=u.allBodies(d.world);n.update(g,y),n._triggerEvents(g)}),g},n.update=function(d,p){var m=d.mouse,v=d.constraint,x=d.body;if(m.button===0){if(v.bodyB)r.set(v.bodyB,!1),v.pointA=m.position;else for(var g=0;g<p.length;g++)if(x=p[g],h.contains(x.bounds,m.position)&&l.canCollide(x.collisionFilter,d.collisionFilter))for(var y=x.parts.length>1?1:0;y<x.parts.length;y++){var _=x.parts[y];if(i.contains(_.vertices,m.position)){v.pointA=m.position,v.bodyB=d.body=x,v.pointB={x:m.position.x-x.position.x,y:m.position.y-x.position.y},v.angleB=x.angle,r.set(x,!1),o.trigger(d,"startdrag",{mouse:m,body:x});break}}}else v.bodyB=d.body=null,v.pointB=null,x&&o.trigger(d,"enddrag",{mouse:m,body:x})},n._triggerEvents=function(d){var p=d.mouse,m=p.sourceEvents;m.mousemove&&o.trigger(d,"mousemove",{mouse:p}),m.mousedown&&o.trigger(d,"mousedown",{mouse:p}),m.mouseup&&o.trigger(d,"mouseup",{mouse:p}),s.clearSourceEvents(p)}})()},function(a,e,t){var n={};a.exports=n;var i=t(2),r=t(14),s=t(1),o=t(11),l=t(3);(function(){n.collides=function(c,u){for(var f=[],h=0;h<u.length;h++){var d=u[h];if(s.overlaps(d.bounds,c.bounds))for(var p=d.parts.length===1?0:1;p<d.parts.length;p++){var m=d.parts[p];if(s.overlaps(m.bounds,c.bounds)){var v=r.collides(m,c);if(v.collided){f.push(v);break}}}}return f},n.ray=function(c,u,f,h){h=h||1e-100;for(var d=i.angle(u,f),p=i.magnitude(i.sub(u,f)),m=(f.x+u.x)*.5,v=(f.y+u.y)*.5,x=o.rectangle(m,v,p,h,{angle:d}),g=n.collides(x,c),y=0;y<g.length;y+=1){var _=g[y];_.body=_.bodyB=_.bodyA}return g},n.region=function(c,u,f){for(var h=[],d=0;d<c.length;d++){var p=c[d],m=s.overlaps(p.bounds,u);(m&&!f||!m&&f)&&h.push(p)}return h},n.point=function(c,u){for(var f=[],h=0;h<c.length;h++){var d=c[h];if(s.contains(d.bounds,u))for(var p=d.parts.length===1?0:1;p<d.parts.length;p++){var m=d.parts[p];if(s.contains(m.bounds,u)&&l.contains(m.vertices,u)){f.push(d);break}}}return f}})()},function(a,e,t){var n={};a.exports=n;var i=t(4),r=t(18),s=t(0);(function(){var o,l;if(typeof window!="undefined"&&(o=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,l=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),!o){var c;o=function(u){c=setTimeout(function(){u(s.now())},1e3/60)},l=function(){clearTimeout(c)}}n.create=function(u){var f={fps:60,correction:1,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,timeScalePrev:1,frameRequestId:null,isFixed:!1,enabled:!0},h=s.extend(f,u);return h.delta=h.delta||1e3/h.fps,h.deltaMin=h.deltaMin||1e3/h.fps,h.deltaMax=h.deltaMax||1e3/(h.fps*.5),h.fps=1e3/h.delta,h},n.run=function(u,f){return typeof u.positionIterations!="undefined"&&(f=u,u=n.create()),function h(d){u.frameRequestId=o(h),d&&u.enabled&&n.tick(u,f,d)}(),u},n.tick=function(u,f,h){var d=f.timing,p=1,m,v={timestamp:d.timestamp};i.trigger(u,"beforeTick",v),u.isFixed?m=u.delta:(m=h-u.timePrev||u.delta,u.timePrev=h,u.deltaHistory.push(m),u.deltaHistory=u.deltaHistory.slice(-u.deltaSampleSize),m=Math.min.apply(null,u.deltaHistory),m=m<u.deltaMin?u.deltaMin:m,m=m>u.deltaMax?u.deltaMax:m,p=m/u.delta,u.delta=m),u.timeScalePrev!==0&&(p*=d.timeScale/u.timeScalePrev),d.timeScale===0&&(p=0),u.timeScalePrev=d.timeScale,u.correction=p,u.frameCounter+=1,h-u.counterTimestamp>=1e3&&(u.fps=u.frameCounter*((h-u.counterTimestamp)/1e3),u.counterTimestamp=h,u.frameCounter=0),i.trigger(u,"tick",v),i.trigger(u,"beforeUpdate",v),r.update(f,m,p),i.trigger(u,"afterUpdate",v),i.trigger(u,"afterTick",v)},n.stop=function(u){l(u.frameRequestId)},n.start=function(u,f){n.run(u,f)}})()},function(a,e,t){var n={};a.exports=n;var i=t(1),r=t(0);(function(){n.pathToVertices=function(s,o){typeof window!="undefined"&&!("SVGPathSeg"in window)&&r.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var l,c,u,f,h,d,p,m,v,x,g=[],y,_,w=0,b=0,S=0;o=o||15;var M=function(E,A,I){var C=I%2==1&&I>1;if(!v||E!=v.x||A!=v.y){v&&C?(y=v.x,_=v.y):(y=0,_=0);var R={x:y+E,y:_+A};(C||!v)&&(v=R),g.push(R),b=y+E,S=_+A}},T=function(E){var A=E.pathSegTypeAsLetter.toUpperCase();if(A!=="Z"){switch(A){case"M":case"L":case"T":case"C":case"S":case"Q":b=E.x,S=E.y;break;case"H":b=E.x;break;case"V":S=E.y;break}M(b,S,E.pathSegType)}};for(n._svgPathToAbsolute(s),u=s.getTotalLength(),d=[],l=0;l<s.pathSegList.numberOfItems;l+=1)d.push(s.pathSegList.getItem(l));for(p=d.concat();w<u;){if(x=s.getPathSegAtLength(w),h=d[x],h!=m){for(;p.length&&p[0]!=h;)T(p.shift());m=h}switch(h.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":f=s.getPointAtLength(w),M(f.x,f.y,0);break}w+=o}for(l=0,c=p.length;l<c;++l)T(p[l]);return g},n._svgPathToAbsolute=function(s){for(var o,l,c,u,f,h,d=s.pathSegList,p=0,m=0,v=d.numberOfItems,x=0;x<v;++x){var g=d.getItem(x),y=g.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(y))"x"in g&&(p=g.x),"y"in g&&(m=g.y);else switch("x1"in g&&(c=p+g.x1),"x2"in g&&(f=p+g.x2),"y1"in g&&(u=m+g.y1),"y2"in g&&(h=m+g.y2),"x"in g&&(p+=g.x),"y"in g&&(m+=g.y),y){case"m":d.replaceItem(s.createSVGPathSegMovetoAbs(p,m),x);break;case"l":d.replaceItem(s.createSVGPathSegLinetoAbs(p,m),x);break;case"h":d.replaceItem(s.createSVGPathSegLinetoHorizontalAbs(p),x);break;case"v":d.replaceItem(s.createSVGPathSegLinetoVerticalAbs(m),x);break;case"c":d.replaceItem(s.createSVGPathSegCurvetoCubicAbs(p,m,c,u,f,h),x);break;case"s":d.replaceItem(s.createSVGPathSegCurvetoCubicSmoothAbs(p,m,f,h),x);break;case"q":d.replaceItem(s.createSVGPathSegCurvetoQuadraticAbs(p,m,c,u),x);break;case"t":d.replaceItem(s.createSVGPathSegCurvetoQuadraticSmoothAbs(p,m),x);break;case"a":d.replaceItem(s.createSVGPathSegArcAbs(p,m,g.r1,g.r2,g.angle,g.largeArcFlag,g.sweepFlag),x);break;case"z":case"Z":p=o,m=l;break}(y=="M"||y=="m")&&(o=p,l=m)}}})()},function(a,e,t){var n={};a.exports=n;var i=t(5),r=t(0);(function(){n.create=i.create,n.add=i.add,n.remove=i.remove,n.clear=i.clear,n.addComposite=i.addComposite,n.addBody=i.addBody,n.addConstraint=i.addConstraint})()}])})});var L1=La((Up,Vp)=>{(function(){"use strict";var a=.5*(Math.sqrt(3)-1),e=(3-Math.sqrt(3))/6,t=1/3,n=1/6,i=(Math.sqrt(5)-1)/4,r=(5-Math.sqrt(5))/20;function s(u){var f;typeof u=="function"?f=u:u?f=l(u):f=Math.random,this.p=o(f),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(var h=0;h<512;h++)this.perm[h]=this.p[h&255],this.permMod12[h]=this.perm[h]%12}s.prototype={grad3:new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),grad4:new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]),noise2D:function(u,f){var h=this.permMod12,d=this.perm,p=this.grad3,m=0,v=0,x=0,g=(u+f)*a,y=Math.floor(u+g),_=Math.floor(f+g),w=(y+_)*e,b=y-w,S=_-w,M=u-b,T=f-S,E,A;M>T?(E=1,A=0):(E=0,A=1);var I=M-E+e,C=T-A+e,R=M-1+2*e,D=T-1+2*e,F=y&255,O=_&255,U=.5-M*M-T*T;if(U>=0){var j=h[F+d[O]]*3;U*=U,m=U*U*(p[j]*M+p[j+1]*T)}var Z=.5-I*I-C*C;if(Z>=0){var K=h[F+E+d[O+A]]*3;Z*=Z,v=Z*Z*(p[K]*I+p[K+1]*C)}var G=.5-R*R-D*D;if(G>=0){var k=h[F+1+d[O+1]]*3;G*=G,x=G*G*(p[k]*R+p[k+1]*D)}return 70*(m+v+x)},noise3D:function(u,f,h){var d=this.permMod12,p=this.perm,m=this.grad3,v,x,g,y,_=(u+f+h)*t,w=Math.floor(u+_),b=Math.floor(f+_),S=Math.floor(h+_),M=(w+b+S)*n,T=w-M,E=b-M,A=S-M,I=u-T,C=f-E,R=h-A,D,F,O,U,j,Z;I>=C?C>=R?(D=1,F=0,O=0,U=1,j=1,Z=0):I>=R?(D=1,F=0,O=0,U=1,j=0,Z=1):(D=0,F=0,O=1,U=1,j=0,Z=1):C<R?(D=0,F=0,O=1,U=0,j=1,Z=1):I<R?(D=0,F=1,O=0,U=0,j=1,Z=1):(D=0,F=1,O=0,U=1,j=1,Z=0);var K=I-D+n,G=C-F+n,k=R-O+n,B=I-U+2*n,H=C-j+2*n,W=R-Z+2*n,X=I-1+3*n,te=C-1+3*n,he=R-1+3*n,ae=w&255,ce=b&255,q=S&255,re=.6-I*I-C*C-R*R;if(re<0)v=0;else{var Q=d[ae+p[ce+p[q]]]*3;re*=re,v=re*re*(m[Q]*I+m[Q+1]*C+m[Q+2]*R)}var oe=.6-K*K-G*G-k*k;if(oe<0)x=0;else{var V=d[ae+D+p[ce+F+p[q+O]]]*3;oe*=oe,x=oe*oe*(m[V]*K+m[V+1]*G+m[V+2]*k)}var P=.6-B*B-H*H-W*W;if(P<0)g=0;else{var N=d[ae+U+p[ce+j+p[q+Z]]]*3;P*=P,g=P*P*(m[N]*B+m[N+1]*H+m[N+2]*W)}var ee=.6-X*X-te*te-he*he;if(ee<0)y=0;else{var se=d[ae+1+p[ce+1+p[q+1]]]*3;ee*=ee,y=ee*ee*(m[se]*X+m[se+1]*te+m[se+2]*he)}return 32*(v+x+g+y)},noise4D:function(u,f,h,d){var p=this.perm,m=this.grad4,v,x,g,y,_,w=(u+f+h+d)*i,b=Math.floor(u+w),S=Math.floor(f+w),M=Math.floor(h+w),T=Math.floor(d+w),E=(b+S+M+T)*r,A=b-E,I=S-E,C=M-E,R=T-E,D=u-A,F=f-I,O=h-C,U=d-R,j=0,Z=0,K=0,G=0;D>F?j++:Z++,D>O?j++:K++,D>U?j++:G++,F>O?Z++:K++,F>U?Z++:G++,O>U?K++:G++;var k,B,H,W,X,te,he,ae,ce,q,re,Q;k=j>=3?1:0,B=Z>=3?1:0,H=K>=3?1:0,W=G>=3?1:0,X=j>=2?1:0,te=Z>=2?1:0,he=K>=2?1:0,ae=G>=2?1:0,ce=j>=1?1:0,q=Z>=1?1:0,re=K>=1?1:0,Q=G>=1?1:0;var oe=D-k+r,V=F-B+r,P=O-H+r,N=U-W+r,ee=D-X+2*r,se=F-te+2*r,me=O-he+2*r,ve=U-ae+2*r,Te=D-ce+3*r,Ee=F-q+3*r,Ie=O-re+3*r,Me=U-Q+3*r,Y=D-1+4*r,ge=F-1+4*r,de=O-1+4*r,Ae=U-1+4*r,we=b&255,qe=S&255,$=M&255,be=T&255,Je=.6-D*D-F*F-O*O-U*U;if(Je<0)v=0;else{var Be=p[we+p[qe+p[$+p[be]]]]%32*4;Je*=Je,v=Je*Je*(m[Be]*D+m[Be+1]*F+m[Be+2]*O+m[Be+3]*U)}var ot=.6-oe*oe-V*V-P*P-N*N;if(ot<0)x=0;else{var mt=p[we+k+p[qe+B+p[$+H+p[be+W]]]]%32*4;ot*=ot,x=ot*ot*(m[mt]*oe+m[mt+1]*V+m[mt+2]*P+m[mt+3]*N)}var Bn=.6-ee*ee-se*se-me*me-ve*ve;if(Bn<0)g=0;else{var di=p[we+X+p[qe+te+p[$+he+p[be+ae]]]]%32*4;Bn*=Bn,g=Bn*Bn*(m[di]*ee+m[di+1]*se+m[di+2]*me+m[di+3]*ve)}var zt=.6-Te*Te-Ee*Ee-Ie*Ie-Me*Me;if(zt<0)y=0;else{var _t=p[we+ce+p[qe+q+p[$+re+p[be+Q]]]]%32*4;zt*=zt,y=zt*zt*(m[_t]*Te+m[_t+1]*Ee+m[_t+2]*Ie+m[_t+3]*Me)}var pr=.6-Y*Y-ge*ge-de*de-Ae*Ae;if(pr<0)_=0;else{var $s=p[we+1+p[qe+1+p[$+1+p[be+1]]]]%32*4;pr*=pr,_=pr*pr*(m[$s]*Y+m[$s+1]*ge+m[$s+2]*de+m[$s+3]*Ae)}return 27*(v+x+g+y+_)}};function o(u){var f,h=new Uint8Array(256);for(f=0;f<256;f++)h[f]=f;for(f=0;f<255;f++){var d=f+~~(u()*(256-f)),p=h[f];h[f]=h[d],h[d]=p}return h}s._buildPermutationTable=o;function l(){var u=0,f=0,h=0,d=1,p=c();u=p(" "),f=p(" "),h=p(" ");for(var m=0;m<arguments.length;m++)u-=p(arguments[m]),u<0&&(u+=1),f-=p(arguments[m]),f<0&&(f+=1),h-=p(arguments[m]),h<0&&(h+=1);return p=null,function(){var v=2091639*u+d*23283064365386963e-26;return u=f,f=h,h=v-(d=v|0)}}function c(){var u=4022871197;return function(f){f=f.toString();for(var h=0;h<f.length;h++){u+=f.charCodeAt(h);var d=.02519603282416938*u;u=d>>>0,d-=u,d*=u,u=d>>>0,d-=u,u+=d*4294967296}return(u>>>0)*23283064365386963e-26}}typeof define!="undefined"&&define.amd&&define(function(){return s}),typeof Up!="undefined"?Up.SimplexNoise=s:typeof window!="undefined"&&(window.SimplexNoise=s),typeof Vp!="undefined"&&(Vp.exports=s)})()});var Bw=La((zF,Fw)=>{"use strict";Fw.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}});var Lt={};Um(Lt,{ACESFilmicToneMapping:()=>dg,AddEquation:()=>cs,AddOperation:()=>cg,AdditiveAnimationBlendMode:()=>Ju,AdditiveBlending:()=>Du,AlphaFormat:()=>_g,AlwaysDepth:()=>ng,AlwaysStencilFunc:()=>m0,AmbientLight:()=>kr,AmbientLightProbe:()=>xd,AnimationClip:()=>Si,AnimationLoader:()=>Lx,AnimationMixer:()=>pl,AnimationObjectGroup:()=>bd,AnimationUtils:()=>ft,ArcCurve:()=>Zc,ArrayCamera:()=>Dc,ArrowHelper:()=>fv,Audio:()=>yh,AudioAnalyser:()=>vd,AudioContext:()=>pd,AudioListener:()=>Wx,AudioLoader:()=>md,AxesHelper:()=>Rd,AxisHelper:()=>NA,BackSide:()=>gt,BasicDepthPacking:()=>f0,BasicShadowMap:()=>c_,BinaryTextureLoader:()=>VA,Bone:()=>xi,BooleanKeyframeTrack:()=>Br,BoundingBoxHelper:()=>OA,Box2:()=>er,Box3:()=>Dt,Box3Helper:()=>cv,BoxBufferGeometry:()=>ni,BoxGeometry:()=>ni,BoxHelper:()=>Cd,BufferAttribute:()=>Se,BufferGeometry:()=>ye,BufferGeometryLoader:()=>dd,ByteType:()=>mg,Cache:()=>Ki,Camera:()=>wo,CameraHelper:()=>lv,CanvasRenderer:()=>GA,CanvasTexture:()=>Xf,CatmullRomCurve3:()=>$c,CineonToneMapping:()=>fg,CircleBufferGeometry:()=>Do,CircleGeometry:()=>Do,ClampToEdgeWrapping:()=>bt,Clock:()=>zr,Color:()=>ue,ColorKeyframeTrack:()=>hh,CompressedTexture:()=>Wc,CompressedTextureLoader:()=>Rx,ConeBufferGeometry:()=>Rr,ConeGeometry:()=>Rr,CubeCamera:()=>ja,CubeReflectionMapping:()=>Ia,CubeRefractionMapping:()=>Da,CubeTexture:()=>_s,CubeTextureLoader:()=>sd,CubeUVReflectionMapping:()=>to,CubeUVRefractionMapping:()=>Fa,CubicBezierCurve:()=>ol,CubicBezierCurve3:()=>Qc,CubicInterpolant:()=>nd,CullFaceBack:()=>Lu,CullFaceFront:()=>Hm,CullFaceFrontBack:()=>l_,CullFaceNone:()=>Vm,Curve:()=>rn,CurvePath:()=>ad,CustomBlending:()=>Gm,CustomToneMapping:()=>pg,CylinderBufferGeometry:()=>yi,CylinderGeometry:()=>yi,Cylindrical:()=>Jx,DataTexture:()=>Lr,DataTexture2DArray:()=>Rc,DataTexture3D:()=>Ic,DataTextureLoader:()=>od,DataUtils:()=>pv,DecrementStencilOp:()=>v_,DecrementWrapStencilOp:()=>w_,DefaultLoadingManager:()=>Cx,DepthFormat:()=>ds,DepthStencilFormat:()=>so,DepthTexture:()=>jf,DirectionalLight:()=>Ai,DirectionalLightHelper:()=>Sh,DiscreteInterpolant:()=>id,DodecahedronBufferGeometry:()=>Fo,DodecahedronGeometry:()=>Fo,DoubleSide:()=>Mn,DstAlphaFactor:()=>Jm,DstColorFactor:()=>Qm,DynamicBufferAttribute:()=>EA,DynamicCopyUsage:()=>F_,DynamicDrawUsage:()=>oo,DynamicReadUsage:()=>R_,EdgesGeometry:()=>Yc,EdgesHelper:()=>kA,EllipseCurve:()=>Bo,EqualDepth:()=>rg,EqualStencilFunc:()=>S_,EquirectangularReflectionMapping:()=>eo,EquirectangularRefractionMapping:()=>sc,Euler:()=>Ut,EventDispatcher:()=>Sn,ExtrudeBufferGeometry:()=>Ln,ExtrudeGeometry:()=>Ln,FaceColors:()=>mA,FileLoader:()=>Pt,FlatShading:()=>Iu,Float16BufferAttribute:()=>Pf,Float32Attribute:()=>FA,Float32BufferAttribute:()=>pe,Float64Attribute:()=>BA,Float64BufferAttribute:()=>Cf,FloatType:()=>Vi,Fog:()=>Ao,FogExp2:()=>Eo,Font:()=>xh,FontLoader:()=>kx,FrontSide:()=>zi,Frustum:()=>So,GLBufferAttribute:()=>Sd,GLSL1:()=>N_,GLSL3:()=>nf,GammaEncoding:()=>cc,GreaterDepth:()=>og,GreaterEqualDepth:()=>sg,GreaterEqualStencilFunc:()=>P_,GreaterStencilFunc:()=>E_,GridHelper:()=>Pd,Group:()=>Jt,HalfFloatType:()=>fs,HemisphereLight:()=>Xo,HemisphereLightHelper:()=>rv,HemisphereLightProbe:()=>gd,IcosahedronBufferGeometry:()=>ko,IcosahedronGeometry:()=>ko,ImageBitmapLoader:()=>dl,ImageLoader:()=>Or,ImageUtils:()=>wr,ImmediateRenderObject:()=>xl,IncrementStencilOp:()=>x_,IncrementWrapStencilOp:()=>y_,InstancedBufferAttribute:()=>mh,InstancedBufferGeometry:()=>ph,InstancedInterleavedBuffer:()=>Md,InstancedMesh:()=>Uc,Int16Attribute:()=>LA,Int16BufferAttribute:()=>Ef,Int32Attribute:()=>IA,Int32BufferAttribute:()=>Af,Int8Attribute:()=>AA,Int8BufferAttribute:()=>Mf,IntType:()=>xg,InterleavedBuffer:()=>gi,InterleavedBufferAttribute:()=>ri,Interpolant:()=>zn,InterpolateDiscrete:()=>ps,InterpolateLinear:()=>yr,InterpolateSmooth:()=>oc,InvertStencilOp:()=>__,JSONLoader:()=>WA,KeepStencilOp:()=>hc,KeyframeTrack:()=>Un,LOD:()=>Vf,LatheBufferGeometry:()=>zo,LatheGeometry:()=>zo,Layers:()=>vc,LensFlare:()=>jA,LessDepth:()=>ig,LessEqualDepth:()=>ic,LessEqualStencilFunc:()=>T_,LessStencilFunc:()=>M_,Light:()=>Vn,LightProbe:()=>qo,Line:()=>Gt,Line3:()=>Ls,LineBasicMaterial:()=>rt,LineCurve:()=>No,LineCurve3:()=>Qf,LineDashedMaterial:()=>lh,LineLoop:()=>Io,LinePieces:()=>pA,LineSegments:()=>Ot,LineStrip:()=>dA,LinearEncoding:()=>jt,LinearFilter:()=>Ke,LinearInterpolant:()=>ch,LinearMipMapLinearFilter:()=>p_,LinearMipMapNearestFilter:()=>d_,LinearMipmapLinearFilter:()=>mi,LinearMipmapNearestFilter:()=>Ba,LinearToneMapping:()=>hg,Loader:()=>vt,LoaderUtils:()=>un,LoadingManager:()=>uh,LogLuvEncoding:()=>u0,LoopOnce:()=>a0,LoopPingPong:()=>c0,LoopRepeat:()=>l0,LuminanceAlphaFormat:()=>Mg,LuminanceFormat:()=>bg,MOUSE:()=>gr,Material:()=>St,MaterialLoader:()=>fd,Math:()=>dt,MathUtils:()=>dt,Matrix3:()=>Ye,Matrix4:()=>fe,MaxEquation:()=>Ou,Mesh:()=>Ce,MeshBasicMaterial:()=>ct,MeshDepthMaterial:()=>Ja,MeshDistanceMaterial:()=>$a,MeshFaceMaterial:()=>xA,MeshLambertMaterial:()=>_i,MeshMatcapMaterial:()=>ah,MeshNormalMaterial:()=>Wo,MeshPhongMaterial:()=>kn,MeshPhysicalMaterial:()=>Qi,MeshStandardMaterial:()=>Rn,MeshToonMaterial:()=>Go,MinEquation:()=>Nu,MirroredRepeatWrapping:()=>hs,MixOperation:()=>lg,MultiMaterial:()=>vA,MultiplyBlending:()=>Bu,MultiplyOperation:()=>Ra,NearestFilter:()=>Mt,NearestMipMapLinearFilter:()=>f_,NearestMipMapNearestFilter:()=>u_,NearestMipmapLinearFilter:()=>io,NearestMipmapNearestFilter:()=>no,NeverDepth:()=>tg,NeverStencilFunc:()=>b_,NoBlending:()=>Ui,NoColors:()=>Nd,NoToneMapping:()=>vr,NormalAnimationBlendMode:()=>ac,NormalBlending:()=>Ks,NotEqualDepth:()=>ag,NotEqualStencilFunc:()=>A_,NumberKeyframeTrack:()=>bi,Object3D:()=>Re,ObjectLoader:()=>gh,ObjectSpaceNormalMap:()=>p0,OctahedronBufferGeometry:()=>Ms,OctahedronGeometry:()=>Ms,OneFactor:()=>qm,OneMinusDstAlphaFactor:()=>$m,OneMinusDstColorFactor:()=>Km,OneMinusSrcAlphaFactor:()=>zu,OneMinusSrcColorFactor:()=>Zm,OrthographicCamera:()=>sn,PCFShadowMap:()=>Ru,PCFSoftShadowMap:()=>nc,PMREMGenerator:()=>_v,ParametricBufferGeometry:()=>ih,ParametricGeometry:()=>ih,Particle:()=>wA,ParticleBasicMaterial:()=>MA,ParticleSystem:()=>_A,ParticleSystemMaterial:()=>SA,Path:()=>Ti,PerspectiveCamera:()=>it,Plane:()=>Tt,PlaneBufferGeometry:()=>tn,PlaneGeometry:()=>tn,PlaneHelper:()=>hv,PointCloud:()=>yA,PointCloudMaterial:()=>bA,PointLight:()=>ci,PointLightHelper:()=>tv,Points:()=>vi,PointsMaterial:()=>On,PolarGridHelper:()=>sv,PolyhedronBufferGeometry:()=>wi,PolyhedronGeometry:()=>wi,PositionalAudio:()=>jx,PropertyBinding:()=>Oe,PropertyMixer:()=>yd,QuadraticBezierCurve:()=>al,QuadraticBezierCurve3:()=>Kc,Quaternion:()=>Ve,QuaternionKeyframeTrack:()=>si,QuaternionLinearInterpolant:()=>rd,REVISION:()=>ki,RGBADepthPacking:()=>d0,RGBAFormat:()=>gn,RGBAIntegerFormat:()=>Lg,RGBA_ASTC_10x10_Format:()=>Gg,RGBA_ASTC_10x5_Format:()=>Ug,RGBA_ASTC_10x6_Format:()=>Vg,RGBA_ASTC_10x8_Format:()=>Hg,RGBA_ASTC_12x10_Format:()=>Wg,RGBA_ASTC_12x12_Format:()=>Xg,RGBA_ASTC_4x4_Format:()=>Ig,RGBA_ASTC_5x4_Format:()=>Dg,RGBA_ASTC_5x5_Format:()=>Fg,RGBA_ASTC_6x5_Format:()=>Bg,RGBA_ASTC_6x6_Format:()=>Ng,RGBA_ASTC_8x5_Format:()=>Og,RGBA_ASTC_8x6_Format:()=>kg,RGBA_ASTC_8x8_Format:()=>zg,RGBA_BPTC_Format:()=>jg,RGBA_ETC2_EAC_Format:()=>Zu,RGBA_PVRTC_2BPPV1_Format:()=>qu,RGBA_PVRTC_4BPPV1_Format:()=>ju,RGBA_S3TC_DXT1_Format:()=>Vu,RGBA_S3TC_DXT3_Format:()=>Hu,RGBA_S3TC_DXT5_Format:()=>Gu,RGBDEncoding:()=>tf,RGBEEncoding:()=>Qu,RGBEFormat:()=>Sg,RGBFormat:()=>mn,RGBIntegerFormat:()=>Cg,RGBM16Encoding:()=>ef,RGBM7Encoding:()=>Ku,RGB_ETC1_Format:()=>Rg,RGB_ETC2_Format:()=>Yu,RGB_PVRTC_2BPPV1_Format:()=>Xu,RGB_PVRTC_4BPPV1_Format:()=>Wu,RGB_S3TC_DXT1_Format:()=>Uu,RGFormat:()=>Ag,RGIntegerFormat:()=>Pg,RawShaderMaterial:()=>Ts,Ray:()=>ji,Raycaster:()=>Yo,RectAreaLight:()=>jo,RedFormat:()=>Tg,RedIntegerFormat:()=>Eg,ReinhardToneMapping:()=>ug,RepeatWrapping:()=>Nt,ReplaceStencilOp:()=>g_,ReverseSubtractEquation:()=>Xm,RingBufferGeometry:()=>Dr,RingGeometry:()=>Dr,SRGB8_ALPHA8_ASTC_10x10_Format:()=>r0,SRGB8_ALPHA8_ASTC_10x5_Format:()=>t0,SRGB8_ALPHA8_ASTC_10x6_Format:()=>n0,SRGB8_ALPHA8_ASTC_10x8_Format:()=>i0,SRGB8_ALPHA8_ASTC_12x10_Format:()=>s0,SRGB8_ALPHA8_ASTC_12x12_Format:()=>o0,SRGB8_ALPHA8_ASTC_4x4_Format:()=>qg,SRGB8_ALPHA8_ASTC_5x4_Format:()=>Yg,SRGB8_ALPHA8_ASTC_5x5_Format:()=>Zg,SRGB8_ALPHA8_ASTC_6x5_Format:()=>Jg,SRGB8_ALPHA8_ASTC_6x6_Format:()=>$g,SRGB8_ALPHA8_ASTC_8x5_Format:()=>Qg,SRGB8_ALPHA8_ASTC_8x6_Format:()=>Kg,SRGB8_ALPHA8_ASTC_8x8_Format:()=>e0,Scene:()=>bs,SceneUtils:()=>XA,ShaderChunk:()=>Ue,ShaderLib:()=>ii,ShaderMaterial:()=>Ht,ShadowMaterial:()=>oh,Shape:()=>li,ShapeBufferGeometry:()=>Ss,ShapeGeometry:()=>Ss,ShapePath:()=>hi,ShapeUtils:()=>Cn,ShortType:()=>gg,Skeleton:()=>$i,SkeletonHelper:()=>Ad,SkinnedMesh:()=>Ji,SmoothShading:()=>h_,Sphere:()=>En,SphereBufferGeometry:()=>hn,SphereGeometry:()=>hn,Spherical:()=>gl,SphericalHarmonics3:()=>dh,SplineCurve:()=>ll,SpotLight:()=>Ei,SpotLightHelper:()=>_h,Sprite:()=>nl,SpriteMaterial:()=>Qa,SrcAlphaFactor:()=>ku,SrcAlphaSaturateFactor:()=>eg,SrcColorFactor:()=>Ym,StaticCopyUsage:()=>D_,StaticDrawUsage:()=>Gi,StaticReadUsage:()=>L_,StereoCamera:()=>Vx,StreamCopyUsage:()=>B_,StreamDrawUsage:()=>C_,StreamReadUsage:()=>I_,StringKeyframeTrack:()=>Nr,SubtractEquation:()=>Wm,SubtractiveBlending:()=>Fu,TOUCH:()=>xr,TangentSpaceNormalMap:()=>Hi,TetrahedronBufferGeometry:()=>Uo,TetrahedronGeometry:()=>Uo,TextBufferGeometry:()=>rh,TextGeometry:()=>rh,Texture:()=>lt,TextureLoader:()=>ai,TorusBufferGeometry:()=>Fr,TorusGeometry:()=>Fr,TorusKnotBufferGeometry:()=>Vo,TorusKnotGeometry:()=>Vo,Triangle:()=>pt,TriangleFanDrawMode:()=>lc,TriangleStripDrawMode:()=>$u,TrianglesDrawMode:()=>h0,TubeBufferGeometry:()=>Ho,TubeGeometry:()=>Ho,UVMapping:()=>rc,Uint16Attribute:()=>RA,Uint16BufferAttribute:()=>ws,Uint32Attribute:()=>DA,Uint32BufferAttribute:()=>Wa,Uint8Attribute:()=>PA,Uint8BufferAttribute:()=>Sf,Uint8ClampedAttribute:()=>CA,Uint8ClampedBufferAttribute:()=>Tf,Uniform:()=>ml,UniformsLib:()=>_e,UniformsUtils:()=>Pr,UnsignedByteType:()=>us,UnsignedInt248Type:()=>ro,UnsignedIntType:()=>Oa,UnsignedShort4444Type:()=>vg,UnsignedShort5551Type:()=>yg,UnsignedShort565Type:()=>wg,UnsignedShortType:()=>Na,VSMShadowMap:()=>Qs,Vector2:()=>J,Vector3:()=>L,Vector4:()=>De,VectorKeyframeTrack:()=>Mi,Vertex:()=>TA,VertexColors:()=>gA,VideoTexture:()=>Wf,WebGL1Renderer:()=>zf,WebGLCubeRenderTarget:()=>qa,WebGLMultipleRenderTargets:()=>af,WebGLMultisampleRenderTarget:()=>fc,WebGLRenderTarget:()=>Zt,WebGLRenderTargetCube:()=>HA,WebGLRenderer:()=>et,WebGLUtils:()=>tx,WireframeGeometry:()=>sh,WireframeHelper:()=>zA,WrapAroundEnding:()=>ka,XHRLoader:()=>UA,ZeroCurvatureEnding:()=>ms,ZeroFactor:()=>jm,ZeroSlopeEnding:()=>gs,ZeroStencilOp:()=>m_,sRGBEncoding:()=>xn});var ki="130",gr={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},xr={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Vm=0,Lu=1,Hm=2,l_=3,c_=0,Ru=1,nc=2,Qs=3,zi=0,gt=1,Mn=2,Iu=1,h_=2,Ui=0,Ks=1,Du=2,Fu=3,Bu=4,Gm=5,cs=100,Wm=101,Xm=102,Nu=103,Ou=104,jm=200,qm=201,Ym=202,Zm=203,ku=204,zu=205,Jm=206,$m=207,Qm=208,Km=209,eg=210,tg=0,ng=1,ig=2,ic=3,rg=4,sg=5,og=6,ag=7,Ra=0,lg=1,cg=2,vr=0,hg=1,ug=2,fg=3,dg=4,pg=5,rc=300,Ia=301,Da=302,eo=303,sc=304,to=306,Fa=307,Nt=1e3,bt=1001,hs=1002,Mt=1003,no=1004,u_=1004,io=1005,f_=1005,Ke=1006,Ba=1007,d_=1007,mi=1008,p_=1008,us=1009,mg=1010,gg=1011,Na=1012,xg=1013,Oa=1014,Vi=1015,fs=1016,vg=1017,yg=1018,wg=1019,ro=1020,_g=1021,mn=1022,gn=1023,bg=1024,Mg=1025,Sg=gn,ds=1026,so=1027,Tg=1028,Eg=1029,Ag=1030,Pg=1031,Cg=1032,Lg=1033,Uu=33776,Vu=33777,Hu=33778,Gu=33779,Wu=35840,Xu=35841,ju=35842,qu=35843,Rg=36196,Yu=37492,Zu=37496,Ig=37808,Dg=37809,Fg=37810,Bg=37811,Ng=37812,Og=37813,kg=37814,zg=37815,Ug=37816,Vg=37817,Hg=37818,Gg=37819,Wg=37820,Xg=37821,jg=36492,qg=37840,Yg=37841,Zg=37842,Jg=37843,$g=37844,Qg=37845,Kg=37846,e0=37847,t0=37848,n0=37849,i0=37850,r0=37851,s0=37852,o0=37853,a0=2200,l0=2201,c0=2202,ps=2300,yr=2301,oc=2302,ms=2400,gs=2401,ka=2402,ac=2500,Ju=2501,h0=0,$u=1,lc=2,jt=3e3,xn=3001,cc=3007,Qu=3002,u0=3003,Ku=3004,ef=3005,tf=3006,f0=3200,d0=3201,Hi=0,p0=1,m_=0,hc=7680,g_=7681,x_=7682,v_=7683,y_=34055,w_=34056,__=5386,b_=512,M_=513,S_=514,T_=515,E_=516,A_=517,P_=518,m0=519,Gi=35044,oo=35048,C_=35040,L_=35045,R_=35049,I_=35041,D_=35046,F_=35050,B_=35042,N_="100",nf="300 es",Sn=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});let n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;let n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;let i=this._listeners[e];if(i!==void 0){let r=i.indexOf(t);r!==-1&&i.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;let n=this._listeners[e.type];if(n!==void 0){e.target=this;let i=n.slice(0);for(let r=0,s=i.length;r<s;r++)i[r].call(this,e);e.target=null}}},qt=[];for(let a=0;a<256;a++)qt[a]=(a<16?"0":"")+a.toString(16);var uc=1234567,xs=Math.PI/180,za=180/Math.PI;function Tn(){let a=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(qt[a&255]+qt[a>>8&255]+qt[a>>16&255]+qt[a>>24&255]+"-"+qt[e&255]+qt[e>>8&255]+"-"+qt[e>>16&15|64]+qt[e>>24&255]+"-"+qt[t&63|128]+qt[t>>8&255]+"-"+qt[t>>16&255]+qt[t>>24&255]+qt[n&255]+qt[n>>8&255]+qt[n>>16&255]+qt[n>>24&255]).toUpperCase()}function Yt(a,e,t){return Math.max(e,Math.min(t,a))}function rf(a,e){return(a%e+e)%e}function O_(a,e,t,n,i){return n+(a-e)*(i-n)/(t-e)}function k_(a,e,t){return a!==e?(t-a)/(e-a):0}function Ua(a,e,t){return(1-t)*a+t*e}function z_(a,e,t,n){return Ua(a,e,1-Math.exp(-t*n))}function U_(a,e=1){return e-Math.abs(rf(a,e*2)-e)}function V_(a,e,t){return a<=e?0:a>=t?1:(a=(a-e)/(t-e),a*a*(3-2*a))}function H_(a,e,t){return a<=e?0:a>=t?1:(a=(a-e)/(t-e),a*a*a*(a*(a*6-15)+10))}function G_(a,e){return a+Math.floor(Math.random()*(e-a+1))}function W_(a,e){return a+Math.random()*(e-a)}function X_(a){return a*(.5-Math.random())}function j_(a){return a!==void 0&&(uc=a%2147483647),uc=uc*16807%2147483647,(uc-1)/2147483646}function q_(a){return a*xs}function Y_(a){return a*za}function sf(a){return(a&a-1)==0&&a!==0}function g0(a){return Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function x0(a){return Math.pow(2,Math.floor(Math.log(a)/Math.LN2))}function Z_(a,e,t,n,i){let r=Math.cos,s=Math.sin,o=r(t/2),l=s(t/2),c=r((e+n)/2),u=s((e+n)/2),f=r((e-n)/2),h=s((e-n)/2),d=r((n-e)/2),p=s((n-e)/2);switch(i){case"XYX":a.set(o*u,l*f,l*h,o*c);break;case"YZY":a.set(l*h,o*u,l*f,o*c);break;case"ZXZ":a.set(l*f,l*h,o*u,o*c);break;case"XZX":a.set(o*u,l*p,l*d,o*c);break;case"YXY":a.set(l*d,o*u,l*p,o*c);break;case"ZYZ":a.set(l*p,l*d,o*u,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}var dt=Object.freeze({__proto__:null,DEG2RAD:xs,RAD2DEG:za,generateUUID:Tn,clamp:Yt,euclideanModulo:rf,mapLinear:O_,inverseLerp:k_,lerp:Ua,damp:z_,pingpong:U_,smoothstep:V_,smootherstep:H_,randInt:G_,randFloat:W_,randFloatSpread:X_,seededRandom:j_,degToRad:q_,radToDeg:Y_,isPowerOfTwo:sf,ceilPowerOfTwo:g0,floorPowerOfTwo:x0,setQuaternionFromProperEuler:Z_}),J=class{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return n!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,s=this.y-e.y;return this.x=r*n-s*i+e.x,this.y=r*i+s*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}};J.prototype.isVector2=!0;var Ye=class{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,i,r,s,o,l,c){let u=this.elements;return u[0]=e,u[1]=i,u[2]=o,u[3]=t,u[4]=r,u[5]=l,u[6]=n,u[7]=s,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let n=e.elements,i=t.elements,r=this.elements,s=n[0],o=n[3],l=n[6],c=n[1],u=n[4],f=n[7],h=n[2],d=n[5],p=n[8],m=i[0],v=i[3],x=i[6],g=i[1],y=i[4],_=i[7],w=i[2],b=i[5],S=i[8];return r[0]=s*m+o*g+l*w,r[3]=s*v+o*y+l*b,r[6]=s*x+o*_+l*S,r[1]=c*m+u*g+f*w,r[4]=c*v+u*y+f*b,r[7]=c*x+u*_+f*S,r[2]=h*m+d*g+p*w,r[5]=h*v+d*y+p*b,r[8]=h*x+d*_+p*S,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],o=e[5],l=e[6],c=e[7],u=e[8];return t*s*u-t*o*c-n*r*u+n*o*l+i*r*c-i*s*l}invert(){let e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],o=e[5],l=e[6],c=e[7],u=e[8],f=u*s-o*c,h=o*l-u*r,d=c*r-s*l,p=t*f+n*h+i*d;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);let m=1/p;return e[0]=f*m,e[1]=(i*c-u*n)*m,e[2]=(o*n-i*s)*m,e[3]=h*m,e[4]=(u*t-i*l)*m,e[5]=(i*r-o*t)*m,e[6]=d*m,e[7]=(n*l-c*t)*m,e[8]=(s*t-n*r)*m,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,s,o){let l=Math.cos(r),c=Math.sin(r);return this.set(n*l,n*c,-n*(l*s+c*o)+s+e,-i*c,i*l,-i*(-c*s+l*o)+o+t,0,0,1),this}scale(e,t){let n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){let t=Math.cos(e),n=Math.sin(e),i=this.elements,r=i[0],s=i[3],o=i[6],l=i[1],c=i[4],u=i[7];return i[0]=t*r+n*l,i[3]=t*s+n*c,i[6]=t*o+n*u,i[1]=-n*r+t*l,i[4]=-n*s+t*c,i[7]=-n*o+t*u,this}translate(e,t){let n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){let t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){let n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}};Ye.prototype.isMatrix3=!0;var ao,wr=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement=="undefined")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{ao===void 0&&(ao=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),ao.width=e.width,ao.height=e.height;let n=ao.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=ao}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}},J_=0,lt=class extends Sn{constructor(e=lt.DEFAULT_IMAGE,t=lt.DEFAULT_MAPPING,n=bt,i=bt,r=Ke,s=mi,o=gn,l=us,c=1,u=jt){super();Object.defineProperty(this,"id",{value:J_++}),this.uuid=Tn(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=s,this.anisotropy=c,this.format=o,this.internalFormat=null,this.type=l,this.offset=new J(0,0),this.repeat=new J(1,1),this.center=new J(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ye,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=u,this.version=0,this.onUpdate=null}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];let n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){let i=this.image;if(i.uuid===void 0&&(i.uuid=Tn()),!t&&e.images[i.uuid]===void 0){let r;if(Array.isArray(i)){r=[];for(let s=0,o=i.length;s<o;s++)i[s].isDataTexture?r.push(of(i[s].image)):r.push(of(i[s]))}else r=of(i);e.images[i.uuid]={uuid:i.uuid,url:r}}n.image=i.uuid}return t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==rc)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Nt:e.x=e.x-Math.floor(e.x);break;case bt:e.x=e.x<0?0:1;break;case hs:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Nt:e.y=e.y-Math.floor(e.y);break;case bt:e.y=e.y<0?0:1;break;case hs:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&this.version++}};lt.DEFAULT_IMAGE=void 0;lt.DEFAULT_MAPPING=rc;lt.prototype.isTexture=!0;function of(a){return typeof HTMLImageElement!="undefined"&&a instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&a instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&a instanceof ImageBitmap?wr.getDataURL(a):a.data?{data:Array.prototype.slice.call(a.data),width:a.width,height:a.height,type:a.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var De=class{constructor(e=0,t=0,n=0,i=1){this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,n=this.y,i=this.z,r=this.w,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*i+s[12]*r,this.y=s[1]*t+s[5]*n+s[9]*i+s[13]*r,this.z=s[2]*t+s[6]*n+s[10]*i+s[14]*r,this.w=s[3]*t+s[7]*n+s[11]*i+s[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r,s=.01,o=.1,l=e.elements,c=l[0],u=l[4],f=l[8],h=l[1],d=l[5],p=l[9],m=l[2],v=l[6],x=l[10];if(Math.abs(u-h)<s&&Math.abs(f-m)<s&&Math.abs(p-v)<s){if(Math.abs(u+h)<o&&Math.abs(f+m)<o&&Math.abs(p+v)<o&&Math.abs(c+d+x-3)<o)return this.set(1,0,0,0),this;t=Math.PI;let y=(c+1)/2,_=(d+1)/2,w=(x+1)/2,b=(u+h)/4,S=(f+m)/4,M=(p+v)/4;return y>_&&y>w?y<s?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(y),i=b/n,r=S/n):_>w?_<s?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(_),n=b/i,r=M/i):w<s?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(w),n=S/r,i=M/r),this.set(n,i,r,t),this}let g=Math.sqrt((v-p)*(v-p)+(f-m)*(f-m)+(h-u)*(h-u));return Math.abs(g)<.001&&(g=1),this.x=(v-p)/g,this.y=(f-m)/g,this.z=(h-u)/g,this.w=Math.acos((c+d+x-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return n!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}};De.prototype.isVector4=!0;var Zt=class extends Sn{constructor(e,t,n={}){super();this.width=e,this.height=t,this.depth=1,this.scissor=new De(0,0,e,t),this.scissorTest=!1,this.viewport=new De(0,0,e,t),this.texture=new lt(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={width:e,height:t,depth:1},this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:Ke,this.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0,this.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!1,this.depthTexture=n.depthTexture!==void 0?n.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,n=1){(this.width!==e||this.height!==t||this.depth!==n)&&(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}};Zt.prototype.isWebGLRenderTarget=!0;var af=class extends Zt{constructor(e,t,n){super(e,t);let i=this.texture;this.texture=[];for(let r=0;r<n;r++)this.texture[r]=i.clone()}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,r=this.texture.length;i<r;i++)this.texture[i].image.width=e,this.texture[i].image.height=t,this.texture[i].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone();return this}};af.prototype.isWebGLMultipleRenderTargets=!0;var fc=class extends Zt{constructor(e,t,n){super(e,t,n);this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}};fc.prototype.isWebGLMultisampleRenderTarget=!0;var Ve=class{constructor(e=0,t=0,n=0,i=1){this._x=e,this._y=t,this._z=n,this._w=i}static slerp(e,t,n,i){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,i)}static slerpFlat(e,t,n,i,r,s,o){let l=n[i+0],c=n[i+1],u=n[i+2],f=n[i+3],h=r[s+0],d=r[s+1],p=r[s+2],m=r[s+3];if(o===0){e[t+0]=l,e[t+1]=c,e[t+2]=u,e[t+3]=f;return}if(o===1){e[t+0]=h,e[t+1]=d,e[t+2]=p,e[t+3]=m;return}if(f!==m||l!==h||c!==d||u!==p){let v=1-o,x=l*h+c*d+u*p+f*m,g=x>=0?1:-1,y=1-x*x;if(y>Number.EPSILON){let w=Math.sqrt(y),b=Math.atan2(w,x*g);v=Math.sin(v*b)/w,o=Math.sin(o*b)/w}let _=o*g;if(l=l*v+h*_,c=c*v+d*_,u=u*v+p*_,f=f*v+m*_,v===1-o){let w=1/Math.sqrt(l*l+c*c+u*u+f*f);l*=w,c*=w,u*=w,f*=w}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=f}static multiplyQuaternionsFlat(e,t,n,i,r,s){let o=n[i],l=n[i+1],c=n[i+2],u=n[i+3],f=r[s],h=r[s+1],d=r[s+2],p=r[s+3];return e[t]=o*p+u*f+l*d-c*h,e[t+1]=l*p+u*h+c*f-o*d,e[t+2]=c*p+u*d+o*h-l*f,e[t+3]=u*p-o*f-l*h-c*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");let n=e._x,i=e._y,r=e._z,s=e._order,o=Math.cos,l=Math.sin,c=o(n/2),u=o(i/2),f=o(r/2),h=l(n/2),d=l(i/2),p=l(r/2);switch(s){case"XYZ":this._x=h*u*f+c*d*p,this._y=c*d*f-h*u*p,this._z=c*u*p+h*d*f,this._w=c*u*f-h*d*p;break;case"YXZ":this._x=h*u*f+c*d*p,this._y=c*d*f-h*u*p,this._z=c*u*p-h*d*f,this._w=c*u*f+h*d*p;break;case"ZXY":this._x=h*u*f-c*d*p,this._y=c*d*f+h*u*p,this._z=c*u*p+h*d*f,this._w=c*u*f-h*d*p;break;case"ZYX":this._x=h*u*f-c*d*p,this._y=c*d*f+h*u*p,this._z=c*u*p-h*d*f,this._w=c*u*f+h*d*p;break;case"YZX":this._x=h*u*f+c*d*p,this._y=c*d*f+h*u*p,this._z=c*u*p-h*d*f,this._w=c*u*f-h*d*p;break;case"XZY":this._x=h*u*f-c*d*p,this._y=c*d*f-h*u*p,this._z=c*u*p+h*d*f,this._w=c*u*f+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,n=t[0],i=t[4],r=t[8],s=t[1],o=t[5],l=t[9],c=t[2],u=t[6],f=t[10],h=n+o+f;if(h>0){let d=.5/Math.sqrt(h+1);this._w=.25/d,this._x=(u-l)*d,this._y=(r-c)*d,this._z=(s-i)*d}else if(n>o&&n>f){let d=2*Math.sqrt(1+n-o-f);this._w=(u-l)/d,this._x=.25*d,this._y=(i+s)/d,this._z=(r+c)/d}else if(o>f){let d=2*Math.sqrt(1+o-n-f);this._w=(r-c)/d,this._x=(i+s)/d,this._y=.25*d,this._z=(l+u)/d}else{let d=2*Math.sqrt(1+f-n-o);this._w=(s-i)/d,this._x=(r+c)/d,this._y=(l+u)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Yt(this.dot(e),-1,1)))}rotateTowards(e,t){let n=this.angleTo(e);if(n===0)return this;let i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return t!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let n=e._x,i=e._y,r=e._z,s=e._w,o=t._x,l=t._y,c=t._z,u=t._w;return this._x=n*u+s*o+i*c-r*l,this._y=i*u+s*l+r*o-n*c,this._z=r*u+s*c+n*l-i*o,this._w=s*u-n*o-i*l-r*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);let n=this._x,i=this._y,r=this._z,s=this._w,o=s*e._w+n*e._x+i*e._y+r*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=s,this._x=n,this._y=i,this._z=r,this;let l=1-o*o;if(l<=Number.EPSILON){let d=1-t;return this._w=d*s+t*this._w,this._x=d*n+t*this._x,this._y=d*i+t*this._y,this._z=d*r+t*this._z,this.normalize(),this._onChangeCallback(),this}let c=Math.sqrt(l),u=Math.atan2(c,o),f=Math.sin((1-t)*u)/c,h=Math.sin(t*u)/c;return this._w=s*f+this._w*h,this._x=n*f+this._x*h,this._y=i*f+this._y*h,this._z=r*f+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){this.copy(e).slerp(t,n)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}};Ve.prototype.isQuaternion=!0;var L=class{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(v0.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(v0.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,n=this.y,i=this.z,r=e.elements,s=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*s,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*s,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*s,this}applyQuaternion(e){let t=this.x,n=this.y,i=this.z,r=e.x,s=e.y,o=e.z,l=e.w,c=l*t+s*i-o*n,u=l*n+o*t-r*i,f=l*i+r*n-s*t,h=-r*t-s*n-o*i;return this.x=c*l+h*-r+u*-o-f*-s,this.y=u*l+h*-s+f*-r-c*-o,this.z=f*l+h*-o+c*-s-u*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return t!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){let n=e.x,i=e.y,r=e.z,s=t.x,o=t.y,l=t.z;return this.x=i*l-r*o,this.y=r*s-n*l,this.z=n*o-i*s,this}projectOnVector(e){let t=e.lengthSq();if(t===0)return this.set(0,0,0);let n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return lf.copy(this).projectOnVector(e),this.sub(lf)}reflect(e){return this.sub(lf.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;let n=this.dot(e)/t;return Math.acos(Yt(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){let i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return n!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}};L.prototype.isVector3=!0;var lf=new L,v0=new Ve,Dt=class{constructor(e=new L(1/0,1/0,1/0),t=new L(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,o=-1/0;for(let l=0,c=e.length;l<c;l+=3){let u=e[l],f=e[l+1],h=e[l+2];u<t&&(t=u),f<n&&(n=f),h<i&&(i=h),u>r&&(r=u),f>s&&(s=f),h>o&&(o=h)}return this.min.set(t,n,i),this.max.set(r,s,o),this}setFromBufferAttribute(e){let t=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,o=-1/0;for(let l=0,c=e.count;l<c;l++){let u=e.getX(l),f=e.getY(l),h=e.getZ(l);u<t&&(t=u),f<n&&(n=f),h<i&&(i=h),u>r&&(r=u),f>s&&(s=f),h>o&&(o=h)}return this.min.set(t,n,i),this.max.set(r,s,o),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let n=Va.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);let t=e.geometry;t!==void 0&&(t.boundingBox===null&&t.computeBoundingBox(),cf.copy(t.boundingBox),cf.applyMatrix4(e.matrixWorld),this.union(cf));let n=e.children;for(let i=0,r=n.length;i<r;i++)this.expandByObject(n[i]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Va),Va.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Ha),dc.subVectors(this.max,Ha),lo.subVectors(e.a,Ha),co.subVectors(e.b,Ha),ho.subVectors(e.c,Ha),_r.subVectors(co,lo),br.subVectors(ho,co),vs.subVectors(lo,ho);let t=[0,-_r.z,_r.y,0,-br.z,br.y,0,-vs.z,vs.y,_r.z,0,-_r.x,br.z,0,-br.x,vs.z,0,-vs.x,-_r.y,_r.x,0,-br.y,br.x,0,-vs.y,vs.x,0];return!hf(t,lo,co,ho,dc)||(t=[1,0,0,0,1,0,0,0,1],!hf(t,lo,co,ho,dc))?!1:(pc.crossVectors(_r,br),t=[pc.x,pc.y,pc.z],hf(t,lo,co,ho,dc))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Va.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(Va).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Wi[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Wi[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Wi[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Wi[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Wi[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Wi[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Wi[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Wi[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Wi),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};Dt.prototype.isBox3=!0;var Wi=[new L,new L,new L,new L,new L,new L,new L,new L],Va=new L,cf=new Dt,lo=new L,co=new L,ho=new L,_r=new L,br=new L,vs=new L,Ha=new L,dc=new L,pc=new L,ys=new L;function hf(a,e,t,n,i){for(let r=0,s=a.length-3;r<=s;r+=3){ys.fromArray(a,r);let o=i.x*Math.abs(ys.x)+i.y*Math.abs(ys.y)+i.z*Math.abs(ys.z),l=e.dot(ys),c=t.dot(ys),u=n.dot(ys);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>o)return!1}return!0}var $_=new Dt,y0=new L,uf=new L,ff=new L,En=class{constructor(e=new L,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let n=this.center;t!==void 0?n.copy(t):$_.setFromPoints(e).getCenter(n);let i=0;for(let r=0,s=e.length;r<s;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){ff.subVectors(e,this.center);let t=ff.lengthSq();if(t>this.radius*this.radius){let n=Math.sqrt(t),i=(n-this.radius)*.5;this.center.add(ff.multiplyScalar(i/n)),this.radius+=i}return this}union(e){return uf.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(y0.copy(e.center).add(uf)),this.expandByPoint(y0.copy(e.center).sub(uf)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}},Xi=new L,df=new L,mc=new L,Mr=new L,pf=new L,gc=new L,mf=new L,ji=class{constructor(e=new L,t=new L(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Xi)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=Xi.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Xi.copy(this.direction).multiplyScalar(t).add(this.origin),Xi.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){df.copy(e).add(t).multiplyScalar(.5),mc.copy(t).sub(e).normalize(),Mr.copy(this.origin).sub(df);let r=e.distanceTo(t)*.5,s=-this.direction.dot(mc),o=Mr.dot(this.direction),l=-Mr.dot(mc),c=Mr.lengthSq(),u=Math.abs(1-s*s),f,h,d,p;if(u>0)if(f=s*l-o,h=s*o-l,p=r*u,f>=0)if(h>=-p)if(h<=p){let m=1/u;f*=m,h*=m,d=f*(f+s*h+2*o)+h*(s*f+h+2*l)+c}else h=r,f=Math.max(0,-(s*h+o)),d=-f*f+h*(h+2*l)+c;else h=-r,f=Math.max(0,-(s*h+o)),d=-f*f+h*(h+2*l)+c;else h<=-p?(f=Math.max(0,-(-s*r+o)),h=f>0?-r:Math.min(Math.max(-r,-l),r),d=-f*f+h*(h+2*l)+c):h<=p?(f=0,h=Math.min(Math.max(-r,-l),r),d=h*(h+2*l)+c):(f=Math.max(0,-(s*r+o)),h=f>0?r:Math.min(Math.max(-r,-l),r),d=-f*f+h*(h+2*l)+c);else h=s>0?-r:r,f=Math.max(0,-(s*h+o)),d=-f*f+h*(h+2*l)+c;return n&&n.copy(this.direction).multiplyScalar(f).add(this.origin),i&&i.copy(mc).multiplyScalar(h).add(df),d}intersectSphere(e,t){Xi.subVectors(e.center,this.origin);let n=Xi.dot(this.direction),i=Xi.dot(Xi)-n*n,r=e.radius*e.radius;if(i>r)return null;let s=Math.sqrt(r-i),o=n-s,l=n+s;return o<0&&l<0?null:o<0?this.at(l,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;let n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){let n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,s,o,l,c=1/this.direction.x,u=1/this.direction.y,f=1/this.direction.z,h=this.origin;return c>=0?(n=(e.min.x-h.x)*c,i=(e.max.x-h.x)*c):(n=(e.max.x-h.x)*c,i=(e.min.x-h.x)*c),u>=0?(r=(e.min.y-h.y)*u,s=(e.max.y-h.y)*u):(r=(e.max.y-h.y)*u,s=(e.min.y-h.y)*u),n>s||r>i||((r>n||n!==n)&&(n=r),(s<i||i!==i)&&(i=s),f>=0?(o=(e.min.z-h.z)*f,l=(e.max.z-h.z)*f):(o=(e.max.z-h.z)*f,l=(e.min.z-h.z)*f),n>l||o>i)||((o>n||n!==n)&&(n=o),(l<i||i!==i)&&(i=l),i<0)?null:this.at(n>=0?n:i,t)}intersectsBox(e){return this.intersectBox(e,Xi)!==null}intersectTriangle(e,t,n,i,r){pf.subVectors(t,e),gc.subVectors(n,e),mf.crossVectors(pf,gc);let s=this.direction.dot(mf),o;if(s>0){if(i)return null;o=1}else if(s<0)o=-1,s=-s;else return null;Mr.subVectors(this.origin,e);let l=o*this.direction.dot(gc.crossVectors(Mr,gc));if(l<0)return null;let c=o*this.direction.dot(pf.cross(Mr));if(c<0||l+c>s)return null;let u=-o*Mr.dot(mf);return u<0?null:this.at(u/s,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},fe=class{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,i,r,s,o,l,c,u,f,h,d,p,m,v){let x=this.elements;return x[0]=e,x[4]=t,x[8]=n,x[12]=i,x[1]=r,x[5]=s,x[9]=o,x[13]=l,x[2]=c,x[6]=u,x[10]=f,x[14]=h,x[3]=d,x[7]=p,x[11]=m,x[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new fe().fromArray(this.elements)}copy(e){let t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){let t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,n=e.elements,i=1/uo.setFromMatrixColumn(e,0).length(),r=1/uo.setFromMatrixColumn(e,1).length(),s=1/uo.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*s,t[9]=n[9]*s,t[10]=n[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");let t=this.elements,n=e.x,i=e.y,r=e.z,s=Math.cos(n),o=Math.sin(n),l=Math.cos(i),c=Math.sin(i),u=Math.cos(r),f=Math.sin(r);if(e.order==="XYZ"){let h=s*u,d=s*f,p=o*u,m=o*f;t[0]=l*u,t[4]=-l*f,t[8]=c,t[1]=d+p*c,t[5]=h-m*c,t[9]=-o*l,t[2]=m-h*c,t[6]=p+d*c,t[10]=s*l}else if(e.order==="YXZ"){let h=l*u,d=l*f,p=c*u,m=c*f;t[0]=h+m*o,t[4]=p*o-d,t[8]=s*c,t[1]=s*f,t[5]=s*u,t[9]=-o,t[2]=d*o-p,t[6]=m+h*o,t[10]=s*l}else if(e.order==="ZXY"){let h=l*u,d=l*f,p=c*u,m=c*f;t[0]=h-m*o,t[4]=-s*f,t[8]=p+d*o,t[1]=d+p*o,t[5]=s*u,t[9]=m-h*o,t[2]=-s*c,t[6]=o,t[10]=s*l}else if(e.order==="ZYX"){let h=s*u,d=s*f,p=o*u,m=o*f;t[0]=l*u,t[4]=p*c-d,t[8]=h*c+m,t[1]=l*f,t[5]=m*c+h,t[9]=d*c-p,t[2]=-c,t[6]=o*l,t[10]=s*l}else if(e.order==="YZX"){let h=s*l,d=s*c,p=o*l,m=o*c;t[0]=l*u,t[4]=m-h*f,t[8]=p*f+d,t[1]=f,t[5]=s*u,t[9]=-o*u,t[2]=-c*u,t[6]=d*f+p,t[10]=h-m*f}else if(e.order==="XZY"){let h=s*l,d=s*c,p=o*l,m=o*c;t[0]=l*u,t[4]=-f,t[8]=c*u,t[1]=h*f+m,t[5]=s*u,t[9]=d*f-p,t[2]=p*f-d,t[6]=o*u,t[10]=m*f+h}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Q_,e,K_)}lookAt(e,t,n){let i=this.elements;return An.subVectors(e,t),An.lengthSq()===0&&(An.z=1),An.normalize(),Sr.crossVectors(n,An),Sr.lengthSq()===0&&(Math.abs(n.z)===1?An.x+=1e-4:An.z+=1e-4,An.normalize(),Sr.crossVectors(n,An)),Sr.normalize(),xc.crossVectors(An,Sr),i[0]=Sr.x,i[4]=xc.x,i[8]=An.x,i[1]=Sr.y,i[5]=xc.y,i[9]=An.y,i[2]=Sr.z,i[6]=xc.z,i[10]=An.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let n=e.elements,i=t.elements,r=this.elements,s=n[0],o=n[4],l=n[8],c=n[12],u=n[1],f=n[5],h=n[9],d=n[13],p=n[2],m=n[6],v=n[10],x=n[14],g=n[3],y=n[7],_=n[11],w=n[15],b=i[0],S=i[4],M=i[8],T=i[12],E=i[1],A=i[5],I=i[9],C=i[13],R=i[2],D=i[6],F=i[10],O=i[14],U=i[3],j=i[7],Z=i[11],K=i[15];return r[0]=s*b+o*E+l*R+c*U,r[4]=s*S+o*A+l*D+c*j,r[8]=s*M+o*I+l*F+c*Z,r[12]=s*T+o*C+l*O+c*K,r[1]=u*b+f*E+h*R+d*U,r[5]=u*S+f*A+h*D+d*j,r[9]=u*M+f*I+h*F+d*Z,r[13]=u*T+f*C+h*O+d*K,r[2]=p*b+m*E+v*R+x*U,r[6]=p*S+m*A+v*D+x*j,r[10]=p*M+m*I+v*F+x*Z,r[14]=p*T+m*C+v*O+x*K,r[3]=g*b+y*E+_*R+w*U,r[7]=g*S+y*A+_*D+w*j,r[11]=g*M+y*I+_*F+w*Z,r[15]=g*T+y*C+_*O+w*K,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],s=e[1],o=e[5],l=e[9],c=e[13],u=e[2],f=e[6],h=e[10],d=e[14],p=e[3],m=e[7],v=e[11],x=e[15];return p*(+r*l*f-i*c*f-r*o*h+n*c*h+i*o*d-n*l*d)+m*(+t*l*d-t*c*h+r*s*h-i*s*d+i*c*u-r*l*u)+v*(+t*c*f-t*o*d-r*s*f+n*s*d+r*o*u-n*c*u)+x*(-i*o*u-t*l*f+t*o*h+i*s*f-n*s*h+n*l*u)}transpose(){let e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){let i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){let e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],o=e[5],l=e[6],c=e[7],u=e[8],f=e[9],h=e[10],d=e[11],p=e[12],m=e[13],v=e[14],x=e[15],g=f*v*c-m*h*c+m*l*d-o*v*d-f*l*x+o*h*x,y=p*h*c-u*v*c-p*l*d+s*v*d+u*l*x-s*h*x,_=u*m*c-p*f*c+p*o*d-s*m*d-u*o*x+s*f*x,w=p*f*l-u*m*l-p*o*h+s*m*h+u*o*v-s*f*v,b=t*g+n*y+i*_+r*w;if(b===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let S=1/b;return e[0]=g*S,e[1]=(m*h*r-f*v*r-m*i*d+n*v*d+f*i*x-n*h*x)*S,e[2]=(o*v*r-m*l*r+m*i*c-n*v*c-o*i*x+n*l*x)*S,e[3]=(f*l*r-o*h*r-f*i*c+n*h*c+o*i*d-n*l*d)*S,e[4]=y*S,e[5]=(u*v*r-p*h*r+p*i*d-t*v*d-u*i*x+t*h*x)*S,e[6]=(p*l*r-s*v*r-p*i*c+t*v*c+s*i*x-t*l*x)*S,e[7]=(s*h*r-u*l*r+u*i*c-t*h*c-s*i*d+t*l*d)*S,e[8]=_*S,e[9]=(p*f*r-u*m*r-p*n*d+t*m*d+u*n*x-t*f*x)*S,e[10]=(s*m*r-p*o*r+p*n*c-t*m*c-s*n*x+t*o*x)*S,e[11]=(u*o*r-s*f*r-u*n*c+t*f*c+s*n*d-t*o*d)*S,e[12]=w*S,e[13]=(u*m*i-p*f*i+p*n*h-t*m*h-u*n*v+t*f*v)*S,e[14]=(p*o*i-s*m*i-p*n*l+t*m*l+s*n*v-t*o*v)*S,e[15]=(s*f*i-u*o*i+u*n*l-t*f*l-s*n*h+t*o*h)*S,this}scale(e){let t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let n=Math.cos(t),i=Math.sin(t),r=1-n,s=e.x,o=e.y,l=e.z,c=r*s,u=r*o;return this.set(c*s+n,c*o-i*l,c*l+i*o,0,c*o+i*l,u*o+n,u*l-i*s,0,c*l-i*o,u*l+i*s,r*l*l+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,s){return this.set(1,n,r,0,e,1,s,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){let i=this.elements,r=t._x,s=t._y,o=t._z,l=t._w,c=r+r,u=s+s,f=o+o,h=r*c,d=r*u,p=r*f,m=s*u,v=s*f,x=o*f,g=l*c,y=l*u,_=l*f,w=n.x,b=n.y,S=n.z;return i[0]=(1-(m+x))*w,i[1]=(d+_)*w,i[2]=(p-y)*w,i[3]=0,i[4]=(d-_)*b,i[5]=(1-(h+x))*b,i[6]=(v+g)*b,i[7]=0,i[8]=(p+y)*S,i[9]=(v-g)*S,i[10]=(1-(h+m))*S,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){let i=this.elements,r=uo.set(i[0],i[1],i[2]).length(),s=uo.set(i[4],i[5],i[6]).length(),o=uo.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],Kn.copy(this);let c=1/r,u=1/s,f=1/o;return Kn.elements[0]*=c,Kn.elements[1]*=c,Kn.elements[2]*=c,Kn.elements[4]*=u,Kn.elements[5]*=u,Kn.elements[6]*=u,Kn.elements[8]*=f,Kn.elements[9]*=f,Kn.elements[10]*=f,t.setFromRotationMatrix(Kn),n.x=r,n.y=s,n.z=o,this}makePerspective(e,t,n,i,r,s){s===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");let o=this.elements,l=2*r/(t-e),c=2*r/(n-i),u=(t+e)/(t-e),f=(n+i)/(n-i),h=-(s+r)/(s-r),d=-2*s*r/(s-r);return o[0]=l,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=c,o[9]=f,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,n,i,r,s){let o=this.elements,l=1/(t-e),c=1/(n-i),u=1/(s-r),f=(t+e)*l,h=(n+i)*c,d=(s+r)*u;return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-f,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){let t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){let n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}};fe.prototype.isMatrix4=!0;var uo=new L,Kn=new fe,Q_=new L(0,0,0),K_=new L(1,1,1),Sr=new L,xc=new L,An=new L,w0=new fe,_0=new Ve,Ut=class{constructor(e=0,t=0,n=0,i=Ut.DefaultOrder){this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){let i=e.elements,r=i[0],s=i[4],o=i[8],l=i[1],c=i[5],u=i[9],f=i[2],h=i[6],d=i[10];switch(t){case"XYZ":this._y=Math.asin(Yt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(h,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Yt(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-f,r),this._z=0);break;case"ZXY":this._x=Math.asin(Yt(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-f,d),this._z=Math.atan2(-s,c)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-Yt(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-s,c));break;case"YZX":this._z=Math.asin(Yt(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-f,r)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-Yt(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,c),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-u,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return w0.makeRotationFromQuaternion(e),this.setFromRotationMatrix(w0,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return _0.setFromEuler(this),this.setFromQuaternion(_0,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new L(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}};Ut.prototype.isEuler=!0;Ut.DefaultOrder="XYZ";Ut.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var vc=class{constructor(){this.mask=1|0}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=4294967295|0}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!=0}},eb=0,b0=new L,fo=new Ve,qi=new fe,yc=new L,Ga=new L,tb=new L,nb=new Ve,M0=new L(1,0,0),S0=new L(0,1,0),T0=new L(0,0,1),ib={type:"added"},E0={type:"removed"},Re=class extends Sn{constructor(){super();Object.defineProperty(this,"id",{value:eb++}),this.uuid=Tn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Re.DefaultUp.clone();let e=new L,t=new Ut,n=new Ve,i=new L(1,1,1);function r(){n.setFromEuler(t,!1)}function s(){t.setFromQuaternion(n,void 0,!1)}t._onChange(r),n._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new fe},normalMatrix:{value:new Ye}}),this.matrix=new fe,this.matrixWorld=new fe,this.matrixAutoUpdate=Re.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new vc,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return fo.setFromAxisAngle(e,t),this.quaternion.multiply(fo),this}rotateOnWorldAxis(e,t){return fo.setFromAxisAngle(e,t),this.quaternion.premultiply(fo),this}rotateX(e){return this.rotateOnAxis(M0,e)}rotateY(e){return this.rotateOnAxis(S0,e)}rotateZ(e){return this.rotateOnAxis(T0,e)}translateOnAxis(e,t){return b0.copy(e).applyQuaternion(this.quaternion),this.position.add(b0.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(M0,e)}translateY(e){return this.translateOnAxis(S0,e)}translateZ(e){return this.translateOnAxis(T0,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(qi.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?yc.copy(e):yc.set(e,t,n);let i=this.parent;this.updateWorldMatrix(!0,!1),Ga.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?qi.lookAt(Ga,yc,this.up):qi.lookAt(yc,Ga,this.up),this.quaternion.setFromRotationMatrix(qi),i&&(qi.extractRotation(i.matrixWorld),fo.setFromRotationMatrix(qi),this.quaternion.premultiply(fo.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(ib)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}let t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(E0)),this}removeFromParent(){let e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){let t=this.children[e];t.parent=null,t.dispatchEvent(E0)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),qi.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),qi.multiply(e.parent.matrixWorld)),e.applyMatrix4(qi),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){let s=this.children[n].getObjectByProperty(e,t);if(s!==void 0)return s}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ga,e,tb),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ga,nb,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);let t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){let t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){let n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){let i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].updateWorldMatrix(!1,!0)}}toJSON(e){let t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON()));function r(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);let o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){let l=o.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){let f=l[c];r(e.shapes,f)}else r(e.shapes,l)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let o=[];for(let l=0,c=this.material.length;l<c;l++)o.push(r(e.materials,this.material[l]));i.material=o}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let o=0;o<this.children.length;o++)i.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let o=0;o<this.animations.length;o++){let l=this.animations[o];i.animations.push(r(e.animations,l))}}if(t){let o=s(e.geometries),l=s(e.materials),c=s(e.textures),u=s(e.images),f=s(e.shapes),h=s(e.skeletons),d=s(e.animations);o.length>0&&(n.geometries=o),l.length>0&&(n.materials=l),c.length>0&&(n.textures=c),u.length>0&&(n.images=u),f.length>0&&(n.shapes=f),h.length>0&&(n.skeletons=h),d.length>0&&(n.animations=d)}return n.object=i,n;function s(o){let l=[];for(let c in o){let u=o[c];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){let i=e.children[n];this.add(i.clone())}return this}};Re.DefaultUp=new L(0,1,0);Re.DefaultMatrixAutoUpdate=!0;Re.prototype.isObject3D=!0;var ei=new L,Yi=new L,gf=new L,Zi=new L,po=new L,mo=new L,A0=new L,xf=new L,vf=new L,yf=new L,pt=class{constructor(e=new L,t=new L,n=new L){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),ei.subVectors(e,t),i.cross(ei);let r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){ei.subVectors(i,t),Yi.subVectors(n,t),gf.subVectors(e,t);let s=ei.dot(ei),o=ei.dot(Yi),l=ei.dot(gf),c=Yi.dot(Yi),u=Yi.dot(gf),f=s*c-o*o;if(f===0)return r.set(-2,-1,-1);let h=1/f,d=(c*l-o*u)*h,p=(s*u-o*l)*h;return r.set(1-d-p,p,d)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,Zi),Zi.x>=0&&Zi.y>=0&&Zi.x+Zi.y<=1}static getUV(e,t,n,i,r,s,o,l){return this.getBarycoord(e,t,n,i,Zi),l.set(0,0),l.addScaledVector(r,Zi.x),l.addScaledVector(s,Zi.y),l.addScaledVector(o,Zi.z),l}static isFrontFacing(e,t,n,i){return ei.subVectors(n,t),Yi.subVectors(e,t),ei.cross(Yi).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return ei.subVectors(this.c,this.b),Yi.subVectors(this.a,this.b),ei.cross(Yi).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return pt.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return pt.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,r){return pt.getUV(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return pt.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return pt.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let n=this.a,i=this.b,r=this.c,s,o;po.subVectors(i,n),mo.subVectors(r,n),xf.subVectors(e,n);let l=po.dot(xf),c=mo.dot(xf);if(l<=0&&c<=0)return t.copy(n);vf.subVectors(e,i);let u=po.dot(vf),f=mo.dot(vf);if(u>=0&&f<=u)return t.copy(i);let h=l*f-u*c;if(h<=0&&l>=0&&u<=0)return s=l/(l-u),t.copy(n).addScaledVector(po,s);yf.subVectors(e,r);let d=po.dot(yf),p=mo.dot(yf);if(p>=0&&d<=p)return t.copy(r);let m=d*c-l*p;if(m<=0&&c>=0&&p<=0)return o=c/(c-p),t.copy(n).addScaledVector(mo,o);let v=u*p-d*f;if(v<=0&&f-u>=0&&d-p>=0)return A0.subVectors(r,i),o=(f-u)/(f-u+(d-p)),t.copy(i).addScaledVector(A0,o);let x=1/(v+m+h);return s=m*x,o=h*x,t.copy(n).addScaledVector(po,s).addScaledVector(mo,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},rb=0,St=class extends Sn{constructor(){super();Object.defineProperty(this,"id",{value:rb++}),this.uuid=Tn(),this.name="",this.type="Material",this.fog=!0,this.blending=Ks,this.side=zi,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=ku,this.blendDst=zu,this.blendEquation=cs,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=ic,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=m0,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=hc,this.stencilZFail=hc,this.stencilZPass=hc,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}onBuild(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(let t in e){let n=e[t];if(n===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===Iu;continue}let i=this[t];if(i===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n}}toJSON(e){let t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});let n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Ks&&(n.blending=this.blending),this.side!==zi&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(n.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.morphTargets===!0&&(n.morphTargets=!0),this.morphNormals===!0&&(n.morphNormals=!0),this.flatShading===!0&&(n.flatShading=this.flatShading),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData);function i(r){let s=[];for(let o in r){let l=r[o];delete l.metadata,s.push(l)}return s}if(t){let r=i(e.textures),s=i(e.images);r.length>0&&(n.textures=r),s.length>0&&(n.images=s)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,n=null;if(t!==null){let i=t.length;n=new Array(i);for(let r=0;r!==i;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}};St.prototype.isMaterial=!0;var P0={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ti={h:0,s:0,l:0},wc={h:0,s:0,l:0};function wf(a,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?a+(e-a)*6*t:t<1/2?e:t<2/3?a+(e-a)*6*(2/3-t):a}function _f(a){return a<.04045?a*.0773993808:Math.pow(a*.9478672986+.0521327014,2.4)}function bf(a){return a<.0031308?a*12.92:1.055*Math.pow(a,.41666)-.055}var ue=class{constructor(e,t,n){return t===void 0&&n===void 0?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this}setRGB(e,t,n){return this.r=e,this.g=t,this.b=n,this}setHSL(e,t,n){if(e=rf(e,1),t=Yt(t,0,1),n=Yt(n,0,1),t===0)this.r=this.g=this.b=n;else{let i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=wf(r,i,e+1/3),this.g=wf(r,i,e),this.b=wf(r,i,e-1/3)}return this}setStyle(e){function t(i){i!==void 0&&parseFloat(i)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let i,r=n[1],s=n[2];switch(r){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,t(i[4]),this;if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,t(i[4]),this;break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){let o=parseFloat(i[1])/360,l=parseInt(i[2],10)/100,c=parseInt(i[3],10)/100;return t(i[4]),this.setHSL(o,l,c)}break}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){let i=n[1],r=i.length;if(r===3)return this.r=parseInt(i.charAt(0)+i.charAt(0),16)/255,this.g=parseInt(i.charAt(1)+i.charAt(1),16)/255,this.b=parseInt(i.charAt(2)+i.charAt(2),16)/255,this;if(r===6)return this.r=parseInt(i.charAt(0)+i.charAt(1),16)/255,this.g=parseInt(i.charAt(2)+i.charAt(3),16)/255,this.b=parseInt(i.charAt(4)+i.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){let t=P0[e.toLowerCase()];return t!==void 0?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){let n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=_f(e.r),this.g=_f(e.g),this.b=_f(e.b),this}copyLinearToSRGB(e){return this.r=bf(e.r),this.g=bf(e.g),this.b=bf(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return this.r*255<<16^this.g*255<<8^this.b*255<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){let t=this.r,n=this.g,i=this.b,r=Math.max(t,n,i),s=Math.min(t,n,i),o,l,c=(s+r)/2;if(s===r)o=0,l=0;else{let u=r-s;switch(l=c<=.5?u/(r+s):u/(2-r-s),r){case t:o=(n-i)/u+(n<i?6:0);break;case n:o=(i-t)/u+2;break;case i:o=(t-n)/u+4;break}o/=6}return e.h=o,e.s=l,e.l=c,e}getStyle(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"}offsetHSL(e,t,n){return this.getHSL(ti),ti.h+=e,ti.s+=t,ti.l+=n,this.setHSL(ti.h,ti.s,ti.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(ti),e.getHSL(wc);let n=Ua(ti.h,wc.h,t),i=Ua(ti.s,wc.s,t),r=Ua(ti.l,wc.l,t);return this.setHSL(n,i,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),e.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}};ue.NAMES=P0;ue.prototype.isColor=!0;ue.prototype.r=1;ue.prototype.g=1;ue.prototype.b=1;var ct=class extends St{constructor(e){super();this.type="MeshBasicMaterial",this.color=new ue(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ra,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this}};ct.prototype.isMeshBasicMaterial=!0;var ht=new L,_c=new J,Se=class{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n===!0,this.usage=Gi,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){let t=this.array,n=0;for(let i=0,r=e.length;i<r;i++){let s=e[i];s===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),s=new ue),t[n++]=s.r,t[n++]=s.g,t[n++]=s.b}return this}copyVector2sArray(e){let t=this.array,n=0;for(let i=0,r=e.length;i<r;i++){let s=e[i];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),s=new J),t[n++]=s.x,t[n++]=s.y}return this}copyVector3sArray(e){let t=this.array,n=0;for(let i=0,r=e.length;i<r;i++){let s=e[i];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),s=new L),t[n++]=s.x,t[n++]=s.y,t[n++]=s.z}return this}copyVector4sArray(e){let t=this.array,n=0;for(let i=0,r=e.length;i<r;i++){let s=e[i];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),s=new De),t[n++]=s.x,t[n++]=s.y,t[n++]=s.z,t[n++]=s.w}return this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)_c.fromBufferAttribute(this,t),_c.applyMatrix3(e),this.setXY(t,_c.x,_c.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)ht.fromBufferAttribute(this,t),ht.applyMatrix3(e),this.setXYZ(t,ht.x,ht.y,ht.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)ht.x=this.getX(t),ht.y=this.getY(t),ht.z=this.getZ(t),ht.applyMatrix4(e),this.setXYZ(t,ht.x,ht.y,ht.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)ht.x=this.getX(t),ht.y=this.getY(t),ht.z=this.getZ(t),ht.applyNormalMatrix(e),this.setXYZ(t,ht.x,ht.y,ht.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)ht.x=this.getX(t),ht.y=this.getY(t),ht.z=this.getZ(t),ht.transformDirection(e),this.setXYZ(t,ht.x,ht.y,ht.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Gi&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}};Se.prototype.isBufferAttribute=!0;var Mf=class extends Se{constructor(e,t,n){super(new Int8Array(e),t,n)}},Sf=class extends Se{constructor(e,t,n){super(new Uint8Array(e),t,n)}},Tf=class extends Se{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}},Ef=class extends Se{constructor(e,t,n){super(new Int16Array(e),t,n)}},ws=class extends Se{constructor(e,t,n){super(new Uint16Array(e),t,n)}},Af=class extends Se{constructor(e,t,n){super(new Int32Array(e),t,n)}},Wa=class extends Se{constructor(e,t,n){super(new Uint32Array(e),t,n)}},Pf=class extends Se{constructor(e,t,n){super(new Uint16Array(e),t,n)}};Pf.prototype.isFloat16BufferAttribute=!0;var pe=class extends Se{constructor(e,t,n){super(new Float32Array(e),t,n)}},Cf=class extends Se{constructor(e,t,n){super(new Float64Array(e),t,n)}};function C0(a){if(a.length===0)return-1/0;let e=a[0];for(let t=1,n=a.length;t<n;++t)a[t]>e&&(e=a[t]);return e}var sb={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function go(a,e){return new sb[a](e)}var ob=0,Nn=new fe,Lf=new Re,xo=new L,Pn=new Dt,Xa=new Dt,Vt=new L,ye=class extends Sn{constructor(){super();Object.defineProperty(this,"id",{value:ob++}),this.uuid=Tn(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(C0(e)>65535?Wa:ws)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);let n=this.attributes.normal;if(n!==void 0){let r=new Ye().getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}let i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Nn.makeRotationFromQuaternion(e),this.applyMatrix4(Nn),this}rotateX(e){return Nn.makeRotationX(e),this.applyMatrix4(Nn),this}rotateY(e){return Nn.makeRotationY(e),this.applyMatrix4(Nn),this}rotateZ(e){return Nn.makeRotationZ(e),this.applyMatrix4(Nn),this}translate(e,t,n){return Nn.makeTranslation(e,t,n),this.applyMatrix4(Nn),this}scale(e,t,n){return Nn.makeScale(e,t,n),this.applyMatrix4(Nn),this}lookAt(e){return Lf.lookAt(e),Lf.updateMatrix(),this.applyMatrix4(Lf.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(xo).negate(),this.translate(xo.x,xo.y,xo.z),this}setFromPoints(e){let t=[];for(let n=0,i=e.length;n<i;n++){let r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new pe(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Dt);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new L(-1/0,-1/0,-1/0),new L(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){let r=t[n];Pn.setFromBufferAttribute(r),this.morphTargetsRelative?(Vt.addVectors(this.boundingBox.min,Pn.min),this.boundingBox.expandByPoint(Vt),Vt.addVectors(this.boundingBox.max,Pn.max),this.boundingBox.expandByPoint(Vt)):(this.boundingBox.expandByPoint(Pn.min),this.boundingBox.expandByPoint(Pn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new En);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new L,1/0);return}if(e){let n=this.boundingSphere.center;if(Pn.setFromBufferAttribute(e),t)for(let r=0,s=t.length;r<s;r++){let o=t[r];Xa.setFromBufferAttribute(o),this.morphTargetsRelative?(Vt.addVectors(Pn.min,Xa.min),Pn.expandByPoint(Vt),Vt.addVectors(Pn.max,Xa.max),Pn.expandByPoint(Vt)):(Pn.expandByPoint(Xa.min),Pn.expandByPoint(Xa.max))}Pn.getCenter(n);let i=0;for(let r=0,s=e.count;r<s;r++)Vt.fromBufferAttribute(e,r),i=Math.max(i,n.distanceToSquared(Vt));if(t)for(let r=0,s=t.length;r<s;r++){let o=t[r],l=this.morphTargetsRelative;for(let c=0,u=o.count;c<u;c++)Vt.fromBufferAttribute(o,c),l&&(xo.fromBufferAttribute(e,c),Vt.add(xo)),i=Math.max(i,n.distanceToSquared(Vt))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeFaceNormals(){}computeTangents(){let e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let n=e.array,i=t.position.array,r=t.normal.array,s=t.uv.array,o=i.length/3;t.tangent===void 0&&this.setAttribute("tangent",new Se(new Float32Array(4*o),4));let l=t.tangent.array,c=[],u=[];for(let E=0;E<o;E++)c[E]=new L,u[E]=new L;let f=new L,h=new L,d=new L,p=new J,m=new J,v=new J,x=new L,g=new L;function y(E,A,I){f.fromArray(i,E*3),h.fromArray(i,A*3),d.fromArray(i,I*3),p.fromArray(s,E*2),m.fromArray(s,A*2),v.fromArray(s,I*2),h.sub(f),d.sub(f),m.sub(p),v.sub(p);let C=1/(m.x*v.y-v.x*m.y);!isFinite(C)||(x.copy(h).multiplyScalar(v.y).addScaledVector(d,-m.y).multiplyScalar(C),g.copy(d).multiplyScalar(m.x).addScaledVector(h,-v.x).multiplyScalar(C),c[E].add(x),c[A].add(x),c[I].add(x),u[E].add(g),u[A].add(g),u[I].add(g))}let _=this.groups;_.length===0&&(_=[{start:0,count:n.length}]);for(let E=0,A=_.length;E<A;++E){let I=_[E],C=I.start,R=I.count;for(let D=C,F=C+R;D<F;D+=3)y(n[D+0],n[D+1],n[D+2])}let w=new L,b=new L,S=new L,M=new L;function T(E){S.fromArray(r,E*3),M.copy(S);let A=c[E];w.copy(A),w.sub(S.multiplyScalar(S.dot(A))).normalize(),b.crossVectors(M,A);let C=b.dot(u[E])<0?-1:1;l[E*4]=w.x,l[E*4+1]=w.y,l[E*4+2]=w.z,l[E*4+3]=C}for(let E=0,A=_.length;E<A;++E){let I=_[E],C=I.start,R=I.count;for(let D=C,F=C+R;D<F;D+=3)T(n[D+0]),T(n[D+1]),T(n[D+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Se(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let h=0,d=n.count;h<d;h++)n.setXYZ(h,0,0,0);let i=new L,r=new L,s=new L,o=new L,l=new L,c=new L,u=new L,f=new L;if(e)for(let h=0,d=e.count;h<d;h+=3){let p=e.getX(h+0),m=e.getX(h+1),v=e.getX(h+2);i.fromBufferAttribute(t,p),r.fromBufferAttribute(t,m),s.fromBufferAttribute(t,v),u.subVectors(s,r),f.subVectors(i,r),u.cross(f),o.fromBufferAttribute(n,p),l.fromBufferAttribute(n,m),c.fromBufferAttribute(n,v),o.add(u),l.add(u),c.add(u),n.setXYZ(p,o.x,o.y,o.z),n.setXYZ(m,l.x,l.y,l.z),n.setXYZ(v,c.x,c.y,c.z)}else for(let h=0,d=t.count;h<d;h+=3)i.fromBufferAttribute(t,h+0),r.fromBufferAttribute(t,h+1),s.fromBufferAttribute(t,h+2),u.subVectors(s,r),f.subVectors(i,r),u.cross(f),n.setXYZ(h+0,u.x,u.y,u.z),n.setXYZ(h+1,u.x,u.y,u.z),n.setXYZ(h+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(e,t){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));let n=this.attributes;for(let i in n){if(e.attributes[i]===void 0)continue;let s=n[i].array,o=e.attributes[i],l=o.array,c=o.itemSize*t,u=Math.min(l.length,s.length-c);for(let f=0,h=c;f<u;f++,h++)s[h]=l[f]}return this}normalizeNormals(){let e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Vt.fromBufferAttribute(e,t),Vt.normalize(),e.setXYZ(t,Vt.x,Vt.y,Vt.z)}toNonIndexed(){function e(o,l){let c=o.array,u=o.itemSize,f=o.normalized,h=new c.constructor(l.length*u),d=0,p=0;for(let m=0,v=l.length;m<v;m++){o.isInterleavedBufferAttribute?d=l[m]*o.data.stride+o.offset:d=l[m]*u;for(let x=0;x<u;x++)h[p++]=c[d++]}return new Se(h,u,f)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new ye,n=this.index.array,i=this.attributes;for(let o in i){let l=i[o],c=e(l,n);t.setAttribute(o,c)}let r=this.morphAttributes;for(let o in r){let l=[],c=r[o];for(let u=0,f=c.length;u<f;u++){let h=c[u],d=e(h,n);l.push(d)}t.morphAttributes[o]=l}t.morphTargetsRelative=this.morphTargetsRelative;let s=this.groups;for(let o=0,l=s.length;o<l;o++){let c=s[o];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){let e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){let l=this.parameters;for(let c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};let t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let n=this.attributes;for(let l in n){let c=n[l];e.data.attributes[l]=c.toJSON(e.data)}let i={},r=!1;for(let l in this.morphAttributes){let c=this.morphAttributes[l],u=[];for(let f=0,h=c.length;f<h;f++){let d=c[f];u.push(d.toJSON(e.data))}u.length>0&&(i[l]=u,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);let s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));let o=this.boundingSphere;return o!==null&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return new ye().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let n=e.index;n!==null&&this.setIndex(n.clone(t));let i=e.attributes;for(let c in i){let u=i[c];this.setAttribute(c,u.clone(t))}let r=e.morphAttributes;for(let c in r){let u=[],f=r[c];for(let h=0,d=f.length;h<d;h++)u.push(f[h].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;let s=e.groups;for(let c=0,u=s.length;c<u;c++){let f=s[c];this.addGroup(f.start,f.count,f.materialIndex)}let o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());let l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}};ye.prototype.isBufferGeometry=!0;var L0=new fe,vo=new ji,Rf=new En,Tr=new L,Er=new L,Ar=new L,If=new L,Df=new L,Ff=new L,bc=new L,Mc=new L,Sc=new L,Tc=new J,Ec=new J,Ac=new J,Bf=new L,Pc=new L,Ce=class extends Re{constructor(e=new ye,t=new ct){super();this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let t=e.morphAttributes,n=Object.keys(t);if(n.length>0){let i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,s=i.length;r<s;r++){let o=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}else{let t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){let n=this.geometry,i=this.material,r=this.matrixWorld;if(i===void 0||(n.boundingSphere===null&&n.computeBoundingSphere(),Rf.copy(n.boundingSphere),Rf.applyMatrix4(r),e.ray.intersectsSphere(Rf)===!1)||(L0.copy(r).invert(),vo.copy(e.ray).applyMatrix4(L0),n.boundingBox!==null&&vo.intersectsBox(n.boundingBox)===!1))return;let s;if(n.isBufferGeometry){let o=n.index,l=n.attributes.position,c=n.morphAttributes.position,u=n.morphTargetsRelative,f=n.attributes.uv,h=n.attributes.uv2,d=n.groups,p=n.drawRange;if(o!==null)if(Array.isArray(i))for(let m=0,v=d.length;m<v;m++){let x=d[m],g=i[x.materialIndex],y=Math.max(x.start,p.start),_=Math.min(x.start+x.count,p.start+p.count);for(let w=y,b=_;w<b;w+=3){let S=o.getX(w),M=o.getX(w+1),T=o.getX(w+2);s=Cc(this,g,e,vo,l,c,u,f,h,S,M,T),s&&(s.faceIndex=Math.floor(w/3),s.face.materialIndex=x.materialIndex,t.push(s))}}else{let m=Math.max(0,p.start),v=Math.min(o.count,p.start+p.count);for(let x=m,g=v;x<g;x+=3){let y=o.getX(x),_=o.getX(x+1),w=o.getX(x+2);s=Cc(this,i,e,vo,l,c,u,f,h,y,_,w),s&&(s.faceIndex=Math.floor(x/3),t.push(s))}}else if(l!==void 0)if(Array.isArray(i))for(let m=0,v=d.length;m<v;m++){let x=d[m],g=i[x.materialIndex],y=Math.max(x.start,p.start),_=Math.min(x.start+x.count,p.start+p.count);for(let w=y,b=_;w<b;w+=3){let S=w,M=w+1,T=w+2;s=Cc(this,g,e,vo,l,c,u,f,h,S,M,T),s&&(s.faceIndex=Math.floor(w/3),s.face.materialIndex=x.materialIndex,t.push(s))}}else{let m=Math.max(0,p.start),v=Math.min(l.count,p.start+p.count);for(let x=m,g=v;x<g;x+=3){let y=x,_=x+1,w=x+2;s=Cc(this,i,e,vo,l,c,u,f,h,y,_,w),s&&(s.faceIndex=Math.floor(x/3),t.push(s))}}}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}};Ce.prototype.isMesh=!0;function ab(a,e,t,n,i,r,s,o){let l;if(e.side===gt?l=n.intersectTriangle(s,r,i,!0,o):l=n.intersectTriangle(i,r,s,e.side!==Mn,o),l===null)return null;Pc.copy(o),Pc.applyMatrix4(a.matrixWorld);let c=t.ray.origin.distanceTo(Pc);return c<t.near||c>t.far?null:{distance:c,point:Pc.clone(),object:a}}function Cc(a,e,t,n,i,r,s,o,l,c,u,f){Tr.fromBufferAttribute(i,c),Er.fromBufferAttribute(i,u),Ar.fromBufferAttribute(i,f);let h=a.morphTargetInfluences;if(e.morphTargets&&r&&h){bc.set(0,0,0),Mc.set(0,0,0),Sc.set(0,0,0);for(let p=0,m=r.length;p<m;p++){let v=h[p],x=r[p];v!==0&&(If.fromBufferAttribute(x,c),Df.fromBufferAttribute(x,u),Ff.fromBufferAttribute(x,f),s?(bc.addScaledVector(If,v),Mc.addScaledVector(Df,v),Sc.addScaledVector(Ff,v)):(bc.addScaledVector(If.sub(Tr),v),Mc.addScaledVector(Df.sub(Er),v),Sc.addScaledVector(Ff.sub(Ar),v)))}Tr.add(bc),Er.add(Mc),Ar.add(Sc)}a.isSkinnedMesh&&(a.boneTransform(c,Tr),a.boneTransform(u,Er),a.boneTransform(f,Ar));let d=ab(a,e,t,n,Tr,Er,Ar,Bf);if(d){o&&(Tc.fromBufferAttribute(o,c),Ec.fromBufferAttribute(o,u),Ac.fromBufferAttribute(o,f),d.uv=pt.getUV(Bf,Tr,Er,Ar,Tc,Ec,Ac,new J)),l&&(Tc.fromBufferAttribute(l,c),Ec.fromBufferAttribute(l,u),Ac.fromBufferAttribute(l,f),d.uv2=pt.getUV(Bf,Tr,Er,Ar,Tc,Ec,Ac,new J));let p={a:c,b:u,c:f,normal:new L,materialIndex:0};pt.getNormal(Tr,Er,Ar,p.normal),d.face=p}return d}var ni=class extends ye{constructor(e=1,t=1,n=1,i=1,r=1,s=1){super();this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:s};let o=this;i=Math.floor(i),r=Math.floor(r),s=Math.floor(s);let l=[],c=[],u=[],f=[],h=0,d=0;p("z","y","x",-1,-1,n,t,e,s,r,0),p("z","y","x",1,-1,n,t,-e,s,r,1),p("x","z","y",1,1,e,n,t,i,s,2),p("x","z","y",1,-1,e,n,-t,i,s,3),p("x","y","z",1,-1,e,t,n,i,r,4),p("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(l),this.setAttribute("position",new pe(c,3)),this.setAttribute("normal",new pe(u,3)),this.setAttribute("uv",new pe(f,2));function p(m,v,x,g,y,_,w,b,S,M,T){let E=_/S,A=w/M,I=_/2,C=w/2,R=b/2,D=S+1,F=M+1,O=0,U=0,j=new L;for(let Z=0;Z<F;Z++){let K=Z*A-C;for(let G=0;G<D;G++){let k=G*E-I;j[m]=k*g,j[v]=K*y,j[x]=R,c.push(j.x,j.y,j.z),j[m]=0,j[v]=0,j[x]=b>0?1:-1,u.push(j.x,j.y,j.z),f.push(G/S),f.push(1-Z/M),O+=1}}for(let Z=0;Z<M;Z++)for(let K=0;K<S;K++){let G=h+K+D*Z,k=h+K+D*(Z+1),B=h+(K+1)+D*(Z+1),H=h+(K+1)+D*Z;l.push(G,k,H),l.push(k,B,H),U+=6}o.addGroup(d,U,T),d+=U,h+=O}}static fromJSON(e){return new ni(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function yo(a){let e={};for(let t in a){e[t]={};for(let n in a[t]){let i=a[t][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?e[t][n]=i.clone():Array.isArray(i)?e[t][n]=i.slice():e[t][n]=i}}return e}function en(a){let e={};for(let t=0;t<a.length;t++){let n=yo(a[t]);for(let i in n)e[i]=n[i]}return e}var Pr={clone:yo,merge:en},lb=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,cb=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,Ht=class extends St{constructor(e){super();this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=lb,this.fragmentShader=cb,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=yo(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(let i in this.uniforms){let s=this.uniforms[i].value;s&&s.isTexture?t.uniforms[i]={type:"t",value:s.toJSON(e).uuid}:s&&s.isColor?t.uniforms[i]={type:"c",value:s.getHex()}:s&&s.isVector2?t.uniforms[i]={type:"v2",value:s.toArray()}:s&&s.isVector3?t.uniforms[i]={type:"v3",value:s.toArray()}:s&&s.isVector4?t.uniforms[i]={type:"v4",value:s.toArray()}:s&&s.isMatrix3?t.uniforms[i]={type:"m3",value:s.toArray()}:s&&s.isMatrix4?t.uniforms[i]={type:"m4",value:s.toArray()}:t.uniforms[i]={value:s}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;let n={};for(let i in this.extensions)this.extensions[i]===!0&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}};Ht.prototype.isShaderMaterial=!0;var wo=class extends Re{constructor(){super();this.type="Camera",this.matrixWorldInverse=new fe,this.projectionMatrix=new fe,this.projectionMatrixInverse=new fe}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};wo.prototype.isCamera=!0;var it=class extends wo{constructor(e=50,t=1,n=.1,i=2e3){super();this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=za*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(xs*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return za*2*Math.atan(Math.tan(xs*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,i,r,s){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(xs*.5*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i,s=this.view;if(this.view!==null&&this.view.enabled){let l=s.fullWidth,c=s.fullHeight;r+=s.offsetX*i/l,t-=s.offsetY*n/c,i*=s.width/l,n*=s.height/c}let o=this.filmOffset;o!==0&&(r+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}};it.prototype.isPerspectiveCamera=!0;var _o=90,bo=1,ja=class extends Re{constructor(e,t,n){super();if(this.type="CubeCamera",n.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=n;let i=new it(_o,bo,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new L(1,0,0)),this.add(i);let r=new it(_o,bo,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new L(-1,0,0)),this.add(r);let s=new it(_o,bo,e,t);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new L(0,1,0)),this.add(s);let o=new it(_o,bo,e,t);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new L(0,-1,0)),this.add(o);let l=new it(_o,bo,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new L(0,0,1)),this.add(l);let c=new it(_o,bo,e,t);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new L(0,0,-1)),this.add(c)}update(e,t){this.parent===null&&this.updateMatrixWorld();let n=this.renderTarget,[i,r,s,o,l,c]=this.children,u=e.xr.enabled,f=e.getRenderTarget();e.xr.enabled=!1;let h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,r),e.setRenderTarget(n,2),e.render(t,s),e.setRenderTarget(n,3),e.render(t,o),e.setRenderTarget(n,4),e.render(t,l),n.texture.generateMipmaps=h,e.setRenderTarget(n,5),e.render(t,c),e.setRenderTarget(f),e.xr.enabled=u}},_s=class extends lt{constructor(e,t,n,i,r,s,o,l,c,u){e=e!==void 0?e:[],t=t!==void 0?t:Ia,o=o!==void 0?o:mn;super(e,t,n,i,r,s,o,l,c,u);this._needsFlipEnvMap=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}};_s.prototype.isCubeTexture=!0;var qa=class extends Zt{constructor(e,t,n){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=n);super(e,e,t);t=t||{},this.texture=new _s(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Ke,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=gn,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new ni(5,5,5),r=new Ht({name:"CubemapFromEquirect",uniforms:yo(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:gt,blending:Ui});r.uniforms.tEquirect.value=t;let s=new Ce(i,r),o=t.minFilter;return t.minFilter===mi&&(t.minFilter=Ke),new ja(1,10,this).update(e,s),t.minFilter=o,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,n,i){let r=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,n,i);e.setRenderTarget(r)}};qa.prototype.isWebGLCubeRenderTarget=!0;var Nf=new L,hb=new L,ub=new Ye,Tt=class{constructor(e=new L(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){let i=Nf.subVectors(n,t).cross(hb.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){let n=e.delta(Nf),i=this.normal.dot(n);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;let r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(n).multiplyScalar(r).add(e.start)}intersectsLine(e){let t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let n=t||ub.getNormalMatrix(e),i=this.coplanarPoint(Nf).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}};Tt.prototype.isPlane=!0;var Mo=new En,Lc=new L,So=class{constructor(e=new Tt,t=new Tt,n=new Tt,i=new Tt,r=new Tt,s=new Tt){this.planes=[e,t,n,i,r,s]}set(e,t,n,i,r,s){let o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(i),o[4].copy(r),o[5].copy(s),this}copy(e){let t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){let t=this.planes,n=e.elements,i=n[0],r=n[1],s=n[2],o=n[3],l=n[4],c=n[5],u=n[6],f=n[7],h=n[8],d=n[9],p=n[10],m=n[11],v=n[12],x=n[13],g=n[14],y=n[15];return t[0].setComponents(o-i,f-l,m-h,y-v).normalize(),t[1].setComponents(o+i,f+l,m+h,y+v).normalize(),t[2].setComponents(o+r,f+c,m+d,y+x).normalize(),t[3].setComponents(o-r,f-c,m-d,y-x).normalize(),t[4].setComponents(o-s,f-u,m-p,y-g).normalize(),t[5].setComponents(o+s,f+u,m+p,y+g).normalize(),this}intersectsObject(e){let t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),Mo.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Mo)}intersectsSprite(e){return Mo.center.set(0,0,0),Mo.radius=.7071067811865476,Mo.applyMatrix4(e.matrixWorld),this.intersectsSphere(Mo)}intersectsSphere(e){let t=this.planes,n=e.center,i=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){let t=this.planes;for(let n=0;n<6;n++){let i=t[n];if(Lc.x=i.normal.x>0?e.max.x:e.min.x,Lc.y=i.normal.y>0?e.max.y:e.min.y,Lc.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Lc)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function R0(){let a=null,e=!1,t=null,n=null;function i(r,s){t(r,s),n=a.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(n=a.requestAnimationFrame(i),e=!0)},stop:function(){a.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){a=r}}}function fb(a,e){let t=e.isWebGL2,n=new WeakMap;function i(c,u){let f=c.array,h=c.usage,d=a.createBuffer();a.bindBuffer(u,d),a.bufferData(u,f,h),c.onUploadCallback();let p=5126;return f instanceof Float32Array?p=5126:f instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):f instanceof Uint16Array?c.isFloat16BufferAttribute?t?p=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):p=5123:f instanceof Int16Array?p=5122:f instanceof Uint32Array?p=5125:f instanceof Int32Array?p=5124:f instanceof Int8Array?p=5120:(f instanceof Uint8Array||f instanceof Uint8ClampedArray)&&(p=5121),{buffer:d,type:p,bytesPerElement:f.BYTES_PER_ELEMENT,version:c.version}}function r(c,u,f){let h=u.array,d=u.updateRange;a.bindBuffer(f,c),d.count===-1?a.bufferSubData(f,0,h):(t?a.bufferSubData(f,d.offset*h.BYTES_PER_ELEMENT,h,d.offset,d.count):a.bufferSubData(f,d.offset*h.BYTES_PER_ELEMENT,h.subarray(d.offset,d.offset+d.count)),d.count=-1)}function s(c){return c.isInterleavedBufferAttribute&&(c=c.data),n.get(c)}function o(c){c.isInterleavedBufferAttribute&&(c=c.data);let u=n.get(c);u&&(a.deleteBuffer(u.buffer),n.delete(c))}function l(c,u){if(c.isGLBufferAttribute){let h=n.get(c);(!h||h.version<c.version)&&n.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);let f=n.get(c);f===void 0?n.set(c,i(c,u)):f.version<c.version&&(r(f.buffer,c,u),f.version=c.version)}return{get:s,remove:o,update:l}}var tn=class extends ye{constructor(e=1,t=1,n=1,i=1){super();this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};let r=e/2,s=t/2,o=Math.floor(n),l=Math.floor(i),c=o+1,u=l+1,f=e/o,h=t/l,d=[],p=[],m=[],v=[];for(let x=0;x<u;x++){let g=x*h-s;for(let y=0;y<c;y++){let _=y*f-r;p.push(_,-g,0),m.push(0,0,1),v.push(y/o),v.push(1-x/l)}}for(let x=0;x<l;x++)for(let g=0;g<o;g++){let y=g+c*x,_=g+c*(x+1),w=g+1+c*(x+1),b=g+1+c*x;d.push(y,_,b),d.push(_,w,b)}this.setIndex(d),this.setAttribute("position",new pe(p,3)),this.setAttribute("normal",new pe(m,3)),this.setAttribute("uv",new pe(v,2))}static fromJSON(e){return new tn(e.width,e.height,e.widthSegments,e.heightSegments)}},db=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,pb=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,mb=`#ifdef ALPHATEST
	if ( diffuseColor.a < ALPHATEST ) discard;
#endif`,gb=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );
	#endif
#endif`,xb=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,vb="vec3 transformed = vec3( position );",yb=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,wb=`vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	return vec2( -1.04, 1.04 ) * a004 + r.zw;
}
float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
#if defined ( PHYSICALLY_CORRECT_LIGHTS )
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
#else
	if( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
		return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );
	}
	return 1.0;
#endif
}
vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 specularColor, const in float dotVH ) {
	float fresnel = exp2( ( -5.55473 * dotVH - 6.98316 ) * dotVH );
	return ( 1.0 - specularColor ) * fresnel + specularColor;
}
vec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {
	float fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );
	vec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;
	return Fr * fresnel + F0;
}
float G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	return 1.0 / ( gl * gv );
}
float G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + viewDir );
	float dotNL = saturate( dot( normal, incidentLight.direction ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( G * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
vec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	return specularColor * brdf.x + brdf.y;
}
void BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	vec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	vec3 FssEss = F * brdf.x + brdf.y;
	float Ess = brdf.x + brdf.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
float GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {
	return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );
}
float BlinnExponentToGGXRoughness( const in float blinnExponent ) {
	return sqrt( 2.0 / ( blinnExponent + 2.0 ) );
}
#if defined( USE_SHEEN )
float D_Charlie(float roughness, float NoH) {
	float invAlpha = 1.0 / roughness;
	float cos2h = NoH * NoH;
	float sin2h = max(1.0 - cos2h, 0.0078125);	return (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);
}
float V_Neubelt(float NoV, float NoL) {
	return saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));
}
vec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {
	vec3 N = geometry.normal;
	vec3 V = geometry.viewDir;
	vec3 H = normalize( V + L );
	float dotNH = saturate( dot( N, H ) );
	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );
}
#endif`,_b=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,bb=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,Mb=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Sb=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,Tb=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Eb=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Ab=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Pb=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,Cb=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,Lb=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement(a) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract(sin(sn) * c);
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
vec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	float distance = dot( planeNormal, point - pointOnPlane );
	return - distance * planeNormal + point;
}
float sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return sign( dot( point - pointOnPlane, planeNormal ) );
}
vec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,Rb=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_maxMipLevel 8.0
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_maxTileSize 256.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		float texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );
		vec2 f = fract( uv );
		uv += 0.5 - f;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		if ( mipInt < cubeUV_maxMipLevel ) {
			uv.y += 2.0 * cubeUV_maxTileSize;
		}
		uv.y += filterInt * 2.0 * cubeUV_minTileSize;
		uv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );
		uv *= texelSize;
		vec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x += texelSize;
		vec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.y += texelSize;
		vec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x -= texelSize;
		vec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		vec3 tm = mix( tl, tr, f.x );
		vec3 bm = mix( bl, br, f.x );
		return mix( tm, bm, f.y );
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Ib=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Db=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Fb=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,Bb=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Nb=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Ob="gl_FragColor = linearToOutputTexel( gl_FragColor );",kb=`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value ) {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,zb=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifndef ENVMAP_TYPE_CUBE_UV
		envColor = envMapTexelToLinear( envColor );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Ub=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Vb=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Hb=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Gb=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Wb=`#ifdef USE_FOG
	fogDepth = - mvPosition.z;
#endif`,Xb=`#ifdef USE_FOG
	varying float fogDepth;
#endif`,jb=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, fogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,qb=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float fogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Yb=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,Zb=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel= texture2D( lightMap, vUv2 );
	reflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
#endif`,Jb=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,$b=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
	#pragma unroll_loop_end
#endif`,Qb=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {
	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	return irradiance;
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		directLight.color = directionalLight.color;
		directLight.direction = directionalLight.direction;
		directLight.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = pointLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		directLight.color = pointLight.color;
		directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );
		directLight.visible = ( directLight.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = spotLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		float angleCos = dot( directLight.direction, spotLight.direction );
		if ( angleCos > spotLight.coneCos ) {
			float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );
			directLight.color = spotLight.color;
			directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );
			directLight.visible = true;
		} else {
			directLight.color = vec3( 0.0 );
			directLight.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			irradiance *= PI;
		#endif
		return irradiance;
	}
#endif`,Kb=`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {
		vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );
			#else
				vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
		#else
			vec4 envMapColor = vec4( 0.0 );
		#endif
		return PI * envMapColor.rgb * envMapIntensity;
	}
	float getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {
		float maxMIPLevelScalar = float( maxMIPLevel );
		float sigma = PI * roughness * roughness / ( 1.0 + roughness );
		float desiredMIPLevel = maxMIPLevelScalar + log2( sigma );
		return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );
	}
	vec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( -viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
		#else
			vec3 reflectVec = refract( -viewDir, normal, refractionRatio );
		#endif
		reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
		float specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );
			#else
				vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
		#endif
		return envMapColor.rgb * envMapIntensity;
	}
#endif`,eM=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,tM=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,nM=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,iM=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,rM=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;
material.specularRoughness = min( material.specularRoughness, 1.0 );
#ifdef REFLECTIVITY
	material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );
#endif
#ifdef CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheen;
#endif`,sM=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float specularRoughness;
	vec3 specularColor;
#ifdef CLEARCOAT
	float clearcoat;
	float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	vec3 sheenColor;
#endif
};
#define MAXIMUM_SPECULAR_COEFFICIENT 0.16
#define DEFAULT_SPECULAR_COEFFICIENT 0.04
float clearcoatDHRApprox( const in float roughness, const in float dotNL ) {
	return DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.specularRoughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	#ifdef CLEARCOAT
		float ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = ccDotNL * directLight.color;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			ccIrradiance *= PI;
		#endif
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
		reflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
	#else
		float clearcoatDHR = 0.0;
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(
			material.specularRoughness,
			directLight.direction,
			geometry,
			material.sheenColor
		);
	#else
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);
	#endif
	reflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef CLEARCOAT
		float ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		reflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
		float ccDotNL = ccDotNV;
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
	#else
		float clearcoatDHR = 0.0;
	#endif
	float clearcoatInv = 1.0 - clearcoatDHR;
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	BRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,oM=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointDirectLightIrradiance( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotDirectLightIrradiance( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,aM=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );
	#ifdef CLEARCOAT
		clearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );
	#endif
#endif`,lM=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,cM=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,hM=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,uM=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,fM=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,dM=`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,pM=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,mM=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,gM=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,xM=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,vM=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,yM=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
#endif`,wM=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifndef USE_MORPHNORMALS
		uniform float morphTargetInfluences[ 8 ];
	#else
		uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,_M=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	transformed += morphTarget0 * morphTargetInfluences[ 0 ];
	transformed += morphTarget1 * morphTargetInfluences[ 1 ];
	transformed += morphTarget2 * morphTargetInfluences[ 2 ];
	transformed += morphTarget3 * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
		transformed += morphTarget4 * morphTargetInfluences[ 4 ];
		transformed += morphTarget5 * morphTargetInfluences[ 5 ];
		transformed += morphTarget6 * morphTargetInfluences[ 6 ];
		transformed += morphTarget7 * morphTargetInfluences[ 7 ];
	#endif
#endif`,bM=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,MM=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,SM=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,TM=`#ifdef CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,EM=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,AM=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,PM=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return (( near + viewZ ) * far ) / (( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,CM=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,LM=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,RM=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,IM=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,DM=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,FM=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,BM=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,NM=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,OM=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,kM=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,zM=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,UM=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,VM=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,HM=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,GM=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,WM=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,XM=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,jM=`#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,qM=`#ifdef USE_TRANSMISSION
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;
	#ifdef USE_TRANSMISSIONMAP
		transmissionFactor *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSNMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition.xyz / vWorldPosition.w;
	vec3 v = normalize( cameraPosition - pos );
	float ior = ( 1.0 + 0.4 * reflectivity ) / ( 1.0 - 0.4 * reflectivity );
	vec3 transmission = transmissionFactor * getIBLVolumeRefraction(
		normal, v, roughnessFactor, material.diffuseColor, totalSpecular,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationColor, attenuationDistance );
	totalDiffuse = mix( totalDiffuse, transmission, transmissionFactor );
#endif`,YM=`#ifdef USE_TRANSMISSION
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec4 vWorldPosition;
	vec3 getVolumeTransmissionRay(vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix) {
		vec3 refractionVector = refract(-v, normalize(n), 1.0 / ior);
		vec3 modelScale;
		modelScale.x = length(vec3(modelMatrix[0].xyz));
		modelScale.y = length(vec3(modelMatrix[1].xyz));
		modelScale.z = length(vec3(modelMatrix[2].xyz));
		return normalize(refractionVector) * thickness * modelScale;
	}
	float applyIorToRoughness(float roughness, float ior) {
		return roughness * clamp(ior * 2.0 - 2.0, 0.0, 1.0);
	}
	vec3 getTransmissionSample(vec2 fragCoord, float roughness, float ior) {
		float framebufferLod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness, ior);
		return texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod).rgb;
	}
	vec3 applyVolumeAttenuation(vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance) {
		if (attenuationDistance == 0.0) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log(attenuationColor) / attenuationDistance;
			vec3 transmittance = exp(-attenuationCoefficient * transmissionDistance);			return transmittance * radiance;
		}
	}
	vec3 getIBLVolumeRefraction(vec3 n, vec3 v, float perceptualRoughness, vec3 baseColor, vec3 specularColor,
		vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,
		vec3 attenuationColor, float attenuationDistance) {
		vec3 transmissionRay = getVolumeTransmissionRay(n, v, thickness, ior, modelMatrix);
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4(refractedRayExit, 1.0);
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec3 transmittedLight = getTransmissionSample(refractionCoords, perceptualRoughness, ior);
		vec3 attenuatedColor = applyVolumeAttenuation(transmittedLight, length(transmissionRay), attenuationColor, attenuationDistance);
		return (1.0 - specularColor) * attenuatedColor * baseColor;
	}
#endif`,ZM=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,JM=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,$M=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,QM=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,KM=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,eS=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,tS=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,nS=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,iS=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,rS=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,sS=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,oS=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,aS=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,lS=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,cS=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,hS=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,uS=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,fS=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,dS=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,pS=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
	
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,mS=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <skinbase_vertex>
	#ifdef USE_ENVMAP
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,gS=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,xS=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,vS=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,yS=`#define MATCAP
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#ifndef FLAT_SHADED
		vNormal = normalize( transformedNormal );
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,wS=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_S=`#define TOON
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,bS=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,MS=`#define PHONG
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,SS=`#define STANDARD
#ifdef PHYSICAL
	#define REFLECTIVITY
	#define CLEARCOAT
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform vec3 attenuationColor;
	uniform float attenuationDistance;
#endif
#ifdef REFLECTIVITY
	uniform float reflectivity;
#endif
#ifdef CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheen;
#endif
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <transmission_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <lights_physical_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,TS=`#define STANDARD
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#ifdef USE_TRANSMISSION
	varying vec4 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition;
#endif
}`,ES=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <packing>
#include <uv_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,AS=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,PS=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,CS=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,LS=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,RS=`#include <common>
#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,IS=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,DS=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Ue={alphamap_fragment:db,alphamap_pars_fragment:pb,alphatest_fragment:mb,aomap_fragment:gb,aomap_pars_fragment:xb,begin_vertex:vb,beginnormal_vertex:yb,bsdfs:wb,bumpmap_pars_fragment:_b,clipping_planes_fragment:bb,clipping_planes_pars_fragment:Mb,clipping_planes_pars_vertex:Sb,clipping_planes_vertex:Tb,color_fragment:Eb,color_pars_fragment:Ab,color_pars_vertex:Pb,color_vertex:Cb,common:Lb,cube_uv_reflection_fragment:Rb,defaultnormal_vertex:Ib,displacementmap_pars_vertex:Db,displacementmap_vertex:Fb,emissivemap_fragment:Bb,emissivemap_pars_fragment:Nb,encodings_fragment:Ob,encodings_pars_fragment:kb,envmap_fragment:zb,envmap_common_pars_fragment:Ub,envmap_pars_fragment:Vb,envmap_pars_vertex:Hb,envmap_physical_pars_fragment:Kb,envmap_vertex:Gb,fog_vertex:Wb,fog_pars_vertex:Xb,fog_fragment:jb,fog_pars_fragment:qb,gradientmap_pars_fragment:Yb,lightmap_fragment:Zb,lightmap_pars_fragment:Jb,lights_lambert_vertex:$b,lights_pars_begin:Qb,lights_toon_fragment:eM,lights_toon_pars_fragment:tM,lights_phong_fragment:nM,lights_phong_pars_fragment:iM,lights_physical_fragment:rM,lights_physical_pars_fragment:sM,lights_fragment_begin:oM,lights_fragment_maps:aM,lights_fragment_end:lM,logdepthbuf_fragment:cM,logdepthbuf_pars_fragment:hM,logdepthbuf_pars_vertex:uM,logdepthbuf_vertex:fM,map_fragment:dM,map_pars_fragment:pM,map_particle_fragment:mM,map_particle_pars_fragment:gM,metalnessmap_fragment:xM,metalnessmap_pars_fragment:vM,morphnormal_vertex:yM,morphtarget_pars_vertex:wM,morphtarget_vertex:_M,normal_fragment_begin:bM,normal_fragment_maps:MM,normalmap_pars_fragment:SM,clearcoat_normal_fragment_begin:TM,clearcoat_normal_fragment_maps:EM,clearcoat_pars_fragment:AM,packing:PM,premultiplied_alpha_fragment:CM,project_vertex:LM,dithering_fragment:RM,dithering_pars_fragment:IM,roughnessmap_fragment:DM,roughnessmap_pars_fragment:FM,shadowmap_pars_fragment:BM,shadowmap_pars_vertex:NM,shadowmap_vertex:OM,shadowmask_pars_fragment:kM,skinbase_vertex:zM,skinning_pars_vertex:UM,skinning_vertex:VM,skinnormal_vertex:HM,specularmap_fragment:GM,specularmap_pars_fragment:WM,tonemapping_fragment:XM,tonemapping_pars_fragment:jM,transmission_fragment:qM,transmission_pars_fragment:YM,uv_pars_fragment:ZM,uv_pars_vertex:JM,uv_vertex:$M,uv2_pars_fragment:QM,uv2_pars_vertex:KM,uv2_vertex:eS,worldpos_vertex:tS,background_frag:nS,background_vert:iS,cube_frag:rS,cube_vert:sS,depth_frag:oS,depth_vert:aS,distanceRGBA_frag:lS,distanceRGBA_vert:cS,equirect_frag:hS,equirect_vert:uS,linedashed_frag:fS,linedashed_vert:dS,meshbasic_frag:pS,meshbasic_vert:mS,meshlambert_frag:gS,meshlambert_vert:xS,meshmatcap_frag:vS,meshmatcap_vert:yS,meshtoon_frag:wS,meshtoon_vert:_S,meshphong_frag:bS,meshphong_vert:MS,meshphysical_frag:SS,meshphysical_vert:TS,normal_frag:ES,normal_vert:AS,points_frag:PS,points_vert:CS,shadow_frag:LS,shadow_vert:RS,sprite_frag:IS,sprite_vert:DS},_e={common:{diffuse:{value:new ue(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Ye},uv2Transform:{value:new Ye},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new J(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ue(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ue(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Ye}},sprite:{diffuse:{value:new ue(16777215)},opacity:{value:1},center:{value:new J(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Ye}}},ii={basic:{uniforms:en([_e.common,_e.specularmap,_e.envmap,_e.aomap,_e.lightmap,_e.fog]),vertexShader:Ue.meshbasic_vert,fragmentShader:Ue.meshbasic_frag},lambert:{uniforms:en([_e.common,_e.specularmap,_e.envmap,_e.aomap,_e.lightmap,_e.emissivemap,_e.fog,_e.lights,{emissive:{value:new ue(0)}}]),vertexShader:Ue.meshlambert_vert,fragmentShader:Ue.meshlambert_frag},phong:{uniforms:en([_e.common,_e.specularmap,_e.envmap,_e.aomap,_e.lightmap,_e.emissivemap,_e.bumpmap,_e.normalmap,_e.displacementmap,_e.fog,_e.lights,{emissive:{value:new ue(0)},specular:{value:new ue(1118481)},shininess:{value:30}}]),vertexShader:Ue.meshphong_vert,fragmentShader:Ue.meshphong_frag},standard:{uniforms:en([_e.common,_e.envmap,_e.aomap,_e.lightmap,_e.emissivemap,_e.bumpmap,_e.normalmap,_e.displacementmap,_e.roughnessmap,_e.metalnessmap,_e.fog,_e.lights,{emissive:{value:new ue(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ue.meshphysical_vert,fragmentShader:Ue.meshphysical_frag},toon:{uniforms:en([_e.common,_e.aomap,_e.lightmap,_e.emissivemap,_e.bumpmap,_e.normalmap,_e.displacementmap,_e.gradientmap,_e.fog,_e.lights,{emissive:{value:new ue(0)}}]),vertexShader:Ue.meshtoon_vert,fragmentShader:Ue.meshtoon_frag},matcap:{uniforms:en([_e.common,_e.bumpmap,_e.normalmap,_e.displacementmap,_e.fog,{matcap:{value:null}}]),vertexShader:Ue.meshmatcap_vert,fragmentShader:Ue.meshmatcap_frag},points:{uniforms:en([_e.points,_e.fog]),vertexShader:Ue.points_vert,fragmentShader:Ue.points_frag},dashed:{uniforms:en([_e.common,_e.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ue.linedashed_vert,fragmentShader:Ue.linedashed_frag},depth:{uniforms:en([_e.common,_e.displacementmap]),vertexShader:Ue.depth_vert,fragmentShader:Ue.depth_frag},normal:{uniforms:en([_e.common,_e.bumpmap,_e.normalmap,_e.displacementmap,{opacity:{value:1}}]),vertexShader:Ue.normal_vert,fragmentShader:Ue.normal_frag},sprite:{uniforms:en([_e.sprite,_e.fog]),vertexShader:Ue.sprite_vert,fragmentShader:Ue.sprite_frag},background:{uniforms:{uvTransform:{value:new Ye},t2D:{value:null}},vertexShader:Ue.background_vert,fragmentShader:Ue.background_frag},cube:{uniforms:en([_e.envmap,{opacity:{value:1}}]),vertexShader:Ue.cube_vert,fragmentShader:Ue.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ue.equirect_vert,fragmentShader:Ue.equirect_frag},distanceRGBA:{uniforms:en([_e.common,_e.displacementmap,{referencePosition:{value:new L},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ue.distanceRGBA_vert,fragmentShader:Ue.distanceRGBA_frag},shadow:{uniforms:en([_e.lights,_e.fog,{color:{value:new ue(0)},opacity:{value:1}}]),vertexShader:Ue.shadow_vert,fragmentShader:Ue.shadow_frag}};ii.physical={uniforms:en([ii.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new J(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new ue(0)},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new J},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new ue(0)}}]),vertexShader:Ue.meshphysical_vert,fragmentShader:Ue.meshphysical_frag};function FS(a,e,t,n,i){let r=new ue(0),s=0,o,l,c=null,u=0,f=null;function h(p,m){let v=!1,x=m.isScene===!0?m.background:null;x&&x.isTexture&&(x=e.get(x));let g=a.xr,y=g.getSession&&g.getSession();y&&y.environmentBlendMode==="additive"&&(x=null),x===null?d(r,s):x&&x.isColor&&(d(x,1),v=!0),(a.autoClear||v)&&a.clear(a.autoClearColor,a.autoClearDepth,a.autoClearStencil),x&&(x.isCubeTexture||x.mapping===to)?(l===void 0&&(l=new Ce(new ni(1,1,1),new Ht({name:"BackgroundCubeMaterial",uniforms:yo(ii.cube.uniforms),vertexShader:ii.cube.vertexShader,fragmentShader:ii.cube.fragmentShader,side:gt,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(_,w,b){this.matrixWorld.copyPosition(b.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(l)),l.material.uniforms.envMap.value=x,l.material.uniforms.flipEnvMap.value=x.isCubeTexture&&x._needsFlipEnvMap?-1:1,(c!==x||u!==x.version||f!==a.toneMapping)&&(l.material.needsUpdate=!0,c=x,u=x.version,f=a.toneMapping),p.unshift(l,l.geometry,l.material,0,0,null)):x&&x.isTexture&&(o===void 0&&(o=new Ce(new tn(2,2),new Ht({name:"BackgroundMaterial",uniforms:yo(ii.background.uniforms),vertexShader:ii.background.vertexShader,fragmentShader:ii.background.fragmentShader,side:zi,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(o)),o.material.uniforms.t2D.value=x,x.matrixAutoUpdate===!0&&x.updateMatrix(),o.material.uniforms.uvTransform.value.copy(x.matrix),(c!==x||u!==x.version||f!==a.toneMapping)&&(o.material.needsUpdate=!0,c=x,u=x.version,f=a.toneMapping),p.unshift(o,o.geometry,o.material,0,0,null))}function d(p,m){t.buffers.color.setClear(p.r,p.g,p.b,m,i)}return{getClearColor:function(){return r},setClearColor:function(p,m=1){r.set(p),s=m,d(r,s)},getClearAlpha:function(){return s},setClearAlpha:function(p){s=p,d(r,s)},render:h}}function BS(a,e,t,n){let i=a.getParameter(34921),r=n.isWebGL2?null:e.get("OES_vertex_array_object"),s=n.isWebGL2||r!==null,o={},l=m(null),c=l;function u(C,R,D,F,O){let U=!1;if(s){let j=p(F,D,R);c!==j&&(c=j,h(c.object)),U=v(F,O),U&&x(F,O)}else{let j=R.wireframe===!0;(c.geometry!==F.id||c.program!==D.id||c.wireframe!==j)&&(c.geometry=F.id,c.program=D.id,c.wireframe=j,U=!0)}C.isInstancedMesh===!0&&(U=!0),O!==null&&t.update(O,34963),U&&(S(C,R,D,F),O!==null&&a.bindBuffer(34963,t.get(O).buffer))}function f(){return n.isWebGL2?a.createVertexArray():r.createVertexArrayOES()}function h(C){return n.isWebGL2?a.bindVertexArray(C):r.bindVertexArrayOES(C)}function d(C){return n.isWebGL2?a.deleteVertexArray(C):r.deleteVertexArrayOES(C)}function p(C,R,D){let F=D.wireframe===!0,O=o[C.id];O===void 0&&(O={},o[C.id]=O);let U=O[R.id];U===void 0&&(U={},O[R.id]=U);let j=U[F];return j===void 0&&(j=m(f()),U[F]=j),j}function m(C){let R=[],D=[],F=[];for(let O=0;O<i;O++)R[O]=0,D[O]=0,F[O]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:R,enabledAttributes:D,attributeDivisors:F,object:C,attributes:{},index:null}}function v(C,R){let D=c.attributes,F=C.attributes,O=0;for(let U in F){let j=D[U],Z=F[U];if(j===void 0||j.attribute!==Z||j.data!==Z.data)return!0;O++}return c.attributesNum!==O||c.index!==R}function x(C,R){let D={},F=C.attributes,O=0;for(let U in F){let j=F[U],Z={};Z.attribute=j,j.data&&(Z.data=j.data),D[U]=Z,O++}c.attributes=D,c.attributesNum=O,c.index=R}function g(){let C=c.newAttributes;for(let R=0,D=C.length;R<D;R++)C[R]=0}function y(C){_(C,0)}function _(C,R){let D=c.newAttributes,F=c.enabledAttributes,O=c.attributeDivisors;D[C]=1,F[C]===0&&(a.enableVertexAttribArray(C),F[C]=1),O[C]!==R&&((n.isWebGL2?a:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](C,R),O[C]=R)}function w(){let C=c.newAttributes,R=c.enabledAttributes;for(let D=0,F=R.length;D<F;D++)R[D]!==C[D]&&(a.disableVertexAttribArray(D),R[D]=0)}function b(C,R,D,F,O,U){n.isWebGL2===!0&&(D===5124||D===5125)?a.vertexAttribIPointer(C,R,D,O,U):a.vertexAttribPointer(C,R,D,F,O,U)}function S(C,R,D,F){if(n.isWebGL2===!1&&(C.isInstancedMesh||F.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;g();let O=F.attributes,U=D.getAttributes(),j=R.defaultAttributeValues;for(let Z in U){let K=U[Z];if(K>=0){let G=O[Z];if(G!==void 0){let k=G.normalized,B=G.itemSize,H=t.get(G);if(H===void 0)continue;let W=H.buffer,X=H.type,te=H.bytesPerElement;if(G.isInterleavedBufferAttribute){let he=G.data,ae=he.stride,ce=G.offset;he&&he.isInstancedInterleavedBuffer?(_(K,he.meshPerAttribute),F._maxInstanceCount===void 0&&(F._maxInstanceCount=he.meshPerAttribute*he.count)):y(K),a.bindBuffer(34962,W),b(K,B,X,k,ae*te,ce*te)}else G.isInstancedBufferAttribute?(_(K,G.meshPerAttribute),F._maxInstanceCount===void 0&&(F._maxInstanceCount=G.meshPerAttribute*G.count)):y(K),a.bindBuffer(34962,W),b(K,B,X,k,0,0)}else if(Z==="instanceMatrix"){let k=t.get(C.instanceMatrix);if(k===void 0)continue;let B=k.buffer,H=k.type;_(K+0,1),_(K+1,1),_(K+2,1),_(K+3,1),a.bindBuffer(34962,B),a.vertexAttribPointer(K+0,4,H,!1,64,0),a.vertexAttribPointer(K+1,4,H,!1,64,16),a.vertexAttribPointer(K+2,4,H,!1,64,32),a.vertexAttribPointer(K+3,4,H,!1,64,48)}else if(Z==="instanceColor"){let k=t.get(C.instanceColor);if(k===void 0)continue;let B=k.buffer,H=k.type;_(K,1),a.bindBuffer(34962,B),a.vertexAttribPointer(K,3,H,!1,12,0)}else if(j!==void 0){let k=j[Z];if(k!==void 0)switch(k.length){case 2:a.vertexAttrib2fv(K,k);break;case 3:a.vertexAttrib3fv(K,k);break;case 4:a.vertexAttrib4fv(K,k);break;default:a.vertexAttrib1fv(K,k)}}}}w()}function M(){A();for(let C in o){let R=o[C];for(let D in R){let F=R[D];for(let O in F)d(F[O].object),delete F[O];delete R[D]}delete o[C]}}function T(C){if(o[C.id]===void 0)return;let R=o[C.id];for(let D in R){let F=R[D];for(let O in F)d(F[O].object),delete F[O];delete R[D]}delete o[C.id]}function E(C){for(let R in o){let D=o[R];if(D[C.id]===void 0)continue;let F=D[C.id];for(let O in F)d(F[O].object),delete F[O];delete D[C.id]}}function A(){I(),c!==l&&(c=l,h(c.object))}function I(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:u,reset:A,resetDefaultState:I,dispose:M,releaseStatesOfGeometry:T,releaseStatesOfProgram:E,initAttributes:g,enableAttribute:y,disableUnusedAttributes:w}}function NS(a,e,t,n){let i=n.isWebGL2,r;function s(c){r=c}function o(c,u){a.drawArrays(r,c,u),t.update(u,r,1)}function l(c,u,f){if(f===0)return;let h,d;if(i)h=a,d="drawArraysInstanced";else if(h=e.get("ANGLE_instanced_arrays"),d="drawArraysInstancedANGLE",h===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}h[d](r,c,u,f),t.update(u,r,f)}this.setMode=s,this.render=o,this.renderInstances=l}function OS(a,e,t){let n;function i(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){let S=e.get("EXT_texture_filter_anisotropic");n=a.getParameter(S.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function r(S){if(S==="highp"){if(a.getShaderPrecisionFormat(35633,36338).precision>0&&a.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";S="mediump"}return S==="mediump"&&a.getShaderPrecisionFormat(35633,36337).precision>0&&a.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let s=typeof WebGL2RenderingContext!="undefined"&&a instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext!="undefined"&&a instanceof WebGL2ComputeRenderingContext,o=t.precision!==void 0?t.precision:"highp",l=r(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);let c=s||e.has("WEBGL_draw_buffers"),u=t.logarithmicDepthBuffer===!0,f=a.getParameter(34930),h=a.getParameter(35660),d=a.getParameter(3379),p=a.getParameter(34076),m=a.getParameter(34921),v=a.getParameter(36347),x=a.getParameter(36348),g=a.getParameter(36349),y=h>0,_=s||e.has("OES_texture_float"),w=y&&_,b=s?a.getParameter(36183):0;return{isWebGL2:s,drawBuffers:c,getMaxAnisotropy:i,getMaxPrecision:r,precision:o,logarithmicDepthBuffer:u,maxTextures:f,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:p,maxAttributes:m,maxVertexUniforms:v,maxVaryings:x,maxFragmentUniforms:g,vertexTextures:y,floatFragmentTextures:_,floatVertexTextures:w,maxSamples:b}}function kS(a){let e=this,t=null,n=0,i=!1,r=!1,s=new Tt,o=new Ye,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(f,h,d){let p=f.length!==0||h||n!==0||i;return i=h,t=u(f,d,0),n=f.length,p},this.beginShadows=function(){r=!0,u(null)},this.endShadows=function(){r=!1,c()},this.setState=function(f,h,d){let p=f.clippingPlanes,m=f.clipIntersection,v=f.clipShadows,x=a.get(f);if(!i||p===null||p.length===0||r&&!v)r?u(null):c();else{let g=r?0:n,y=g*4,_=x.clippingState||null;l.value=_,_=u(p,h,y,d);for(let w=0;w!==y;++w)_[w]=t[w];x.clippingState=_,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=g}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function u(f,h,d,p){let m=f!==null?f.length:0,v=null;if(m!==0){if(v=l.value,p!==!0||v===null){let x=d+m*4,g=h.matrixWorldInverse;o.getNormalMatrix(g),(v===null||v.length<x)&&(v=new Float32Array(x));for(let y=0,_=d;y!==m;++y,_+=4)s.copy(f[y]).applyMatrix4(g,o),s.normal.toArray(v,_),v[_+3]=s.constant}l.value=v,l.needsUpdate=!0}return e.numPlanes=m,e.numIntersection=0,v}}function zS(a){let e=new WeakMap;function t(s,o){return o===eo?s.mapping=Ia:o===sc&&(s.mapping=Da),s}function n(s){if(s&&s.isTexture){let o=s.mapping;if(o===eo||o===sc)if(e.has(s)){let l=e.get(s).texture;return t(l,s.mapping)}else{let l=s.image;if(l&&l.height>0){let c=a.getRenderTarget(),u=new qa(l.height/2);return u.fromEquirectangularTexture(a,s),e.set(s,u),a.setRenderTarget(c),s.addEventListener("dispose",i),t(u.texture,s.mapping)}else return null}}return s}function i(s){let o=s.target;o.removeEventListener("dispose",i);let l=e.get(o);l!==void 0&&(e.delete(o),l.dispose())}function r(){e=new WeakMap}return{get:n,dispose:r}}function US(a){let e={};function t(n){if(e[n]!==void 0)return e[n];let i;switch(n){case"WEBGL_depth_texture":i=a.getExtension("WEBGL_depth_texture")||a.getExtension("MOZ_WEBGL_depth_texture")||a.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=a.getExtension("WEBGL_compressed_texture_s3tc")||a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=a.getExtension("WEBGL_compressed_texture_pvrtc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=a.getExtension(n)}return e[n]=i,i}return{has:function(n){return t(n)!==null},init:function(n){n.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float")},get:function(n){let i=t(n);return i===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),i}}}function VS(a,e,t,n){let i={},r=new WeakMap;function s(f){let h=f.target;h.index!==null&&e.remove(h.index);for(let p in h.attributes)e.remove(h.attributes[p]);h.removeEventListener("dispose",s),delete i[h.id];let d=r.get(h);d&&(e.remove(d),r.delete(h)),n.releaseStatesOfGeometry(h),h.isInstancedBufferGeometry===!0&&delete h._maxInstanceCount,t.memory.geometries--}function o(f,h){return i[h.id]===!0||(h.addEventListener("dispose",s),i[h.id]=!0,t.memory.geometries++),h}function l(f){let h=f.attributes;for(let p in h)e.update(h[p],34962);let d=f.morphAttributes;for(let p in d){let m=d[p];for(let v=0,x=m.length;v<x;v++)e.update(m[v],34962)}}function c(f){let h=[],d=f.index,p=f.attributes.position,m=0;if(d!==null){let g=d.array;m=d.version;for(let y=0,_=g.length;y<_;y+=3){let w=g[y+0],b=g[y+1],S=g[y+2];h.push(w,b,b,S,S,w)}}else{let g=p.array;m=p.version;for(let y=0,_=g.length/3-1;y<_;y+=3){let w=y+0,b=y+1,S=y+2;h.push(w,b,b,S,S,w)}}let v=new(C0(h)>65535?Wa:ws)(h,1);v.version=m;let x=r.get(f);x&&e.remove(x),r.set(f,v)}function u(f){let h=r.get(f);if(h){let d=f.index;d!==null&&h.version<d.version&&c(f)}else c(f);return r.get(f)}return{get:o,update:l,getWireframeAttribute:u}}function HS(a,e,t,n){let i=n.isWebGL2,r;function s(h){r=h}let o,l;function c(h){o=h.type,l=h.bytesPerElement}function u(h,d){a.drawElements(r,d,o,h*l),t.update(d,r,1)}function f(h,d,p){if(p===0)return;let m,v;if(i)m=a,v="drawElementsInstanced";else if(m=e.get("ANGLE_instanced_arrays"),v="drawElementsInstancedANGLE",m===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}m[v](r,d,o,h*l,p),t.update(d,r,p)}this.setMode=s,this.setIndex=c,this.render=u,this.renderInstances=f}function GS(a){let e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(r,s,o){switch(t.calls++,s){case 4:t.triangles+=o*(r/3);break;case 1:t.lines+=o*(r/2);break;case 3:t.lines+=o*(r-1);break;case 2:t.lines+=o*r;break;case 0:t.points+=o*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",s);break}}function i(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:n}}function WS(a,e){return a[0]-e[0]}function XS(a,e){return Math.abs(e[1])-Math.abs(a[1])}function jS(a){let e={},t=new Float32Array(8),n=[];for(let r=0;r<8;r++)n[r]=[r,0];function i(r,s,o,l){let c=r.morphTargetInfluences,u=c===void 0?0:c.length,f=e[s.id];if(f===void 0||f.length!==u){f=[];for(let v=0;v<u;v++)f[v]=[v,0];e[s.id]=f}for(let v=0;v<u;v++){let x=f[v];x[0]=v,x[1]=c[v]}f.sort(XS);for(let v=0;v<8;v++)v<u&&f[v][1]?(n[v][0]=f[v][0],n[v][1]=f[v][1]):(n[v][0]=Number.MAX_SAFE_INTEGER,n[v][1]=0);n.sort(WS);let h=o.morphTargets&&s.morphAttributes.position,d=o.morphNormals&&s.morphAttributes.normal,p=0;for(let v=0;v<8;v++){let x=n[v],g=x[0],y=x[1];g!==Number.MAX_SAFE_INTEGER&&y?(h&&s.getAttribute("morphTarget"+v)!==h[g]&&s.setAttribute("morphTarget"+v,h[g]),d&&s.getAttribute("morphNormal"+v)!==d[g]&&s.setAttribute("morphNormal"+v,d[g]),t[v]=y,p+=y):(h&&s.hasAttribute("morphTarget"+v)===!0&&s.deleteAttribute("morphTarget"+v),d&&s.hasAttribute("morphNormal"+v)===!0&&s.deleteAttribute("morphNormal"+v),t[v]=0)}let m=s.morphTargetsRelative?1:1-p;l.getUniforms().setValue(a,"morphTargetBaseInfluence",m),l.getUniforms().setValue(a,"morphTargetInfluences",t)}return{update:i}}function qS(a,e,t,n){let i=new WeakMap;function r(l){let c=n.render.frame,u=l.geometry,f=e.get(l,u);return i.get(f)!==c&&(e.update(f),i.set(f,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),t.update(l.instanceMatrix,34962),l.instanceColor!==null&&t.update(l.instanceColor,34962)),f}function s(){i=new WeakMap}function o(l){let c=l.target;c.removeEventListener("dispose",o),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:r,dispose:s}}var Rc=class extends lt{constructor(e=null,t=1,n=1,i=1){super(null);this.image={data:e,width:t,height:n,depth:i},this.magFilter=Mt,this.minFilter=Mt,this.wrapR=bt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}};Rc.prototype.isDataTexture2DArray=!0;var Ic=class extends lt{constructor(e=null,t=1,n=1,i=1){super(null);this.image={data:e,width:t,height:n,depth:i},this.magFilter=Mt,this.minFilter=Mt,this.wrapR=bt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}};Ic.prototype.isDataTexture3D=!0;var I0=new lt,YS=new Rc,ZS=new Ic,D0=new _s,F0=[],B0=[],N0=new Float32Array(16),O0=new Float32Array(9),k0=new Float32Array(4);function To(a,e,t){let n=a[0];if(n<=0||n>0)return a;let i=e*t,r=F0[i];if(r===void 0&&(r=new Float32Array(i),F0[i]=r),e!==0){n.toArray(r,0);for(let s=1,o=0;s!==e;++s)o+=t,a[s].toArray(r,o)}return r}function cn(a,e){if(a.length!==e.length)return!1;for(let t=0,n=a.length;t<n;t++)if(a[t]!==e[t])return!1;return!0}function nn(a,e){for(let t=0,n=e.length;t<n;t++)a[t]=e[t]}function z0(a,e){let t=B0[e];t===void 0&&(t=new Int32Array(e),B0[e]=t);for(let n=0;n!==e;++n)t[n]=a.allocateTextureUnit();return t}function JS(a,e){let t=this.cache;t[0]!==e&&(a.uniform1f(this.addr,e),t[0]=e)}function $S(a,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(a.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(cn(t,e))return;a.uniform2fv(this.addr,e),nn(t,e)}}function QS(a,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(a.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(a.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(cn(t,e))return;a.uniform3fv(this.addr,e),nn(t,e)}}function KS(a,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(a.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(cn(t,e))return;a.uniform4fv(this.addr,e),nn(t,e)}}function eT(a,e){let t=this.cache,n=e.elements;if(n===void 0){if(cn(t,e))return;a.uniformMatrix2fv(this.addr,!1,e),nn(t,e)}else{if(cn(t,n))return;k0.set(n),a.uniformMatrix2fv(this.addr,!1,k0),nn(t,n)}}function tT(a,e){let t=this.cache,n=e.elements;if(n===void 0){if(cn(t,e))return;a.uniformMatrix3fv(this.addr,!1,e),nn(t,e)}else{if(cn(t,n))return;O0.set(n),a.uniformMatrix3fv(this.addr,!1,O0),nn(t,n)}}function nT(a,e){let t=this.cache,n=e.elements;if(n===void 0){if(cn(t,e))return;a.uniformMatrix4fv(this.addr,!1,e),nn(t,e)}else{if(cn(t,n))return;N0.set(n),a.uniformMatrix4fv(this.addr,!1,N0),nn(t,n)}}function iT(a,e){let t=this.cache;t[0]!==e&&(a.uniform1i(this.addr,e),t[0]=e)}function rT(a,e){let t=this.cache;cn(t,e)||(a.uniform2iv(this.addr,e),nn(t,e))}function sT(a,e){let t=this.cache;cn(t,e)||(a.uniform3iv(this.addr,e),nn(t,e))}function oT(a,e){let t=this.cache;cn(t,e)||(a.uniform4iv(this.addr,e),nn(t,e))}function aT(a,e){let t=this.cache;t[0]!==e&&(a.uniform1ui(this.addr,e),t[0]=e)}function lT(a,e){let t=this.cache;cn(t,e)||(a.uniform2uiv(this.addr,e),nn(t,e))}function cT(a,e){let t=this.cache;cn(t,e)||(a.uniform3uiv(this.addr,e),nn(t,e))}function hT(a,e){let t=this.cache;cn(t,e)||(a.uniform4uiv(this.addr,e),nn(t,e))}function uT(a,e,t){let n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(a.uniform1i(this.addr,i),n[0]=i),t.safeSetTexture2D(e||I0,i)}function fT(a,e,t){let n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(a.uniform1i(this.addr,i),n[0]=i),t.setTexture3D(e||ZS,i)}function dT(a,e,t){let n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(a.uniform1i(this.addr,i),n[0]=i),t.safeSetTextureCube(e||D0,i)}function pT(a,e,t){let n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(a.uniform1i(this.addr,i),n[0]=i),t.setTexture2DArray(e||YS,i)}function mT(a){switch(a){case 5126:return JS;case 35664:return $S;case 35665:return QS;case 35666:return KS;case 35674:return eT;case 35675:return tT;case 35676:return nT;case 5124:case 35670:return iT;case 35667:case 35671:return rT;case 35668:case 35672:return sT;case 35669:case 35673:return oT;case 5125:return aT;case 36294:return lT;case 36295:return cT;case 36296:return hT;case 35678:case 36198:case 36298:case 36306:case 35682:return uT;case 35679:case 36299:case 36307:return fT;case 35680:case 36300:case 36308:case 36293:return dT;case 36289:case 36303:case 36311:case 36292:return pT}}function gT(a,e){a.uniform1fv(this.addr,e)}function xT(a,e){let t=To(e,this.size,2);a.uniform2fv(this.addr,t)}function vT(a,e){let t=To(e,this.size,3);a.uniform3fv(this.addr,t)}function yT(a,e){let t=To(e,this.size,4);a.uniform4fv(this.addr,t)}function wT(a,e){let t=To(e,this.size,4);a.uniformMatrix2fv(this.addr,!1,t)}function _T(a,e){let t=To(e,this.size,9);a.uniformMatrix3fv(this.addr,!1,t)}function bT(a,e){let t=To(e,this.size,16);a.uniformMatrix4fv(this.addr,!1,t)}function MT(a,e){a.uniform1iv(this.addr,e)}function ST(a,e){a.uniform2iv(this.addr,e)}function TT(a,e){a.uniform3iv(this.addr,e)}function ET(a,e){a.uniform4iv(this.addr,e)}function AT(a,e){a.uniform1uiv(this.addr,e)}function PT(a,e){a.uniform2uiv(this.addr,e)}function CT(a,e){a.uniform3uiv(this.addr,e)}function LT(a,e){a.uniform4uiv(this.addr,e)}function RT(a,e,t){let n=e.length,i=z0(t,n);a.uniform1iv(this.addr,i);for(let r=0;r!==n;++r)t.safeSetTexture2D(e[r]||I0,i[r])}function IT(a,e,t){let n=e.length,i=z0(t,n);a.uniform1iv(this.addr,i);for(let r=0;r!==n;++r)t.safeSetTextureCube(e[r]||D0,i[r])}function DT(a){switch(a){case 5126:return gT;case 35664:return xT;case 35665:return vT;case 35666:return yT;case 35674:return wT;case 35675:return _T;case 35676:return bT;case 5124:case 35670:return MT;case 35667:case 35671:return ST;case 35668:case 35672:return TT;case 35669:case 35673:return ET;case 5125:return AT;case 36294:return PT;case 36295:return CT;case 36296:return LT;case 35678:case 36198:case 36298:case 36306:case 35682:return RT;case 35680:case 36300:case 36308:case 36293:return IT}}function FT(a,e,t){this.id=a,this.addr=t,this.cache=[],this.setValue=mT(e.type)}function U0(a,e,t){this.id=a,this.addr=t,this.cache=[],this.size=e.size,this.setValue=DT(e.type)}U0.prototype.updateCache=function(a){let e=this.cache;a instanceof Float32Array&&e.length!==a.length&&(this.cache=new Float32Array(a.length)),nn(e,a)};function V0(a){this.id=a,this.seq=[],this.map={}}V0.prototype.setValue=function(a,e,t){let n=this.seq;for(let i=0,r=n.length;i!==r;++i){let s=n[i];s.setValue(a,e[s.id],t)}};var Of=/(\w+)(\])?(\[|\.)?/g;function H0(a,e){a.seq.push(e),a.map[e.id]=e}function BT(a,e,t){let n=a.name,i=n.length;for(Of.lastIndex=0;;){let r=Of.exec(n),s=Of.lastIndex,o=r[1],l=r[2]==="]",c=r[3];if(l&&(o=o|0),c===void 0||c==="["&&s+2===i){H0(t,c===void 0?new FT(o,a,e):new U0(o,a,e));break}else{let f=t.map[o];f===void 0&&(f=new V0(o),H0(t,f)),t=f}}}function Cr(a,e){this.seq=[],this.map={};let t=a.getProgramParameter(e,35718);for(let n=0;n<t;++n){let i=a.getActiveUniform(e,n),r=a.getUniformLocation(e,i.name);BT(i,r,this)}}Cr.prototype.setValue=function(a,e,t,n){let i=this.map[e];i!==void 0&&i.setValue(a,t,n)};Cr.prototype.setOptional=function(a,e,t){let n=e[t];n!==void 0&&this.setValue(a,t,n)};Cr.upload=function(a,e,t,n){for(let i=0,r=e.length;i!==r;++i){let s=e[i],o=t[s.id];o.needsUpdate!==!1&&s.setValue(a,o.value,n)}};Cr.seqWithValue=function(a,e){let t=[];for(let n=0,i=a.length;n!==i;++n){let r=a[n];r.id in e&&t.push(r)}return t};function G0(a,e,t){let n=a.createShader(e);return a.shaderSource(n,t),a.compileShader(n),n}var NT=0;function OT(a){let e=a.split(`
`);for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join(`
`)}function W0(a){switch(a){case jt:return["Linear","( value )"];case xn:return["sRGB","( value )"];case Qu:return["RGBE","( value )"];case Ku:return["RGBM","( value, 7.0 )"];case ef:return["RGBM","( value, 16.0 )"];case tf:return["RGBD","( value, 256.0 )"];case cc:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case u0:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",a),["Linear","( value )"]}}function X0(a,e,t){let n=a.getShaderParameter(e,35713),i=a.getShaderInfoLog(e).trim();if(n&&i==="")return"";let r=a.getShaderSource(e);return"THREE.WebGLShader: gl.getShaderInfoLog() "+t+`
`+i+OT(r)}function Ya(a,e){let t=W0(e);return"vec4 "+a+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function kT(a,e){let t=W0(e);return"vec4 "+a+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function zT(a,e){let t;switch(e){case hg:t="Linear";break;case ug:t="Reinhard";break;case fg:t="OptimizedCineon";break;case dg:t="ACESFilmic";break;case pg:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+a+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function UT(a){return[a.extensionDerivatives||a.envMapCubeUV||a.bumpMap||a.tangentSpaceNormalMap||a.clearcoatNormalMap||a.flatShading||a.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(a.extensionFragDepth||a.logarithmicDepthBuffer)&&a.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",a.extensionDrawBuffers&&a.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(a.extensionShaderTextureLOD||a.envMap||a.transmission>0)&&a.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Za).join(`
`)}function VT(a){let e=[];for(let t in a){let n=a[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function HT(a,e){let t={},n=a.getProgramParameter(e,35721);for(let i=0;i<n;i++){let s=a.getActiveAttrib(e,i).name;t[s]=a.getAttribLocation(e,s)}return t}function Za(a){return a!==""}function j0(a,e){return a.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function q0(a,e){return a.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}var GT=/^[ \t]*#include +<([\w\d./]+)>/gm;function kf(a){return a.replace(GT,WT)}function WT(a,e){let t=Ue[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return kf(t)}var XT=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,jT=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Y0(a){return a.replace(jT,Z0).replace(XT,qT)}function qT(a,e,t,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Z0(a,e,t,n)}function Z0(a,e,t,n){let i="";for(let r=parseInt(e);r<parseInt(t);r++)i+=n.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return i}function J0(a){let e="precision "+a.precision+` float;
precision `+a.precision+" int;";return a.precision==="highp"?e+=`
#define HIGH_PRECISION`:a.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:a.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function YT(a){let e="SHADOWMAP_TYPE_BASIC";return a.shadowMapType===Ru?e="SHADOWMAP_TYPE_PCF":a.shadowMapType===nc?e="SHADOWMAP_TYPE_PCF_SOFT":a.shadowMapType===Qs&&(e="SHADOWMAP_TYPE_VSM"),e}function ZT(a){let e="ENVMAP_TYPE_CUBE";if(a.envMap)switch(a.envMapMode){case Ia:case Da:e="ENVMAP_TYPE_CUBE";break;case to:case Fa:e="ENVMAP_TYPE_CUBE_UV";break}return e}function JT(a){let e="ENVMAP_MODE_REFLECTION";if(a.envMap)switch(a.envMapMode){case Da:case Fa:e="ENVMAP_MODE_REFRACTION";break}return e}function $T(a){let e="ENVMAP_BLENDING_NONE";if(a.envMap)switch(a.combine){case Ra:e="ENVMAP_BLENDING_MULTIPLY";break;case lg:e="ENVMAP_BLENDING_MIX";break;case cg:e="ENVMAP_BLENDING_ADD";break}return e}function QT(a,e,t,n){let i=a.getContext(),r=t.defines,s=t.vertexShader,o=t.fragmentShader,l=YT(t),c=ZT(t),u=JT(t),f=$T(t),h=a.gammaFactor>0?a.gammaFactor:1,d=t.isWebGL2?"":UT(t),p=VT(r),m=i.createProgram(),v,x,g=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(v=[p].filter(Za).join(`
`),v.length>0&&(v+=`
`),x=[d,p].filter(Za).join(`
`),x.length>0&&(x+=`
`)):(v=[J0(t),"#define SHADER_NAME "+t.shaderName,p,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+h,"#define MAX_BONES "+t.maxBones,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.useVertexTexture?"#define BONE_TEXTURE":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Za).join(`
`),x=[d,J0(t),"#define SHADER_NAME "+t.shaderName,p,t.alphaTest?"#define ALPHATEST "+t.alphaTest+(t.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+h,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+f:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.sheen?"#define USE_SHEEN":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==vr?"#define TONE_MAPPING":"",t.toneMapping!==vr?Ue.tonemapping_pars_fragment:"",t.toneMapping!==vr?zT("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",Ue.encodings_pars_fragment,t.map?Ya("mapTexelToLinear",t.mapEncoding):"",t.matcap?Ya("matcapTexelToLinear",t.matcapEncoding):"",t.envMap?Ya("envMapTexelToLinear",t.envMapEncoding):"",t.emissiveMap?Ya("emissiveMapTexelToLinear",t.emissiveMapEncoding):"",t.lightMap?Ya("lightMapTexelToLinear",t.lightMapEncoding):"",kT("linearToOutputTexel",t.outputEncoding),t.depthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Za).join(`
`)),s=kf(s),s=j0(s,t),s=q0(s,t),o=kf(o),o=j0(o,t),o=q0(o,t),s=Y0(s),o=Y0(o),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(g=`#version 300 es
`,v=["#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+v,x=["#define varying in",t.glslVersion===nf?"":"out highp vec4 pc_fragColor;",t.glslVersion===nf?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+x);let y=g+v+s,_=g+x+o,w=G0(i,35633,y),b=G0(i,35632,_);if(i.attachShader(m,w),i.attachShader(m,b),t.index0AttributeName!==void 0?i.bindAttribLocation(m,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(m,0,"position"),i.linkProgram(m),a.debug.checkShaderErrors){let T=i.getProgramInfoLog(m).trim(),E=i.getShaderInfoLog(w).trim(),A=i.getShaderInfoLog(b).trim(),I=!0,C=!0;if(i.getProgramParameter(m,35714)===!1){I=!1;let R=X0(i,w,"vertex"),D=X0(i,b,"fragment");console.error("THREE.WebGLProgram: shader error: ",i.getError(),"35715",i.getProgramParameter(m,35715),"gl.getProgramInfoLog",T,R,D)}else T!==""?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",T):(E===""||A==="")&&(C=!1);C&&(this.diagnostics={runnable:I,programLog:T,vertexShader:{log:E,prefix:v},fragmentShader:{log:A,prefix:x}})}i.deleteShader(w),i.deleteShader(b);let S;this.getUniforms=function(){return S===void 0&&(S=new Cr(i,m)),S};let M;return this.getAttributes=function(){return M===void 0&&(M=HT(i,m)),M},this.destroy=function(){n.releaseStatesOfProgram(this),i.deleteProgram(m),this.program=void 0},this.name=t.shaderName,this.id=NT++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=w,this.fragmentShader=b,this}function KT(a,e,t,n,i,r){let s=[],o=n.isWebGL2,l=n.logarithmicDepthBuffer,c=n.floatVertexTextures,u=n.maxVertexUniforms,f=n.vertexTextures,h=n.precision,d={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},p=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmission","transmissionMap","thicknessMap"];function m(b){let M=b.skeleton.bones;if(c)return 1024;{let E=Math.floor((u-20)/4),A=Math.min(E,M.length);return A<M.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+M.length+" bones. This GPU supports "+A+"."),0):A}}function v(b){let S;return b&&b.isTexture?S=b.encoding:b&&b.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),S=b.texture.encoding):S=jt,S}function x(b,S,M,T,E){let A=T.fog,I=b.isMeshStandardMaterial?T.environment:null,C=e.get(b.envMap||I),R=d[b.type],D=E.isSkinnedMesh?m(E):0;b.precision!==null&&(h=n.getMaxPrecision(b.precision),h!==b.precision&&console.warn("THREE.WebGLProgram.getParameters:",b.precision,"not supported, using",h,"instead."));let F,O;if(R){let Z=ii[R];F=Z.vertexShader,O=Z.fragmentShader}else F=b.vertexShader,O=b.fragmentShader;let U=a.getRenderTarget();return{isWebGL2:o,shaderID:R,shaderName:b.type,vertexShader:F,fragmentShader:O,defines:b.defines,isRawShaderMaterial:b.isRawShaderMaterial===!0,glslVersion:b.glslVersion,precision:h,instancing:E.isInstancedMesh===!0,instancingColor:E.isInstancedMesh===!0&&E.instanceColor!==null,supportsVertexTextures:f,outputEncoding:U!==null?v(U.texture):a.outputEncoding,map:!!b.map,mapEncoding:v(b.map),matcap:!!b.matcap,matcapEncoding:v(b.matcap),envMap:!!C,envMapMode:C&&C.mapping,envMapEncoding:v(C),envMapCubeUV:!!C&&(C.mapping===to||C.mapping===Fa),lightMap:!!b.lightMap,lightMapEncoding:v(b.lightMap),aoMap:!!b.aoMap,emissiveMap:!!b.emissiveMap,emissiveMapEncoding:v(b.emissiveMap),bumpMap:!!b.bumpMap,normalMap:!!b.normalMap,objectSpaceNormalMap:b.normalMapType===p0,tangentSpaceNormalMap:b.normalMapType===Hi,clearcoatMap:!!b.clearcoatMap,clearcoatRoughnessMap:!!b.clearcoatRoughnessMap,clearcoatNormalMap:!!b.clearcoatNormalMap,displacementMap:!!b.displacementMap,roughnessMap:!!b.roughnessMap,metalnessMap:!!b.metalnessMap,specularMap:!!b.specularMap,alphaMap:!!b.alphaMap,gradientMap:!!b.gradientMap,sheen:!!b.sheen,transmission:!!b.transmission,transmissionMap:!!b.transmissionMap,thicknessMap:!!b.thicknessMap,combine:b.combine,vertexTangents:b.normalMap&&b.vertexTangents,vertexColors:b.vertexColors,vertexAlphas:b.vertexColors===!0&&E.geometry&&E.geometry.attributes.color&&E.geometry.attributes.color.itemSize===4,vertexUvs:!!b.map||!!b.bumpMap||!!b.normalMap||!!b.specularMap||!!b.alphaMap||!!b.emissiveMap||!!b.roughnessMap||!!b.metalnessMap||!!b.clearcoatMap||!!b.clearcoatRoughnessMap||!!b.clearcoatNormalMap||!!b.displacementMap||!!b.transmissionMap||!!b.thicknessMap,uvsVertexOnly:!(!!b.map||!!b.bumpMap||!!b.normalMap||!!b.specularMap||!!b.alphaMap||!!b.emissiveMap||!!b.roughnessMap||!!b.metalnessMap||!!b.clearcoatNormalMap||!!b.transmission||!!b.transmissionMap||!!b.thicknessMap)&&!!b.displacementMap,fog:!!A,useFog:b.fog,fogExp2:A&&A.isFogExp2,flatShading:!!b.flatShading,sizeAttenuation:b.sizeAttenuation,logarithmicDepthBuffer:l,skinning:E.isSkinnedMesh===!0&&D>0,maxBones:D,useVertexTexture:c,morphTargets:b.morphTargets,morphNormals:b.morphNormals,numDirLights:S.directional.length,numPointLights:S.point.length,numSpotLights:S.spot.length,numRectAreaLights:S.rectArea.length,numHemiLights:S.hemi.length,numDirLightShadows:S.directionalShadowMap.length,numPointLightShadows:S.pointShadowMap.length,numSpotLightShadows:S.spotShadowMap.length,numClippingPlanes:r.numPlanes,numClipIntersection:r.numIntersection,dithering:b.dithering,shadowMapEnabled:a.shadowMap.enabled&&M.length>0,shadowMapType:a.shadowMap.type,toneMapping:b.toneMapped?a.toneMapping:vr,physicallyCorrectLights:a.physicallyCorrectLights,premultipliedAlpha:b.premultipliedAlpha,alphaTest:b.alphaTest,doubleSided:b.side===Mn,flipSided:b.side===gt,depthPacking:b.depthPacking!==void 0?b.depthPacking:!1,index0AttributeName:b.index0AttributeName,extensionDerivatives:b.extensions&&b.extensions.derivatives,extensionFragDepth:b.extensions&&b.extensions.fragDepth,extensionDrawBuffers:b.extensions&&b.extensions.drawBuffers,extensionShaderTextureLOD:b.extensions&&b.extensions.shaderTextureLOD,rendererExtensionFragDepth:o||t.has("EXT_frag_depth"),rendererExtensionDrawBuffers:o||t.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:o||t.has("EXT_shader_texture_lod"),customProgramCacheKey:b.customProgramCacheKey()}}function g(b){let S=[];if(b.shaderID?S.push(b.shaderID):(S.push(b.fragmentShader),S.push(b.vertexShader)),b.defines!==void 0)for(let M in b.defines)S.push(M),S.push(b.defines[M]);if(b.isRawShaderMaterial===!1){for(let M=0;M<p.length;M++)S.push(b[p[M]]);S.push(a.outputEncoding),S.push(a.gammaFactor)}return S.push(b.customProgramCacheKey),S.join()}function y(b){let S=d[b.type],M;if(S){let T=ii[S];M=Pr.clone(T.uniforms)}else M=b.uniforms;return M}function _(b,S){let M;for(let T=0,E=s.length;T<E;T++){let A=s[T];if(A.cacheKey===S){M=A,++M.usedTimes;break}}return M===void 0&&(M=new QT(a,S,b,i),s.push(M)),M}function w(b){if(--b.usedTimes==0){let S=s.indexOf(b);s[S]=s[s.length-1],s.pop(),b.destroy()}}return{getParameters:x,getProgramCacheKey:g,getUniforms:y,acquireProgram:_,releaseProgram:w,programs:s}}function eE(){let a=new WeakMap;function e(r){let s=a.get(r);return s===void 0&&(s={},a.set(r,s)),s}function t(r){a.delete(r)}function n(r,s,o){a.get(r)[s]=o}function i(){a=new WeakMap}return{get:e,remove:t,update:n,dispose:i}}function tE(a,e){return a.groupOrder!==e.groupOrder?a.groupOrder-e.groupOrder:a.renderOrder!==e.renderOrder?a.renderOrder-e.renderOrder:a.program!==e.program?a.program.id-e.program.id:a.material.id!==e.material.id?a.material.id-e.material.id:a.z!==e.z?a.z-e.z:a.id-e.id}function $0(a,e){return a.groupOrder!==e.groupOrder?a.groupOrder-e.groupOrder:a.renderOrder!==e.renderOrder?a.renderOrder-e.renderOrder:a.z!==e.z?e.z-a.z:a.id-e.id}function Q0(a){let e=[],t=0,n=[],i=[],r=[],s={id:-1};function o(){t=0,n.length=0,i.length=0,r.length=0}function l(d,p,m,v,x,g){let y=e[t],_=a.get(m);return y===void 0?(y={id:d.id,object:d,geometry:p,material:m,program:_.program||s,groupOrder:v,renderOrder:d.renderOrder,z:x,group:g},e[t]=y):(y.id=d.id,y.object=d,y.geometry=p,y.material=m,y.program=_.program||s,y.groupOrder=v,y.renderOrder=d.renderOrder,y.z=x,y.group=g),t++,y}function c(d,p,m,v,x,g){let y=l(d,p,m,v,x,g);m.transmission>0?i.push(y):m.transparent===!0?r.push(y):n.push(y)}function u(d,p,m,v,x,g){let y=l(d,p,m,v,x,g);m.transmission>0?i.unshift(y):m.transparent===!0?r.unshift(y):n.unshift(y)}function f(d,p){n.length>1&&n.sort(d||tE),i.length>1&&i.sort(p||$0),r.length>1&&r.sort(p||$0)}function h(){for(let d=t,p=e.length;d<p;d++){let m=e[d];if(m.id===null)break;m.id=null,m.object=null,m.geometry=null,m.material=null,m.program=null,m.group=null}}return{opaque:n,transmissive:i,transparent:r,init:o,push:c,unshift:u,finish:h,sort:f}}function nE(a){let e=new WeakMap;function t(i,r){let s;return e.has(i)===!1?(s=new Q0(a),e.set(i,[s])):r>=e.get(i).length?(s=new Q0(a),e.get(i).push(s)):s=e.get(i)[r],s}function n(){e=new WeakMap}return{get:t,dispose:n}}function iE(){let a={};return{get:function(e){if(a[e.id]!==void 0)return a[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new L,color:new ue};break;case"SpotLight":t={position:new L,direction:new L,color:new ue,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new L,color:new ue,distance:0,decay:0};break;case"HemisphereLight":t={direction:new L,skyColor:new ue,groundColor:new ue};break;case"RectAreaLight":t={color:new ue,position:new L,halfWidth:new L,halfHeight:new L};break}return a[e.id]=t,t}}}function rE(){let a={};return{get:function(e){if(a[e.id]!==void 0)return a[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new J};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new J};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new J,shadowCameraNear:1,shadowCameraFar:1e3};break}return a[e.id]=t,t}}}var sE=0;function oE(a,e){return(e.castShadow?1:0)-(a.castShadow?1:0)}function aE(a,e){let t=new iE,n=rE(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let u=0;u<9;u++)i.probe.push(new L);let r=new L,s=new fe,o=new fe;function l(u){let f=0,h=0,d=0;for(let S=0;S<9;S++)i.probe[S].set(0,0,0);let p=0,m=0,v=0,x=0,g=0,y=0,_=0,w=0;u.sort(oE);for(let S=0,M=u.length;S<M;S++){let T=u[S],E=T.color,A=T.intensity,I=T.distance,C=T.shadow&&T.shadow.map?T.shadow.map.texture:null;if(T.isAmbientLight)f+=E.r*A,h+=E.g*A,d+=E.b*A;else if(T.isLightProbe)for(let R=0;R<9;R++)i.probe[R].addScaledVector(T.sh.coefficients[R],A);else if(T.isDirectionalLight){let R=t.get(T);if(R.color.copy(T.color).multiplyScalar(T.intensity),T.castShadow){let D=T.shadow,F=n.get(T);F.shadowBias=D.bias,F.shadowNormalBias=D.normalBias,F.shadowRadius=D.radius,F.shadowMapSize=D.mapSize,i.directionalShadow[p]=F,i.directionalShadowMap[p]=C,i.directionalShadowMatrix[p]=T.shadow.matrix,y++}i.directional[p]=R,p++}else if(T.isSpotLight){let R=t.get(T);if(R.position.setFromMatrixPosition(T.matrixWorld),R.color.copy(E).multiplyScalar(A),R.distance=I,R.coneCos=Math.cos(T.angle),R.penumbraCos=Math.cos(T.angle*(1-T.penumbra)),R.decay=T.decay,T.castShadow){let D=T.shadow,F=n.get(T);F.shadowBias=D.bias,F.shadowNormalBias=D.normalBias,F.shadowRadius=D.radius,F.shadowMapSize=D.mapSize,i.spotShadow[v]=F,i.spotShadowMap[v]=C,i.spotShadowMatrix[v]=T.shadow.matrix,w++}i.spot[v]=R,v++}else if(T.isRectAreaLight){let R=t.get(T);R.color.copy(E).multiplyScalar(A),R.halfWidth.set(T.width*.5,0,0),R.halfHeight.set(0,T.height*.5,0),i.rectArea[x]=R,x++}else if(T.isPointLight){let R=t.get(T);if(R.color.copy(T.color).multiplyScalar(T.intensity),R.distance=T.distance,R.decay=T.decay,T.castShadow){let D=T.shadow,F=n.get(T);F.shadowBias=D.bias,F.shadowNormalBias=D.normalBias,F.shadowRadius=D.radius,F.shadowMapSize=D.mapSize,F.shadowCameraNear=D.camera.near,F.shadowCameraFar=D.camera.far,i.pointShadow[m]=F,i.pointShadowMap[m]=C,i.pointShadowMatrix[m]=T.shadow.matrix,_++}i.point[m]=R,m++}else if(T.isHemisphereLight){let R=t.get(T);R.skyColor.copy(T.color).multiplyScalar(A),R.groundColor.copy(T.groundColor).multiplyScalar(A),i.hemi[g]=R,g++}}x>0&&(e.isWebGL2||a.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=_e.LTC_FLOAT_1,i.rectAreaLTC2=_e.LTC_FLOAT_2):a.has("OES_texture_half_float_linear")===!0?(i.rectAreaLTC1=_e.LTC_HALF_1,i.rectAreaLTC2=_e.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=f,i.ambient[1]=h,i.ambient[2]=d;let b=i.hash;(b.directionalLength!==p||b.pointLength!==m||b.spotLength!==v||b.rectAreaLength!==x||b.hemiLength!==g||b.numDirectionalShadows!==y||b.numPointShadows!==_||b.numSpotShadows!==w)&&(i.directional.length=p,i.spot.length=v,i.rectArea.length=x,i.point.length=m,i.hemi.length=g,i.directionalShadow.length=y,i.directionalShadowMap.length=y,i.pointShadow.length=_,i.pointShadowMap.length=_,i.spotShadow.length=w,i.spotShadowMap.length=w,i.directionalShadowMatrix.length=y,i.pointShadowMatrix.length=_,i.spotShadowMatrix.length=w,b.directionalLength=p,b.pointLength=m,b.spotLength=v,b.rectAreaLength=x,b.hemiLength=g,b.numDirectionalShadows=y,b.numPointShadows=_,b.numSpotShadows=w,i.version=sE++)}function c(u,f){let h=0,d=0,p=0,m=0,v=0,x=f.matrixWorldInverse;for(let g=0,y=u.length;g<y;g++){let _=u[g];if(_.isDirectionalLight){let w=i.directional[h];w.direction.setFromMatrixPosition(_.matrixWorld),r.setFromMatrixPosition(_.target.matrixWorld),w.direction.sub(r),w.direction.transformDirection(x),h++}else if(_.isSpotLight){let w=i.spot[p];w.position.setFromMatrixPosition(_.matrixWorld),w.position.applyMatrix4(x),w.direction.setFromMatrixPosition(_.matrixWorld),r.setFromMatrixPosition(_.target.matrixWorld),w.direction.sub(r),w.direction.transformDirection(x),p++}else if(_.isRectAreaLight){let w=i.rectArea[m];w.position.setFromMatrixPosition(_.matrixWorld),w.position.applyMatrix4(x),o.identity(),s.copy(_.matrixWorld),s.premultiply(x),o.extractRotation(s),w.halfWidth.set(_.width*.5,0,0),w.halfHeight.set(0,_.height*.5,0),w.halfWidth.applyMatrix4(o),w.halfHeight.applyMatrix4(o),m++}else if(_.isPointLight){let w=i.point[d];w.position.setFromMatrixPosition(_.matrixWorld),w.position.applyMatrix4(x),d++}else if(_.isHemisphereLight){let w=i.hemi[v];w.direction.setFromMatrixPosition(_.matrixWorld),w.direction.transformDirection(x),w.direction.normalize(),v++}}}return{setup:l,setupView:c,state:i}}function K0(a,e){let t=new aE(a,e),n=[],i=[];function r(){n.length=0,i.length=0}function s(f){n.push(f)}function o(f){i.push(f)}function l(){t.setup(n)}function c(f){t.setupView(n,f)}return{init:r,state:{lightsArray:n,shadowsArray:i,lights:t},setupLights:l,setupLightsView:c,pushLight:s,pushShadow:o}}function lE(a,e){let t=new WeakMap;function n(r,s=0){let o;return t.has(r)===!1?(o=new K0(a,e),t.set(r,[o])):s>=t.get(r).length?(o=new K0(a,e),t.get(r).push(o)):o=t.get(r)[s],o}function i(){t=new WeakMap}return{get:n,dispose:i}}var Ja=class extends St{constructor(e){super();this.type="MeshDepthMaterial",this.depthPacking=f0,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}};Ja.prototype.isMeshDepthMaterial=!0;var $a=class extends St{constructor(e){super();this.type="MeshDistanceMaterial",this.referencePosition=new L,this.nearDistance=1,this.farDistance=1e3,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}};$a.prototype.isMeshDistanceMaterial=!0;var cE=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	float mean = 0.0;
	float squared_mean = 0.0;
	float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );
	for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean * HALF_SAMPLE_RATE;
	squared_mean = squared_mean * HALF_SAMPLE_RATE;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`,hE=`void main() {
	gl_Position = vec4( position, 1.0 );
}`;function ex(a,e,t){let n=new So,i=new J,r=new J,s=new De,o=[],l=[],c={},u=t.maxTextureSize,f={0:gt,1:zi,2:Mn},h=new Ht({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new J},radius:{value:4}},vertexShader:hE,fragmentShader:cE}),d=h.clone();d.defines.HORIZONTAL_PASS=1;let p=new ye;p.setAttribute("position",new Se(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let m=new Ce(p,h),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Ru,this.render=function(b,S,M){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||b.length===0)return;let T=a.getRenderTarget(),E=a.getActiveCubeFace(),A=a.getActiveMipmapLevel(),I=a.state;I.setBlending(Ui),I.buffers.color.setClear(1,1,1,1),I.buffers.depth.setTest(!0),I.setScissorTest(!1);for(let C=0,R=b.length;C<R;C++){let D=b[C],F=D.shadow;if(F===void 0){console.warn("THREE.WebGLShadowMap:",D,"has no shadow.");continue}if(F.autoUpdate===!1&&F.needsUpdate===!1)continue;i.copy(F.mapSize);let O=F.getFrameExtents();if(i.multiply(O),r.copy(F.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(r.x=Math.floor(u/O.x),i.x=r.x*O.x,F.mapSize.x=r.x),i.y>u&&(r.y=Math.floor(u/O.y),i.y=r.y*O.y,F.mapSize.y=r.y)),F.map===null&&!F.isPointLightShadow&&this.type===Qs){let j={minFilter:Ke,magFilter:Ke,format:gn};F.map=new Zt(i.x,i.y,j),F.map.texture.name=D.name+".shadowMap",F.mapPass=new Zt(i.x,i.y,j),F.camera.updateProjectionMatrix()}if(F.map===null){let j={minFilter:Mt,magFilter:Mt,format:gn};F.map=new Zt(i.x,i.y,j),F.map.texture.name=D.name+".shadowMap",F.camera.updateProjectionMatrix()}a.setRenderTarget(F.map),a.clear();let U=F.getViewportCount();for(let j=0;j<U;j++){let Z=F.getViewport(j);s.set(r.x*Z.x,r.y*Z.y,r.x*Z.z,r.y*Z.w),I.viewport(s),F.updateMatrices(D,j),n=F.getFrustum(),w(S,M,F.camera,D,this.type)}!F.isPointLightShadow&&this.type===Qs&&x(F,M),F.needsUpdate=!1}v.needsUpdate=!1,a.setRenderTarget(T,E,A)};function x(b,S){let M=e.update(m);h.uniforms.shadow_pass.value=b.map.texture,h.uniforms.resolution.value=b.mapSize,h.uniforms.radius.value=b.radius,a.setRenderTarget(b.mapPass),a.clear(),a.renderBufferDirect(S,null,M,h,m,null),d.uniforms.shadow_pass.value=b.mapPass.texture,d.uniforms.resolution.value=b.mapSize,d.uniforms.radius.value=b.radius,a.setRenderTarget(b.map),a.clear(),a.renderBufferDirect(S,null,M,d,m,null)}function g(b){let S=b<<0,M=o[S];return M===void 0&&(M=new Ja({depthPacking:d0,morphTargets:b}),o[S]=M),M}function y(b){let S=b<<0,M=l[S];return M===void 0&&(M=new $a({morphTargets:b}),l[S]=M),M}function _(b,S,M,T,E,A,I){let C=null,R=g,D=b.customDepthMaterial;if(T.isPointLight===!0&&(R=y,D=b.customDistanceMaterial),D===void 0){let F=!1;M.morphTargets===!0&&(F=S.morphAttributes&&S.morphAttributes.position&&S.morphAttributes.position.length>0),C=R(F)}else C=D;if(a.localClippingEnabled&&M.clipShadows===!0&&M.clippingPlanes.length!==0){let F=C.uuid,O=M.uuid,U=c[F];U===void 0&&(U={},c[F]=U);let j=U[O];j===void 0&&(j=C.clone(),U[O]=j),C=j}return C.visible=M.visible,C.wireframe=M.wireframe,I===Qs?C.side=M.shadowSide!==null?M.shadowSide:M.side:C.side=M.shadowSide!==null?M.shadowSide:f[M.side],C.clipShadows=M.clipShadows,C.clippingPlanes=M.clippingPlanes,C.clipIntersection=M.clipIntersection,C.wireframeLinewidth=M.wireframeLinewidth,C.linewidth=M.linewidth,T.isPointLight===!0&&C.isMeshDistanceMaterial===!0&&(C.referencePosition.setFromMatrixPosition(T.matrixWorld),C.nearDistance=E,C.farDistance=A),C}function w(b,S,M,T,E){if(b.visible===!1)return;if(b.layers.test(S.layers)&&(b.isMesh||b.isLine||b.isPoints)&&(b.castShadow||b.receiveShadow&&E===Qs)&&(!b.frustumCulled||n.intersectsObject(b))){b.modelViewMatrix.multiplyMatrices(M.matrixWorldInverse,b.matrixWorld);let C=e.update(b),R=b.material;if(Array.isArray(R)){let D=C.groups;for(let F=0,O=D.length;F<O;F++){let U=D[F],j=R[U.materialIndex];if(j&&j.visible){let Z=_(b,C,j,T,M.near,M.far,E);a.renderBufferDirect(M,null,C,Z,b,U)}}}else if(R.visible){let D=_(b,C,R,T,M.near,M.far,E);a.renderBufferDirect(M,null,C,D,b,null)}}let I=b.children;for(let C=0,R=I.length;C<R;C++)w(I[C],S,M,T,E)}}function uE(a,e,t){let n=t.isWebGL2;function i(){let Y=!1,ge=new De,de=null,Ae=new De(0,0,0,0);return{setMask:function(we){de!==we&&!Y&&(a.colorMask(we,we,we,we),de=we)},setLocked:function(we){Y=we},setClear:function(we,qe,$,be,Je){Je===!0&&(we*=be,qe*=be,$*=be),ge.set(we,qe,$,be),Ae.equals(ge)===!1&&(a.clearColor(we,qe,$,be),Ae.copy(ge))},reset:function(){Y=!1,de=null,Ae.set(-1,0,0,0)}}}function r(){let Y=!1,ge=null,de=null,Ae=null;return{setTest:function(we){we?B(2929):H(2929)},setMask:function(we){ge!==we&&!Y&&(a.depthMask(we),ge=we)},setFunc:function(we){if(de!==we){if(we)switch(we){case tg:a.depthFunc(512);break;case ng:a.depthFunc(519);break;case ig:a.depthFunc(513);break;case ic:a.depthFunc(515);break;case rg:a.depthFunc(514);break;case sg:a.depthFunc(518);break;case og:a.depthFunc(516);break;case ag:a.depthFunc(517);break;default:a.depthFunc(515)}else a.depthFunc(515);de=we}},setLocked:function(we){Y=we},setClear:function(we){Ae!==we&&(a.clearDepth(we),Ae=we)},reset:function(){Y=!1,ge=null,de=null,Ae=null}}}function s(){let Y=!1,ge=null,de=null,Ae=null,we=null,qe=null,$=null,be=null,Je=null;return{setTest:function(Be){Y||(Be?B(2960):H(2960))},setMask:function(Be){ge!==Be&&!Y&&(a.stencilMask(Be),ge=Be)},setFunc:function(Be,ot,mt){(de!==Be||Ae!==ot||we!==mt)&&(a.stencilFunc(Be,ot,mt),de=Be,Ae=ot,we=mt)},setOp:function(Be,ot,mt){(qe!==Be||$!==ot||be!==mt)&&(a.stencilOp(Be,ot,mt),qe=Be,$=ot,be=mt)},setLocked:function(Be){Y=Be},setClear:function(Be){Je!==Be&&(a.clearStencil(Be),Je=Be)},reset:function(){Y=!1,ge=null,de=null,Ae=null,we=null,qe=null,$=null,be=null,Je=null}}}let o=new i,l=new r,c=new s,u={},f=null,h={},d=null,p=!1,m=null,v=null,x=null,g=null,y=null,_=null,w=null,b=!1,S=null,M=null,T=null,E=null,A=null,I=a.getParameter(35661),C=!1,R=0,D=a.getParameter(7938);D.indexOf("WebGL")!==-1?(R=parseFloat(/^WebGL (\d)/.exec(D)[1]),C=R>=1):D.indexOf("OpenGL ES")!==-1&&(R=parseFloat(/^OpenGL ES (\d)/.exec(D)[1]),C=R>=2);let F=null,O={},U=a.getParameter(3088),j=a.getParameter(2978),Z=new De().fromArray(U),K=new De().fromArray(j);function G(Y,ge,de){let Ae=new Uint8Array(4),we=a.createTexture();a.bindTexture(Y,we),a.texParameteri(Y,10241,9728),a.texParameteri(Y,10240,9728);for(let qe=0;qe<de;qe++)a.texImage2D(ge+qe,0,6408,1,1,0,6408,5121,Ae);return we}let k={};k[3553]=G(3553,3553,1),k[34067]=G(34067,34069,6),o.setClear(0,0,0,1),l.setClear(1),c.setClear(0),B(2929),l.setFunc(ic),re(!1),Q(Lu),B(2884),ce(Ui);function B(Y){u[Y]!==!0&&(a.enable(Y),u[Y]=!0)}function H(Y){u[Y]!==!1&&(a.disable(Y),u[Y]=!1)}function W(Y){Y!==f&&(a.bindFramebuffer(36160,Y),f=Y)}function X(Y,ge){return ge===null&&f!==null&&(ge=f),h[Y]!==ge?(a.bindFramebuffer(Y,ge),h[Y]=ge,n&&(Y===36009&&(h[36160]=ge),Y===36160&&(h[36009]=ge)),!0):!1}function te(Y){return d!==Y?(a.useProgram(Y),d=Y,!0):!1}let he={[cs]:32774,[Wm]:32778,[Xm]:32779};if(n)he[Nu]=32775,he[Ou]=32776;else{let Y=e.get("EXT_blend_minmax");Y!==null&&(he[Nu]=Y.MIN_EXT,he[Ou]=Y.MAX_EXT)}let ae={[jm]:0,[qm]:1,[Ym]:768,[ku]:770,[eg]:776,[Qm]:774,[Jm]:772,[Zm]:769,[zu]:771,[Km]:775,[$m]:773};function ce(Y,ge,de,Ae,we,qe,$,be){if(Y===Ui){p===!0&&(H(3042),p=!1);return}if(p===!1&&(B(3042),p=!0),Y!==Gm){if(Y!==m||be!==b){if((v!==cs||y!==cs)&&(a.blendEquation(32774),v=cs,y=cs),be)switch(Y){case Ks:a.blendFuncSeparate(1,771,1,771);break;case Du:a.blendFunc(1,1);break;case Fu:a.blendFuncSeparate(0,0,769,771);break;case Bu:a.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",Y);break}else switch(Y){case Ks:a.blendFuncSeparate(770,771,1,771);break;case Du:a.blendFunc(770,1);break;case Fu:a.blendFunc(0,769);break;case Bu:a.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",Y);break}x=null,g=null,_=null,w=null,m=Y,b=be}return}we=we||ge,qe=qe||de,$=$||Ae,(ge!==v||we!==y)&&(a.blendEquationSeparate(he[ge],he[we]),v=ge,y=we),(de!==x||Ae!==g||qe!==_||$!==w)&&(a.blendFuncSeparate(ae[de],ae[Ae],ae[qe],ae[$]),x=de,g=Ae,_=qe,w=$),m=Y,b=null}function q(Y,ge){Y.side===Mn?H(2884):B(2884);let de=Y.side===gt;ge&&(de=!de),re(de),Y.blending===Ks&&Y.transparent===!1?ce(Ui):ce(Y.blending,Y.blendEquation,Y.blendSrc,Y.blendDst,Y.blendEquationAlpha,Y.blendSrcAlpha,Y.blendDstAlpha,Y.premultipliedAlpha),l.setFunc(Y.depthFunc),l.setTest(Y.depthTest),l.setMask(Y.depthWrite),o.setMask(Y.colorWrite);let Ae=Y.stencilWrite;c.setTest(Ae),Ae&&(c.setMask(Y.stencilWriteMask),c.setFunc(Y.stencilFunc,Y.stencilRef,Y.stencilFuncMask),c.setOp(Y.stencilFail,Y.stencilZFail,Y.stencilZPass)),V(Y.polygonOffset,Y.polygonOffsetFactor,Y.polygonOffsetUnits),Y.alphaToCoverage===!0?B(32926):H(32926)}function re(Y){S!==Y&&(Y?a.frontFace(2304):a.frontFace(2305),S=Y)}function Q(Y){Y!==Vm?(B(2884),Y!==M&&(Y===Lu?a.cullFace(1029):Y===Hm?a.cullFace(1028):a.cullFace(1032))):H(2884),M=Y}function oe(Y){Y!==T&&(C&&a.lineWidth(Y),T=Y)}function V(Y,ge,de){Y?(B(32823),(E!==ge||A!==de)&&(a.polygonOffset(ge,de),E=ge,A=de)):H(32823)}function P(Y){Y?B(3089):H(3089)}function N(Y){Y===void 0&&(Y=33984+I-1),F!==Y&&(a.activeTexture(Y),F=Y)}function ee(Y,ge){F===null&&N();let de=O[F];de===void 0&&(de={type:void 0,texture:void 0},O[F]=de),(de.type!==Y||de.texture!==ge)&&(a.bindTexture(Y,ge||k[Y]),de.type=Y,de.texture=ge)}function se(){let Y=O[F];Y!==void 0&&Y.type!==void 0&&(a.bindTexture(Y.type,null),Y.type=void 0,Y.texture=void 0)}function me(){try{a.compressedTexImage2D.apply(a,arguments)}catch(Y){console.error("THREE.WebGLState:",Y)}}function ve(){try{a.texImage2D.apply(a,arguments)}catch(Y){console.error("THREE.WebGLState:",Y)}}function Te(){try{a.texImage3D.apply(a,arguments)}catch(Y){console.error("THREE.WebGLState:",Y)}}function Ee(Y){Z.equals(Y)===!1&&(a.scissor(Y.x,Y.y,Y.z,Y.w),Z.copy(Y))}function Ie(Y){K.equals(Y)===!1&&(a.viewport(Y.x,Y.y,Y.z,Y.w),K.copy(Y))}function Me(){a.disable(3042),a.disable(2884),a.disable(2929),a.disable(32823),a.disable(3089),a.disable(2960),a.disable(32926),a.blendEquation(32774),a.blendFunc(1,0),a.blendFuncSeparate(1,0,1,0),a.colorMask(!0,!0,!0,!0),a.clearColor(0,0,0,0),a.depthMask(!0),a.depthFunc(513),a.clearDepth(1),a.stencilMask(4294967295),a.stencilFunc(519,0,4294967295),a.stencilOp(7680,7680,7680),a.clearStencil(0),a.cullFace(1029),a.frontFace(2305),a.polygonOffset(0,0),a.activeTexture(33984),a.bindFramebuffer(36160,null),n===!0&&(a.bindFramebuffer(36009,null),a.bindFramebuffer(36008,null)),a.useProgram(null),a.lineWidth(1),a.scissor(0,0,a.canvas.width,a.canvas.height),a.viewport(0,0,a.canvas.width,a.canvas.height),u={},F=null,O={},f=null,h={},d=null,p=!1,m=null,v=null,x=null,g=null,y=null,_=null,w=null,b=!1,S=null,M=null,T=null,E=null,A=null,Z.set(0,0,a.canvas.width,a.canvas.height),K.set(0,0,a.canvas.width,a.canvas.height),o.reset(),l.reset(),c.reset()}return{buffers:{color:o,depth:l,stencil:c},enable:B,disable:H,bindFramebuffer:X,bindXRFramebuffer:W,useProgram:te,setBlending:ce,setMaterial:q,setFlipSided:re,setCullFace:Q,setLineWidth:oe,setPolygonOffset:V,setScissorTest:P,activeTexture:N,bindTexture:ee,unbindTexture:se,compressedTexImage2D:me,texImage2D:ve,texImage3D:Te,scissor:Ee,viewport:Ie,reset:Me}}function fE(a,e,t,n,i,r,s){let o=i.isWebGL2,l=i.maxTextures,c=i.maxCubemapSize,u=i.maxTextureSize,f=i.maxSamples,h=new WeakMap,d,p=!1;try{p=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch(P){}function m(P,N){return p?new OffscreenCanvas(P,N):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function v(P,N,ee,se){let me=1;if((P.width>se||P.height>se)&&(me=se/Math.max(P.width,P.height)),me<1||N===!0)if(typeof HTMLImageElement!="undefined"&&P instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&P instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&P instanceof ImageBitmap){let ve=N?x0:Math.floor,Te=ve(me*P.width),Ee=ve(me*P.height);d===void 0&&(d=m(Te,Ee));let Ie=ee?m(Te,Ee):d;return Ie.width=Te,Ie.height=Ee,Ie.getContext("2d").drawImage(P,0,0,Te,Ee),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+P.width+"x"+P.height+") to ("+Te+"x"+Ee+")."),Ie}else return"data"in P&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+P.width+"x"+P.height+")."),P;return P}function x(P){return sf(P.width)&&sf(P.height)}function g(P){return o?!1:P.wrapS!==bt||P.wrapT!==bt||P.minFilter!==Mt&&P.minFilter!==Ke}function y(P,N){return P.generateMipmaps&&N&&P.minFilter!==Mt&&P.minFilter!==Ke}function _(P,N,ee,se,me=1){a.generateMipmap(P);let ve=n.get(N);ve.__maxMipLevel=Math.log2(Math.max(ee,se,me))}function w(P,N,ee){if(o===!1)return N;if(P!==null){if(a[P]!==void 0)return a[P];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+P+"'")}let se=N;return N===6403&&(ee===5126&&(se=33326),ee===5131&&(se=33325),ee===5121&&(se=33321)),N===6407&&(ee===5126&&(se=34837),ee===5131&&(se=34843),ee===5121&&(se=32849)),N===6408&&(ee===5126&&(se=34836),ee===5131&&(se=34842),ee===5121&&(se=32856)),(se===33325||se===33326||se===34842||se===34836)&&e.get("EXT_color_buffer_float"),se}function b(P){return P===Mt||P===no||P===io?9728:9729}function S(P){let N=P.target;N.removeEventListener("dispose",S),T(N),N.isVideoTexture&&h.delete(N),s.memory.textures--}function M(P){let N=P.target;N.removeEventListener("dispose",M),E(N)}function T(P){let N=n.get(P);N.__webglInit!==void 0&&(a.deleteTexture(N.__webglTexture),n.remove(P))}function E(P){let N=P.texture,ee=n.get(P),se=n.get(N);if(!!P){if(se.__webglTexture!==void 0&&(a.deleteTexture(se.__webglTexture),s.memory.textures--),P.depthTexture&&P.depthTexture.dispose(),P.isWebGLCubeRenderTarget)for(let me=0;me<6;me++)a.deleteFramebuffer(ee.__webglFramebuffer[me]),ee.__webglDepthbuffer&&a.deleteRenderbuffer(ee.__webglDepthbuffer[me]);else a.deleteFramebuffer(ee.__webglFramebuffer),ee.__webglDepthbuffer&&a.deleteRenderbuffer(ee.__webglDepthbuffer),ee.__webglMultisampledFramebuffer&&a.deleteFramebuffer(ee.__webglMultisampledFramebuffer),ee.__webglColorRenderbuffer&&a.deleteRenderbuffer(ee.__webglColorRenderbuffer),ee.__webglDepthRenderbuffer&&a.deleteRenderbuffer(ee.__webglDepthRenderbuffer);if(P.isWebGLMultipleRenderTargets)for(let me=0,ve=N.length;me<ve;me++){let Te=n.get(N[me]);Te.__webglTexture&&(a.deleteTexture(Te.__webglTexture),s.memory.textures--),n.remove(N[me])}n.remove(N),n.remove(P)}}let A=0;function I(){A=0}function C(){let P=A;return P>=l&&console.warn("THREE.WebGLTextures: Trying to use "+P+" texture units while this GPU supports only "+l),A+=1,P}function R(P,N){let ee=n.get(P);if(P.isVideoTexture&&q(P),P.version>0&&ee.__version!==P.version){let se=P.image;if(se===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(se.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{G(ee,P,N);return}}t.activeTexture(33984+N),t.bindTexture(3553,ee.__webglTexture)}function D(P,N){let ee=n.get(P);if(P.version>0&&ee.__version!==P.version){G(ee,P,N);return}t.activeTexture(33984+N),t.bindTexture(35866,ee.__webglTexture)}function F(P,N){let ee=n.get(P);if(P.version>0&&ee.__version!==P.version){G(ee,P,N);return}t.activeTexture(33984+N),t.bindTexture(32879,ee.__webglTexture)}function O(P,N){let ee=n.get(P);if(P.version>0&&ee.__version!==P.version){k(ee,P,N);return}t.activeTexture(33984+N),t.bindTexture(34067,ee.__webglTexture)}let U={[Nt]:10497,[bt]:33071,[hs]:33648},j={[Mt]:9728,[no]:9984,[io]:9986,[Ke]:9729,[Ba]:9985,[mi]:9987};function Z(P,N,ee){if(ee?(a.texParameteri(P,10242,U[N.wrapS]),a.texParameteri(P,10243,U[N.wrapT]),(P===32879||P===35866)&&a.texParameteri(P,32882,U[N.wrapR]),a.texParameteri(P,10240,j[N.magFilter]),a.texParameteri(P,10241,j[N.minFilter])):(a.texParameteri(P,10242,33071),a.texParameteri(P,10243,33071),(P===32879||P===35866)&&a.texParameteri(P,32882,33071),(N.wrapS!==bt||N.wrapT!==bt)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),a.texParameteri(P,10240,b(N.magFilter)),a.texParameteri(P,10241,b(N.minFilter)),N.minFilter!==Mt&&N.minFilter!==Ke&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){let se=e.get("EXT_texture_filter_anisotropic");if(N.type===Vi&&e.has("OES_texture_float_linear")===!1||o===!1&&N.type===fs&&e.has("OES_texture_half_float_linear")===!1)return;(N.anisotropy>1||n.get(N).__currentAnisotropy)&&(a.texParameterf(P,se.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(N.anisotropy,i.getMaxAnisotropy())),n.get(N).__currentAnisotropy=N.anisotropy)}}function K(P,N){P.__webglInit===void 0&&(P.__webglInit=!0,N.addEventListener("dispose",S),P.__webglTexture=a.createTexture(),s.memory.textures++)}function G(P,N,ee){let se=3553;N.isDataTexture2DArray&&(se=35866),N.isDataTexture3D&&(se=32879),K(P,N),t.activeTexture(33984+ee),t.bindTexture(se,P.__webglTexture),a.pixelStorei(37440,N.flipY),a.pixelStorei(37441,N.premultiplyAlpha),a.pixelStorei(3317,N.unpackAlignment),a.pixelStorei(37443,0);let me=g(N)&&x(N.image)===!1,ve=v(N.image,me,!1,u),Te=x(ve)||o,Ee=r.convert(N.format),Ie=r.convert(N.type),Me=w(N.internalFormat,Ee,Ie);Z(se,N,Te);let Y,ge=N.mipmaps;if(N.isDepthTexture)Me=6402,o?N.type===Vi?Me=36012:N.type===Oa?Me=33190:N.type===ro?Me=35056:Me=33189:N.type===Vi&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),N.format===ds&&Me===6402&&N.type!==Na&&N.type!==Oa&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),N.type=Na,Ie=r.convert(N.type)),N.format===so&&Me===6402&&(Me=34041,N.type!==ro&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),N.type=ro,Ie=r.convert(N.type))),t.texImage2D(3553,0,Me,ve.width,ve.height,0,Ee,Ie,null);else if(N.isDataTexture)if(ge.length>0&&Te){for(let de=0,Ae=ge.length;de<Ae;de++)Y=ge[de],t.texImage2D(3553,de,Me,Y.width,Y.height,0,Ee,Ie,Y.data);N.generateMipmaps=!1,P.__maxMipLevel=ge.length-1}else t.texImage2D(3553,0,Me,ve.width,ve.height,0,Ee,Ie,ve.data),P.__maxMipLevel=0;else if(N.isCompressedTexture){for(let de=0,Ae=ge.length;de<Ae;de++)Y=ge[de],N.format!==gn&&N.format!==mn?Ee!==null?t.compressedTexImage2D(3553,de,Me,Y.width,Y.height,0,Y.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):t.texImage2D(3553,de,Me,Y.width,Y.height,0,Ee,Ie,Y.data);P.__maxMipLevel=ge.length-1}else if(N.isDataTexture2DArray)t.texImage3D(35866,0,Me,ve.width,ve.height,ve.depth,0,Ee,Ie,ve.data),P.__maxMipLevel=0;else if(N.isDataTexture3D)t.texImage3D(32879,0,Me,ve.width,ve.height,ve.depth,0,Ee,Ie,ve.data),P.__maxMipLevel=0;else if(ge.length>0&&Te){for(let de=0,Ae=ge.length;de<Ae;de++)Y=ge[de],t.texImage2D(3553,de,Me,Ee,Ie,Y);N.generateMipmaps=!1,P.__maxMipLevel=ge.length-1}else t.texImage2D(3553,0,Me,Ee,Ie,ve),P.__maxMipLevel=0;y(N,Te)&&_(se,N,ve.width,ve.height),P.__version=N.version,N.onUpdate&&N.onUpdate(N)}function k(P,N,ee){if(N.image.length!==6)return;K(P,N),t.activeTexture(33984+ee),t.bindTexture(34067,P.__webglTexture),a.pixelStorei(37440,N.flipY),a.pixelStorei(37441,N.premultiplyAlpha),a.pixelStorei(3317,N.unpackAlignment),a.pixelStorei(37443,0);let se=N&&(N.isCompressedTexture||N.image[0].isCompressedTexture),me=N.image[0]&&N.image[0].isDataTexture,ve=[];for(let de=0;de<6;de++)!se&&!me?ve[de]=v(N.image[de],!1,!0,c):ve[de]=me?N.image[de].image:N.image[de];let Te=ve[0],Ee=x(Te)||o,Ie=r.convert(N.format),Me=r.convert(N.type),Y=w(N.internalFormat,Ie,Me);Z(34067,N,Ee);let ge;if(se){for(let de=0;de<6;de++){ge=ve[de].mipmaps;for(let Ae=0;Ae<ge.length;Ae++){let we=ge[Ae];N.format!==gn&&N.format!==mn?Ie!==null?t.compressedTexImage2D(34069+de,Ae,Y,we.width,we.height,0,we.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):t.texImage2D(34069+de,Ae,Y,we.width,we.height,0,Ie,Me,we.data)}}P.__maxMipLevel=ge.length-1}else{ge=N.mipmaps;for(let de=0;de<6;de++)if(me){t.texImage2D(34069+de,0,Y,ve[de].width,ve[de].height,0,Ie,Me,ve[de].data);for(let Ae=0;Ae<ge.length;Ae++){let qe=ge[Ae].image[de].image;t.texImage2D(34069+de,Ae+1,Y,qe.width,qe.height,0,Ie,Me,qe.data)}}else{t.texImage2D(34069+de,0,Y,Ie,Me,ve[de]);for(let Ae=0;Ae<ge.length;Ae++){let we=ge[Ae];t.texImage2D(34069+de,Ae+1,Y,Ie,Me,we.image[de])}}P.__maxMipLevel=ge.length}y(N,Ee)&&_(34067,N,Te.width,Te.height),P.__version=N.version,N.onUpdate&&N.onUpdate(N)}function B(P,N,ee,se,me){let ve=r.convert(ee.format),Te=r.convert(ee.type),Ee=w(ee.internalFormat,ve,Te);me===32879||me===35866?t.texImage3D(me,0,Ee,N.width,N.height,N.depth,0,ve,Te,null):t.texImage2D(me,0,Ee,N.width,N.height,0,ve,Te,null),t.bindFramebuffer(36160,P),a.framebufferTexture2D(36160,se,me,n.get(ee).__webglTexture,0),t.bindFramebuffer(36160,null)}function H(P,N,ee){if(a.bindRenderbuffer(36161,P),N.depthBuffer&&!N.stencilBuffer){let se=33189;if(ee){let me=N.depthTexture;me&&me.isDepthTexture&&(me.type===Vi?se=36012:me.type===Oa&&(se=33190));let ve=ce(N);a.renderbufferStorageMultisample(36161,ve,se,N.width,N.height)}else a.renderbufferStorage(36161,se,N.width,N.height);a.framebufferRenderbuffer(36160,36096,36161,P)}else if(N.depthBuffer&&N.stencilBuffer){if(ee){let se=ce(N);a.renderbufferStorageMultisample(36161,se,35056,N.width,N.height)}else a.renderbufferStorage(36161,34041,N.width,N.height);a.framebufferRenderbuffer(36160,33306,36161,P)}else{let se=N.isWebGLMultipleRenderTargets===!0?N.texture[0]:N.texture,me=r.convert(se.format),ve=r.convert(se.type),Te=w(se.internalFormat,me,ve);if(ee){let Ee=ce(N);a.renderbufferStorageMultisample(36161,Ee,Te,N.width,N.height)}else a.renderbufferStorage(36161,Te,N.width,N.height)}a.bindRenderbuffer(36161,null)}function W(P,N){if(N&&N.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,P),!(N.depthTexture&&N.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(N.depthTexture).__webglTexture||N.depthTexture.image.width!==N.width||N.depthTexture.image.height!==N.height)&&(N.depthTexture.image.width=N.width,N.depthTexture.image.height=N.height,N.depthTexture.needsUpdate=!0),R(N.depthTexture,0);let se=n.get(N.depthTexture).__webglTexture;if(N.depthTexture.format===ds)a.framebufferTexture2D(36160,36096,3553,se,0);else if(N.depthTexture.format===so)a.framebufferTexture2D(36160,33306,3553,se,0);else throw new Error("Unknown depthTexture format")}function X(P){let N=n.get(P),ee=P.isWebGLCubeRenderTarget===!0;if(P.depthTexture){if(ee)throw new Error("target.depthTexture not supported in Cube render targets");W(N.__webglFramebuffer,P)}else if(ee){N.__webglDepthbuffer=[];for(let se=0;se<6;se++)t.bindFramebuffer(36160,N.__webglFramebuffer[se]),N.__webglDepthbuffer[se]=a.createRenderbuffer(),H(N.__webglDepthbuffer[se],P,!1)}else t.bindFramebuffer(36160,N.__webglFramebuffer),N.__webglDepthbuffer=a.createRenderbuffer(),H(N.__webglDepthbuffer,P,!1);t.bindFramebuffer(36160,null)}function te(P){let N=P.texture,ee=n.get(P),se=n.get(N);P.addEventListener("dispose",M),P.isWebGLMultipleRenderTargets!==!0&&(se.__webglTexture=a.createTexture(),se.__version=N.version,s.memory.textures++);let me=P.isWebGLCubeRenderTarget===!0,ve=P.isWebGLMultipleRenderTargets===!0,Te=P.isWebGLMultisampleRenderTarget===!0,Ee=N.isDataTexture3D||N.isDataTexture2DArray,Ie=x(P)||o;if(o&&N.format===mn&&(N.type===Vi||N.type===fs)&&(N.format=gn,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),me){ee.__webglFramebuffer=[];for(let Me=0;Me<6;Me++)ee.__webglFramebuffer[Me]=a.createFramebuffer()}else if(ee.__webglFramebuffer=a.createFramebuffer(),ve)if(i.drawBuffers){let Me=P.texture;for(let Y=0,ge=Me.length;Y<ge;Y++){let de=n.get(Me[Y]);de.__webglTexture===void 0&&(de.__webglTexture=a.createTexture(),s.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(Te)if(o){ee.__webglMultisampledFramebuffer=a.createFramebuffer(),ee.__webglColorRenderbuffer=a.createRenderbuffer(),a.bindRenderbuffer(36161,ee.__webglColorRenderbuffer);let Me=r.convert(N.format),Y=r.convert(N.type),ge=w(N.internalFormat,Me,Y),de=ce(P);a.renderbufferStorageMultisample(36161,de,ge,P.width,P.height),t.bindFramebuffer(36160,ee.__webglMultisampledFramebuffer),a.framebufferRenderbuffer(36160,36064,36161,ee.__webglColorRenderbuffer),a.bindRenderbuffer(36161,null),P.depthBuffer&&(ee.__webglDepthRenderbuffer=a.createRenderbuffer(),H(ee.__webglDepthRenderbuffer,P,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(me){t.bindTexture(34067,se.__webglTexture),Z(34067,N,Ie);for(let Me=0;Me<6;Me++)B(ee.__webglFramebuffer[Me],P,N,36064,34069+Me);y(N,Ie)&&_(34067,N,P.width,P.height),t.bindTexture(34067,null)}else if(ve){let Me=P.texture;for(let Y=0,ge=Me.length;Y<ge;Y++){let de=Me[Y],Ae=n.get(de);t.bindTexture(3553,Ae.__webglTexture),Z(3553,de,Ie),B(ee.__webglFramebuffer,P,de,36064+Y,3553),y(de,Ie)&&_(3553,de,P.width,P.height)}t.bindTexture(3553,null)}else{let Me=3553;Ee&&(o?Me=N.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),t.bindTexture(Me,se.__webglTexture),Z(Me,N,Ie),B(ee.__webglFramebuffer,P,N,36064,Me),y(N,Ie)&&_(Me,N,P.width,P.height,P.depth),t.bindTexture(Me,null)}P.depthBuffer&&X(P)}function he(P){let N=x(P)||o,ee=P.isWebGLMultipleRenderTargets===!0?P.texture:[P.texture];for(let se=0,me=ee.length;se<me;se++){let ve=ee[se];if(y(ve,N)){let Te=P.isWebGLCubeRenderTarget?34067:3553,Ee=n.get(ve).__webglTexture;t.bindTexture(Te,Ee),_(Te,ve,P.width,P.height),t.bindTexture(Te,null)}}}function ae(P){if(P.isWebGLMultisampleRenderTarget)if(o){let N=P.width,ee=P.height,se=16384;P.depthBuffer&&(se|=256),P.stencilBuffer&&(se|=1024);let me=n.get(P);t.bindFramebuffer(36008,me.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,me.__webglFramebuffer),a.blitFramebuffer(0,0,N,ee,0,0,N,ee,se,9728),t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,me.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function ce(P){return o&&P.isWebGLMultisampleRenderTarget?Math.min(f,P.samples):0}function q(P){let N=s.render.frame;h.get(P)!==N&&(h.set(P,N),P.update())}let re=!1,Q=!1;function oe(P,N){P&&P.isWebGLRenderTarget&&(re===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),re=!0),P=P.texture),R(P,N)}function V(P,N){P&&P.isWebGLCubeRenderTarget&&(Q===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),Q=!0),P=P.texture),O(P,N)}this.allocateTextureUnit=C,this.resetTextureUnits=I,this.setTexture2D=R,this.setTexture2DArray=D,this.setTexture3D=F,this.setTextureCube=O,this.setupRenderTarget=te,this.updateRenderTargetMipmap=he,this.updateMultisampleRenderTarget=ae,this.safeSetTexture2D=oe,this.safeSetTextureCube=V}function tx(a,e,t){let n=t.isWebGL2;function i(r){let s;if(r===us)return 5121;if(r===vg)return 32819;if(r===yg)return 32820;if(r===wg)return 33635;if(r===mg)return 5120;if(r===gg)return 5122;if(r===Na)return 5123;if(r===xg)return 5124;if(r===Oa)return 5125;if(r===Vi)return 5126;if(r===fs)return n?5131:(s=e.get("OES_texture_half_float"),s!==null?s.HALF_FLOAT_OES:null);if(r===_g)return 6406;if(r===mn)return 6407;if(r===gn)return 6408;if(r===bg)return 6409;if(r===Mg)return 6410;if(r===ds)return 6402;if(r===so)return 34041;if(r===Tg)return 6403;if(r===Eg)return 36244;if(r===Ag)return 33319;if(r===Pg)return 33320;if(r===Cg)return 36248;if(r===Lg)return 36249;if(r===Uu||r===Vu||r===Hu||r===Gu)if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(r===Uu)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===Vu)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===Hu)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===Gu)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===Wu||r===Xu||r===ju||r===qu)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(r===Wu)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===Xu)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===ju)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===qu)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===Rg)return s=e.get("WEBGL_compressed_texture_etc1"),s!==null?s.COMPRESSED_RGB_ETC1_WEBGL:null;if((r===Yu||r===Zu)&&(s=e.get("WEBGL_compressed_texture_etc"),s!==null)){if(r===Yu)return s.COMPRESSED_RGB8_ETC2;if(r===Zu)return s.COMPRESSED_RGBA8_ETC2_EAC}if(r===Ig||r===Dg||r===Fg||r===Bg||r===Ng||r===Og||r===kg||r===zg||r===Ug||r===Vg||r===Hg||r===Gg||r===Wg||r===Xg||r===qg||r===Yg||r===Zg||r===Jg||r===$g||r===Qg||r===Kg||r===e0||r===t0||r===n0||r===i0||r===r0||r===s0||r===o0)return s=e.get("WEBGL_compressed_texture_astc"),s!==null?r:null;if(r===jg)return s=e.get("EXT_texture_compression_bptc"),s!==null?r:null;if(r===ro)return n?34042:(s=e.get("WEBGL_depth_texture"),s!==null?s.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:i}}var Dc=class extends it{constructor(e=[]){super();this.cameras=e}};Dc.prototype.isArrayCamera=!0;var Jt=class extends Re{constructor(){super();this.type="Group"}};Jt.prototype.isGroup=!0;var dE={type:"move"},Fc=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Jt,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Jt,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new L,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new L),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Jt,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new L,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new L),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,s=null,o=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred")if(o!==null&&(i=t.getPose(e.targetRaySpace,n),i!==null&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(dE))),c&&e.hand){s=!0;for(let m of e.hand.values()){let v=t.getJointPose(m,n);if(c.joints[m.jointName]===void 0){let g=new Jt;g.matrixAutoUpdate=!1,g.visible=!1,c.joints[m.jointName]=g,c.add(g)}let x=c.joints[m.jointName];v!==null&&(x.matrix.fromArray(v.transform.matrix),x.matrix.decompose(x.position,x.rotation,x.scale),x.jointRadius=v.radius),x.visible=v!==null}let u=c.joints["index-finger-tip"],f=c.joints["thumb-tip"],h=u.position.distanceTo(f.position),d=.02,p=.005;c.inputState.pinching&&h>d+p?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&h<=d-p&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1));return o!==null&&(o.visible=i!==null),l!==null&&(l.visible=r!==null),c!==null&&(c.visible=s!==null),this}},nx=class extends Sn{constructor(e,t){super();let n=this,i=e.state,r=null,s=1,o=null,l="local-floor",c=null,u=null,f=null,h=null,d=[],p=new Map,m=new it;m.layers.enable(1),m.viewport=new De;let v=new it;v.layers.enable(2),v.viewport=new De;let x=[m,v],g=new Dc;g.layers.enable(1),g.layers.enable(2);let y=null,_=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(D){let F=d[D];return F===void 0&&(F=new Fc,d[D]=F),F.getTargetRaySpace()},this.getControllerGrip=function(D){let F=d[D];return F===void 0&&(F=new Fc,d[D]=F),F.getGripSpace()},this.getHand=function(D){let F=d[D];return F===void 0&&(F=new Fc,d[D]=F),F.getHandSpace()};function w(D){let F=p.get(D.inputSource);F&&F.dispatchEvent({type:D.type,data:D.inputSource})}function b(){p.forEach(function(D,F){D.disconnect(F)}),p.clear(),y=null,_=null,i.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),R.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(D){s=D,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(D){l=D,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getSession=function(){return r},this.setSession=async function(D){if(r=D,r!==null){r.addEventListener("select",w),r.addEventListener("selectstart",w),r.addEventListener("selectend",w),r.addEventListener("squeeze",w),r.addEventListener("squeezestart",w),r.addEventListener("squeezeend",w),r.addEventListener("end",b),r.addEventListener("inputsourceschange",S);let F=t.getContextAttributes();if(F.xrCompatible!==!0&&await t.makeXRCompatible(),r.renderState.layers===void 0){let O={antialias:F.antialias,alpha:F.alpha,depth:F.depth,stencil:F.stencil,framebufferScaleFactor:s},U=new XRWebGLLayer(r,t,O);r.updateRenderState({baseLayer:U})}else{let O=0;F.depth&&(O=F.stencil?34041:6402);let U={colorFormat:F.alpha?6408:6407,depthFormat:O,scaleFactor:s};u=new XRWebGLBinding(r,t),h=u.createProjectionLayer(U),f=t.createFramebuffer(),r.updateRenderState({layers:[h]})}o=await r.requestReferenceSpace(l),R.setContext(r),R.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};function S(D){let F=r.inputSources;for(let O=0;O<d.length;O++)p.set(F[O],d[O]);for(let O=0;O<D.removed.length;O++){let U=D.removed[O],j=p.get(U);j&&(j.dispatchEvent({type:"disconnected",data:U}),p.delete(U))}for(let O=0;O<D.added.length;O++){let U=D.added[O],j=p.get(U);j&&j.dispatchEvent({type:"connected",data:U})}}let M=new L,T=new L;function E(D,F,O){M.setFromMatrixPosition(F.matrixWorld),T.setFromMatrixPosition(O.matrixWorld);let U=M.distanceTo(T),j=F.projectionMatrix.elements,Z=O.projectionMatrix.elements,K=j[14]/(j[10]-1),G=j[14]/(j[10]+1),k=(j[9]+1)/j[5],B=(j[9]-1)/j[5],H=(j[8]-1)/j[0],W=(Z[8]+1)/Z[0],X=K*H,te=K*W,he=U/(-H+W),ae=he*-H;F.matrixWorld.decompose(D.position,D.quaternion,D.scale),D.translateX(ae),D.translateZ(he),D.matrixWorld.compose(D.position,D.quaternion,D.scale),D.matrixWorldInverse.copy(D.matrixWorld).invert();let ce=K+he,q=G+he,re=X-ae,Q=te+(U-ae),oe=k*G/q*ce,V=B*G/q*ce;D.projectionMatrix.makePerspective(re,Q,oe,V,ce,q)}function A(D,F){F===null?D.matrixWorld.copy(D.matrix):D.matrixWorld.multiplyMatrices(F.matrixWorld,D.matrix),D.matrixWorldInverse.copy(D.matrixWorld).invert()}this.updateCamera=function(D){if(r===null)return;g.near=v.near=m.near=D.near,g.far=v.far=m.far=D.far,(y!==g.near||_!==g.far)&&(r.updateRenderState({depthNear:g.near,depthFar:g.far}),y=g.near,_=g.far);let F=D.parent,O=g.cameras;A(g,F);for(let j=0;j<O.length;j++)A(O[j],F);g.matrixWorld.decompose(g.position,g.quaternion,g.scale),D.position.copy(g.position),D.quaternion.copy(g.quaternion),D.scale.copy(g.scale),D.matrix.copy(g.matrix),D.matrixWorld.copy(g.matrixWorld);let U=D.children;for(let j=0,Z=U.length;j<Z;j++)U[j].updateMatrixWorld(!0);O.length===2?E(g,m,v):g.projectionMatrix.copy(m.projectionMatrix)},this.getCamera=function(){return g};let I=null;function C(D,F){if(c=F.getViewerPose(o),c!==null){let U=c.views,j=r.renderState.baseLayer;r.renderState.layers===void 0&&i.bindXRFramebuffer(j.framebuffer);let Z=!1;U.length!==g.cameras.length&&(g.cameras.length=0,Z=!0);for(let K=0;K<U.length;K++){let G=U[K],k=null;if(r.renderState.layers===void 0)k=j.getViewport(G);else{let H=u.getViewSubImage(h,G);i.bindXRFramebuffer(f),t.framebufferTexture2D(36160,36064,3553,H.colorTexture,0),H.depthStencilTexture!==void 0&&t.framebufferTexture2D(36160,36096,3553,H.depthStencilTexture,0),k=H.viewport}let B=x[K];B.matrix.fromArray(G.transform.matrix),B.projectionMatrix.fromArray(G.projectionMatrix),B.viewport.set(k.x,k.y,k.width,k.height),K===0&&g.matrix.copy(B.matrix),Z===!0&&g.cameras.push(B)}}let O=r.inputSources;for(let U=0;U<d.length;U++){let j=d[U],Z=O[U];j.update(Z,F,o)}I&&I(D,F)}let R=new R0;R.setAnimationLoop(C),this.setAnimationLoop=function(D){I=D},this.dispose=function(){}}};function pE(a){function e(x,g){x.fogColor.value.copy(g.color),g.isFog?(x.fogNear.value=g.near,x.fogFar.value=g.far):g.isFogExp2&&(x.fogDensity.value=g.density)}function t(x,g,y,_,w){g.isMeshBasicMaterial?n(x,g):g.isMeshLambertMaterial?(n(x,g),l(x,g)):g.isMeshToonMaterial?(n(x,g),u(x,g)):g.isMeshPhongMaterial?(n(x,g),c(x,g)):g.isMeshStandardMaterial?(n(x,g),g.isMeshPhysicalMaterial?h(x,g,w):f(x,g)):g.isMeshMatcapMaterial?(n(x,g),d(x,g)):g.isMeshDepthMaterial?(n(x,g),p(x,g)):g.isMeshDistanceMaterial?(n(x,g),m(x,g)):g.isMeshNormalMaterial?(n(x,g),v(x,g)):g.isLineBasicMaterial?(i(x,g),g.isLineDashedMaterial&&r(x,g)):g.isPointsMaterial?s(x,g,y,_):g.isSpriteMaterial?o(x,g):g.isShadowMaterial?(x.color.value.copy(g.color),x.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}function n(x,g){x.opacity.value=g.opacity,g.color&&x.diffuse.value.copy(g.color),g.emissive&&x.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(x.map.value=g.map),g.alphaMap&&(x.alphaMap.value=g.alphaMap),g.specularMap&&(x.specularMap.value=g.specularMap);let y=a.get(g).envMap;if(y){x.envMap.value=y,x.flipEnvMap.value=y.isCubeTexture&&y._needsFlipEnvMap?-1:1,x.reflectivity.value=g.reflectivity,x.refractionRatio.value=g.refractionRatio;let b=a.get(y).__maxMipLevel;b!==void 0&&(x.maxMipLevel.value=b)}g.lightMap&&(x.lightMap.value=g.lightMap,x.lightMapIntensity.value=g.lightMapIntensity),g.aoMap&&(x.aoMap.value=g.aoMap,x.aoMapIntensity.value=g.aoMapIntensity);let _;g.map?_=g.map:g.specularMap?_=g.specularMap:g.displacementMap?_=g.displacementMap:g.normalMap?_=g.normalMap:g.bumpMap?_=g.bumpMap:g.roughnessMap?_=g.roughnessMap:g.metalnessMap?_=g.metalnessMap:g.alphaMap?_=g.alphaMap:g.emissiveMap?_=g.emissiveMap:g.clearcoatMap?_=g.clearcoatMap:g.clearcoatNormalMap?_=g.clearcoatNormalMap:g.clearcoatRoughnessMap&&(_=g.clearcoatRoughnessMap),_!==void 0&&(_.isWebGLRenderTarget&&(_=_.texture),_.matrixAutoUpdate===!0&&_.updateMatrix(),x.uvTransform.value.copy(_.matrix));let w;g.aoMap?w=g.aoMap:g.lightMap&&(w=g.lightMap),w!==void 0&&(w.isWebGLRenderTarget&&(w=w.texture),w.matrixAutoUpdate===!0&&w.updateMatrix(),x.uv2Transform.value.copy(w.matrix))}function i(x,g){x.diffuse.value.copy(g.color),x.opacity.value=g.opacity}function r(x,g){x.dashSize.value=g.dashSize,x.totalSize.value=g.dashSize+g.gapSize,x.scale.value=g.scale}function s(x,g,y,_){x.diffuse.value.copy(g.color),x.opacity.value=g.opacity,x.size.value=g.size*y,x.scale.value=_*.5,g.map&&(x.map.value=g.map),g.alphaMap&&(x.alphaMap.value=g.alphaMap);let w;g.map?w=g.map:g.alphaMap&&(w=g.alphaMap),w!==void 0&&(w.matrixAutoUpdate===!0&&w.updateMatrix(),x.uvTransform.value.copy(w.matrix))}function o(x,g){x.diffuse.value.copy(g.color),x.opacity.value=g.opacity,x.rotation.value=g.rotation,g.map&&(x.map.value=g.map),g.alphaMap&&(x.alphaMap.value=g.alphaMap);let y;g.map?y=g.map:g.alphaMap&&(y=g.alphaMap),y!==void 0&&(y.matrixAutoUpdate===!0&&y.updateMatrix(),x.uvTransform.value.copy(y.matrix))}function l(x,g){g.emissiveMap&&(x.emissiveMap.value=g.emissiveMap)}function c(x,g){x.specular.value.copy(g.specular),x.shininess.value=Math.max(g.shininess,1e-4),g.emissiveMap&&(x.emissiveMap.value=g.emissiveMap),g.bumpMap&&(x.bumpMap.value=g.bumpMap,x.bumpScale.value=g.bumpScale,g.side===gt&&(x.bumpScale.value*=-1)),g.normalMap&&(x.normalMap.value=g.normalMap,x.normalScale.value.copy(g.normalScale),g.side===gt&&x.normalScale.value.negate()),g.displacementMap&&(x.displacementMap.value=g.displacementMap,x.displacementScale.value=g.displacementScale,x.displacementBias.value=g.displacementBias)}function u(x,g){g.gradientMap&&(x.gradientMap.value=g.gradientMap),g.emissiveMap&&(x.emissiveMap.value=g.emissiveMap),g.bumpMap&&(x.bumpMap.value=g.bumpMap,x.bumpScale.value=g.bumpScale,g.side===gt&&(x.bumpScale.value*=-1)),g.normalMap&&(x.normalMap.value=g.normalMap,x.normalScale.value.copy(g.normalScale),g.side===gt&&x.normalScale.value.negate()),g.displacementMap&&(x.displacementMap.value=g.displacementMap,x.displacementScale.value=g.displacementScale,x.displacementBias.value=g.displacementBias)}function f(x,g){x.roughness.value=g.roughness,x.metalness.value=g.metalness,g.roughnessMap&&(x.roughnessMap.value=g.roughnessMap),g.metalnessMap&&(x.metalnessMap.value=g.metalnessMap),g.emissiveMap&&(x.emissiveMap.value=g.emissiveMap),g.bumpMap&&(x.bumpMap.value=g.bumpMap,x.bumpScale.value=g.bumpScale,g.side===gt&&(x.bumpScale.value*=-1)),g.normalMap&&(x.normalMap.value=g.normalMap,x.normalScale.value.copy(g.normalScale),g.side===gt&&x.normalScale.value.negate()),g.displacementMap&&(x.displacementMap.value=g.displacementMap,x.displacementScale.value=g.displacementScale,x.displacementBias.value=g.displacementBias),a.get(g).envMap&&(x.envMapIntensity.value=g.envMapIntensity)}function h(x,g,y){f(x,g),x.reflectivity.value=g.reflectivity,x.clearcoat.value=g.clearcoat,x.clearcoatRoughness.value=g.clearcoatRoughness,g.sheen&&x.sheen.value.copy(g.sheen),g.clearcoatMap&&(x.clearcoatMap.value=g.clearcoatMap),g.clearcoatRoughnessMap&&(x.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap),g.clearcoatNormalMap&&(x.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),x.clearcoatNormalMap.value=g.clearcoatNormalMap,g.side===gt&&x.clearcoatNormalScale.value.negate()),x.transmission.value=g.transmission,g.transmissionMap&&(x.transmissionMap.value=g.transmissionMap),g.transmission>0&&(x.transmissionSamplerMap.value=y.texture,x.transmissionSamplerSize.value.set(y.width,y.height)),x.thickness.value=g.thickness,g.thicknessMap&&(x.thicknessMap.value=g.thicknessMap),x.attenuationDistance.value=g.attenuationDistance,x.attenuationColor.value.copy(g.attenuationColor)}function d(x,g){g.matcap&&(x.matcap.value=g.matcap),g.bumpMap&&(x.bumpMap.value=g.bumpMap,x.bumpScale.value=g.bumpScale,g.side===gt&&(x.bumpScale.value*=-1)),g.normalMap&&(x.normalMap.value=g.normalMap,x.normalScale.value.copy(g.normalScale),g.side===gt&&x.normalScale.value.negate()),g.displacementMap&&(x.displacementMap.value=g.displacementMap,x.displacementScale.value=g.displacementScale,x.displacementBias.value=g.displacementBias)}function p(x,g){g.displacementMap&&(x.displacementMap.value=g.displacementMap,x.displacementScale.value=g.displacementScale,x.displacementBias.value=g.displacementBias)}function m(x,g){g.displacementMap&&(x.displacementMap.value=g.displacementMap,x.displacementScale.value=g.displacementScale,x.displacementBias.value=g.displacementBias),x.referencePosition.value.copy(g.referencePosition),x.nearDistance.value=g.nearDistance,x.farDistance.value=g.farDistance}function v(x,g){g.bumpMap&&(x.bumpMap.value=g.bumpMap,x.bumpScale.value=g.bumpScale,g.side===gt&&(x.bumpScale.value*=-1)),g.normalMap&&(x.normalMap.value=g.normalMap,x.normalScale.value.copy(g.normalScale),g.side===gt&&x.normalScale.value.negate()),g.displacementMap&&(x.displacementMap.value=g.displacementMap,x.displacementScale.value=g.displacementScale,x.displacementBias.value=g.displacementBias)}return{refreshFogUniforms:e,refreshMaterialUniforms:t}}function mE(){let a=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return a.style.display="block",a}function et(a={}){let e=a.canvas!==void 0?a.canvas:mE(),t=a.context!==void 0?a.context:null,n=a.alpha!==void 0?a.alpha:!1,i=a.depth!==void 0?a.depth:!0,r=a.stencil!==void 0?a.stencil:!0,s=a.antialias!==void 0?a.antialias:!1,o=a.premultipliedAlpha!==void 0?a.premultipliedAlpha:!0,l=a.preserveDrawingBuffer!==void 0?a.preserveDrawingBuffer:!1,c=a.powerPreference!==void 0?a.powerPreference:"default",u=a.failIfMajorPerformanceCaveat!==void 0?a.failIfMajorPerformanceCaveat:!1,f=null,h=null,d=[],p=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=jt,this.physicallyCorrectLights=!1,this.toneMapping=vr,this.toneMappingExposure=1;let m=this,v=!1,x=0,g=0,y=null,_=-1,w=null,b=new De,S=new De,M=null,T=e.width,E=e.height,A=1,I=null,C=null,R=new De(0,0,T,E),D=new De(0,0,T,E),F=!1,O=[],U=new So,j=!1,Z=!1,K=null,G=new fe,k=new L,B={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function H(){return y===null?A:1}let W=t;function X(z,ie){for(let ne=0;ne<z.length;ne++){let le=z[ne],xe=e.getContext(le,ie);if(xe!==null)return xe}return null}try{let z={alpha:n,depth:i,stencil:r,antialias:s,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if(e.addEventListener("webglcontextlost",qe,!1),e.addEventListener("webglcontextrestored",$,!1),W===null){let ie=["webgl2","webgl","experimental-webgl"];if(m.isWebGL1Renderer===!0&&ie.shift(),W=X(ie,z),W===null)throw X(ie)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}W.getShaderPrecisionFormat===void 0&&(W.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(z){throw console.error("THREE.WebGLRenderer: "+z.message),z}let te,he,ae,ce,q,re,Q,oe,V,P,N,ee,se,me,ve,Te,Ee,Ie,Me,Y,ge,de;function Ae(){te=new US(W),he=new OS(W,te,a),te.init(he),ge=new tx(W,te,he),ae=new uE(W,te,he),O[0]=1029,ce=new GS(W),q=new eE,re=new fE(W,te,ae,q,he,ge,ce),Q=new zS(m),oe=new fb(W,he),de=new BS(W,te,oe,he),V=new VS(W,oe,ce,de),P=new qS(W,V,oe,ce),Ie=new jS(W),ve=new kS(q),N=new KT(m,Q,te,he,de,ve),ee=new pE(q),se=new nE(q),me=new lE(te,he),Ee=new FS(m,Q,ae,P,o),Te=new ex(m,P,he),Me=new NS(W,te,ce,he),Y=new HS(W,te,ce,he),ce.programs=N.programs,m.capabilities=he,m.extensions=te,m.properties=q,m.renderLists=se,m.shadowMap=Te,m.state=ae,m.info=ce}Ae();let we=new nx(m,W);this.xr=we,this.getContext=function(){return W},this.getContextAttributes=function(){return W.getContextAttributes()},this.forceContextLoss=function(){let z=te.get("WEBGL_lose_context");z&&z.loseContext()},this.forceContextRestore=function(){let z=te.get("WEBGL_lose_context");z&&z.restoreContext()},this.getPixelRatio=function(){return A},this.setPixelRatio=function(z){z!==void 0&&(A=z,this.setSize(T,E,!1))},this.getSize=function(z){return z.set(T,E)},this.setSize=function(z,ie,ne){if(we.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}T=z,E=ie,e.width=Math.floor(z*A),e.height=Math.floor(ie*A),ne!==!1&&(e.style.width=z+"px",e.style.height=ie+"px"),this.setViewport(0,0,z,ie)},this.getDrawingBufferSize=function(z){return z.set(T*A,E*A).floor()},this.setDrawingBufferSize=function(z,ie,ne){T=z,E=ie,A=ne,e.width=Math.floor(z*ne),e.height=Math.floor(ie*ne),this.setViewport(0,0,z,ie)},this.getCurrentViewport=function(z){return z.copy(b)},this.getViewport=function(z){return z.copy(R)},this.setViewport=function(z,ie,ne,le){z.isVector4?R.set(z.x,z.y,z.z,z.w):R.set(z,ie,ne,le),ae.viewport(b.copy(R).multiplyScalar(A).floor())},this.getScissor=function(z){return z.copy(D)},this.setScissor=function(z,ie,ne,le){z.isVector4?D.set(z.x,z.y,z.z,z.w):D.set(z,ie,ne,le),ae.scissor(S.copy(D).multiplyScalar(A).floor())},this.getScissorTest=function(){return F},this.setScissorTest=function(z){ae.setScissorTest(F=z)},this.setOpaqueSort=function(z){I=z},this.setTransparentSort=function(z){C=z},this.getClearColor=function(z){return z.copy(Ee.getClearColor())},this.setClearColor=function(){Ee.setClearColor.apply(Ee,arguments)},this.getClearAlpha=function(){return Ee.getClearAlpha()},this.setClearAlpha=function(){Ee.setClearAlpha.apply(Ee,arguments)},this.clear=function(z,ie,ne){let le=0;(z===void 0||z)&&(le|=16384),(ie===void 0||ie)&&(le|=256),(ne===void 0||ne)&&(le|=1024),W.clear(le)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",qe,!1),e.removeEventListener("webglcontextrestored",$,!1),se.dispose(),me.dispose(),q.dispose(),Q.dispose(),P.dispose(),de.dispose(),we.dispose(),we.removeEventListener("sessionstart",di),we.removeEventListener("sessionend",zt),K&&(K.dispose(),K=null),_t.stop()};function qe(z){z.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),v=!0}function $(){console.log("THREE.WebGLRenderer: Context Restored."),v=!1;let z=ce.autoReset,ie=Te.enabled,ne=Te.autoUpdate,le=Te.needsUpdate,xe=Te.type;Ae(),ce.autoReset=z,Te.enabled=ie,Te.autoUpdate=ne,Te.needsUpdate=le,Te.type=xe}function be(z){let ie=z.target;ie.removeEventListener("dispose",be),Je(ie)}function Je(z){Be(z),q.remove(z)}function Be(z){let ie=q.get(z).programs;ie!==void 0&&ie.forEach(function(ne){N.releaseProgram(ne)})}function ot(z,ie){z.render(function(ne){m.renderBufferImmediate(ne,ie)})}this.renderBufferImmediate=function(z,ie){de.initAttributes();let ne=q.get(z);z.hasPositions&&!ne.position&&(ne.position=W.createBuffer()),z.hasNormals&&!ne.normal&&(ne.normal=W.createBuffer()),z.hasUvs&&!ne.uv&&(ne.uv=W.createBuffer()),z.hasColors&&!ne.color&&(ne.color=W.createBuffer());let le=ie.getAttributes();z.hasPositions&&(W.bindBuffer(34962,ne.position),W.bufferData(34962,z.positionArray,35048),de.enableAttribute(le.position),W.vertexAttribPointer(le.position,3,5126,!1,0,0)),z.hasNormals&&(W.bindBuffer(34962,ne.normal),W.bufferData(34962,z.normalArray,35048),de.enableAttribute(le.normal),W.vertexAttribPointer(le.normal,3,5126,!1,0,0)),z.hasUvs&&(W.bindBuffer(34962,ne.uv),W.bufferData(34962,z.uvArray,35048),de.enableAttribute(le.uv),W.vertexAttribPointer(le.uv,2,5126,!1,0,0)),z.hasColors&&(W.bindBuffer(34962,ne.color),W.bufferData(34962,z.colorArray,35048),de.enableAttribute(le.color),W.vertexAttribPointer(le.color,3,5126,!1,0,0)),de.disableUnusedAttributes(),W.drawArrays(4,0,z.count),z.count=0},this.renderBufferDirect=function(z,ie,ne,le,xe,ke){ie===null&&(ie=B);let Ne=xe.isMesh&&xe.matrixWorld.determinant()<0,Pe=km(z,ie,le,xe);ae.setMaterial(le,Ne);let ze=ne.index,Le=ne.attributes.position;if(ze===null){if(Le===void 0||Le.count===0)return}else if(ze.count===0)return;let Ge=1;le.wireframe===!0&&(ze=V.getWireframeAttribute(ne),Ge=2),(le.morphTargets||le.morphNormals)&&Ie.update(xe,ne,le,Pe),de.setup(xe,le,Pe,ne,ze);let Fe,nt=Me;ze!==null&&(Fe=oe.get(ze),nt=Y,nt.setIndex(Fe));let pi=ze!==null?ze.count:Le.count,ln=ne.drawRange.start*Ge,as=ne.drawRange.count*Ge,ut=ke!==null?ke.start*Ge:0,ls=ke!==null?ke.count*Ge:1/0,Kt=Math.max(ln,ut),t_=Math.min(pi,ln+as,ut+ls)-1,ec=Math.max(0,t_-Kt+1);if(ec!==0){if(xe.isMesh)le.wireframe===!0?(ae.setLineWidth(le.wireframeLinewidth*H()),nt.setMode(1)):nt.setMode(4);else if(xe.isLine){let Ca=le.linewidth;Ca===void 0&&(Ca=1),ae.setLineWidth(Ca*H()),xe.isLineSegments?nt.setMode(1):xe.isLineLoop?nt.setMode(2):nt.setMode(3)}else xe.isPoints?nt.setMode(0):xe.isSprite&&nt.setMode(4);if(xe.isInstancedMesh)nt.renderInstances(Kt,ec,xe.count);else if(ne.isInstancedBufferGeometry){let Ca=Math.min(ne.instanceCount,ne._maxInstanceCount);nt.renderInstances(Kt,ec,Ca)}else nt.render(Kt,ec)}},this.compile=function(z,ie){h=me.get(z),h.init(),z.traverseVisible(function(ne){ne.isLight&&ne.layers.test(ie.layers)&&(h.pushLight(ne),ne.castShadow&&h.pushShadow(ne))}),h.setupLights(),z.traverse(function(ne){let le=ne.material;if(le)if(Array.isArray(le))for(let xe=0;xe<le.length;xe++){let ke=le[xe];Cu(ke,z,ne)}else Cu(le,z,ne)})};let mt=null;function Bn(z){mt&&mt(z)}function di(){_t.stop()}function zt(){_t.start()}let _t=new R0;_t.setAnimationLoop(Bn),typeof window!="undefined"&&_t.setContext(window),this.setAnimationLoop=function(z){mt=z,we.setAnimationLoop(z),z===null?_t.stop():_t.start()},we.addEventListener("sessionstart",di),we.addEventListener("sessionend",zt),this.render=function(z,ie){if(ie!==void 0&&ie.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(v===!0)return;z.autoUpdate===!0&&z.updateMatrixWorld(),ie.parent===null&&ie.updateMatrixWorld(),we.enabled===!0&&we.isPresenting===!0&&(we.cameraAutoUpdate===!0&&we.updateCamera(ie),ie=we.getCamera()),z.isScene===!0&&z.onBeforeRender(m,z,ie,y),h=me.get(z,p.length),h.init(),p.push(h),G.multiplyMatrices(ie.projectionMatrix,ie.matrixWorldInverse),U.setFromProjectionMatrix(G),Z=this.localClippingEnabled,j=ve.init(this.clippingPlanes,Z,ie),f=se.get(z,d.length),f.init(),d.push(f),pr(z,ie,0,m.sortObjects),f.finish(),m.sortObjects===!0&&f.sort(I,C),j===!0&&ve.beginShadows();let ne=h.state.shadowsArray;Te.render(ne,z,ie),h.setupLights(),h.setupLightsView(ie),j===!0&&ve.endShadows(),this.info.autoReset===!0&&this.info.reset(),Ee.render(f,z);let le=f.opaque,xe=f.transmissive,ke=f.transparent;le.length>0&&Kl(le,z,ie),xe.length>0&&$s(le,xe,z,ie),ke.length>0&&Kl(ke,z,ie),y!==null&&(re.updateMultisampleRenderTarget(y),re.updateRenderTargetMipmap(y)),z.isScene===!0&&z.onAfterRender(m,z,ie),ae.buffers.depth.setTest(!0),ae.buffers.depth.setMask(!0),ae.buffers.color.setMask(!0),ae.setPolygonOffset(!1),de.resetDefaultState(),_=-1,w=null,p.pop(),p.length>0?h=p[p.length-1]:h=null,d.pop(),d.length>0?f=d[d.length-1]:f=null};function pr(z,ie,ne,le){if(z.visible===!1)return;if(z.layers.test(ie.layers)){if(z.isGroup)ne=z.renderOrder;else if(z.isLOD)z.autoUpdate===!0&&z.update(ie);else if(z.isLight)h.pushLight(z),z.castShadow&&h.pushShadow(z);else if(z.isSprite){if(!z.frustumCulled||U.intersectsSprite(z)){le&&k.setFromMatrixPosition(z.matrixWorld).applyMatrix4(G);let Ne=P.update(z),Pe=z.material;Pe.visible&&f.push(z,Ne,Pe,ne,k.z,null)}}else if(z.isImmediateRenderObject)le&&k.setFromMatrixPosition(z.matrixWorld).applyMatrix4(G),f.push(z,null,z.material,ne,k.z,null);else if((z.isMesh||z.isLine||z.isPoints)&&(z.isSkinnedMesh&&z.skeleton.frame!==ce.render.frame&&(z.skeleton.update(),z.skeleton.frame=ce.render.frame),!z.frustumCulled||U.intersectsObject(z))){le&&k.setFromMatrixPosition(z.matrixWorld).applyMatrix4(G);let Ne=P.update(z),Pe=z.material;if(Array.isArray(Pe)){let ze=Ne.groups;for(let Le=0,Ge=ze.length;Le<Ge;Le++){let Fe=ze[Le],nt=Pe[Fe.materialIndex];nt&&nt.visible&&f.push(z,Ne,nt,ne,k.z,Fe)}}else Pe.visible&&f.push(z,Ne,Pe,ne,k.z,null)}}let ke=z.children;for(let Ne=0,Pe=ke.length;Ne<Pe;Ne++)pr(ke[Ne],ie,ne,le)}function $s(z,ie,ne,le){if(K===null){let Pe=s===!0&&he.isWebGL2===!0?fc:Zt;K=new Pe(1024,1024,{generateMipmaps:!0,type:ge.convert(fs)!==null?fs:us,minFilter:mi,magFilter:Mt,wrapS:bt,wrapT:bt})}let xe=m.getRenderTarget();m.setRenderTarget(K),m.clear();let ke=m.toneMapping;m.toneMapping=vr,Kl(z,ne,le),m.toneMapping=ke,re.updateMultisampleRenderTarget(K),re.updateRenderTargetMipmap(K),m.setRenderTarget(xe),Kl(ie,ne,le)}function Kl(z,ie,ne){let le=ie.isScene===!0?ie.overrideMaterial:null;for(let xe=0,ke=z.length;xe<ke;xe++){let Ne=z[xe],Pe=Ne.object,ze=Ne.geometry,Le=le===null?Ne.material:le,Ge=Ne.group;if(ne.isArrayCamera){let Fe=ne.cameras;for(let nt=0,pi=Fe.length;nt<pi;nt++){let ln=Fe[nt];Pe.layers.test(ln.layers)&&(ae.viewport(b.copy(ln.viewport)),h.setupLightsView(ln),Nm(Pe,ie,ln,ze,Le,Ge))}}else Nm(Pe,ie,ne,ze,Le,Ge)}}function Nm(z,ie,ne,le,xe,ke){if(z.onBeforeRender(m,ie,ne,le,xe,ke),z.modelViewMatrix.multiplyMatrices(ne.matrixWorldInverse,z.matrixWorld),z.normalMatrix.getNormalMatrix(z.modelViewMatrix),z.isImmediateRenderObject){let Ne=km(ne,ie,xe,z);ae.setMaterial(xe),de.reset(),ot(z,Ne)}else xe.transparent===!0&&xe.side===Mn?(xe.side=gt,xe.needsUpdate=!0,m.renderBufferDirect(ne,ie,le,xe,z,ke),xe.side=zi,xe.needsUpdate=!0,m.renderBufferDirect(ne,ie,le,xe,z,ke),xe.side=Mn):m.renderBufferDirect(ne,ie,le,xe,z,ke);z.onAfterRender(m,ie,ne,le,xe,ke)}function Cu(z,ie,ne){ie.isScene!==!0&&(ie=B);let le=q.get(z),xe=h.state.lights,ke=h.state.shadowsArray,Ne=xe.state.version,Pe=N.getParameters(z,xe.state,ke,ie,ne),ze=N.getProgramCacheKey(Pe),Le=le.programs;le.environment=z.isMeshStandardMaterial?ie.environment:null,le.fog=ie.fog,le.envMap=Q.get(z.envMap||le.environment),Le===void 0&&(z.addEventListener("dispose",be),Le=new Map,le.programs=Le);let Ge=Le.get(ze);if(Ge!==void 0){if(le.currentProgram===Ge&&le.lightsStateVersion===Ne)return Om(z,Pe),Ge}else Pe.uniforms=N.getUniforms(z),z.onBuild(Pe,m),z.onBeforeCompile(Pe,m),Ge=N.acquireProgram(Pe,ze),Le.set(ze,Ge),le.uniforms=Pe.uniforms;let Fe=le.uniforms;(!z.isShaderMaterial&&!z.isRawShaderMaterial||z.clipping===!0)&&(Fe.clippingPlanes=ve.uniform),Om(z,Pe),le.needsLights=e_(z),le.lightsStateVersion=Ne,le.needsLights&&(Fe.ambientLightColor.value=xe.state.ambient,Fe.lightProbe.value=xe.state.probe,Fe.directionalLights.value=xe.state.directional,Fe.directionalLightShadows.value=xe.state.directionalShadow,Fe.spotLights.value=xe.state.spot,Fe.spotLightShadows.value=xe.state.spotShadow,Fe.rectAreaLights.value=xe.state.rectArea,Fe.ltc_1.value=xe.state.rectAreaLTC1,Fe.ltc_2.value=xe.state.rectAreaLTC2,Fe.pointLights.value=xe.state.point,Fe.pointLightShadows.value=xe.state.pointShadow,Fe.hemisphereLights.value=xe.state.hemi,Fe.directionalShadowMap.value=xe.state.directionalShadowMap,Fe.directionalShadowMatrix.value=xe.state.directionalShadowMatrix,Fe.spotShadowMap.value=xe.state.spotShadowMap,Fe.spotShadowMatrix.value=xe.state.spotShadowMatrix,Fe.pointShadowMap.value=xe.state.pointShadowMap,Fe.pointShadowMatrix.value=xe.state.pointShadowMatrix);let nt=Ge.getUniforms(),pi=Cr.seqWithValue(nt.seq,Fe);return le.currentProgram=Ge,le.uniformsList=pi,Ge}function Om(z,ie){let ne=q.get(z);ne.outputEncoding=ie.outputEncoding,ne.instancing=ie.instancing,ne.skinning=ie.skinning,ne.numClippingPlanes=ie.numClippingPlanes,ne.numIntersection=ie.numClipIntersection,ne.vertexAlphas=ie.vertexAlphas}function km(z,ie,ne,le){ie.isScene!==!0&&(ie=B),re.resetTextureUnits();let xe=ie.fog,ke=ne.isMeshStandardMaterial?ie.environment:null,Ne=y===null?m.outputEncoding:y.texture.encoding,Pe=Q.get(ne.envMap||ke),ze=ne.vertexColors===!0&&le.geometry&&le.geometry.attributes.color&&le.geometry.attributes.color.itemSize===4,Le=q.get(ne),Ge=h.state.lights;if(j===!0&&(Z===!0||z!==w)){let Kt=z===w&&ne.id===_;ve.setState(ne,z,Kt)}let Fe=!1;ne.version===Le.__version?(Le.needsLights&&Le.lightsStateVersion!==Ge.state.version||Le.outputEncoding!==Ne||le.isInstancedMesh&&Le.instancing===!1||!le.isInstancedMesh&&Le.instancing===!0||le.isSkinnedMesh&&Le.skinning===!1||!le.isSkinnedMesh&&Le.skinning===!0||Le.envMap!==Pe||ne.fog&&Le.fog!==xe||Le.numClippingPlanes!==void 0&&(Le.numClippingPlanes!==ve.numPlanes||Le.numIntersection!==ve.numIntersection)||Le.vertexAlphas!==ze)&&(Fe=!0):(Fe=!0,Le.__version=ne.version);let nt=Le.currentProgram;Fe===!0&&(nt=Cu(ne,ie,le));let pi=!1,ln=!1,as=!1,ut=nt.getUniforms(),ls=Le.uniforms;if(ae.useProgram(nt.program)&&(pi=!0,ln=!0,as=!0),ne.id!==_&&(_=ne.id,ln=!0),pi||w!==z){if(ut.setValue(W,"projectionMatrix",z.projectionMatrix),he.logarithmicDepthBuffer&&ut.setValue(W,"logDepthBufFC",2/(Math.log(z.far+1)/Math.LN2)),w!==z&&(w=z,ln=!0,as=!0),ne.isShaderMaterial||ne.isMeshPhongMaterial||ne.isMeshToonMaterial||ne.isMeshStandardMaterial||ne.envMap){let Kt=ut.map.cameraPosition;Kt!==void 0&&Kt.setValue(W,k.setFromMatrixPosition(z.matrixWorld))}(ne.isMeshPhongMaterial||ne.isMeshToonMaterial||ne.isMeshLambertMaterial||ne.isMeshBasicMaterial||ne.isMeshStandardMaterial||ne.isShaderMaterial)&&ut.setValue(W,"isOrthographic",z.isOrthographicCamera===!0),(ne.isMeshPhongMaterial||ne.isMeshToonMaterial||ne.isMeshLambertMaterial||ne.isMeshBasicMaterial||ne.isMeshStandardMaterial||ne.isShaderMaterial||ne.isShadowMaterial||le.isSkinnedMesh)&&ut.setValue(W,"viewMatrix",z.matrixWorldInverse)}if(le.isSkinnedMesh){ut.setOptional(W,le,"bindMatrix"),ut.setOptional(W,le,"bindMatrixInverse");let Kt=le.skeleton;Kt&&(he.floatVertexTextures?(Kt.boneTexture===null&&Kt.computeBoneTexture(),ut.setValue(W,"boneTexture",Kt.boneTexture,re),ut.setValue(W,"boneTextureSize",Kt.boneTextureSize)):ut.setOptional(W,Kt,"boneMatrices"))}return(ln||Le.receiveShadow!==le.receiveShadow)&&(Le.receiveShadow=le.receiveShadow,ut.setValue(W,"receiveShadow",le.receiveShadow)),ln&&(ut.setValue(W,"toneMappingExposure",m.toneMappingExposure),Le.needsLights&&Kw(ls,as),xe&&ne.fog&&ee.refreshFogUniforms(ls,xe),ee.refreshMaterialUniforms(ls,ne,A,E,K),Cr.upload(W,Le.uniformsList,ls,re)),ne.isShaderMaterial&&ne.uniformsNeedUpdate===!0&&(Cr.upload(W,Le.uniformsList,ls,re),ne.uniformsNeedUpdate=!1),ne.isSpriteMaterial&&ut.setValue(W,"center",le.center),ut.setValue(W,"modelViewMatrix",le.modelViewMatrix),ut.setValue(W,"normalMatrix",le.normalMatrix),ut.setValue(W,"modelMatrix",le.matrixWorld),nt}function Kw(z,ie){z.ambientLightColor.needsUpdate=ie,z.lightProbe.needsUpdate=ie,z.directionalLights.needsUpdate=ie,z.directionalLightShadows.needsUpdate=ie,z.pointLights.needsUpdate=ie,z.pointLightShadows.needsUpdate=ie,z.spotLights.needsUpdate=ie,z.spotLightShadows.needsUpdate=ie,z.rectAreaLights.needsUpdate=ie,z.hemisphereLights.needsUpdate=ie}function e_(z){return z.isMeshLambertMaterial||z.isMeshToonMaterial||z.isMeshPhongMaterial||z.isMeshStandardMaterial||z.isShadowMaterial||z.isShaderMaterial&&z.lights===!0}this.getActiveCubeFace=function(){return x},this.getActiveMipmapLevel=function(){return g},this.getRenderTarget=function(){return y},this.setRenderTarget=function(z,ie=0,ne=0){y=z,x=ie,g=ne,z&&q.get(z).__webglFramebuffer===void 0&&re.setupRenderTarget(z);let le=null,xe=!1,ke=!1;if(z){let Pe=z.texture;(Pe.isDataTexture3D||Pe.isDataTexture2DArray)&&(ke=!0);let ze=q.get(z).__webglFramebuffer;z.isWebGLCubeRenderTarget?(le=ze[ie],xe=!0):z.isWebGLMultisampleRenderTarget?le=q.get(z).__webglMultisampledFramebuffer:le=ze,b.copy(z.viewport),S.copy(z.scissor),M=z.scissorTest}else b.copy(R).multiplyScalar(A).floor(),S.copy(D).multiplyScalar(A).floor(),M=F;if(ae.bindFramebuffer(36160,le)&&he.drawBuffers){let Pe=!1;if(z)if(z.isWebGLMultipleRenderTargets){let ze=z.texture;if(O.length!==ze.length||O[0]!==36064){for(let Le=0,Ge=ze.length;Le<Ge;Le++)O[Le]=36064+Le;O.length=ze.length,Pe=!0}}else(O.length!==1||O[0]!==36064)&&(O[0]=36064,O.length=1,Pe=!0);else(O.length!==1||O[0]!==1029)&&(O[0]=1029,O.length=1,Pe=!0);Pe&&(he.isWebGL2?W.drawBuffers(O):te.get("WEBGL_draw_buffers").drawBuffersWEBGL(O))}if(ae.viewport(b),ae.scissor(S),ae.setScissorTest(M),xe){let Pe=q.get(z.texture);W.framebufferTexture2D(36160,36064,34069+ie,Pe.__webglTexture,ne)}else if(ke){let Pe=q.get(z.texture),ze=ie||0;W.framebufferTextureLayer(36160,36064,Pe.__webglTexture,ne||0,ze)}},this.readRenderTargetPixels=function(z,ie,ne,le,xe,ke,Ne){if(!(z&&z.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Pe=q.get(z).__webglFramebuffer;if(z.isWebGLCubeRenderTarget&&Ne!==void 0&&(Pe=Pe[Ne]),Pe){ae.bindFramebuffer(36160,Pe);try{let ze=z.texture,Le=ze.format,Ge=ze.type;if(Le!==gn&&ge.convert(Le)!==W.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let Fe=Ge===fs&&(te.has("EXT_color_buffer_half_float")||he.isWebGL2&&te.has("EXT_color_buffer_float"));if(Ge!==us&&ge.convert(Ge)!==W.getParameter(35738)&&!(Ge===Vi&&(he.isWebGL2||te.has("OES_texture_float")||te.has("WEBGL_color_buffer_float")))&&!Fe){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}W.checkFramebufferStatus(36160)===36053?ie>=0&&ie<=z.width-le&&ne>=0&&ne<=z.height-xe&&W.readPixels(ie,ne,le,xe,ge.convert(Le),ge.convert(Ge),ke):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{let ze=y!==null?q.get(y).__webglFramebuffer:null;ae.bindFramebuffer(36160,ze)}}},this.copyFramebufferToTexture=function(z,ie,ne=0){let le=Math.pow(2,-ne),xe=Math.floor(ie.image.width*le),ke=Math.floor(ie.image.height*le),Ne=ge.convert(ie.format);he.isWebGL2&&(Ne===6407&&(Ne=32849),Ne===6408&&(Ne=32856)),re.setTexture2D(ie,0),W.copyTexImage2D(3553,ne,Ne,z.x,z.y,xe,ke,0),ae.unbindTexture()},this.copyTextureToTexture=function(z,ie,ne,le=0){let xe=ie.image.width,ke=ie.image.height,Ne=ge.convert(ne.format),Pe=ge.convert(ne.type);re.setTexture2D(ne,0),W.pixelStorei(37440,ne.flipY),W.pixelStorei(37441,ne.premultiplyAlpha),W.pixelStorei(3317,ne.unpackAlignment),ie.isDataTexture?W.texSubImage2D(3553,le,z.x,z.y,xe,ke,Ne,Pe,ie.image.data):ie.isCompressedTexture?W.compressedTexSubImage2D(3553,le,z.x,z.y,ie.mipmaps[0].width,ie.mipmaps[0].height,Ne,ie.mipmaps[0].data):W.texSubImage2D(3553,le,z.x,z.y,Ne,Pe,ie.image),le===0&&ne.generateMipmaps&&W.generateMipmap(3553),ae.unbindTexture()},this.copyTextureToTexture3D=function(z,ie,ne,le,xe=0){if(m.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let ke=z.max.x-z.min.x+1,Ne=z.max.y-z.min.y+1,Pe=z.max.z-z.min.z+1,ze=ge.convert(le.format),Le=ge.convert(le.type),Ge;if(le.isDataTexture3D)re.setTexture3D(le,0),Ge=32879;else if(le.isDataTexture2DArray)re.setTexture2DArray(le,0),Ge=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}W.pixelStorei(37440,le.flipY),W.pixelStorei(37441,le.premultiplyAlpha),W.pixelStorei(3317,le.unpackAlignment);let Fe=W.getParameter(3314),nt=W.getParameter(32878),pi=W.getParameter(3316),ln=W.getParameter(3315),as=W.getParameter(32877),ut=ne.isCompressedTexture?ne.mipmaps[0]:ne.image;W.pixelStorei(3314,ut.width),W.pixelStorei(32878,ut.height),W.pixelStorei(3316,z.min.x),W.pixelStorei(3315,z.min.y),W.pixelStorei(32877,z.min.z),ne.isDataTexture||ne.isDataTexture3D?W.texSubImage3D(Ge,xe,ie.x,ie.y,ie.z,ke,Ne,Pe,ze,Le,ut.data):ne.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),W.compressedTexSubImage3D(Ge,xe,ie.x,ie.y,ie.z,ke,Ne,Pe,ze,ut.data)):W.texSubImage3D(Ge,xe,ie.x,ie.y,ie.z,ke,Ne,Pe,ze,Le,ut),W.pixelStorei(3314,Fe),W.pixelStorei(32878,nt),W.pixelStorei(3316,pi),W.pixelStorei(3315,ln),W.pixelStorei(32877,as),xe===0&&le.generateMipmaps&&W.generateMipmap(Ge),ae.unbindTexture()},this.initTexture=function(z){re.setTexture2D(z,0),ae.unbindTexture()},this.resetState=function(){x=0,g=0,y=null,ae.reset(),de.reset()},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var zf=class extends et{};zf.prototype.isWebGL1Renderer=!0;var Eo=class{constructor(e,t=25e-5){this.name="",this.color=new ue(e),this.density=t}clone(){return new Eo(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}};Eo.prototype.isFogExp2=!0;var Ao=class{constructor(e,t=1,n=1e3){this.name="",this.color=new ue(e),this.near=t,this.far=n}clone(){return new Ao(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}};Ao.prototype.isFog=!0;var bs=class extends Re{constructor(){super();this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),t}};bs.prototype.isScene=!0;var gi=class{constructor(e,t){this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Gi,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Tn()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Tn()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Tn()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}};gi.prototype.isInterleavedBuffer=!0;var At=new L,ri=class{constructor(e,t,n,i=!1){this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=i===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)At.x=this.getX(t),At.y=this.getY(t),At.z=this.getZ(t),At.applyMatrix4(e),this.setXYZ(t,At.x,At.y,At.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)At.x=this.getX(t),At.y=this.getY(t),At.z=this.getZ(t),At.applyNormalMatrix(e),this.setXYZ(t,At.x,At.y,At.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)At.x=this.getX(t),At.y=this.getY(t),At.z=this.getZ(t),At.transformDirection(e),this.setXYZ(t,At.x,At.y,At.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");let t=[];for(let n=0;n<this.count;n++){let i=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[i+r])}return new Se(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new ri(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");let t=[];for(let n=0;n<this.count;n++){let i=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[i+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}};ri.prototype.isInterleavedBufferAttribute=!0;var Qa=class extends St{constructor(e){super();this.type="SpriteMaterial",this.color=new ue(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}};Qa.prototype.isSpriteMaterial=!0;var Po,Ka=new L,Co=new L,Lo=new L,Ro=new J,el=new J,ix=new fe,Bc=new L,tl=new L,Nc=new L,rx=new J,Uf=new J,sx=new J,nl=class extends Re{constructor(e){super();if(this.type="Sprite",Po===void 0){Po=new ye;let t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new gi(t,5);Po.setIndex([0,1,2,0,2,3]),Po.setAttribute("position",new ri(n,3,0,!1)),Po.setAttribute("uv",new ri(n,2,3,!1))}this.geometry=Po,this.material=e!==void 0?e:new Qa,this.center=new J(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Co.setFromMatrixScale(this.matrixWorld),ix.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Lo.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Co.multiplyScalar(-Lo.z);let n=this.material.rotation,i,r;n!==0&&(r=Math.cos(n),i=Math.sin(n));let s=this.center;Oc(Bc.set(-.5,-.5,0),Lo,s,Co,i,r),Oc(tl.set(.5,-.5,0),Lo,s,Co,i,r),Oc(Nc.set(.5,.5,0),Lo,s,Co,i,r),rx.set(0,0),Uf.set(1,0),sx.set(1,1);let o=e.ray.intersectTriangle(Bc,tl,Nc,!1,Ka);if(o===null&&(Oc(tl.set(-.5,.5,0),Lo,s,Co,i,r),Uf.set(0,1),o=e.ray.intersectTriangle(Bc,Nc,tl,!1,Ka),o===null))return;let l=e.ray.origin.distanceTo(Ka);l<e.near||l>e.far||t.push({distance:l,point:Ka.clone(),uv:pt.getUV(Ka,Bc,tl,Nc,rx,Uf,sx,new J),face:null,object:this})}copy(e){return super.copy(e),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}};nl.prototype.isSprite=!0;function Oc(a,e,t,n,i,r){Ro.subVectors(a,t).addScalar(.5).multiply(n),i!==void 0?(el.x=r*Ro.x-i*Ro.y,el.y=i*Ro.x+r*Ro.y):el.copy(Ro),a.copy(e),a.x+=el.x,a.y+=el.y,a.applyMatrix4(ix)}var kc=new L,ox=new L,Vf=class extends Re{constructor(){super();this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);let t=e.levels;for(let n=0,i=t.length;n<i;n++){let r=t[n];this.addLevel(r.object.clone(),r.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){t=Math.abs(t);let n=this.levels,i;for(i=0;i<n.length&&!(t<n[i].distance);i++);return n.splice(i,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){let t=this.levels;if(t.length>0){let n,i;for(n=1,i=t.length;n<i&&!(e<t[n].distance);n++);return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){kc.setFromMatrixPosition(this.matrixWorld);let i=e.ray.origin.distanceTo(kc);this.getObjectForDistance(i).raycast(e,t)}}update(e){let t=this.levels;if(t.length>1){kc.setFromMatrixPosition(e.matrixWorld),ox.setFromMatrixPosition(this.matrixWorld);let n=kc.distanceTo(ox)/e.zoom;t[0].object.visible=!0;let i,r;for(i=1,r=t.length;i<r&&n>=t[i].distance;i++)t[i-1].object.visible=!1,t[i].object.visible=!0;for(this._currentLevel=i-1;i<r;i++)t[i].object.visible=!1}}toJSON(e){let t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];let n=this.levels;for(let i=0,r=n.length;i<r;i++){let s=n[i];t.object.levels.push({object:s.object.uuid,distance:s.distance})}return t}},ax=new L,lx=new De,cx=new De,gE=new L,hx=new fe,Ji=class extends Ce{constructor(e,t){super(e,t);this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new fe,this.bindMatrixInverse=new fe}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){let e=new De,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);let r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){let n=this.skeleton,i=this.geometry;lx.fromBufferAttribute(i.attributes.skinIndex,e),cx.fromBufferAttribute(i.attributes.skinWeight,e),ax.fromBufferAttribute(i.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){let s=cx.getComponent(r);if(s!==0){let o=lx.getComponent(r);hx.multiplyMatrices(n.bones[o].matrixWorld,n.boneInverses[o]),t.addScaledVector(gE.copy(ax).applyMatrix4(hx),s)}}return t.applyMatrix4(this.bindMatrixInverse)}};Ji.prototype.isSkinnedMesh=!0;var xi=class extends Re{constructor(){super();this.type="Bone"}};xi.prototype.isBone=!0;var Lr=class extends lt{constructor(e=null,t=1,n=1,i,r,s,o,l,c=Mt,u=Mt,f,h){super(null,s,o,l,c,u,i,r,f,h);this.image={data:e,width:t,height:n},this.magFilter=c,this.minFilter=u,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}};Lr.prototype.isDataTexture=!0;var ux=new fe,xE=new fe,$i=class{constructor(e=[],t=[]){this.uuid=Tn(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new fe)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){let n=new fe;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){let n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){let n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){let e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let r=0,s=e.length;r<s;r++){let o=e[r]?e[r].matrixWorld:xE;ux.multiplyMatrices(o,t[r]),ux.toArray(n,r*16)}i!==null&&(i.needsUpdate=!0)}clone(){return new $i(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=g0(e),e=Math.max(e,4);let t=new Float32Array(e*e*4);t.set(this.boneMatrices);let n=new Lr(t,e,e,gn,Vi);return this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){let i=this.bones[t];if(i.name===e)return i}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){let r=e.bones[n],s=t[r];s===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),s=new xi),this.bones.push(s),this.boneInverses.push(new fe().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){let e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let t=this.bones,n=this.boneInverses;for(let i=0,r=t.length;i<r;i++){let s=t[i];e.bones.push(s.uuid);let o=n[i];e.boneInverses.push(o.toArray())}return e}},fx=new fe,dx=new fe,zc=[],il=new Ce,Uc=class extends Ce{constructor(e,t,n){super(e,t);this.instanceMatrix=new Se(new Float32Array(n*16),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){let n=this.matrixWorld,i=this.count;if(il.geometry=this.geometry,il.material=this.material,il.material!==void 0)for(let r=0;r<i;r++){this.getMatrixAt(r,fx),dx.multiplyMatrices(n,fx),il.matrixWorld=dx,il.raycast(e,zc);for(let s=0,o=zc.length;s<o;s++){let l=zc[s];l.instanceId=r,l.object=this,t.push(l)}zc.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Se(new Float32Array(this.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}};Uc.prototype.isInstancedMesh=!0;var rt=class extends St{constructor(e){super();this.type="LineBasicMaterial",this.color=new ue(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this}};rt.prototype.isLineBasicMaterial=!0;var px=new L,mx=new L,gx=new fe,Hf=new ji,Vc=new En,Gt=class extends Re{constructor(e=new ye,t=new rt){super();this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(e.isBufferGeometry)if(e.index===null){let t=e.attributes.position,n=[0];for(let i=1,r=t.count;i<r;i++)px.fromBufferAttribute(t,i-1),mx.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=px.distanceTo(mx);e.setAttribute("lineDistance",new pe(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){let n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,s=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Vc.copy(n.boundingSphere),Vc.applyMatrix4(i),Vc.radius+=r,e.ray.intersectsSphere(Vc)===!1)return;gx.copy(i).invert(),Hf.copy(e.ray).applyMatrix4(gx);let o=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=new L,u=new L,f=new L,h=new L,d=this.isLineSegments?2:1;if(n.isBufferGeometry){let p=n.index,v=n.attributes.position;if(p!==null){let x=Math.max(0,s.start),g=Math.min(p.count,s.start+s.count);for(let y=x,_=g-1;y<_;y+=d){let w=p.getX(y),b=p.getX(y+1);if(c.fromBufferAttribute(v,w),u.fromBufferAttribute(v,b),Hf.distanceSqToSegment(c,u,h,f)>l)continue;h.applyMatrix4(this.matrixWorld);let M=e.ray.origin.distanceTo(h);M<e.near||M>e.far||t.push({distance:M,point:f.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}else{let x=Math.max(0,s.start),g=Math.min(v.count,s.start+s.count);for(let y=x,_=g-1;y<_;y+=d){if(c.fromBufferAttribute(v,y),u.fromBufferAttribute(v,y+1),Hf.distanceSqToSegment(c,u,h,f)>l)continue;h.applyMatrix4(this.matrixWorld);let b=e.ray.origin.distanceTo(h);b<e.near||b>e.far||t.push({distance:b,point:f.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let t=e.morphAttributes,n=Object.keys(t);if(n.length>0){let i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,s=i.length;r<s;r++){let o=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}else{let t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}};Gt.prototype.isLine=!0;var xx=new L,vx=new L,Ot=class extends Gt{constructor(e,t){super(e,t);this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(e.isBufferGeometry)if(e.index===null){let t=e.attributes.position,n=[];for(let i=0,r=t.count;i<r;i+=2)xx.fromBufferAttribute(t,i),vx.fromBufferAttribute(t,i+1),n[i]=i===0?0:n[i-1],n[i+1]=n[i]+xx.distanceTo(vx);e.setAttribute("lineDistance",new pe(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}};Ot.prototype.isLineSegments=!0;var Io=class extends Gt{constructor(e,t){super(e,t);this.type="LineLoop"}};Io.prototype.isLineLoop=!0;var On=class extends St{constructor(e){super();this.type="PointsMaterial",this.color=new ue(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this}};On.prototype.isPointsMaterial=!0;var yx=new fe,Gf=new ji,Hc=new En,Gc=new L,vi=class extends Re{constructor(e=new ye,t=new On){super();this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){let n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,s=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Hc.copy(n.boundingSphere),Hc.applyMatrix4(i),Hc.radius+=r,e.ray.intersectsSphere(Hc)===!1)return;yx.copy(i).invert(),Gf.copy(e.ray).applyMatrix4(yx);let o=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o;if(n.isBufferGeometry){let c=n.index,f=n.attributes.position;if(c!==null){let h=Math.max(0,s.start),d=Math.min(c.count,s.start+s.count);for(let p=h,m=d;p<m;p++){let v=c.getX(p);Gc.fromBufferAttribute(f,v),wx(Gc,v,l,i,e,t,this)}}else{let h=Math.max(0,s.start),d=Math.min(f.count,s.start+s.count);for(let p=h,m=d;p<m;p++)Gc.fromBufferAttribute(f,p),wx(Gc,p,l,i,e,t,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let t=e.morphAttributes,n=Object.keys(t);if(n.length>0){let i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,s=i.length;r<s;r++){let o=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}else{let t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}};vi.prototype.isPoints=!0;function wx(a,e,t,n,i,r,s){let o=Gf.distanceSqToPoint(a);if(o<t){let l=new L;Gf.closestPointToPoint(a,l),l.applyMatrix4(n);let c=i.ray.origin.distanceTo(l);if(c<i.near||c>i.far)return;r.push({distance:c,distanceToRay:Math.sqrt(o),point:l,index:e,face:null,object:s})}}var Wf=class extends lt{constructor(e,t,n,i,r,s,o,l,c){super(e,t,n,i,r,s,o,l,c);this.format=o!==void 0?o:mn,this.minFilter=s!==void 0?s:Ke,this.magFilter=r!==void 0?r:Ke,this.generateMipmaps=!1;let u=this;function f(){u.needsUpdate=!0,e.requestVideoFrameCallback(f)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(f)}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}};Wf.prototype.isVideoTexture=!0;var Wc=class extends lt{constructor(e,t,n,i,r,s,o,l,c,u,f,h){super(null,s,o,l,c,u,i,r,f,h);this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}};Wc.prototype.isCompressedTexture=!0;var Xf=class extends lt{constructor(e,t,n,i,r,s,o,l,c){super(e,t,n,i,r,s,o,l,c);this.needsUpdate=!0}};Xf.prototype.isCanvasTexture=!0;var jf=class extends lt{constructor(e,t,n,i,r,s,o,l,c,u){if(u=u!==void 0?u:ds,u!==ds&&u!==so)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&u===ds&&(n=Na),n===void 0&&u===so&&(n=ro);super(null,i,r,s,o,l,u,n,c);this.image={width:e,height:t},this.magFilter=o!==void 0?o:Mt,this.minFilter=l!==void 0?l:Mt,this.flipY=!1,this.generateMipmaps=!1}};jf.prototype.isDepthTexture=!0;var Do=class extends ye{constructor(e=1,t=8,n=0,i=Math.PI*2){super();this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},t=Math.max(3,t);let r=[],s=[],o=[],l=[],c=new L,u=new J;s.push(0,0,0),o.push(0,0,1),l.push(.5,.5);for(let f=0,h=3;f<=t;f++,h+=3){let d=n+f/t*i;c.x=e*Math.cos(d),c.y=e*Math.sin(d),s.push(c.x,c.y,c.z),o.push(0,0,1),u.x=(s[h]/e+1)/2,u.y=(s[h+1]/e+1)/2,l.push(u.x,u.y)}for(let f=1;f<=t;f++)r.push(f,f+1,0);this.setIndex(r),this.setAttribute("position",new pe(s,3)),this.setAttribute("normal",new pe(o,3)),this.setAttribute("uv",new pe(l,2))}static fromJSON(e){return new Do(e.radius,e.segments,e.thetaStart,e.thetaLength)}},yi=class extends ye{constructor(e=1,t=1,n=1,i=8,r=1,s=!1,o=0,l=Math.PI*2){super();this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:l};let c=this;i=Math.floor(i),r=Math.floor(r);let u=[],f=[],h=[],d=[],p=0,m=[],v=n/2,x=0;g(),s===!1&&(e>0&&y(!0),t>0&&y(!1)),this.setIndex(u),this.setAttribute("position",new pe(f,3)),this.setAttribute("normal",new pe(h,3)),this.setAttribute("uv",new pe(d,2));function g(){let _=new L,w=new L,b=0,S=(t-e)/n;for(let M=0;M<=r;M++){let T=[],E=M/r,A=E*(t-e)+e;for(let I=0;I<=i;I++){let C=I/i,R=C*l+o,D=Math.sin(R),F=Math.cos(R);w.x=A*D,w.y=-E*n+v,w.z=A*F,f.push(w.x,w.y,w.z),_.set(D,S,F).normalize(),h.push(_.x,_.y,_.z),d.push(C,1-E),T.push(p++)}m.push(T)}for(let M=0;M<i;M++)for(let T=0;T<r;T++){let E=m[T][M],A=m[T+1][M],I=m[T+1][M+1],C=m[T][M+1];u.push(E,A,C),u.push(A,I,C),b+=6}c.addGroup(x,b,0),x+=b}function y(_){let w=p,b=new J,S=new L,M=0,T=_===!0?e:t,E=_===!0?1:-1;for(let I=1;I<=i;I++)f.push(0,v*E,0),h.push(0,E,0),d.push(.5,.5),p++;let A=p;for(let I=0;I<=i;I++){let R=I/i*l+o,D=Math.cos(R),F=Math.sin(R);S.x=T*F,S.y=v*E,S.z=T*D,f.push(S.x,S.y,S.z),h.push(0,E,0),b.x=D*.5+.5,b.y=F*.5*E+.5,d.push(b.x,b.y),p++}for(let I=0;I<i;I++){let C=w+I,R=A+I;_===!0?u.push(R,R+1,C):u.push(R+1,R,C),M+=3}c.addGroup(x,M,_===!0?1:2),x+=M}}static fromJSON(e){return new yi(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},Rr=class extends yi{constructor(e=1,t=1,n=8,i=1,r=!1,s=0,o=Math.PI*2){super(0,e,t,n,i,r,s,o);this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:s,thetaLength:o}}static fromJSON(e){return new Rr(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},wi=class extends ye{constructor(e,t,n=1,i=0){super();this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};let r=[],s=[];o(i),c(n),u(),this.setAttribute("position",new pe(r,3)),this.setAttribute("normal",new pe(r.slice(),3)),this.setAttribute("uv",new pe(s,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function o(g){let y=new L,_=new L,w=new L;for(let b=0;b<t.length;b+=3)d(t[b+0],y),d(t[b+1],_),d(t[b+2],w),l(y,_,w,g)}function l(g,y,_,w){let b=w+1,S=[];for(let M=0;M<=b;M++){S[M]=[];let T=g.clone().lerp(_,M/b),E=y.clone().lerp(_,M/b),A=b-M;for(let I=0;I<=A;I++)I===0&&M===b?S[M][I]=T:S[M][I]=T.clone().lerp(E,I/A)}for(let M=0;M<b;M++)for(let T=0;T<2*(b-M)-1;T++){let E=Math.floor(T/2);T%2==0?(h(S[M][E+1]),h(S[M+1][E]),h(S[M][E])):(h(S[M][E+1]),h(S[M+1][E+1]),h(S[M+1][E]))}}function c(g){let y=new L;for(let _=0;_<r.length;_+=3)y.x=r[_+0],y.y=r[_+1],y.z=r[_+2],y.normalize().multiplyScalar(g),r[_+0]=y.x,r[_+1]=y.y,r[_+2]=y.z}function u(){let g=new L;for(let y=0;y<r.length;y+=3){g.x=r[y+0],g.y=r[y+1],g.z=r[y+2];let _=v(g)/2/Math.PI+.5,w=x(g)/Math.PI+.5;s.push(_,1-w)}p(),f()}function f(){for(let g=0;g<s.length;g+=6){let y=s[g+0],_=s[g+2],w=s[g+4],b=Math.max(y,_,w),S=Math.min(y,_,w);b>.9&&S<.1&&(y<.2&&(s[g+0]+=1),_<.2&&(s[g+2]+=1),w<.2&&(s[g+4]+=1))}}function h(g){r.push(g.x,g.y,g.z)}function d(g,y){let _=g*3;y.x=e[_+0],y.y=e[_+1],y.z=e[_+2]}function p(){let g=new L,y=new L,_=new L,w=new L,b=new J,S=new J,M=new J;for(let T=0,E=0;T<r.length;T+=9,E+=6){g.set(r[T+0],r[T+1],r[T+2]),y.set(r[T+3],r[T+4],r[T+5]),_.set(r[T+6],r[T+7],r[T+8]),b.set(s[E+0],s[E+1]),S.set(s[E+2],s[E+3]),M.set(s[E+4],s[E+5]),w.copy(g).add(y).add(_).divideScalar(3);let A=v(w);m(b,E+0,g,A),m(S,E+2,y,A),m(M,E+4,_,A)}}function m(g,y,_,w){w<0&&g.x===1&&(s[y]=g.x-1),_.x===0&&_.z===0&&(s[y]=w/2/Math.PI+.5)}function v(g){return Math.atan2(g.z,-g.x)}function x(g){return Math.atan2(-g.y,Math.sqrt(g.x*g.x+g.z*g.z))}}static fromJSON(e){return new wi(e.vertices,e.indices,e.radius,e.details)}},Fo=class extends wi{constructor(e=1,t=0){let n=(1+Math.sqrt(5))/2,i=1/n,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],s=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(r,s,e,t);this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Fo(e.radius,e.detail)}},Xc=new L,jc=new L,qf=new L,qc=new pt,Yc=class extends ye{constructor(e,t){super();if(this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=t!==void 0?t:1,e.isGeometry===!0){console.error("THREE.EdgesGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return}let i=Math.pow(10,4),r=Math.cos(xs*t),s=e.getIndex(),o=e.getAttribute("position"),l=s?s.count:o.count,c=[0,0,0],u=["a","b","c"],f=new Array(3),h={},d=[];for(let p=0;p<l;p+=3){s?(c[0]=s.getX(p),c[1]=s.getX(p+1),c[2]=s.getX(p+2)):(c[0]=p,c[1]=p+1,c[2]=p+2);let{a:m,b:v,c:x}=qc;if(m.fromBufferAttribute(o,c[0]),v.fromBufferAttribute(o,c[1]),x.fromBufferAttribute(o,c[2]),qc.getNormal(qf),f[0]=`${Math.round(m.x*i)},${Math.round(m.y*i)},${Math.round(m.z*i)}`,f[1]=`${Math.round(v.x*i)},${Math.round(v.y*i)},${Math.round(v.z*i)}`,f[2]=`${Math.round(x.x*i)},${Math.round(x.y*i)},${Math.round(x.z*i)}`,!(f[0]===f[1]||f[1]===f[2]||f[2]===f[0]))for(let g=0;g<3;g++){let y=(g+1)%3,_=f[g],w=f[y],b=qc[u[g]],S=qc[u[y]],M=`${_}_${w}`,T=`${w}_${_}`;T in h&&h[T]?(qf.dot(h[T].normal)<=r&&(d.push(b.x,b.y,b.z),d.push(S.x,S.y,S.z)),h[T]=null):M in h||(h[M]={index0:c[g],index1:c[y],normal:qf.clone()})}}for(let p in h)if(h[p]){let{index0:m,index1:v}=h[p];Xc.fromBufferAttribute(o,m),jc.fromBufferAttribute(o,v),d.push(Xc.x,Xc.y,Xc.z),d.push(jc.x,jc.y,jc.z)}this.setAttribute("position",new pe(d,3))}},rn=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){let t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){let t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t=[],n,i=this.getPoint(0),r=0;t.push(0);for(let s=1;s<=e;s++)n=this.getPoint(s/e),r+=n.distanceTo(i),t.push(r),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let n=this.getLengths(),i=0,r=n.length,s;t?s=t:s=e*n[r-1];let o=0,l=r-1,c;for(;o<=l;)if(i=Math.floor(o+(l-o)/2),c=n[i]-s,c<0)o=i+1;else if(c>0)l=i-1;else{l=i;break}if(i=l,n[i]===s)return i/(r-1);let u=n[i],h=n[i+1]-u,d=(s-u)/h;return(i+d)/(r-1)}getTangent(e,t){let n=1e-4,i=e-n,r=e+n;i<0&&(i=0),r>1&&(r=1);let s=this.getPoint(i),o=this.getPoint(r),l=t||(s.isVector2?new J:new L);return l.copy(o).sub(s).normalize(),l}getTangentAt(e,t){let n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){let n=new L,i=[],r=[],s=[],o=new L,l=new fe;for(let d=0;d<=e;d++){let p=d/e;i[d]=this.getTangentAt(p,new L),i[d].normalize()}r[0]=new L,s[0]=new L;let c=Number.MAX_VALUE,u=Math.abs(i[0].x),f=Math.abs(i[0].y),h=Math.abs(i[0].z);u<=c&&(c=u,n.set(1,0,0)),f<=c&&(c=f,n.set(0,1,0)),h<=c&&n.set(0,0,1),o.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],o),s[0].crossVectors(i[0],r[0]);for(let d=1;d<=e;d++){if(r[d]=r[d-1].clone(),s[d]=s[d-1].clone(),o.crossVectors(i[d-1],i[d]),o.length()>Number.EPSILON){o.normalize();let p=Math.acos(Yt(i[d-1].dot(i[d]),-1,1));r[d].applyMatrix4(l.makeRotationAxis(o,p))}s[d].crossVectors(i[d],r[d])}if(t===!0){let d=Math.acos(Yt(r[0].dot(r[e]),-1,1));d/=e,i[0].dot(o.crossVectors(r[0],r[e]))>0&&(d=-d);for(let p=1;p<=e;p++)r[p].applyMatrix4(l.makeRotationAxis(i[p],d*p)),s[p].crossVectors(i[p],r[p])}return{tangents:i,normals:r,binormals:s}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},Bo=class extends rn{constructor(e=0,t=0,n=1,i=1,r=0,s=Math.PI*2,o=!1,l=0){super();this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=o,this.aRotation=l}getPoint(e,t){let n=t||new J,i=Math.PI*2,r=this.aEndAngle-this.aStartAngle,s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(s?r=0:r=i),this.aClockwise===!0&&!s&&(r===i?r=-i:r=r-i);let o=this.aStartAngle+e*r,l=this.aX+this.xRadius*Math.cos(o),c=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){let u=Math.cos(this.aRotation),f=Math.sin(this.aRotation),h=l-this.aX,d=c-this.aY;l=h*u-d*f+this.aX,c=h*f+d*u+this.aY}return n.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}};Bo.prototype.isEllipseCurve=!0;var Zc=class extends Bo{constructor(e,t,n,i,r,s){super(e,t,n,n,i,r,s);this.type="ArcCurve"}};Zc.prototype.isArcCurve=!0;function Yf(){let a=0,e=0,t=0,n=0;function i(r,s,o,l){a=r,e=o,t=-3*r+3*s-2*o-l,n=2*r-2*s+o+l}return{initCatmullRom:function(r,s,o,l,c){i(s,o,c*(o-r),c*(l-s))},initNonuniformCatmullRom:function(r,s,o,l,c,u,f){let h=(s-r)/c-(o-r)/(c+u)+(o-s)/u,d=(o-s)/u-(l-s)/(u+f)+(l-o)/f;h*=u,d*=u,i(s,o,h,d)},calc:function(r){let s=r*r,o=s*r;return a+e*r+t*s+n*o}}}var Jc=new L,Zf=new Yf,Jf=new Yf,$f=new Yf,$c=class extends rn{constructor(e=[],t=!1,n="centripetal",i=.5){super();this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e,t=new L){let n=t,i=this.points,r=i.length,s=(r-(this.closed?0:1))*e,o=Math.floor(s),l=s-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/r)+1)*r:l===0&&o===r-1&&(o=r-2,l=1);let c,u;this.closed||o>0?c=i[(o-1)%r]:(Jc.subVectors(i[0],i[1]).add(i[0]),c=Jc);let f=i[o%r],h=i[(o+1)%r];if(this.closed||o+2<r?u=i[(o+2)%r]:(Jc.subVectors(i[r-1],i[r-2]).add(i[r-1]),u=Jc),this.curveType==="centripetal"||this.curveType==="chordal"){let d=this.curveType==="chordal"?.5:.25,p=Math.pow(c.distanceToSquared(f),d),m=Math.pow(f.distanceToSquared(h),d),v=Math.pow(h.distanceToSquared(u),d);m<1e-4&&(m=1),p<1e-4&&(p=m),v<1e-4&&(v=m),Zf.initNonuniformCatmullRom(c.x,f.x,h.x,u.x,p,m,v),Jf.initNonuniformCatmullRom(c.y,f.y,h.y,u.y,p,m,v),$f.initNonuniformCatmullRom(c.z,f.z,h.z,u.z,p,m,v)}else this.curveType==="catmullrom"&&(Zf.initCatmullRom(c.x,f.x,h.x,u.x,this.tension),Jf.initCatmullRom(c.y,f.y,h.y,u.y,this.tension),$f.initCatmullRom(c.z,f.z,h.z,u.z,this.tension));return n.set(Zf.calc(l),Jf.calc(l),$f.calc(l)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){let i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){let i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){let i=e.points[t];this.points.push(new L().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}};$c.prototype.isCatmullRomCurve3=!0;function _x(a,e,t,n,i){let r=(n-e)*.5,s=(i-t)*.5,o=a*a,l=a*o;return(2*t-2*n+r+s)*l+(-3*t+3*n-2*r-s)*o+r*a+t}function vE(a,e){let t=1-a;return t*t*e}function yE(a,e){return 2*(1-a)*a*e}function wE(a,e){return a*a*e}function rl(a,e,t,n){return vE(a,e)+yE(a,t)+wE(a,n)}function _E(a,e){let t=1-a;return t*t*t*e}function bE(a,e){let t=1-a;return 3*t*t*a*e}function ME(a,e){return 3*(1-a)*a*a*e}function SE(a,e){return a*a*a*e}function sl(a,e,t,n,i){return _E(a,e)+bE(a,t)+ME(a,n)+SE(a,i)}var ol=class extends rn{constructor(e=new J,t=new J,n=new J,i=new J){super();this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new J){let n=t,i=this.v0,r=this.v1,s=this.v2,o=this.v3;return n.set(sl(e,i.x,r.x,s.x,o.x),sl(e,i.y,r.y,s.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}};ol.prototype.isCubicBezierCurve=!0;var Qc=class extends rn{constructor(e=new L,t=new L,n=new L,i=new L){super();this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new L){let n=t,i=this.v0,r=this.v1,s=this.v2,o=this.v3;return n.set(sl(e,i.x,r.x,s.x,o.x),sl(e,i.y,r.y,s.y,o.y),sl(e,i.z,r.z,s.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}};Qc.prototype.isCubicBezierCurve3=!0;var No=class extends rn{constructor(e=new J,t=new J){super();this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new J){let n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){let n=t||new J;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}};No.prototype.isLineCurve=!0;var Qf=class extends rn{constructor(e=new L,t=new L){super();this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new L){let n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},al=class extends rn{constructor(e=new J,t=new J,n=new J){super();this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new J){let n=t,i=this.v0,r=this.v1,s=this.v2;return n.set(rl(e,i.x,r.x,s.x),rl(e,i.y,r.y,s.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}};al.prototype.isQuadraticBezierCurve=!0;var Kc=class extends rn{constructor(e=new L,t=new L,n=new L){super();this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new L){let n=t,i=this.v0,r=this.v1,s=this.v2;return n.set(rl(e,i.x,r.x,s.x),rl(e,i.y,r.y,s.y),rl(e,i.z,r.z,s.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}};Kc.prototype.isQuadraticBezierCurve3=!0;var ll=class extends rn{constructor(e=[]){super();this.type="SplineCurve",this.points=e}getPoint(e,t=new J){let n=t,i=this.points,r=(i.length-1)*e,s=Math.floor(r),o=r-s,l=i[s===0?s:s-1],c=i[s],u=i[s>i.length-2?i.length-1:s+1],f=i[s>i.length-3?i.length-1:s+2];return n.set(_x(o,l.x,c.x,u.x,f.x),_x(o,l.y,c.y,u.y,f.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){let i=e.points[t];this.points.push(i.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){let i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){let i=e.points[t];this.points.push(new J().fromArray(i))}return this}};ll.prototype.isSplineCurve=!0;var Kf=Object.freeze({__proto__:null,ArcCurve:Zc,CatmullRomCurve3:$c,CubicBezierCurve:ol,CubicBezierCurve3:Qc,EllipseCurve:Bo,LineCurve:No,LineCurve3:Qf,QuadraticBezierCurve:al,QuadraticBezierCurve3:Kc,SplineCurve:ll}),TE={triangulate:function(a,e,t=2){let n=e&&e.length,i=n?e[0]*t:a.length,r=bx(a,0,i,t,!0),s=[];if(!r||r.next===r.prev)return s;let o,l,c,u,f,h,d;if(n&&(r=LE(a,e,r,t)),a.length>80*t){o=c=a[0],l=u=a[1];for(let p=t;p<i;p+=t)f=a[p],h=a[p+1],f<o&&(o=f),h<l&&(l=h),f>c&&(c=f),h>u&&(u=h);d=Math.max(c-o,u-l),d=d!==0?1/d:0}return cl(r,s,t,o,l,d),s}};function bx(a,e,t,n,i){let r,s;if(i===VE(a,e,t,n)>0)for(r=e;r<t;r+=n)s=Tx(r,a[r],a[r+1],s);else for(r=t-n;r>=e;r-=n)s=Tx(r,a[r],a[r+1],s);return s&&eh(s,s.next)&&(ul(s),s=s.next),s}function Ir(a,e){if(!a)return a;e||(e=a);let t=a,n;do if(n=!1,!t.steiner&&(eh(t,t.next)||xt(t.prev,t,t.next)===0)){if(ul(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function cl(a,e,t,n,i,r,s){if(!a)return;!s&&r&&BE(a,n,i,r);let o=a,l,c;for(;a.prev!==a.next;){if(l=a.prev,c=a.next,r?AE(a,n,i,r):EE(a)){e.push(l.i/t),e.push(a.i/t),e.push(c.i/t),ul(a),a=c.next,o=c.next;continue}if(a=c,a===o){s?s===1?(a=PE(Ir(a),e,t),cl(a,e,t,n,i,r,2)):s===2&&CE(a,e,t,n,i,r):cl(Ir(a),e,t,n,i,r,1);break}}}function EE(a){let e=a.prev,t=a,n=a.next;if(xt(e,t,n)>=0)return!1;let i=a.next.next;for(;i!==a.prev;){if(Oo(e.x,e.y,t.x,t.y,n.x,n.y,i.x,i.y)&&xt(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function AE(a,e,t,n){let i=a.prev,r=a,s=a.next;if(xt(i,r,s)>=0)return!1;let o=i.x<r.x?i.x<s.x?i.x:s.x:r.x<s.x?r.x:s.x,l=i.y<r.y?i.y<s.y?i.y:s.y:r.y<s.y?r.y:s.y,c=i.x>r.x?i.x>s.x?i.x:s.x:r.x>s.x?r.x:s.x,u=i.y>r.y?i.y>s.y?i.y:s.y:r.y>s.y?r.y:s.y,f=ed(o,l,e,t,n),h=ed(c,u,e,t,n),d=a.prevZ,p=a.nextZ;for(;d&&d.z>=f&&p&&p.z<=h;){if(d!==a.prev&&d!==a.next&&Oo(i.x,i.y,r.x,r.y,s.x,s.y,d.x,d.y)&&xt(d.prev,d,d.next)>=0||(d=d.prevZ,p!==a.prev&&p!==a.next&&Oo(i.x,i.y,r.x,r.y,s.x,s.y,p.x,p.y)&&xt(p.prev,p,p.next)>=0))return!1;p=p.nextZ}for(;d&&d.z>=f;){if(d!==a.prev&&d!==a.next&&Oo(i.x,i.y,r.x,r.y,s.x,s.y,d.x,d.y)&&xt(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;p&&p.z<=h;){if(p!==a.prev&&p!==a.next&&Oo(i.x,i.y,r.x,r.y,s.x,s.y,p.x,p.y)&&xt(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function PE(a,e,t){let n=a;do{let i=n.prev,r=n.next.next;!eh(i,r)&&Mx(i,n,n.next,r)&&hl(i,r)&&hl(r,i)&&(e.push(i.i/t),e.push(n.i/t),e.push(r.i/t),ul(n),ul(n.next),n=a=r),n=n.next}while(n!==a);return Ir(n)}function CE(a,e,t,n,i,r){let s=a;do{let o=s.next.next;for(;o!==s.prev;){if(s.i!==o.i&&kE(s,o)){let l=Sx(s,o);s=Ir(s,s.next),l=Ir(l,l.next),cl(s,e,t,n,i,r),cl(l,e,t,n,i,r);return}o=o.next}s=s.next}while(s!==a)}function LE(a,e,t,n){let i=[],r,s,o,l,c;for(r=0,s=e.length;r<s;r++)o=e[r]*n,l=r<s-1?e[r+1]*n:a.length,c=bx(a,o,l,n,!1),c===c.next&&(c.steiner=!0),i.push(OE(c));for(i.sort(RE),r=0;r<i.length;r++)IE(i[r],t),t=Ir(t,t.next);return t}function RE(a,e){return a.x-e.x}function IE(a,e){if(e=DE(a,e),e){let t=Sx(e,a);Ir(e,e.next),Ir(t,t.next)}}function DE(a,e){let t=e,n=a.x,i=a.y,r=-1/0,s;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){let h=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(h<=n&&h>r){if(r=h,h===n){if(i===t.y)return t;if(i===t.next.y)return t.next}s=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!s)return null;if(n===r)return s;let o=s,l=s.x,c=s.y,u=1/0,f;t=s;do n>=t.x&&t.x>=l&&n!==t.x&&Oo(i<c?n:r,i,l,c,i<c?r:n,i,t.x,t.y)&&(f=Math.abs(i-t.y)/(n-t.x),hl(t,a)&&(f<u||f===u&&(t.x>s.x||t.x===s.x&&FE(s,t)))&&(s=t,u=f)),t=t.next;while(t!==o);return s}function FE(a,e){return xt(a.prev,a,e.prev)<0&&xt(e.next,a,a.next)<0}function BE(a,e,t,n){let i=a;do i.z===null&&(i.z=ed(i.x,i.y,e,t,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==a);i.prevZ.nextZ=null,i.prevZ=null,NE(i)}function NE(a){let e,t,n,i,r,s,o,l,c=1;do{for(t=a,a=null,r=null,s=0;t;){for(s++,n=t,o=0,e=0;e<c&&(o++,n=n.nextZ,!!n);e++);for(l=c;o>0||l>0&&n;)o!==0&&(l===0||!n||t.z<=n.z)?(i=t,t=t.nextZ,o--):(i=n,n=n.nextZ,l--),r?r.nextZ=i:a=i,i.prevZ=r,r=i;t=n}r.nextZ=null,c*=2}while(s>1);return a}function ed(a,e,t,n,i){return a=32767*(a-t)*i,e=32767*(e-n)*i,a=(a|a<<8)&16711935,a=(a|a<<4)&252645135,a=(a|a<<2)&858993459,a=(a|a<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,a|e<<1}function OE(a){let e=a,t=a;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==a);return t}function Oo(a,e,t,n,i,r,s,o){return(i-s)*(e-o)-(a-s)*(r-o)>=0&&(a-s)*(n-o)-(t-s)*(e-o)>=0&&(t-s)*(r-o)-(i-s)*(n-o)>=0}function kE(a,e){return a.next.i!==e.i&&a.prev.i!==e.i&&!zE(a,e)&&(hl(a,e)&&hl(e,a)&&UE(a,e)&&(xt(a.prev,a,e.prev)||xt(a,e.prev,e))||eh(a,e)&&xt(a.prev,a,a.next)>0&&xt(e.prev,e,e.next)>0)}function xt(a,e,t){return(e.y-a.y)*(t.x-e.x)-(e.x-a.x)*(t.y-e.y)}function eh(a,e){return a.x===e.x&&a.y===e.y}function Mx(a,e,t,n){let i=nh(xt(a,e,t)),r=nh(xt(a,e,n)),s=nh(xt(t,n,a)),o=nh(xt(t,n,e));return!!(i!==r&&s!==o||i===0&&th(a,t,e)||r===0&&th(a,n,e)||s===0&&th(t,a,n)||o===0&&th(t,e,n))}function th(a,e,t){return e.x<=Math.max(a.x,t.x)&&e.x>=Math.min(a.x,t.x)&&e.y<=Math.max(a.y,t.y)&&e.y>=Math.min(a.y,t.y)}function nh(a){return a>0?1:a<0?-1:0}function zE(a,e){let t=a;do{if(t.i!==a.i&&t.next.i!==a.i&&t.i!==e.i&&t.next.i!==e.i&&Mx(t,t.next,a,e))return!0;t=t.next}while(t!==a);return!1}function hl(a,e){return xt(a.prev,a,a.next)<0?xt(a,e,a.next)>=0&&xt(a,a.prev,e)>=0:xt(a,e,a.prev)<0||xt(a,a.next,e)<0}function UE(a,e){let t=a,n=!1,i=(a.x+e.x)/2,r=(a.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&i<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==a);return n}function Sx(a,e){let t=new td(a.i,a.x,a.y),n=new td(e.i,e.x,e.y),i=a.next,r=e.prev;return a.next=e,e.prev=a,t.next=i,i.prev=t,n.next=t,t.prev=n,r.next=n,n.prev=r,n}function Tx(a,e,t,n){let i=new td(a,e,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function ul(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function td(a,e,t){this.i=a,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function VE(a,e,t,n){let i=0;for(let r=e,s=t-n;r<t;r+=n)i+=(a[s]-a[r])*(a[r+1]+a[s+1]),s=r;return i}var Cn=class{static area(e){let t=e.length,n=0;for(let i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return n*.5}static isClockWise(e){return Cn.area(e)<0}static triangulateShape(e,t){let n=[],i=[],r=[];Ex(e),Ax(n,e);let s=e.length;t.forEach(Ex);for(let l=0;l<t.length;l++)i.push(s),s+=t[l].length,Ax(n,t[l]);let o=TE.triangulate(n,i);for(let l=0;l<o.length;l+=3)r.push(o.slice(l,l+3));return r}};function Ex(a){let e=a.length;e>2&&a[e-1].equals(a[0])&&a.pop()}function Ax(a,e){for(let t=0;t<e.length;t++)a.push(e[t].x),a.push(e[t].y)}var Ln=class extends ye{constructor(e,t){super();this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];let n=this,i=[],r=[];for(let o=0,l=e.length;o<l;o++){let c=e[o];s(c)}this.setAttribute("position",new pe(i,3)),this.setAttribute("uv",new pe(r,2)),this.computeVertexNormals();function s(o){let l=[],c=t.curveSegments!==void 0?t.curveSegments:12,u=t.steps!==void 0?t.steps:1,f=t.depth!==void 0?t.depth:100,h=t.bevelEnabled!==void 0?t.bevelEnabled:!0,d=t.bevelThickness!==void 0?t.bevelThickness:6,p=t.bevelSize!==void 0?t.bevelSize:d-2,m=t.bevelOffset!==void 0?t.bevelOffset:0,v=t.bevelSegments!==void 0?t.bevelSegments:3,x=t.extrudePath,g=t.UVGenerator!==void 0?t.UVGenerator:HE;t.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),f=t.amount);let y,_=!1,w,b,S,M;x&&(y=x.getSpacedPoints(u),_=!0,h=!1,w=x.computeFrenetFrames(u,!1),b=new L,S=new L,M=new L),h||(v=0,d=0,p=0,m=0);let T=o.extractPoints(c),E=T.shape,A=T.holes;if(!Cn.isClockWise(E)){E=E.reverse();for(let q=0,re=A.length;q<re;q++){let Q=A[q];Cn.isClockWise(Q)&&(A[q]=Q.reverse())}}let C=Cn.triangulateShape(E,A),R=E;for(let q=0,re=A.length;q<re;q++){let Q=A[q];E=E.concat(Q)}function D(q,re,Q){return re||console.error("THREE.ExtrudeGeometry: vec does not exist"),re.clone().multiplyScalar(Q).add(q)}let F=E.length,O=C.length;function U(q,re,Q){let oe,V,P,N=q.x-re.x,ee=q.y-re.y,se=Q.x-q.x,me=Q.y-q.y,ve=N*N+ee*ee,Te=N*me-ee*se;if(Math.abs(Te)>Number.EPSILON){let Ee=Math.sqrt(ve),Ie=Math.sqrt(se*se+me*me),Me=re.x-ee/Ee,Y=re.y+N/Ee,ge=Q.x-me/Ie,de=Q.y+se/Ie,Ae=((ge-Me)*me-(de-Y)*se)/(N*me-ee*se);oe=Me+N*Ae-q.x,V=Y+ee*Ae-q.y;let we=oe*oe+V*V;if(we<=2)return new J(oe,V);P=Math.sqrt(we/2)}else{let Ee=!1;N>Number.EPSILON?se>Number.EPSILON&&(Ee=!0):N<-Number.EPSILON?se<-Number.EPSILON&&(Ee=!0):Math.sign(ee)===Math.sign(me)&&(Ee=!0),Ee?(oe=-ee,V=N,P=Math.sqrt(ve)):(oe=N,V=ee,P=Math.sqrt(ve/2))}return new J(oe/P,V/P)}let j=[];for(let q=0,re=R.length,Q=re-1,oe=q+1;q<re;q++,Q++,oe++)Q===re&&(Q=0),oe===re&&(oe=0),j[q]=U(R[q],R[Q],R[oe]);let Z=[],K,G=j.concat();for(let q=0,re=A.length;q<re;q++){let Q=A[q];K=[];for(let oe=0,V=Q.length,P=V-1,N=oe+1;oe<V;oe++,P++,N++)P===V&&(P=0),N===V&&(N=0),K[oe]=U(Q[oe],Q[P],Q[N]);Z.push(K),G=G.concat(K)}for(let q=0;q<v;q++){let re=q/v,Q=d*Math.cos(re*Math.PI/2),oe=p*Math.sin(re*Math.PI/2)+m;for(let V=0,P=R.length;V<P;V++){let N=D(R[V],j[V],oe);X(N.x,N.y,-Q)}for(let V=0,P=A.length;V<P;V++){let N=A[V];K=Z[V];for(let ee=0,se=N.length;ee<se;ee++){let me=D(N[ee],K[ee],oe);X(me.x,me.y,-Q)}}}let k=p+m;for(let q=0;q<F;q++){let re=h?D(E[q],G[q],k):E[q];_?(S.copy(w.normals[0]).multiplyScalar(re.x),b.copy(w.binormals[0]).multiplyScalar(re.y),M.copy(y[0]).add(S).add(b),X(M.x,M.y,M.z)):X(re.x,re.y,0)}for(let q=1;q<=u;q++)for(let re=0;re<F;re++){let Q=h?D(E[re],G[re],k):E[re];_?(S.copy(w.normals[q]).multiplyScalar(Q.x),b.copy(w.binormals[q]).multiplyScalar(Q.y),M.copy(y[q]).add(S).add(b),X(M.x,M.y,M.z)):X(Q.x,Q.y,f/u*q)}for(let q=v-1;q>=0;q--){let re=q/v,Q=d*Math.cos(re*Math.PI/2),oe=p*Math.sin(re*Math.PI/2)+m;for(let V=0,P=R.length;V<P;V++){let N=D(R[V],j[V],oe);X(N.x,N.y,f+Q)}for(let V=0,P=A.length;V<P;V++){let N=A[V];K=Z[V];for(let ee=0,se=N.length;ee<se;ee++){let me=D(N[ee],K[ee],oe);_?X(me.x,me.y+y[u-1].y,y[u-1].x+Q):X(me.x,me.y,f+Q)}}}B(),H();function B(){let q=i.length/3;if(h){let re=0,Q=F*re;for(let oe=0;oe<O;oe++){let V=C[oe];te(V[2]+Q,V[1]+Q,V[0]+Q)}re=u+v*2,Q=F*re;for(let oe=0;oe<O;oe++){let V=C[oe];te(V[0]+Q,V[1]+Q,V[2]+Q)}}else{for(let re=0;re<O;re++){let Q=C[re];te(Q[2],Q[1],Q[0])}for(let re=0;re<O;re++){let Q=C[re];te(Q[0]+F*u,Q[1]+F*u,Q[2]+F*u)}}n.addGroup(q,i.length/3-q,0)}function H(){let q=i.length/3,re=0;W(R,re),re+=R.length;for(let Q=0,oe=A.length;Q<oe;Q++){let V=A[Q];W(V,re),re+=V.length}n.addGroup(q,i.length/3-q,1)}function W(q,re){let Q=q.length;for(;--Q>=0;){let oe=Q,V=Q-1;V<0&&(V=q.length-1);for(let P=0,N=u+v*2;P<N;P++){let ee=F*P,se=F*(P+1),me=re+oe+ee,ve=re+V+ee,Te=re+V+se,Ee=re+oe+se;he(me,ve,Te,Ee)}}}function X(q,re,Q){l.push(q),l.push(re),l.push(Q)}function te(q,re,Q){ae(q),ae(re),ae(Q);let oe=i.length/3,V=g.generateTopUV(n,i,oe-3,oe-2,oe-1);ce(V[0]),ce(V[1]),ce(V[2])}function he(q,re,Q,oe){ae(q),ae(re),ae(oe),ae(re),ae(Q),ae(oe);let V=i.length/3,P=g.generateSideWallUV(n,i,V-6,V-3,V-2,V-1);ce(P[0]),ce(P[1]),ce(P[3]),ce(P[1]),ce(P[2]),ce(P[3])}function ae(q){i.push(l[q*3+0]),i.push(l[q*3+1]),i.push(l[q*3+2])}function ce(q){r.push(q.x),r.push(q.y)}}}toJSON(){let e=super.toJSON(),t=this.parameters.shapes,n=this.parameters.options;return GE(t,n,e)}static fromJSON(e,t){let n=[];for(let r=0,s=e.shapes.length;r<s;r++){let o=t[e.shapes[r]];n.push(o)}let i=e.options.extrudePath;return i!==void 0&&(e.options.extrudePath=new Kf[i.type]().fromJSON(i)),new Ln(n,e.options)}},HE={generateTopUV:function(a,e,t,n,i){let r=e[t*3],s=e[t*3+1],o=e[n*3],l=e[n*3+1],c=e[i*3],u=e[i*3+1];return[new J(r,s),new J(o,l),new J(c,u)]},generateSideWallUV:function(a,e,t,n,i,r){let s=e[t*3],o=e[t*3+1],l=e[t*3+2],c=e[n*3],u=e[n*3+1],f=e[n*3+2],h=e[i*3],d=e[i*3+1],p=e[i*3+2],m=e[r*3],v=e[r*3+1],x=e[r*3+2];return Math.abs(o-u)<Math.abs(s-c)?[new J(s,1-l),new J(c,1-f),new J(h,1-p),new J(m,1-x)]:[new J(o,1-l),new J(u,1-f),new J(d,1-p),new J(v,1-x)]}};function GE(a,e,t){if(t.shapes=[],Array.isArray(a))for(let n=0,i=a.length;n<i;n++){let r=a[n];t.shapes.push(r.uuid)}else t.shapes.push(a.uuid);return e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}var ko=class extends wi{constructor(e=1,t=0){let n=(1+Math.sqrt(5))/2,i=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(i,r,e,t);this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new ko(e.radius,e.detail)}},zo=class extends ye{constructor(e,t=12,n=0,i=Math.PI*2){super();this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t),i=Yt(i,0,Math.PI*2);let r=[],s=[],o=[],l=1/t,c=new L,u=new J;for(let f=0;f<=t;f++){let h=n+f*l*i,d=Math.sin(h),p=Math.cos(h);for(let m=0;m<=e.length-1;m++)c.x=e[m].x*d,c.y=e[m].y,c.z=e[m].x*p,s.push(c.x,c.y,c.z),u.x=f/t,u.y=m/(e.length-1),o.push(u.x,u.y)}for(let f=0;f<t;f++)for(let h=0;h<e.length-1;h++){let d=h+f*e.length,p=d,m=d+e.length,v=d+e.length+1,x=d+1;r.push(p,m,x),r.push(m,v,x)}if(this.setIndex(r),this.setAttribute("position",new pe(s,3)),this.setAttribute("uv",new pe(o,2)),this.computeVertexNormals(),i===Math.PI*2){let f=this.attributes.normal.array,h=new L,d=new L,p=new L,m=t*e.length*3;for(let v=0,x=0;v<e.length;v++,x+=3)h.x=f[x+0],h.y=f[x+1],h.z=f[x+2],d.x=f[m+x+0],d.y=f[m+x+1],d.z=f[m+x+2],p.addVectors(h,d).normalize(),f[x+0]=f[m+x+0]=p.x,f[x+1]=f[m+x+1]=p.y,f[x+2]=f[m+x+2]=p.z}}static fromJSON(e){return new zo(e.points,e.segments,e.phiStart,e.phiLength)}},Ms=class extends wi{constructor(e=1,t=0){let n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,i,e,t);this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Ms(e.radius,e.detail)}},ih=class extends ye{constructor(e,t,n){super();this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n};let i=[],r=[],s=[],o=[],l=1e-5,c=new L,u=new L,f=new L,h=new L,d=new L;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");let p=t+1;for(let m=0;m<=n;m++){let v=m/n;for(let x=0;x<=t;x++){let g=x/t;e(g,v,u),r.push(u.x,u.y,u.z),g-l>=0?(e(g-l,v,f),h.subVectors(u,f)):(e(g+l,v,f),h.subVectors(f,u)),v-l>=0?(e(g,v-l,f),d.subVectors(u,f)):(e(g,v+l,f),d.subVectors(f,u)),c.crossVectors(h,d).normalize(),s.push(c.x,c.y,c.z),o.push(g,v)}}for(let m=0;m<n;m++)for(let v=0;v<t;v++){let x=m*p+v,g=m*p+v+1,y=(m+1)*p+v+1,_=(m+1)*p+v;i.push(x,g,_),i.push(g,y,_)}this.setIndex(i),this.setAttribute("position",new pe(r,3)),this.setAttribute("normal",new pe(s,3)),this.setAttribute("uv",new pe(o,2))}},Dr=class extends ye{constructor(e=.5,t=1,n=8,i=1,r=0,s=Math.PI*2){super();this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:s},n=Math.max(3,n),i=Math.max(1,i);let o=[],l=[],c=[],u=[],f=e,h=(t-e)/i,d=new L,p=new J;for(let m=0;m<=i;m++){for(let v=0;v<=n;v++){let x=r+v/n*s;d.x=f*Math.cos(x),d.y=f*Math.sin(x),l.push(d.x,d.y,d.z),c.push(0,0,1),p.x=(d.x/t+1)/2,p.y=(d.y/t+1)/2,u.push(p.x,p.y)}f+=h}for(let m=0;m<i;m++){let v=m*(n+1);for(let x=0;x<n;x++){let g=x+v,y=g,_=g+n+1,w=g+n+2,b=g+1;o.push(y,_,b),o.push(_,w,b)}}this.setIndex(o),this.setAttribute("position",new pe(l,3)),this.setAttribute("normal",new pe(c,3)),this.setAttribute("uv",new pe(u,2))}static fromJSON(e){return new Dr(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}},Ss=class extends ye{constructor(e,t=12){super();this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};let n=[],i=[],r=[],s=[],o=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let u=0;u<e.length;u++)c(e[u]),this.addGroup(o,l,u),o+=l,l=0;this.setIndex(n),this.setAttribute("position",new pe(i,3)),this.setAttribute("normal",new pe(r,3)),this.setAttribute("uv",new pe(s,2));function c(u){let f=i.length/3,h=u.extractPoints(t),d=h.shape,p=h.holes;Cn.isClockWise(d)===!1&&(d=d.reverse());for(let v=0,x=p.length;v<x;v++){let g=p[v];Cn.isClockWise(g)===!0&&(p[v]=g.reverse())}let m=Cn.triangulateShape(d,p);for(let v=0,x=p.length;v<x;v++){let g=p[v];d=d.concat(g)}for(let v=0,x=d.length;v<x;v++){let g=d[v];i.push(g.x,g.y,0),r.push(0,0,1),s.push(g.x,g.y)}for(let v=0,x=m.length;v<x;v++){let g=m[v],y=g[0]+f,_=g[1]+f,w=g[2]+f;n.push(y,_,w),l+=3}}}toJSON(){let e=super.toJSON(),t=this.parameters.shapes;return WE(t,e)}static fromJSON(e,t){let n=[];for(let i=0,r=e.shapes.length;i<r;i++){let s=t[e.shapes[i]];n.push(s)}return new Ss(n,e.curveSegments)}};function WE(a,e){if(e.shapes=[],Array.isArray(a))for(let t=0,n=a.length;t<n;t++){let i=a[t];e.shapes.push(i.uuid)}else e.shapes.push(a.uuid);return e}var hn=class extends ye{constructor(e=1,t=8,n=6,i=0,r=Math.PI*2,s=0,o=Math.PI){super();this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:s,thetaLength:o},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));let l=Math.min(s+o,Math.PI),c=0,u=[],f=new L,h=new L,d=[],p=[],m=[],v=[];for(let x=0;x<=n;x++){let g=[],y=x/n,_=0;x==0&&s==0?_=.5/t:x==n&&l==Math.PI&&(_=-.5/t);for(let w=0;w<=t;w++){let b=w/t;f.x=-e*Math.cos(i+b*r)*Math.sin(s+y*o),f.y=e*Math.cos(s+y*o),f.z=e*Math.sin(i+b*r)*Math.sin(s+y*o),p.push(f.x,f.y,f.z),h.copy(f).normalize(),m.push(h.x,h.y,h.z),v.push(b+_,1-y),g.push(c++)}u.push(g)}for(let x=0;x<n;x++)for(let g=0;g<t;g++){let y=u[x][g+1],_=u[x][g],w=u[x+1][g],b=u[x+1][g+1];(x!==0||s>0)&&d.push(y,_,b),(x!==n-1||l<Math.PI)&&d.push(_,w,b)}this.setIndex(d),this.setAttribute("position",new pe(p,3)),this.setAttribute("normal",new pe(m,3)),this.setAttribute("uv",new pe(v,2))}static fromJSON(e){return new hn(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}},Uo=class extends wi{constructor(e=1,t=0){let n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,i,e,t);this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Uo(e.radius,e.detail)}},rh=class extends Ln{constructor(e,t={}){let n=t.font;if(!(n&&n.isFont))return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new ye;let i=n.generateShapes(e,t.size);t.depth=t.height!==void 0?t.height:50,t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1);super(i,t);this.type="TextGeometry"}},Fr=class extends ye{constructor(e=1,t=.4,n=8,i=6,r=Math.PI*2){super();this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);let s=[],o=[],l=[],c=[],u=new L,f=new L,h=new L;for(let d=0;d<=n;d++)for(let p=0;p<=i;p++){let m=p/i*r,v=d/n*Math.PI*2;f.x=(e+t*Math.cos(v))*Math.cos(m),f.y=(e+t*Math.cos(v))*Math.sin(m),f.z=t*Math.sin(v),o.push(f.x,f.y,f.z),u.x=e*Math.cos(m),u.y=e*Math.sin(m),h.subVectors(f,u).normalize(),l.push(h.x,h.y,h.z),c.push(p/i),c.push(d/n)}for(let d=1;d<=n;d++)for(let p=1;p<=i;p++){let m=(i+1)*d+p-1,v=(i+1)*(d-1)+p-1,x=(i+1)*(d-1)+p,g=(i+1)*d+p;s.push(m,v,g),s.push(v,x,g)}this.setIndex(s),this.setAttribute("position",new pe(o,3)),this.setAttribute("normal",new pe(l,3)),this.setAttribute("uv",new pe(c,2))}static fromJSON(e){return new Fr(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}},Vo=class extends ye{constructor(e=1,t=.4,n=64,i=8,r=2,s=3){super();this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:r,q:s},n=Math.floor(n),i=Math.floor(i);let o=[],l=[],c=[],u=[],f=new L,h=new L,d=new L,p=new L,m=new L,v=new L,x=new L;for(let y=0;y<=n;++y){let _=y/n*r*Math.PI*2;g(_,r,s,e,d),g(_+.01,r,s,e,p),v.subVectors(p,d),x.addVectors(p,d),m.crossVectors(v,x),x.crossVectors(m,v),m.normalize(),x.normalize();for(let w=0;w<=i;++w){let b=w/i*Math.PI*2,S=-t*Math.cos(b),M=t*Math.sin(b);f.x=d.x+(S*x.x+M*m.x),f.y=d.y+(S*x.y+M*m.y),f.z=d.z+(S*x.z+M*m.z),l.push(f.x,f.y,f.z),h.subVectors(f,d).normalize(),c.push(h.x,h.y,h.z),u.push(y/n),u.push(w/i)}}for(let y=1;y<=n;y++)for(let _=1;_<=i;_++){let w=(i+1)*(y-1)+(_-1),b=(i+1)*y+(_-1),S=(i+1)*y+_,M=(i+1)*(y-1)+_;o.push(w,b,M),o.push(b,S,M)}this.setIndex(o),this.setAttribute("position",new pe(l,3)),this.setAttribute("normal",new pe(c,3)),this.setAttribute("uv",new pe(u,2));function g(y,_,w,b,S){let M=Math.cos(y),T=Math.sin(y),E=w/_*y,A=Math.cos(E);S.x=b*(2+A)*.5*M,S.y=b*(2+A)*T*.5,S.z=b*Math.sin(E)*.5}}static fromJSON(e){return new Vo(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}},Ho=class extends ye{constructor(e,t=64,n=1,i=8,r=!1){super();this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:r};let s=e.computeFrenetFrames(t,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;let o=new L,l=new L,c=new J,u=new L,f=[],h=[],d=[],p=[];m(),this.setIndex(p),this.setAttribute("position",new pe(f,3)),this.setAttribute("normal",new pe(h,3)),this.setAttribute("uv",new pe(d,2));function m(){for(let y=0;y<t;y++)v(y);v(r===!1?t:0),g(),x()}function v(y){u=e.getPointAt(y/t,u);let _=s.normals[y],w=s.binormals[y];for(let b=0;b<=i;b++){let S=b/i*Math.PI*2,M=Math.sin(S),T=-Math.cos(S);l.x=T*_.x+M*w.x,l.y=T*_.y+M*w.y,l.z=T*_.z+M*w.z,l.normalize(),h.push(l.x,l.y,l.z),o.x=u.x+n*l.x,o.y=u.y+n*l.y,o.z=u.z+n*l.z,f.push(o.x,o.y,o.z)}}function x(){for(let y=1;y<=t;y++)for(let _=1;_<=i;_++){let w=(i+1)*(y-1)+(_-1),b=(i+1)*y+(_-1),S=(i+1)*y+_,M=(i+1)*(y-1)+_;p.push(w,b,M),p.push(b,S,M)}}function g(){for(let y=0;y<=t;y++)for(let _=0;_<=i;_++)c.x=y/t,c.y=_/i,d.push(c.x,c.y)}}toJSON(){let e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Ho(new Kf[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}},sh=class extends ye{constructor(e){super();if(this.type="WireframeGeometry",e.isGeometry===!0){console.error("THREE.WireframeGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return}let t=[],n=[0,0],i={},r=new L;if(e.index!==null){let s=e.attributes.position,o=e.index,l=e.groups;l.length===0&&(l=[{start:0,count:o.count,materialIndex:0}]);for(let c=0,u=l.length;c<u;++c){let f=l[c],h=f.start,d=f.count;for(let p=h,m=h+d;p<m;p+=3)for(let v=0;v<3;v++){let x=o.getX(p+v),g=o.getX(p+(v+1)%3);n[0]=Math.min(x,g),n[1]=Math.max(x,g);let y=n[0]+","+n[1];i[y]===void 0&&(i[y]={index1:n[0],index2:n[1]})}}for(let c in i){let u=i[c];r.fromBufferAttribute(s,u.index1),t.push(r.x,r.y,r.z),r.fromBufferAttribute(s,u.index2),t.push(r.x,r.y,r.z)}}else{let s=e.attributes.position;for(let o=0,l=s.count/3;o<l;o++)for(let c=0;c<3;c++){let u=3*o+c;r.fromBufferAttribute(s,u),t.push(r.x,r.y,r.z);let f=3*o+(c+1)%3;r.fromBufferAttribute(s,f),t.push(r.x,r.y,r.z)}}this.setAttribute("position",new pe(t,3))}},Px=Object.freeze({__proto__:null,BoxGeometry:ni,BoxBufferGeometry:ni,CircleGeometry:Do,CircleBufferGeometry:Do,ConeGeometry:Rr,ConeBufferGeometry:Rr,CylinderGeometry:yi,CylinderBufferGeometry:yi,DodecahedronGeometry:Fo,DodecahedronBufferGeometry:Fo,EdgesGeometry:Yc,ExtrudeGeometry:Ln,ExtrudeBufferGeometry:Ln,IcosahedronGeometry:ko,IcosahedronBufferGeometry:ko,LatheGeometry:zo,LatheBufferGeometry:zo,OctahedronGeometry:Ms,OctahedronBufferGeometry:Ms,ParametricGeometry:ih,ParametricBufferGeometry:ih,PlaneGeometry:tn,PlaneBufferGeometry:tn,PolyhedronGeometry:wi,PolyhedronBufferGeometry:wi,RingGeometry:Dr,RingBufferGeometry:Dr,ShapeGeometry:Ss,ShapeBufferGeometry:Ss,SphereGeometry:hn,SphereBufferGeometry:hn,TetrahedronGeometry:Uo,TetrahedronBufferGeometry:Uo,TextGeometry:rh,TextBufferGeometry:rh,TorusGeometry:Fr,TorusBufferGeometry:Fr,TorusKnotGeometry:Vo,TorusKnotBufferGeometry:Vo,TubeGeometry:Ho,TubeBufferGeometry:Ho,WireframeGeometry:sh}),oh=class extends St{constructor(e){super();this.type="ShadowMaterial",this.color=new ue(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}};oh.prototype.isShadowMaterial=!0;var Ts=class extends Ht{constructor(e){super(e);this.type="RawShaderMaterial"}};Ts.prototype.isRawShaderMaterial=!0;var Rn=class extends St{constructor(e){super();this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ue(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ue(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Hi,this.normalScale=new J(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.vertexTangents=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this.vertexTangents=e.vertexTangents,this}};Rn.prototype.isMeshStandardMaterial=!0;var Qi=class extends Rn{constructor(e){super();this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new J(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(t){this.reflectivity=Yt(2.5*(t-1)/(t+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new ue(1,1,1),this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new ue).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this}};Qi.prototype.isMeshPhysicalMaterial=!0;var kn=class extends St{constructor(e){super();this.type="MeshPhongMaterial",this.color=new ue(16777215),this.specular=new ue(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ue(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Hi,this.normalScale=new J(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ra,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}};kn.prototype.isMeshPhongMaterial=!0;var Go=class extends St{constructor(e){super();this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ue(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ue(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Hi,this.normalScale=new J(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}};Go.prototype.isMeshToonMaterial=!0;var Wo=class extends St{constructor(e){super();this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Hi,this.normalScale=new J(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}};Wo.prototype.isMeshNormalMaterial=!0;var _i=class extends St{constructor(e){super();this.type="MeshLambertMaterial",this.color=new ue(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ue(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ra,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}};_i.prototype.isMeshLambertMaterial=!0;var ah=class extends St{constructor(e){super();this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ue(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Hi,this.normalScale=new J(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}};ah.prototype.isMeshMatcapMaterial=!0;var lh=class extends rt{constructor(e){super();this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}};lh.prototype.isLineDashedMaterial=!0;var XE=Object.freeze({__proto__:null,ShadowMaterial:oh,SpriteMaterial:Qa,RawShaderMaterial:Ts,ShaderMaterial:Ht,PointsMaterial:On,MeshPhysicalMaterial:Qi,MeshStandardMaterial:Rn,MeshPhongMaterial:kn,MeshToonMaterial:Go,MeshNormalMaterial:Wo,MeshLambertMaterial:_i,MeshDepthMaterial:Ja,MeshDistanceMaterial:$a,MeshBasicMaterial:ct,MeshMatcapMaterial:ah,LineDashedMaterial:lh,LineBasicMaterial:rt,Material:St}),ft={arraySlice:function(a,e,t){return ft.isTypedArray(a)?new a.constructor(a.subarray(e,t!==void 0?t:a.length)):a.slice(e,t)},convertArray:function(a,e,t){return!a||!t&&a.constructor===e?a:typeof e.BYTES_PER_ELEMENT=="number"?new e(a):Array.prototype.slice.call(a)},isTypedArray:function(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)},getKeyframeOrder:function(a){function e(i,r){return a[i]-a[r]}let t=a.length,n=new Array(t);for(let i=0;i!==t;++i)n[i]=i;return n.sort(e),n},sortedArray:function(a,e,t){let n=a.length,i=new a.constructor(n);for(let r=0,s=0;s!==n;++r){let o=t[r]*e;for(let l=0;l!==e;++l)i[s++]=a[o+l]}return i},flattenJSON:function(a,e,t,n){let i=1,r=a[0];for(;r!==void 0&&r[n]===void 0;)r=a[i++];if(r===void 0)return;let s=r[n];if(s!==void 0)if(Array.isArray(s))do s=r[n],s!==void 0&&(e.push(r.time),t.push.apply(t,s)),r=a[i++];while(r!==void 0);else if(s.toArray!==void 0)do s=r[n],s!==void 0&&(e.push(r.time),s.toArray(t,t.length)),r=a[i++];while(r!==void 0);else do s=r[n],s!==void 0&&(e.push(r.time),t.push(s)),r=a[i++];while(r!==void 0)},subclip:function(a,e,t,n,i=30){let r=a.clone();r.name=e;let s=[];for(let l=0;l<r.tracks.length;++l){let c=r.tracks[l],u=c.getValueSize(),f=[],h=[];for(let d=0;d<c.times.length;++d){let p=c.times[d]*i;if(!(p<t||p>=n)){f.push(c.times[d]);for(let m=0;m<u;++m)h.push(c.values[d*u+m])}}f.length!==0&&(c.times=ft.convertArray(f,c.times.constructor),c.values=ft.convertArray(h,c.values.constructor),s.push(c))}r.tracks=s;let o=1/0;for(let l=0;l<r.tracks.length;++l)o>r.tracks[l].times[0]&&(o=r.tracks[l].times[0]);for(let l=0;l<r.tracks.length;++l)r.tracks[l].shift(-1*o);return r.resetDuration(),r},makeClipAdditive:function(a,e=0,t=a,n=30){n<=0&&(n=30);let i=t.tracks.length,r=e/n;for(let s=0;s<i;++s){let o=t.tracks[s],l=o.ValueTypeName;if(l==="bool"||l==="string")continue;let c=a.tracks.find(function(x){return x.name===o.name&&x.ValueTypeName===l});if(c===void 0)continue;let u=0,f=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=f/3);let h=0,d=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=d/3);let p=o.times.length-1,m;if(r<=o.times[0]){let x=u,g=f-u;m=ft.arraySlice(o.values,x,g)}else if(r>=o.times[p]){let x=p*f+u,g=x+f-u;m=ft.arraySlice(o.values,x,g)}else{let x=o.createInterpolant(),g=u,y=f-u;x.evaluate(r),m=ft.arraySlice(x.resultBuffer,g,y)}l==="quaternion"&&new Ve().fromArray(m).normalize().conjugate().toArray(m);let v=c.times.length;for(let x=0;x<v;++x){let g=x*d+h;if(l==="quaternion")Ve.multiplyQuaternionsFlat(c.values,g,m,0,c.values,g);else{let y=d-h*2;for(let _=0;_<y;++_)c.values[g+_]-=m[_]}}}return a.blendMode=Ju,a}},zn=class{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let s;n:{i:if(!(e<i)){for(let o=n+2;;){if(i===void 0){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,r)}if(n===o)break;if(r=i,i=t[++n],e<i)break t}s=t.length;break n}if(!(e>=r)){let o=t[1];e<o&&(n=2,r=o);for(let l=n-2;;){if(r===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(n===l)break;if(i=r,r=t[--n-1],e>=r)break t}s=n,n=0;break n}break e}for(;n<s;){let o=n+s>>>1;e<t[o]?s=o:n=o+1}if(i=t[n],r=t[n-1],r===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(i===void 0)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,r,e)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let s=0;s!==i;++s)t[s]=n[r+s];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}};zn.prototype.beforeStart_=zn.prototype.copySampleValue_;zn.prototype.afterEnd_=zn.prototype.copySampleValue_;var nd=class extends zn{constructor(e,t,n,i){super(e,t,n,i);this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ms,endingEnd:ms}}intervalChanged_(e,t,n){let i=this.parameterPositions,r=e-2,s=e+1,o=i[r],l=i[s];if(o===void 0)switch(this.getSettings_().endingStart){case gs:r=e,o=2*t-n;break;case ka:r=i.length-2,o=t+i[r]-i[r+1];break;default:r=e,o=n}if(l===void 0)switch(this.getSettings_().endingEnd){case gs:s=e,l=2*n-t;break;case ka:s=1,l=n+i[1]-i[0];break;default:s=e-1,l=t}let c=(n-t)*.5,u=this.valueSize;this._weightPrev=c/(t-o),this._weightNext=c/(l-n),this._offsetPrev=r*u,this._offsetNext=s*u}interpolate_(e,t,n,i){let r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,l=e*o,c=l-o,u=this._offsetPrev,f=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-t)/(i-t),m=p*p,v=m*p,x=-h*v+2*h*m-h*p,g=(1+h)*v+(-1.5-2*h)*m+(-.5+h)*p+1,y=(-1-d)*v+(1.5+d)*m+.5*p,_=d*v-d*m;for(let w=0;w!==o;++w)r[w]=x*s[u+w]+g*s[c+w]+y*s[l+w]+_*s[f+w];return r}},ch=class extends zn{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){let r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,l=e*o,c=l-o,u=(n-t)/(i-t),f=1-u;for(let h=0;h!==o;++h)r[h]=s[c+h]*f+s[l+h]*u;return r}},id=class extends zn{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}},Un=class{constructor(e,t,n,i){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=ft.convertArray(t,this.TimeBufferType),this.values=ft.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){let t=e.constructor,n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:ft.convertArray(e.times,Array),values:ft.convertArray(e.values,Array)};let i=e.getInterpolation();i!==e.DefaultInterpolation&&(n.interpolation=i)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new id(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new ch(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new nd(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case ps:t=this.InterpolantFactoryMethodDiscrete;break;case yr:t=this.InterpolantFactoryMethodLinear;break;case oc:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){let n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ps;case this.InterpolantFactoryMethodLinear:return yr;case this.InterpolantFactoryMethodSmooth:return oc}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){let t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(e!==1){let t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){let n=this.times,i=n.length,r=0,s=i-1;for(;r!==i&&n[r]<e;)++r;for(;s!==-1&&n[s]>t;)--s;if(++s,r!==0||s!==i){r>=s&&(s=Math.max(s,1),r=s-1);let o=this.getValueSize();this.times=ft.arraySlice(n,r,s),this.values=ft.arraySlice(this.values,r*o,s*o)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let n=this.times,i=this.values,r=n.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let o=0;o!==r;o++){let l=n[o];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,l),e=!1;break}if(s!==null&&s>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,l,s),e=!1;break}s=l}if(i!==void 0&&ft.isTypedArray(i))for(let o=0,l=i.length;o!==l;++o){let c=i[o];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,c),e=!1;break}}return e}optimize(){let e=ft.arraySlice(this.times),t=ft.arraySlice(this.values),n=this.getValueSize(),i=this.getInterpolation()===oc,r=e.length-1,s=1;for(let o=1;o<r;++o){let l=!1,c=e[o],u=e[o+1];if(c!==u&&(o!==1||c!==e[0]))if(i)l=!0;else{let f=o*n,h=f-n,d=f+n;for(let p=0;p!==n;++p){let m=t[f+p];if(m!==t[h+p]||m!==t[d+p]){l=!0;break}}}if(l){if(o!==s){e[s]=e[o];let f=o*n,h=s*n;for(let d=0;d!==n;++d)t[h+d]=t[f+d]}++s}}if(r>0){e[s]=e[r];for(let o=r*n,l=s*n,c=0;c!==n;++c)t[l+c]=t[o+c];++s}return s!==e.length?(this.times=ft.arraySlice(e,0,s),this.values=ft.arraySlice(t,0,s*n)):(this.times=e,this.values=t),this}clone(){let e=ft.arraySlice(this.times,0),t=ft.arraySlice(this.values,0),n=this.constructor,i=new n(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}};Un.prototype.TimeBufferType=Float32Array;Un.prototype.ValueBufferType=Float32Array;Un.prototype.DefaultInterpolation=yr;var Br=class extends Un{};Br.prototype.ValueTypeName="bool";Br.prototype.ValueBufferType=Array;Br.prototype.DefaultInterpolation=ps;Br.prototype.InterpolantFactoryMethodLinear=void 0;Br.prototype.InterpolantFactoryMethodSmooth=void 0;var hh=class extends Un{};hh.prototype.ValueTypeName="color";var bi=class extends Un{};bi.prototype.ValueTypeName="number";var rd=class extends zn{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){let r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,l=(n-t)/(i-t),c=e*o;for(let u=c+o;c!==u;c+=4)Ve.slerpFlat(r,0,s,c-o,s,c,l);return r}},si=class extends Un{InterpolantFactoryMethodLinear(e){return new rd(this.times,this.values,this.getValueSize(),e)}};si.prototype.ValueTypeName="quaternion";si.prototype.DefaultInterpolation=yr;si.prototype.InterpolantFactoryMethodSmooth=void 0;var Nr=class extends Un{};Nr.prototype.ValueTypeName="string";Nr.prototype.ValueBufferType=Array;Nr.prototype.DefaultInterpolation=ps;Nr.prototype.InterpolantFactoryMethodLinear=void 0;Nr.prototype.InterpolantFactoryMethodSmooth=void 0;var Mi=class extends Un{};Mi.prototype.ValueTypeName="vector";var Si=class{constructor(e,t=-1,n,i=ac){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=Tn(),this.duration<0&&this.resetDuration()}static parse(e){let t=[],n=e.tracks,i=1/(e.fps||1);for(let s=0,o=n.length;s!==o;++s)t.push(qE(n[s]).scale(i));let r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){let t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,s=n.length;r!==s;++r)t.push(Un.toJSON(n[r]));return i}static CreateFromMorphTargetSequence(e,t,n,i){let r=t.length,s=[];for(let o=0;o<r;o++){let l=[],c=[];l.push((o+r-1)%r,o,(o+1)%r),c.push(0,1,0);let u=ft.getKeyframeOrder(l);l=ft.sortedArray(l,1,u),c=ft.sortedArray(c,1,u),!i&&l[0]===0&&(l.push(r),c.push(c[0])),s.push(new bi(".morphTargetInfluences["+t[o].name+"]",l,c).scale(1/n))}return new this(e,-1,s)}static findByName(e,t){let n=e;if(!Array.isArray(e)){let i=e;n=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null}static CreateClipsFromMorphTargetSequences(e,t,n){let i={},r=/^([\w-]*?)([\d]+)$/;for(let o=0,l=e.length;o<l;o++){let c=e[o],u=c.name.match(r);if(u&&u.length>1){let f=u[1],h=i[f];h||(i[f]=h=[]),h.push(c)}}let s=[];for(let o in i)s.push(this.CreateFromMorphTargetSequence(o,i[o],t,n));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let n=function(f,h,d,p,m){if(d.length!==0){let v=[],x=[];ft.flattenJSON(d,v,x,p),v.length!==0&&m.push(new f(h,v,x))}},i=[],r=e.name||"default",s=e.fps||30,o=e.blendMode,l=e.length||-1,c=e.hierarchy||[];for(let f=0;f<c.length;f++){let h=c[f].keys;if(!(!h||h.length===0))if(h[0].morphTargets){let d={},p;for(p=0;p<h.length;p++)if(h[p].morphTargets)for(let m=0;m<h[p].morphTargets.length;m++)d[h[p].morphTargets[m]]=-1;for(let m in d){let v=[],x=[];for(let g=0;g!==h[p].morphTargets.length;++g){let y=h[p];v.push(y.time),x.push(y.morphTarget===m?1:0)}i.push(new bi(".morphTargetInfluence["+m+"]",v,x))}l=d.length*(s||1)}else{let d=".bones["+t[f].name+"]";n(Mi,d+".position",h,"pos",i),n(si,d+".quaternion",h,"rot",i),n(Mi,d+".scale",h,"scl",i)}}return i.length===0?null:new this(r,l,i,o)}resetDuration(){let e=this.tracks,t=0;for(let n=0,i=e.length;n!==i;++n){let r=this.tracks[n];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function jE(a){switch(a.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return bi;case"vector":case"vector2":case"vector3":case"vector4":return Mi;case"color":return hh;case"quaternion":return si;case"bool":case"boolean":return Br;case"string":return Nr}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+a)}function qE(a){if(a.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let e=jE(a.type);if(a.times===void 0){let t=[],n=[];ft.flattenJSON(a.keys,t,n,"value"),a.times=t,a.values=n}return e.parse!==void 0?e.parse(a):new e(a.name,a.times,a.values,a.interpolation)}var Ki={enabled:!1,files:{},add:function(a,e){this.enabled!==!1&&(this.files[a]=e)},get:function(a){if(this.enabled!==!1)return this.files[a]},remove:function(a){delete this.files[a]},clear:function(){this.files={}}},uh=class{constructor(e,t,n){let i=this,r=!1,s=0,o=0,l,c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(u){o++,r===!1&&i.onStart!==void 0&&i.onStart(u,s,o),r=!0},this.itemEnd=function(u){s++,i.onProgress!==void 0&&i.onProgress(u,s,o),s===o&&(r=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(u){i.onError!==void 0&&i.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,f){return c.push(u,f),this},this.removeHandler=function(u){let f=c.indexOf(u);return f!==-1&&c.splice(f,2),this},this.getHandler=function(u){for(let f=0,h=c.length;f<h;f+=2){let d=c[f],p=c[f+1];if(d.global&&(d.lastIndex=0),d.test(u))return p}return null}}},Cx=new uh,vt=class{constructor(e){this.manager=e!==void 0?e:Cx,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let n=this;return new Promise(function(i,r){n.load(e,i,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}},oi={},Pt=class extends vt{constructor(e){super(e)}load(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let r=this,s=Ki.get(e);if(s!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(s),r.manager.itemEnd(e)},0),s;if(oi[e]!==void 0){oi[e].push({onLoad:t,onProgress:n,onError:i});return}let o=/^data:(.*?)(;base64)?,(.*)$/,l=e.match(o),c;if(l){let u=l[1],f=!!l[2],h=l[3];h=decodeURIComponent(h),f&&(h=atob(h));try{let d,p=(this.responseType||"").toLowerCase();switch(p){case"arraybuffer":case"blob":let m=new Uint8Array(h.length);for(let x=0;x<h.length;x++)m[x]=h.charCodeAt(x);p==="blob"?d=new Blob([m.buffer],{type:u}):d=m.buffer;break;case"document":d=new DOMParser().parseFromString(h,u);break;case"json":d=JSON.parse(h);break;default:d=h;break}setTimeout(function(){t&&t(d),r.manager.itemEnd(e)},0)}catch(d){setTimeout(function(){i&&i(d),r.manager.itemError(e),r.manager.itemEnd(e)},0)}}else{oi[e]=[],oi[e].push({onLoad:t,onProgress:n,onError:i}),c=new XMLHttpRequest,c.open("GET",e,!0),c.addEventListener("load",function(u){let f=this.response,h=oi[e];if(delete oi[e],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Ki.add(e,f);for(let d=0,p=h.length;d<p;d++){let m=h[d];m.onLoad&&m.onLoad(f)}r.manager.itemEnd(e)}else{for(let d=0,p=h.length;d<p;d++){let m=h[d];m.onError&&m.onError(u)}r.manager.itemError(e),r.manager.itemEnd(e)}},!1),c.addEventListener("progress",function(u){let f=oi[e];for(let h=0,d=f.length;h<d;h++){let p=f[h];p.onProgress&&p.onProgress(u)}},!1),c.addEventListener("error",function(u){let f=oi[e];delete oi[e];for(let h=0,d=f.length;h<d;h++){let p=f[h];p.onError&&p.onError(u)}r.manager.itemError(e),r.manager.itemEnd(e)},!1),c.addEventListener("abort",function(u){let f=oi[e];delete oi[e];for(let h=0,d=f.length;h<d;h++){let p=f[h];p.onError&&p.onError(u)}r.manager.itemError(e),r.manager.itemEnd(e)},!1),this.responseType!==void 0&&(c.responseType=this.responseType),this.withCredentials!==void 0&&(c.withCredentials=this.withCredentials),c.overrideMimeType&&c.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain");for(let u in this.requestHeader)c.setRequestHeader(u,this.requestHeader[u]);c.send(null)}return r.manager.itemStart(e),c}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}},Lx=class extends vt{constructor(e){super(e)}load(e,t,n,i){let r=this,s=new Pt(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(o){try{t(r.parse(JSON.parse(o)))}catch(l){i?i(l):console.error(l),r.manager.itemError(e)}},n,i)}parse(e){let t=[];for(let n=0;n<e.length;n++){let i=Si.parse(e[n]);t.push(i)}return t}},Rx=class extends vt{constructor(e){super(e)}load(e,t,n,i){let r=this,s=[],o=new Wc,l=new Pt(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(r.withCredentials);let c=0;function u(f){l.load(e[f],function(h){let d=r.parse(h,!0);s[f]={width:d.width,height:d.height,format:d.format,mipmaps:d.mipmaps},c+=1,c===6&&(d.mipmapCount===1&&(o.minFilter=Ke),o.image=s,o.format=d.format,o.needsUpdate=!0,t&&t(o))},n,i)}if(Array.isArray(e))for(let f=0,h=e.length;f<h;++f)u(f);else l.load(e,function(f){let h=r.parse(f,!0);if(h.isCubemap){let d=h.mipmaps.length/h.mipmapCount;for(let p=0;p<d;p++){s[p]={mipmaps:[]};for(let m=0;m<h.mipmapCount;m++)s[p].mipmaps.push(h.mipmaps[p*h.mipmapCount+m]),s[p].format=h.format,s[p].width=h.width,s[p].height=h.height}o.image=s}else o.image.width=h.width,o.image.height=h.height,o.mipmaps=h.mipmaps;h.mipmapCount===1&&(o.minFilter=Ke),o.format=h.format,o.needsUpdate=!0,t&&t(o)},n,i);return o}},Or=class extends vt{constructor(e){super(e)}load(e,t,n,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let r=this,s=Ki.get(e);if(s!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(s),r.manager.itemEnd(e)},0),s;let o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function l(){o.removeEventListener("load",l,!1),o.removeEventListener("error",c,!1),Ki.add(e,this),t&&t(this),r.manager.itemEnd(e)}function c(u){o.removeEventListener("load",l,!1),o.removeEventListener("error",c,!1),i&&i(u),r.manager.itemError(e),r.manager.itemEnd(e)}return o.addEventListener("load",l,!1),o.addEventListener("error",c,!1),e.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(e),o.src=e,o}},sd=class extends vt{constructor(e){super(e)}load(e,t,n,i){let r=new _s,s=new Or(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let o=0;function l(c){s.load(e[c],function(u){r.images[c]=u,o++,o===6&&(r.needsUpdate=!0,t&&t(r))},void 0,i)}for(let c=0;c<e.length;++c)l(c);return r}},od=class extends vt{constructor(e){super(e)}load(e,t,n,i){let r=this,s=new Lr,o=new Pt(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(r.withCredentials),o.load(e,function(l){let c=r.parse(l);!c||(c.image!==void 0?s.image=c.image:c.data!==void 0&&(s.image.width=c.width,s.image.height=c.height,s.image.data=c.data),s.wrapS=c.wrapS!==void 0?c.wrapS:bt,s.wrapT=c.wrapT!==void 0?c.wrapT:bt,s.magFilter=c.magFilter!==void 0?c.magFilter:Ke,s.minFilter=c.minFilter!==void 0?c.minFilter:Ke,s.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.encoding!==void 0&&(s.encoding=c.encoding),c.flipY!==void 0&&(s.flipY=c.flipY),c.format!==void 0&&(s.format=c.format),c.type!==void 0&&(s.type=c.type),c.mipmaps!==void 0&&(s.mipmaps=c.mipmaps,s.minFilter=mi),c.mipmapCount===1&&(s.minFilter=Ke),c.generateMipmaps!==void 0&&(s.generateMipmaps=c.generateMipmaps),s.needsUpdate=!0,t&&t(s,c))},n,i),s}},ai=class extends vt{constructor(e){super(e)}load(e,t,n,i){let r=new lt,s=new Or(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,function(o){r.image=o;let l=e.search(/\.jpe?g($|\?)/i)>0||e.search(/^data\:image\/jpeg/)===0;r.format=l?mn:gn,r.needsUpdate=!0,t!==void 0&&t(r)},n,i),r}},ad=class extends rn{constructor(){super();this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new No(t,e))}getPoint(e){let t=e*this.getLength(),n=this.getCurveLengths(),i=0;for(;i<n.length;){if(n[i]>=t){let r=n[i]-t,s=this.curves[i],o=s.getLength(),l=o===0?0:1-r/o;return s.getPointAt(l)}i++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let t=[],n;for(let i=0,r=this.curves;i<r.length;i++){let s=r[i],o=s&&s.isEllipseCurve?e*2:s&&(s.isLineCurve||s.isLineCurve3)?1:s&&s.isSplineCurve?e*s.points.length:e,l=s.getPoints(o);for(let c=0;c<l.length;c++){let u=l[c];n&&n.equals(u)||(t.push(u),n=u)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){let i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){let i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){let i=e.curves[t];this.curves.push(new Kf[i.type]().fromJSON(i))}return this}},Ti=class extends ad{constructor(e){super();this.type="Path",this.currentPoint=new J,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let n=new No(this.currentPoint.clone(),new J(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){let r=new al(this.currentPoint.clone(),new J(e,t),new J(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,r,s){let o=new ol(this.currentPoint.clone(),new J(e,t),new J(n,i),new J(r,s));return this.curves.push(o),this.currentPoint.set(r,s),this}splineThru(e){let t=[this.currentPoint.clone()].concat(e),n=new ll(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,r,s){let o=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+o,t+l,n,i,r,s),this}absarc(e,t,n,i,r,s){return this.absellipse(e,t,n,n,i,r,s),this}ellipse(e,t,n,i,r,s,o,l){let c=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+c,t+u,n,i,r,s,o,l),this}absellipse(e,t,n,i,r,s,o,l){let c=new Bo(e,t,n,i,r,s,o,l);if(this.curves.length>0){let f=c.getPoint(0);f.equals(this.currentPoint)||this.lineTo(f.x,f.y)}this.curves.push(c);let u=c.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}},li=class extends Ti{constructor(e){super(e);this.uuid=Tn(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){let i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){let i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){let i=e.holes[t];this.holes.push(new Ti().fromJSON(i))}return this}},Vn=class extends Re{constructor(e,t=1){super();this.type="Light",this.color=new ue(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}};Vn.prototype.isLight=!0;var Xo=class extends Vn{constructor(e,t,n){super(e,n);this.type="HemisphereLight",this.position.copy(Re.DefaultUp),this.updateMatrix(),this.groundColor=new ue(t)}copy(e){return Vn.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}};Xo.prototype.isHemisphereLight=!0;var Ix=new fe,Dx=new L,Fx=new L,fh=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new J(512,512),this.map=null,this.mapPass=null,this.matrix=new fe,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new So,this._frameExtents=new J(1,1),this._viewportCount=1,this._viewports=[new De(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,n=this.matrix;Dx.setFromMatrixPosition(e.matrixWorld),t.position.copy(Dx),Fx.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Fx),t.updateMatrixWorld(),Ix.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ix),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},ld=class extends fh{constructor(){super(new it(50,1,.5,500));this.focus=1}updateMatrices(e){let t=this.camera,n=za*2*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(n!==t.fov||i!==t.aspect||r!==t.far)&&(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}};ld.prototype.isSpotLightShadow=!0;var Ei=class extends Vn{constructor(e,t,n=0,i=Math.PI/3,r=0,s=1){super(e,t);this.type="SpotLight",this.position.copy(Re.DefaultUp),this.updateMatrix(),this.target=new Re,this.distance=n,this.angle=i,this.penumbra=r,this.decay=s,this.shadow=new ld}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}};Ei.prototype.isSpotLight=!0;var Bx=new fe,fl=new L,cd=new L,hd=class extends fh{constructor(){super(new it(90,1,.5,500));this._frameExtents=new J(4,2),this._viewportCount=6,this._viewports=[new De(2,1,1,1),new De(0,1,1,1),new De(3,1,1,1),new De(1,1,1,1),new De(3,0,1,1),new De(1,0,1,1)],this._cubeDirections=[new L(1,0,0),new L(-1,0,0),new L(0,0,1),new L(0,0,-1),new L(0,1,0),new L(0,-1,0)],this._cubeUps=[new L(0,1,0),new L(0,1,0),new L(0,1,0),new L(0,1,0),new L(0,0,1),new L(0,0,-1)]}updateMatrices(e,t=0){let n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),fl.setFromMatrixPosition(e.matrixWorld),n.position.copy(fl),cd.copy(n.position),cd.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(cd),n.updateMatrixWorld(),i.makeTranslation(-fl.x,-fl.y,-fl.z),Bx.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Bx)}};hd.prototype.isPointLightShadow=!0;var ci=class extends Vn{constructor(e,t,n=0,i=1){super(e,t);this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new hd}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}};ci.prototype.isPointLight=!0;var sn=class extends wo{constructor(e=-1,t=1,n=1,i=-1,r=.1,s=2e3){super();this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2,r=n-e,s=n+e,o=i+t,l=i-t;if(this.view!==null&&this.view.enabled){let c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=c*this.view.offsetX,s=r+c*this.view.width,o-=u*this.view.offsetY,l=o-u*this.view.height}this.projectionMatrix.makeOrthographic(r,s,o,l,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}};sn.prototype.isOrthographicCamera=!0;var ud=class extends fh{constructor(){super(new sn(-5,5,5,-5,.5,500))}};ud.prototype.isDirectionalLightShadow=!0;var Ai=class extends Vn{constructor(e,t){super(e,t);this.type="DirectionalLight",this.position.copy(Re.DefaultUp),this.updateMatrix(),this.target=new Re,this.shadow=new ud}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}};Ai.prototype.isDirectionalLight=!0;var kr=class extends Vn{constructor(e,t){super(e,t);this.type="AmbientLight"}};kr.prototype.isAmbientLight=!0;var jo=class extends Vn{constructor(e,t,n=10,i=10){super(e,t);this.type="RectAreaLight",this.width=n,this.height=i}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){let t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}};jo.prototype.isRectAreaLight=!0;var dh=class{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new L)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){let n=e.x,i=e.y,r=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.282095),t.addScaledVector(s[1],.488603*i),t.addScaledVector(s[2],.488603*r),t.addScaledVector(s[3],.488603*n),t.addScaledVector(s[4],1.092548*(n*i)),t.addScaledVector(s[5],1.092548*(i*r)),t.addScaledVector(s[6],.315392*(3*r*r-1)),t.addScaledVector(s[7],1.092548*(n*r)),t.addScaledVector(s[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){let n=e.x,i=e.y,r=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.886227),t.addScaledVector(s[1],2*.511664*i),t.addScaledVector(s[2],2*.511664*r),t.addScaledVector(s[3],2*.511664*n),t.addScaledVector(s[4],2*.429043*n*i),t.addScaledVector(s[5],2*.429043*i*r),t.addScaledVector(s[6],.743125*r*r-.247708),t.addScaledVector(s[7],2*.429043*n*r),t.addScaledVector(s[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){let n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+i*3);return this}toArray(e=[],t=0){let n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+i*3);return e}static getBasisAt(e,t){let n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}};dh.prototype.isSphericalHarmonics3=!0;var qo=class extends Vn{constructor(e=new dh,t=1){super(void 0,t);this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){let t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}};qo.prototype.isLightProbe=!0;var fd=class extends vt{constructor(e){super(e);this.textures={}}load(e,t,n,i){let r=this,s=new Pt(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,function(o){try{t(r.parse(JSON.parse(o)))}catch(l){i?i(l):console.error(l),r.manager.itemError(e)}},n,i)}parse(e){let t=this.textures;function n(r){return t[r]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",r),t[r]}let i=new XE[e.type];if(e.uuid!==void 0&&(i.uuid=e.uuid),e.name!==void 0&&(i.name=e.name),e.color!==void 0&&i.color!==void 0&&i.color.setHex(e.color),e.roughness!==void 0&&(i.roughness=e.roughness),e.metalness!==void 0&&(i.metalness=e.metalness),e.sheen!==void 0&&(i.sheen=new ue().setHex(e.sheen)),e.emissive!==void 0&&i.emissive!==void 0&&i.emissive.setHex(e.emissive),e.specular!==void 0&&i.specular!==void 0&&i.specular.setHex(e.specular),e.shininess!==void 0&&(i.shininess=e.shininess),e.clearcoat!==void 0&&(i.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=e.clearcoatRoughness),e.transmission!==void 0&&(i.transmission=e.transmission),e.thickness!==void 0&&(i.thickness=e.thickness),e.attenuationDistance!==void 0&&(i.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&i.attenuationColor!==void 0&&i.attenuationColor.setHex(e.attenuationColor),e.fog!==void 0&&(i.fog=e.fog),e.flatShading!==void 0&&(i.flatShading=e.flatShading),e.blending!==void 0&&(i.blending=e.blending),e.combine!==void 0&&(i.combine=e.combine),e.side!==void 0&&(i.side=e.side),e.shadowSide!==void 0&&(i.shadowSide=e.shadowSide),e.opacity!==void 0&&(i.opacity=e.opacity),e.transparent!==void 0&&(i.transparent=e.transparent),e.alphaTest!==void 0&&(i.alphaTest=e.alphaTest),e.depthTest!==void 0&&(i.depthTest=e.depthTest),e.depthWrite!==void 0&&(i.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(i.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(i.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(i.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(i.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(i.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(i.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(i.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(i.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(i.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(i.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(i.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(i.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(i.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(i.rotation=e.rotation),e.linewidth!==1&&(i.linewidth=e.linewidth),e.dashSize!==void 0&&(i.dashSize=e.dashSize),e.gapSize!==void 0&&(i.gapSize=e.gapSize),e.scale!==void 0&&(i.scale=e.scale),e.polygonOffset!==void 0&&(i.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(i.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(i.polygonOffsetUnits=e.polygonOffsetUnits),e.morphTargets!==void 0&&(i.morphTargets=e.morphTargets),e.morphNormals!==void 0&&(i.morphNormals=e.morphNormals),e.dithering!==void 0&&(i.dithering=e.dithering),e.alphaToCoverage!==void 0&&(i.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(i.premultipliedAlpha=e.premultipliedAlpha),e.vertexTangents!==void 0&&(i.vertexTangents=e.vertexTangents),e.visible!==void 0&&(i.visible=e.visible),e.toneMapped!==void 0&&(i.toneMapped=e.toneMapped),e.userData!==void 0&&(i.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),e.uniforms!==void 0)for(let r in e.uniforms){let s=e.uniforms[r];switch(i.uniforms[r]={},s.type){case"t":i.uniforms[r].value=n(s.value);break;case"c":i.uniforms[r].value=new ue().setHex(s.value);break;case"v2":i.uniforms[r].value=new J().fromArray(s.value);break;case"v3":i.uniforms[r].value=new L().fromArray(s.value);break;case"v4":i.uniforms[r].value=new De().fromArray(s.value);break;case"m3":i.uniforms[r].value=new Ye().fromArray(s.value);break;case"m4":i.uniforms[r].value=new fe().fromArray(s.value);break;default:i.uniforms[r].value=s.value}}if(e.defines!==void 0&&(i.defines=e.defines),e.vertexShader!==void 0&&(i.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(i.fragmentShader=e.fragmentShader),e.extensions!==void 0)for(let r in e.extensions)i.extensions[r]=e.extensions[r];if(e.shading!==void 0&&(i.flatShading=e.shading===1),e.size!==void 0&&(i.size=e.size),e.sizeAttenuation!==void 0&&(i.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(i.map=n(e.map)),e.matcap!==void 0&&(i.matcap=n(e.matcap)),e.alphaMap!==void 0&&(i.alphaMap=n(e.alphaMap)),e.bumpMap!==void 0&&(i.bumpMap=n(e.bumpMap)),e.bumpScale!==void 0&&(i.bumpScale=e.bumpScale),e.normalMap!==void 0&&(i.normalMap=n(e.normalMap)),e.normalMapType!==void 0&&(i.normalMapType=e.normalMapType),e.normalScale!==void 0){let r=e.normalScale;Array.isArray(r)===!1&&(r=[r,r]),i.normalScale=new J().fromArray(r)}return e.displacementMap!==void 0&&(i.displacementMap=n(e.displacementMap)),e.displacementScale!==void 0&&(i.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(i.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(i.roughnessMap=n(e.roughnessMap)),e.metalnessMap!==void 0&&(i.metalnessMap=n(e.metalnessMap)),e.emissiveMap!==void 0&&(i.emissiveMap=n(e.emissiveMap)),e.emissiveIntensity!==void 0&&(i.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(i.specularMap=n(e.specularMap)),e.envMap!==void 0&&(i.envMap=n(e.envMap)),e.envMapIntensity!==void 0&&(i.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(i.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(i.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(i.lightMap=n(e.lightMap)),e.lightMapIntensity!==void 0&&(i.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(i.aoMap=n(e.aoMap)),e.aoMapIntensity!==void 0&&(i.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(i.gradientMap=n(e.gradientMap)),e.clearcoatMap!==void 0&&(i.clearcoatMap=n(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(i.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(i.clearcoatNormalScale=new J().fromArray(e.clearcoatNormalScale)),e.transmissionMap!==void 0&&(i.transmissionMap=n(e.transmissionMap)),e.thicknessMap!==void 0&&(i.thicknessMap=n(e.thicknessMap)),i}setTextures(e){return this.textures=e,this}},un=class{static decodeText(e){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(e);let t="";for(let n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(n){return t}}static extractUrlBase(e){let t=e.lastIndexOf("/");return t===-1?"./":e.substr(0,t+1)}},ph=class extends ye{constructor(){super();this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){let e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}};ph.prototype.isInstancedBufferGeometry=!0;var mh=class extends Se{constructor(e,t,n,i=1){typeof n=="number"&&(i=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument."));super(e,t,n);this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}};mh.prototype.isInstancedBufferAttribute=!0;var dd=class extends vt{constructor(e){super(e)}load(e,t,n,i){let r=this,s=new Pt(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,function(o){try{t(r.parse(JSON.parse(o)))}catch(l){i?i(l):console.error(l),r.manager.itemError(e)}},n,i)}parse(e){let t={},n={};function i(d,p){if(t[p]!==void 0)return t[p];let v=d.interleavedBuffers[p],x=r(d,v.buffer),g=go(v.type,x),y=new gi(g,v.stride);return y.uuid=v.uuid,t[p]=y,y}function r(d,p){if(n[p]!==void 0)return n[p];let v=d.arrayBuffers[p],x=new Uint32Array(v).buffer;return n[p]=x,x}let s=e.isInstancedBufferGeometry?new ph:new ye,o=e.data.index;if(o!==void 0){let d=go(o.type,o.array);s.setIndex(new Se(d,1))}let l=e.data.attributes;for(let d in l){let p=l[d],m;if(p.isInterleavedBufferAttribute){let v=i(e.data,p.data);m=new ri(v,p.itemSize,p.offset,p.normalized)}else{let v=go(p.type,p.array),x=p.isInstancedBufferAttribute?mh:Se;m=new x(v,p.itemSize,p.normalized)}p.name!==void 0&&(m.name=p.name),p.usage!==void 0&&m.setUsage(p.usage),p.updateRange!==void 0&&(m.updateRange.offset=p.updateRange.offset,m.updateRange.count=p.updateRange.count),s.setAttribute(d,m)}let c=e.data.morphAttributes;if(c)for(let d in c){let p=c[d],m=[];for(let v=0,x=p.length;v<x;v++){let g=p[v],y;if(g.isInterleavedBufferAttribute){let _=i(e.data,g.data);y=new ri(_,g.itemSize,g.offset,g.normalized)}else{let _=go(g.type,g.array);y=new Se(_,g.itemSize,g.normalized)}g.name!==void 0&&(y.name=g.name),m.push(y)}s.morphAttributes[d]=m}e.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);let f=e.data.groups||e.data.drawcalls||e.data.offsets;if(f!==void 0)for(let d=0,p=f.length;d!==p;++d){let m=f[d];s.addGroup(m.start,m.count,m.materialIndex)}let h=e.data.boundingSphere;if(h!==void 0){let d=new L;h.center!==void 0&&d.fromArray(h.center),s.boundingSphere=new En(d,h.radius)}return e.name&&(s.name=e.name),e.userData&&(s.userData=e.userData),s}},gh=class extends vt{constructor(e){super(e)}load(e,t,n,i){let r=this,s=this.path===""?un.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;let o=new Pt(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){let c=null;try{c=JSON.parse(l)}catch(f){i!==void 0&&i(f),console.error("THREE:ObjectLoader: Can't parse "+e+".",f.message);return}let u=c.metadata;if(u===void 0||u.type===void 0||u.type.toLowerCase()==="geometry"){console.error("THREE.ObjectLoader: Can't load "+e);return}r.parse(c,t)},n,i)}async loadAsync(e,t){let n=this,i=this.path===""?un.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||i;let r=new Pt(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);let s=await r.loadAsync(e,t),o=JSON.parse(s),l=o.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await n.parseAsync(o)}parse(e,t){let n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,i),s=this.parseImages(e.images,function(){t!==void 0&&t(c)}),o=this.parseTextures(e.textures,s),l=this.parseMaterials(e.materials,o),c=this.parseObject(e.object,r,l,o,n),u=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,u),t!==void 0){let f=!1;for(let h in s)if(s[h]instanceof HTMLImageElement){f=!0;break}f===!1&&t(c)}return c}async parseAsync(e){let t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,n),r=await this.parseImagesAsync(e.images),s=this.parseTextures(e.textures,r),o=this.parseMaterials(e.materials,s),l=this.parseObject(e.object,i,o,s,t),c=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,c),l}parseShapes(e){let t={};if(e!==void 0)for(let n=0,i=e.length;n<i;n++){let r=new li().fromJSON(e[n]);t[r.uuid]=r}return t}parseSkeletons(e,t){let n={},i={};if(t.traverse(function(r){r.isBone&&(i[r.uuid]=r)}),e!==void 0)for(let r=0,s=e.length;r<s;r++){let o=new $i().fromJSON(e[r],i);n[o.uuid]=o}return n}parseGeometries(e,t){let n={};if(e!==void 0){let i=new dd;for(let r=0,s=e.length;r<s;r++){let o,l=e[r];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":o=i.parse(l);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:l.type in Px?o=Px[l.type].fromJSON(l,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}o.uuid=l.uuid,l.name!==void 0&&(o.name=l.name),o.isBufferGeometry===!0&&l.userData!==void 0&&(o.userData=l.userData),n[l.uuid]=o}}return n}parseMaterials(e,t){let n={},i={};if(e!==void 0){let r=new fd;r.setTextures(t);for(let s=0,o=e.length;s<o;s++){let l=e[s];if(l.type==="MultiMaterial"){let c=[];for(let u=0;u<l.materials.length;u++){let f=l.materials[u];n[f.uuid]===void 0&&(n[f.uuid]=r.parse(f)),c.push(n[f.uuid])}i[l.uuid]=c}else n[l.uuid]===void 0&&(n[l.uuid]=r.parse(l)),i[l.uuid]=n[l.uuid]}}return i}parseAnimations(e){let t={};if(e!==void 0)for(let n=0;n<e.length;n++){let i=e[n],r=Si.parse(i);t[r.uuid]=r}return t}parseImages(e,t){let n=this,i={},r;function s(l){return n.manager.itemStart(l),r.load(l,function(){n.manager.itemEnd(l)},void 0,function(){n.manager.itemError(l),n.manager.itemEnd(l)})}function o(l){if(typeof l=="string"){let c=l,u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:n.resourcePath+c;return s(u)}else return l.data?{data:go(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){let l=new uh(t);r=new Or(l),r.setCrossOrigin(this.crossOrigin);for(let c=0,u=e.length;c<u;c++){let f=e[c],h=f.url;if(Array.isArray(h)){i[f.uuid]=[];for(let d=0,p=h.length;d<p;d++){let m=h[d],v=o(m);v!==null&&(v instanceof HTMLImageElement?i[f.uuid].push(v):i[f.uuid].push(new Lr(v.data,v.width,v.height)))}}else{let d=o(f.url);d!==null&&(i[f.uuid]=d)}}}return i}async parseImagesAsync(e){let t=this,n={},i;async function r(s){if(typeof s=="string"){let o=s,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(o)?o:t.resourcePath+o;return await i.loadAsync(l)}else return s.data?{data:go(s.type,s.data),width:s.width,height:s.height}:null}if(e!==void 0&&e.length>0){i=new Or(this.manager),i.setCrossOrigin(this.crossOrigin);for(let s=0,o=e.length;s<o;s++){let l=e[s],c=l.url;if(Array.isArray(c)){n[l.uuid]=[];for(let u=0,f=c.length;u<f;u++){let h=c[u],d=await r(h);d!==null&&(d instanceof HTMLImageElement?n[l.uuid].push(d):n[l.uuid].push(new Lr(d.data,d.width,d.height)))}}else{let u=await r(l.url);u!==null&&(n[l.uuid]=u)}}}return n}parseTextures(e,t){function n(r,s){return typeof r=="number"?r:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",r),s[r])}let i={};if(e!==void 0)for(let r=0,s=e.length;r<s;r++){let o=e[r];o.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),t[o.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",o.image);let l,c=t[o.image];Array.isArray(c)?(l=new _s(c),c.length===6&&(l.needsUpdate=!0)):(c&&c.data?l=new Lr(c.data,c.width,c.height):l=new lt(c),c&&(l.needsUpdate=!0)),l.uuid=o.uuid,o.name!==void 0&&(l.name=o.name),o.mapping!==void 0&&(l.mapping=n(o.mapping,YE)),o.offset!==void 0&&l.offset.fromArray(o.offset),o.repeat!==void 0&&l.repeat.fromArray(o.repeat),o.center!==void 0&&l.center.fromArray(o.center),o.rotation!==void 0&&(l.rotation=o.rotation),o.wrap!==void 0&&(l.wrapS=n(o.wrap[0],Nx),l.wrapT=n(o.wrap[1],Nx)),o.format!==void 0&&(l.format=o.format),o.type!==void 0&&(l.type=o.type),o.encoding!==void 0&&(l.encoding=o.encoding),o.minFilter!==void 0&&(l.minFilter=n(o.minFilter,Ox)),o.magFilter!==void 0&&(l.magFilter=n(o.magFilter,Ox)),o.anisotropy!==void 0&&(l.anisotropy=o.anisotropy),o.flipY!==void 0&&(l.flipY=o.flipY),o.premultiplyAlpha!==void 0&&(l.premultiplyAlpha=o.premultiplyAlpha),o.unpackAlignment!==void 0&&(l.unpackAlignment=o.unpackAlignment),i[o.uuid]=l}return i}parseObject(e,t,n,i,r){let s;function o(h){return t[h]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",h),t[h]}function l(h){if(h!==void 0){if(Array.isArray(h)){let d=[];for(let p=0,m=h.length;p<m;p++){let v=h[p];n[v]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",v),d.push(n[v])}return d}return n[h]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",h),n[h]}}function c(h){return i[h]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",h),i[h]}let u,f;switch(e.type){case"Scene":s=new bs,e.background!==void 0&&(Number.isInteger(e.background)?s.background=new ue(e.background):s.background=c(e.background)),e.environment!==void 0&&(s.environment=c(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?s.fog=new Ao(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(s.fog=new Eo(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":s=new it(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(s.focus=e.focus),e.zoom!==void 0&&(s.zoom=e.zoom),e.filmGauge!==void 0&&(s.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(s.filmOffset=e.filmOffset),e.view!==void 0&&(s.view=Object.assign({},e.view));break;case"OrthographicCamera":s=new sn(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(s.zoom=e.zoom),e.view!==void 0&&(s.view=Object.assign({},e.view));break;case"AmbientLight":s=new kr(e.color,e.intensity);break;case"DirectionalLight":s=new Ai(e.color,e.intensity);break;case"PointLight":s=new ci(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":s=new jo(e.color,e.intensity,e.width,e.height);break;case"SpotLight":s=new Ei(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":s=new Xo(e.color,e.groundColor,e.intensity);break;case"LightProbe":s=new qo().fromJSON(e);break;case"SkinnedMesh":u=o(e.geometry),f=l(e.material),s=new Ji(u,f),e.bindMode!==void 0&&(s.bindMode=e.bindMode),e.bindMatrix!==void 0&&s.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(s.skeleton=e.skeleton);break;case"Mesh":u=o(e.geometry),f=l(e.material),s=new Ce(u,f);break;case"InstancedMesh":u=o(e.geometry),f=l(e.material);let h=e.count,d=e.instanceMatrix,p=e.instanceColor;s=new Uc(u,f,h),s.instanceMatrix=new Se(new Float32Array(d.array),16),p!==void 0&&(s.instanceColor=new Se(new Float32Array(p.array),p.itemSize));break;case"LOD":s=new Vf;break;case"Line":s=new Gt(o(e.geometry),l(e.material));break;case"LineLoop":s=new Io(o(e.geometry),l(e.material));break;case"LineSegments":s=new Ot(o(e.geometry),l(e.material));break;case"PointCloud":case"Points":s=new vi(o(e.geometry),l(e.material));break;case"Sprite":s=new nl(l(e.material));break;case"Group":s=new Jt;break;case"Bone":s=new xi;break;default:s=new Re}if(s.uuid=e.uuid,e.name!==void 0&&(s.name=e.name),e.matrix!==void 0?(s.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(s.matrixAutoUpdate=e.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(e.position!==void 0&&s.position.fromArray(e.position),e.rotation!==void 0&&s.rotation.fromArray(e.rotation),e.quaternion!==void 0&&s.quaternion.fromArray(e.quaternion),e.scale!==void 0&&s.scale.fromArray(e.scale)),e.castShadow!==void 0&&(s.castShadow=e.castShadow),e.receiveShadow!==void 0&&(s.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(s.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(s.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(s.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&s.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(s.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(s.visible=e.visible),e.frustumCulled!==void 0&&(s.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(s.renderOrder=e.renderOrder),e.userData!==void 0&&(s.userData=e.userData),e.layers!==void 0&&(s.layers.mask=e.layers),e.children!==void 0){let h=e.children;for(let d=0;d<h.length;d++)s.add(this.parseObject(h[d],t,n,i,r))}if(e.animations!==void 0){let h=e.animations;for(let d=0;d<h.length;d++){let p=h[d];s.animations.push(r[p])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(s.autoUpdate=e.autoUpdate);let h=e.levels;for(let d=0;d<h.length;d++){let p=h[d],m=s.getObjectByProperty("uuid",p.object);m!==void 0&&s.addLevel(m,p.distance)}}return s}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(n){if(n.isSkinnedMesh===!0&&n.skeleton!==void 0){let i=t[n.skeleton];i===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",n.skeleton):n.bind(i,n.bindMatrix)}})}setTexturePath(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}},YE={UVMapping:rc,CubeReflectionMapping:Ia,CubeRefractionMapping:Da,EquirectangularReflectionMapping:eo,EquirectangularRefractionMapping:sc,CubeUVReflectionMapping:to,CubeUVRefractionMapping:Fa},Nx={RepeatWrapping:Nt,ClampToEdgeWrapping:bt,MirroredRepeatWrapping:hs},Ox={NearestFilter:Mt,NearestMipmapNearestFilter:no,NearestMipmapLinearFilter:io,LinearFilter:Ke,LinearMipmapNearestFilter:Ba,LinearMipmapLinearFilter:mi},dl=class extends vt{constructor(e){super(e);typeof createImageBitmap=="undefined"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch=="undefined"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let r=this,s=Ki.get(e);if(s!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(s),r.manager.itemEnd(e)},0),s;let o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader,fetch(e,o).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(l){Ki.add(e,l),t&&t(l),r.manager.itemEnd(e)}).catch(function(l){i&&i(l),r.manager.itemError(e),r.manager.itemEnd(e)}),r.manager.itemStart(e)}};dl.prototype.isImageBitmapLoader=!0;var hi=class{constructor(){this.type="ShapePath",this.color=new ue,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Ti,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}bezierCurveTo(e,t,n,i,r,s){return this.currentPath.bezierCurveTo(e,t,n,i,r,s),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e,t){function n(g){let y=[];for(let _=0,w=g.length;_<w;_++){let b=g[_],S=new li;S.curves=b.curves,y.push(S)}return y}function i(g,y){let _=y.length,w=!1;for(let b=_-1,S=0;S<_;b=S++){let M=y[b],T=y[S],E=T.x-M.x,A=T.y-M.y;if(Math.abs(A)>Number.EPSILON){if(A<0&&(M=y[S],E=-E,T=y[b],A=-A),g.y<M.y||g.y>T.y)continue;if(g.y===M.y){if(g.x===M.x)return!0}else{let I=A*(g.x-M.x)-E*(g.y-M.y);if(I===0)return!0;if(I<0)continue;w=!w}}else{if(g.y!==M.y)continue;if(T.x<=g.x&&g.x<=M.x||M.x<=g.x&&g.x<=T.x)return!0}}return w}let r=Cn.isClockWise,s=this.subPaths;if(s.length===0)return[];if(t===!0)return n(s);let o,l,c,u=[];if(s.length===1)return l=s[0],c=new li,c.curves=l.curves,u.push(c),u;let f=!r(s[0].getPoints());f=e?!f:f;let h=[],d=[],p=[],m=0,v;d[m]=void 0,p[m]=[];for(let g=0,y=s.length;g<y;g++)l=s[g],v=l.getPoints(),o=r(v),o=e?!o:o,o?(!f&&d[m]&&m++,d[m]={s:new li,p:v},d[m].s.curves=l.curves,f&&m++,p[m]=[]):p[m].push({h:l,p:v[0]});if(!d[0])return n(s);if(d.length>1){let g=!1,y=[];for(let _=0,w=d.length;_<w;_++)h[_]=[];for(let _=0,w=d.length;_<w;_++){let b=p[_];for(let S=0;S<b.length;S++){let M=b[S],T=!0;for(let E=0;E<d.length;E++)i(M.p,d[E].p)&&(_!==E&&y.push({froms:_,tos:E,hole:S}),T?(T=!1,h[E].push(M)):g=!0);T&&h[_].push(M)}}y.length>0&&(g||(p=h))}let x;for(let g=0,y=d.length;g<y;g++){c=d[g].s,u.push(c),x=p[g];for(let _=0,w=x.length;_<w;_++)c.holes.push(x[_].h)}return u}},xh=class{constructor(e){this.type="Font",this.data=e}generateShapes(e,t=100){let n=[],i=ZE(e,t,this.data);for(let r=0,s=i.length;r<s;r++)Array.prototype.push.apply(n,i[r].toShapes());return n}};function ZE(a,e,t){let n=Array.from(a),i=e/t.resolution,r=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*i,s=[],o=0,l=0;for(let c=0;c<n.length;c++){let u=n[c];if(u===`
`)o=0,l-=r;else{let f=JE(u,i,o,l,t);o+=f.offsetX,s.push(f.path)}}return s}function JE(a,e,t,n,i){let r=i.glyphs[a]||i.glyphs["?"];if(!r){console.error('THREE.Font: character "'+a+'" does not exists in font family '+i.familyName+".");return}let s=new hi,o,l,c,u,f,h,d,p;if(r.o){let m=r._cachedOutline||(r._cachedOutline=r.o.split(" "));for(let v=0,x=m.length;v<x;)switch(m[v++]){case"m":o=m[v++]*e+t,l=m[v++]*e+n,s.moveTo(o,l);break;case"l":o=m[v++]*e+t,l=m[v++]*e+n,s.lineTo(o,l);break;case"q":c=m[v++]*e+t,u=m[v++]*e+n,f=m[v++]*e+t,h=m[v++]*e+n,s.quadraticCurveTo(f,h,c,u);break;case"b":c=m[v++]*e+t,u=m[v++]*e+n,f=m[v++]*e+t,h=m[v++]*e+n,d=m[v++]*e+t,p=m[v++]*e+n,s.bezierCurveTo(f,h,d,p,c,u);break}}return{offsetX:r.ha*e,path:s}}xh.prototype.isFont=!0;var kx=class extends vt{constructor(e){super(e)}load(e,t,n,i){let r=this,s=new Pt(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,function(o){let l;try{l=JSON.parse(o)}catch(u){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),l=JSON.parse(o.substring(65,o.length-2))}let c=r.parse(l);t&&t(c)},n,i)}parse(e){return new xh(e)}},vh,pd={getContext:function(){return vh===void 0&&(vh=new(window.AudioContext||window.webkitAudioContext)),vh},setContext:function(a){vh=a}},md=class extends vt{constructor(e){super(e)}load(e,t,n,i){let r=this,s=new Pt(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(o){try{let l=o.slice(0);pd.getContext().decodeAudioData(l,function(u){t(u)})}catch(l){i?i(l):console.error(l),r.manager.itemError(e)}},n,i)}},gd=class extends qo{constructor(e,t,n=1){super(void 0,n);let i=new ue().set(e),r=new ue().set(t),s=new L(i.r,i.g,i.b),o=new L(r.r,r.g,r.b),l=Math.sqrt(Math.PI),c=l*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(o).multiplyScalar(l),this.sh.coefficients[1].copy(s).sub(o).multiplyScalar(c)}};gd.prototype.isHemisphereLightProbe=!0;var xd=class extends qo{constructor(e,t=1){super(void 0,t);let n=new ue().set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}};xd.prototype.isAmbientLightProbe=!0;var zx=new fe,Ux=new fe,Vx=class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new it,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new it,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){let t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;let i=e.projectionMatrix.clone(),r=t.eyeSep/2,s=r*t.near/t.focus,o=t.near*Math.tan(xs*t.fov*.5)/t.zoom,l,c;Ux.elements[12]=-r,zx.elements[12]=r,l=-o*t.aspect+s,c=o*t.aspect+s,i.elements[0]=2*t.near/(c-l),i.elements[8]=(c+l)/(c-l),this.cameraL.projectionMatrix.copy(i),l=-o*t.aspect-s,c=o*t.aspect-s,i.elements[0]=2*t.near/(c-l),i.elements[8]=(c+l)/(c-l),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Ux),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(zx)}},zr=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Hx(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=Hx();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};function Hx(){return(typeof performance=="undefined"?Date:performance).now()}var Es=new L,Gx=new Ve,$E=new L,As=new L,Wx=class extends Re{constructor(){super();this.type="AudioListener",this.context=pd.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new zr}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);let t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Es,Gx,$E),As.set(0,0,-1).applyQuaternion(Gx),t.positionX){let i=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Es.x,i),t.positionY.linearRampToValueAtTime(Es.y,i),t.positionZ.linearRampToValueAtTime(Es.z,i),t.forwardX.linearRampToValueAtTime(As.x,i),t.forwardY.linearRampToValueAtTime(As.y,i),t.forwardZ.linearRampToValueAtTime(As.z,i),t.upX.linearRampToValueAtTime(n.x,i),t.upY.linearRampToValueAtTime(n.y,i),t.upZ.linearRampToValueAtTime(n.z,i)}else t.setPosition(Es.x,Es.y,Es.z),t.setOrientation(As.x,As.y,As.z,n.x,n.y,n.z)}},yh=class extends Re{constructor(e){super();this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;let t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}},Ps=new L,Xx=new Ve,QE=new L,Cs=new L,jx=class extends yh{constructor(e){super(e);this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Ps,Xx,QE),Cs.set(0,0,1).applyQuaternion(Xx);let t=this.panner;if(t.positionX){let n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Ps.x,n),t.positionY.linearRampToValueAtTime(Ps.y,n),t.positionZ.linearRampToValueAtTime(Ps.z,n),t.orientationX.linearRampToValueAtTime(Cs.x,n),t.orientationY.linearRampToValueAtTime(Cs.y,n),t.orientationZ.linearRampToValueAtTime(Cs.z,n)}else t.setPosition(Ps.x,Ps.y,Ps.z),t.setOrientation(Cs.x,Cs.y,Cs.z)}},vd=class{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0,t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}},yd=class{constructor(e,t,n){this.binding=e,this.valueSize=n;let i,r,s;switch(t){case"quaternion":i=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:i=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){let n=this.buffer,i=this.valueSize,r=e*i+i,s=this.cumulativeWeight;if(s===0){for(let o=0;o!==i;++o)n[r+o]=n[o];s=t}else{s+=t;let o=t/s;this._mixBufferRegion(n,r,0,o,i)}this.cumulativeWeight=s}accumulateAdditive(e){let t=this.buffer,n=this.valueSize,i=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){let t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){let l=t*this._origIndex;this._mixBufferRegion(n,i,l,1-r,t)}s>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let l=t,c=t+t;l!==c;++l)if(n[l]!==n[l+t]){o.setValue(n,i);break}}saveOriginalState(){let e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let r=n,s=i;r!==s;++r)t[r]=t[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,r){if(i>=.5)for(let s=0;s!==r;++s)e[t+s]=e[n+s]}_slerp(e,t,n,i){Ve.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,r){let s=this._workIndex*r;Ve.multiplyQuaternionsFlat(e,s,e,t,e,n),Ve.slerpFlat(e,t,e,t,e,s,i)}_lerp(e,t,n,i,r){let s=1-i;for(let o=0;o!==r;++o){let l=t+o;e[l]=e[l]*s+e[n+o]*i}}_lerpAdditive(e,t,n,i,r){for(let s=0;s!==r;++s){let o=t+s;e[o]=e[o]+e[n+s]*i}}},wd="\\[\\]\\.:\\/",KE=new RegExp("["+wd+"]","g"),_d="[^"+wd+"]",eA="[^"+wd.replace("\\.","")+"]",tA=/((?:WC+[\/:])*)/.source.replace("WC",_d),nA=/(WCOD+)?/.source.replace("WCOD",eA),iA=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_d),rA=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_d),sA=new RegExp("^"+tA+nA+iA+rA+"$"),oA=["material","materials","bones"],qx=class{constructor(e,t,n){let i=n||Oe.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();let n=this._targetGroup.nCachedObjects_,i=this._bindings[n];i!==void 0&&i.getValue(e,t)}setValue(e,t){let n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},Oe=class{constructor(e,t,n){this.path=t,this.parsedPath=n||Oe.parseTrackName(t),this.node=Oe.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Oe.Composite(e,t,n):new Oe(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(KE,"")}static parseTrackName(e){let t=sA.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);let n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){let r=n.nodeName.substring(i+1);oA.indexOf(r)!==-1&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=r)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(!t||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){let n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){let n=function(r){for(let s=0;s<r.length;s++){let o=r[s];if(o.name===t||o.uuid===t)return o;let l=n(o.children);if(l)return l}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.node[this.propertyName]}_getValue_array(e,t){let n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){let n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){let n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){let n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node,t=this.parsedPath,n=t.objectName,i=t.propertyName,r=t.propertyIndex;if(e||(e=Oe.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(n){let c=t.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===c){c=u;break}break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}let s=e[i];if(s===void 0){let c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+i+" but it wasn't found.",e);return}let o=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?o=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(r!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}l=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else s.fromArray!==void 0&&s.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(l=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};Oe.Composite=qx;Oe.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Oe.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Oe.prototype.GetterByBindingType=[Oe.prototype._getValue_direct,Oe.prototype._getValue_array,Oe.prototype._getValue_arrayElement,Oe.prototype._getValue_toArray];Oe.prototype.SetterByBindingTypeAndVersioning=[[Oe.prototype._setValue_direct,Oe.prototype._setValue_direct_setNeedsUpdate,Oe.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Oe.prototype._setValue_array,Oe.prototype._setValue_array_setNeedsUpdate,Oe.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Oe.prototype._setValue_arrayElement,Oe.prototype._setValue_arrayElement_setNeedsUpdate,Oe.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Oe.prototype._setValue_fromArray,Oe.prototype._setValue_fromArray_setNeedsUpdate,Oe.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var bd=class{constructor(){this.uuid=Tn(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;let e={};this._indicesByUUID=e;for(let n=0,i=arguments.length;n!==i;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};let t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){let e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,s=r.length,o,l=e.length,c=this.nCachedObjects_;for(let u=0,f=arguments.length;u!==f;++u){let h=arguments[u],d=h.uuid,p=t[d];if(p===void 0){p=l++,t[d]=p,e.push(h);for(let m=0,v=s;m!==v;++m)r[m].push(new Oe(h,n[m],i[m]))}else if(p<c){o=e[p];let m=--c,v=e[m];t[v.uuid]=p,e[p]=v,t[d]=m,e[m]=h;for(let x=0,g=s;x!==g;++x){let y=r[x],_=y[m],w=y[p];y[p]=_,w===void 0&&(w=new Oe(h,n[x],i[x])),y[m]=w}}else e[p]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){let e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length,r=this.nCachedObjects_;for(let s=0,o=arguments.length;s!==o;++s){let l=arguments[s],c=l.uuid,u=t[c];if(u!==void 0&&u>=r){let f=r++,h=e[f];t[h.uuid]=u,e[u]=h,t[c]=f,e[f]=l;for(let d=0,p=i;d!==p;++d){let m=n[d],v=m[f],x=m[u];m[u]=v,m[f]=x}}}this.nCachedObjects_=r}uncache(){let e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length,r=this.nCachedObjects_,s=e.length;for(let o=0,l=arguments.length;o!==l;++o){let c=arguments[o],u=c.uuid,f=t[u];if(f!==void 0)if(delete t[u],f<r){let h=--r,d=e[h],p=--s,m=e[p];t[d.uuid]=f,e[f]=d,t[m.uuid]=h,e[h]=m,e.pop();for(let v=0,x=i;v!==x;++v){let g=n[v],y=g[h],_=g[p];g[f]=y,g[h]=_,g.pop()}}else{let h=--s,d=e[h];h>0&&(t[d.uuid]=f),e[f]=d,e.pop();for(let p=0,m=i;p!==m;++p){let v=n[p];v[f]=v[h],v.pop()}}}this.nCachedObjects_=r}subscribe_(e,t){let n=this._bindingsIndicesByPath,i=n[e],r=this._bindings;if(i!==void 0)return r[i];let s=this._paths,o=this._parsedPaths,l=this._objects,c=l.length,u=this.nCachedObjects_,f=new Array(c);i=r.length,n[e]=i,s.push(e),o.push(t),r.push(f);for(let h=u,d=l.length;h!==d;++h){let p=l[h];f[h]=new Oe(p,e,t)}return f}unsubscribe_(e){let t=this._bindingsIndicesByPath,n=t[e];if(n!==void 0){let i=this._paths,r=this._parsedPaths,s=this._bindings,o=s.length-1,l=s[o],c=e[o];t[c]=n,s[n]=l,s.pop(),r[n]=r[o],r.pop(),i[n]=i[o],i.pop()}}};bd.prototype.isAnimationObjectGroup=!0;var Yx=class{constructor(e,t,n=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;let r=t.tracks,s=r.length,o=new Array(s),l={endingStart:ms,endingEnd:ms};for(let c=0;c!==s;++c){let u=r[c].createInterpolant(null);o[c]=u,u.settings=l}this._interpolantSettings=l,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=l0,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){let i=this._clip.duration,r=e._clip.duration,s=r/i,o=i/r;e.warp(1,s,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){let e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){let i=this._mixer,r=i.time,s=this.timeScale,o=this._timeScaleInterpolant;o===null&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);let l=o.parameterPositions,c=o.sampleValues;return l[0]=r,l[1]=r+n,c[0]=e/s,c[1]=t/s,this}stopWarping(){let e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled){this._updateWeight(e);return}let r=this._startTime;if(r!==null){let l=(e-r)*n;if(l<0||n===0)return;this._startTime=null,t=n*l}t*=this._updateTimeScale(e);let s=this._updateTime(t),o=this._updateWeight(e);if(o>0){let l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case Ju:for(let u=0,f=l.length;u!==f;++u)l[u].evaluate(s),c[u].accumulateAdditive(o);break;case ac:default:for(let u=0,f=l.length;u!==f;++u)l[u].evaluate(s),c[u].accumulate(i,o)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;let n=this._weightInterpolant;if(n!==null){let i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;let n=this._timeScaleInterpolant;n!==null&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){let t=this._clip.duration,n=this.loop,i=this.time+e,r=this._loopCount,s=n===c0;if(e===0)return r===-1?i:s&&(r&1)==1?t-i:i;if(n===a0){r===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else if(i<0)i=0;else{this.time=i;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(r===-1&&(e>=0?(r=0,this._setEndings(!0,this.repetitions===0,s)):this._setEndings(this.repetitions===0,!0,s)),i>=t||i<0){let o=Math.floor(i/t);i-=t*o,r+=Math.abs(o);let l=this.repetitions-r;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){let c=e<0;this._setEndings(c,!c,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=i;if(s&&(r&1)==1)return t-i}return i}_setEndings(e,t,n){let i=this._interpolantSettings;n?(i.endingStart=gs,i.endingEnd=gs):(e?i.endingStart=this.zeroSlopeAtStart?gs:ms:i.endingStart=ka,t?i.endingEnd=this.zeroSlopeAtEnd?gs:ms:i.endingEnd=ka)}_scheduleFading(e,t,n){let i=this._mixer,r=i.time,s=this._weightInterpolant;s===null&&(s=i._lendControlInterpolant(),this._weightInterpolant=s);let o=s.parameterPositions,l=s.sampleValues;return o[0]=r,l[0]=t,o[1]=r+e,l[1]=n,this}},pl=class extends Sn{constructor(e){super();this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){let n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,s=e._propertyBindings,o=e._interpolants,l=n.uuid,c=this._bindingsByRootAndName,u=c[l];u===void 0&&(u={},c[l]=u);for(let f=0;f!==r;++f){let h=i[f],d=h.name,p=u[d];if(p!==void 0)s[f]=p;else{if(p=s[f],p!==void 0){p._cacheIndex===null&&(++p.referenceCount,this._addInactiveBinding(p,l,d));continue}let m=t&&t._propertyBindings[f].binding.parsedPath;p=new yd(Oe.create(n,d,m),h.ValueTypeName,h.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,l,d),s[f]=p}o[f].resultBuffer=p.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){let n=(e._localRoot||this._root).uuid,i=e._clip.uuid,r=this._actionsByClip[i];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,i,n)}let t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){let r=t[n];r.useCount++==0&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){let r=t[n];--r.useCount==0&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,n){let i=this._actions,r=this._actionsByClip,s=r[t];if(s===void 0)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=s;else{let o=s.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=i.length,i.push(e),s.actionByRoot[n]=e}_removeInactiveAction(e){let t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;let r=e._clip.uuid,s=this._actionsByClip,o=s[r],l=o.knownActions,c=l[l.length-1],u=e._byClipCacheIndex;c._byClipCacheIndex=u,l[u]=c,l.pop(),e._byClipCacheIndex=null;let f=o.actionByRoot,h=(e._localRoot||this._root).uuid;delete f[h],l.length===0&&delete s[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){let r=t[n];--r.referenceCount==0&&this._removeInactiveBinding(r)}}_lendAction(e){let t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackAction(e){let t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_addInactiveBinding(e,t,n){let i=this._bindingsByRootAndName,r=this._bindings,s=i[t];s===void 0&&(s={},i[t]=s),s[n]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){let t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,s=this._bindingsByRootAndName,o=s[i],l=t[t.length-1],c=e._cacheIndex;l._cacheIndex=c,t[c]=l,t.pop(),delete o[r],Object.keys(o).length===0&&delete s[i]}_lendBinding(e){let t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackBinding(e){let t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_lendControlInterpolant(){let e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return n===void 0&&(n=new ch(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){let t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r}clipAction(e,t,n){let i=t||this._root,r=i.uuid,s=typeof e=="string"?Si.findByName(i,e):e,o=s!==null?s.uuid:e,l=this._actionsByClip[o],c=null;if(n===void 0&&(s!==null?n=s.blendMode:n=ac),l!==void 0){let f=l.actionByRoot[r];if(f!==void 0&&f.blendMode===n)return f;c=l.knownActions[0],s===null&&(s=c._clip)}if(s===null)return null;let u=new Yx(this,s,t,n);return this._bindAction(u,c),this._addInactiveAction(u,o,r),u}existingAction(e,t){let n=t||this._root,i=n.uuid,r=typeof e=="string"?Si.findByName(n,e):e,s=r?r.uuid:e,o=this._actionsByClip[s];return o!==void 0&&o.actionByRoot[i]||null}stopAllAction(){let e=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;let t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),s=this._accuIndex^=1;for(let c=0;c!==n;++c)t[c]._update(i,e,r,s);let o=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)o[c].apply(s);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(r!==void 0){let s=r.knownActions;for(let o=0,l=s.length;o!==l;++o){let c=s[o];this._deactivateAction(c);let u=c._cacheIndex,f=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,f._cacheIndex=u,t[u]=f,t.pop(),this._removeInactiveBindingsForAction(c)}delete i[n]}}uncacheRoot(e){let t=e.uuid,n=this._actionsByClip;for(let s in n){let o=n[s].actionByRoot,l=o[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}let i=this._bindingsByRootAndName,r=i[t];if(r!==void 0)for(let s in r){let o=r[s];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(e,t){let n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}};pl.prototype._controlInterpolantsResultBuffer=new Float32Array(1);var ml=class{constructor(e){typeof e=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new ml(this.value.clone===void 0?this.value:this.value.clone())}},Md=class extends gi{constructor(e,t,n=1){super(e,t);this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){let t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){let t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}};Md.prototype.isInstancedInterleavedBuffer=!0;var Sd=class{constructor(e,t,n,i,r){this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=i,this.count=r,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}};Sd.prototype.isGLBufferAttribute=!0;var Yo=class{constructor(e,t,n=0,i=1/0){this.ray=new ji(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new vc,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!1,n=[]){return Td(e,this,n,t),n.sort(Zx),n}intersectObjects(e,t=!1,n=[]){for(let i=0,r=e.length;i<r;i++)Td(e[i],this,n,t);return n.sort(Zx),n}};function Zx(a,e){return a.distance-e.distance}function Td(a,e,t,n){if(a.layers.test(e.layers)&&a.raycast(e,t),n===!0){let i=a.children;for(let r=0,s=i.length;r<s;r++)Td(i[r],e,t,!0)}}var gl=class{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){let e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Yt(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}},Jx=class{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return new this.constructor().copy(this)}},$x=new J,er=class{constructor(e=new J(1/0,1/0),t=new J(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let n=$x.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return $x.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};er.prototype.isBox2=!0;var Qx=new L,wh=new L,Ls=class{constructor(e=new L,t=new L){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Qx.subVectors(e,this.start),wh.subVectors(this.end,this.start);let n=wh.dot(wh),r=wh.dot(Qx)/n;return t&&(r=Yt(r,0,1)),r}closestPointToPoint(e,t,n){let i=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}},xl=class extends Re{constructor(e){super();this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}};xl.prototype.isImmediateRenderObject=!0;var Kx=new L,_h=class extends Re{constructor(e,t){super();this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;let n=new ye,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let s=0,o=1,l=32;s<l;s++,o++){let c=s/l*Math.PI*2,u=o/l*Math.PI*2;i.push(Math.cos(c),Math.sin(c),1,Math.cos(u),Math.sin(u),1)}n.setAttribute("position",new pe(i,3));let r=new rt({fog:!1,toneMapped:!1});this.cone=new Ot(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();let e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Kx.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Kx),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},Ur=new L,bh=new fe,Ed=new fe,Ad=class extends Ot{constructor(e){let t=ev(e),n=new ye,i=[],r=[],s=new ue(0,0,1),o=new ue(0,1,0);for(let c=0;c<t.length;c++){let u=t[c];u.parent&&u.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(s.r,s.g,s.b),r.push(o.r,o.g,o.b))}n.setAttribute("position",new pe(i,3)),n.setAttribute("color",new pe(r,3));let l=new rt({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,l);this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){let t=this.bones,n=this.geometry,i=n.getAttribute("position");Ed.copy(this.root.matrixWorld).invert();for(let r=0,s=0;r<t.length;r++){let o=t[r];o.parent&&o.parent.isBone&&(bh.multiplyMatrices(Ed,o.matrixWorld),Ur.setFromMatrixPosition(bh),i.setXYZ(s,Ur.x,Ur.y,Ur.z),bh.multiplyMatrices(Ed,o.parent.matrixWorld),Ur.setFromMatrixPosition(bh),i.setXYZ(s+1,Ur.x,Ur.y,Ur.z),s+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}};function ev(a){let e=[];a&&a.isBone&&e.push(a);for(let t=0;t<a.children.length;t++)e.push.apply(e,ev(a.children[t]));return e}var tv=class extends Ce{constructor(e,t,n){let i=new hn(t,4,2),r=new ct({wireframe:!0,fog:!1,toneMapped:!1});super(i,r);this.light=e,this.light.updateMatrixWorld(),this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},aA=new L,nv=new ue,iv=new ue,rv=class extends Re{constructor(e,t,n){super();this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;let i=new Ms(t);i.rotateY(Math.PI*.5),this.material=new ct({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);let r=i.getAttribute("position"),s=new Float32Array(r.count*3);i.setAttribute("color",new Se(s,3)),this.add(new Ce(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){let e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{let t=e.geometry.getAttribute("color");nv.copy(this.light.color),iv.copy(this.light.groundColor);for(let n=0,i=t.count;n<i;n++){let r=n<i/2?nv:iv;t.setXYZ(n,r.r,r.g,r.b)}t.needsUpdate=!0}e.lookAt(aA.setFromMatrixPosition(this.light.matrixWorld).negate())}},Pd=class extends Ot{constructor(e=10,t=10,n=4473924,i=8947848){n=new ue(n),i=new ue(i);let r=t/2,s=e/t,o=e/2,l=[],c=[];for(let h=0,d=0,p=-o;h<=t;h++,p+=s){l.push(-o,0,p,o,0,p),l.push(p,0,-o,p,0,o);let m=h===r?n:i;m.toArray(c,d),d+=3,m.toArray(c,d),d+=3,m.toArray(c,d),d+=3,m.toArray(c,d),d+=3}let u=new ye;u.setAttribute("position",new pe(l,3)),u.setAttribute("color",new pe(c,3));let f=new rt({vertexColors:!0,toneMapped:!1});super(u,f);this.type="GridHelper"}},sv=class extends Ot{constructor(e=10,t=16,n=8,i=64,r=4473924,s=8947848){r=new ue(r),s=new ue(s);let o=[],l=[];for(let f=0;f<=t;f++){let h=f/t*(Math.PI*2),d=Math.sin(h)*e,p=Math.cos(h)*e;o.push(0,0,0),o.push(d,0,p);let m=f&1?r:s;l.push(m.r,m.g,m.b),l.push(m.r,m.g,m.b)}for(let f=0;f<=n;f++){let h=f&1?r:s,d=e-e/n*f;for(let p=0;p<i;p++){let m=p/i*(Math.PI*2),v=Math.sin(m)*d,x=Math.cos(m)*d;o.push(v,0,x),l.push(h.r,h.g,h.b),m=(p+1)/i*(Math.PI*2),v=Math.sin(m)*d,x=Math.cos(m)*d,o.push(v,0,x),l.push(h.r,h.g,h.b)}}let c=new ye;c.setAttribute("position",new pe(o,3)),c.setAttribute("color",new pe(l,3));let u=new rt({vertexColors:!0,toneMapped:!1});super(c,u);this.type="PolarGridHelper"}},ov=new L,Mh=new L,av=new L,Sh=class extends Re{constructor(e,t,n){super();this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,t===void 0&&(t=1);let i=new ye;i.setAttribute("position",new pe([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));let r=new rt({fog:!1,toneMapped:!1});this.lightPlane=new Gt(i,r),this.add(this.lightPlane),i=new ye,i.setAttribute("position",new pe([0,0,0,0,0,1],3)),this.targetLine=new Gt(i,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){ov.setFromMatrixPosition(this.light.matrixWorld),Mh.setFromMatrixPosition(this.light.target.matrixWorld),av.subVectors(Mh,ov),this.lightPlane.lookAt(Mh),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Mh),this.targetLine.scale.z=av.length()}},Th=new L,Et=new wo,lv=class extends Ot{constructor(e){let t=new ye,n=new rt({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],s={},o=new ue(16755200),l=new ue(16711680),c=new ue(43775),u=new ue(16777215),f=new ue(3355443);h("n1","n2",o),h("n2","n4",o),h("n4","n3",o),h("n3","n1",o),h("f1","f2",o),h("f2","f4",o),h("f4","f3",o),h("f3","f1",o),h("n1","f1",o),h("n2","f2",o),h("n3","f3",o),h("n4","f4",o),h("p","n1",l),h("p","n2",l),h("p","n3",l),h("p","n4",l),h("u1","u2",c),h("u2","u3",c),h("u3","u1",c),h("c","t",u),h("p","c",f),h("cn1","cn2",f),h("cn3","cn4",f),h("cf1","cf2",f),h("cf3","cf4",f);function h(p,m,v){d(p,v),d(m,v)}function d(p,m){i.push(0,0,0),r.push(m.r,m.g,m.b),s[p]===void 0&&(s[p]=[]),s[p].push(i.length/3-1)}t.setAttribute("position",new pe(i,3)),t.setAttribute("color",new pe(r,3));super(t,n);this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){let e=this.geometry,t=this.pointMap,n=1,i=1;Et.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Ct("c",t,e,Et,0,0,-1),Ct("t",t,e,Et,0,0,1),Ct("n1",t,e,Et,-n,-i,-1),Ct("n2",t,e,Et,n,-i,-1),Ct("n3",t,e,Et,-n,i,-1),Ct("n4",t,e,Et,n,i,-1),Ct("f1",t,e,Et,-n,-i,1),Ct("f2",t,e,Et,n,-i,1),Ct("f3",t,e,Et,-n,i,1),Ct("f4",t,e,Et,n,i,1),Ct("u1",t,e,Et,n*.7,i*1.1,-1),Ct("u2",t,e,Et,-n*.7,i*1.1,-1),Ct("u3",t,e,Et,0,i*2,-1),Ct("cf1",t,e,Et,-n,0,1),Ct("cf2",t,e,Et,n,0,1),Ct("cf3",t,e,Et,0,-i,1),Ct("cf4",t,e,Et,0,i,1),Ct("cn1",t,e,Et,-n,0,-1),Ct("cn2",t,e,Et,n,0,-1),Ct("cn3",t,e,Et,0,-i,-1),Ct("cn4",t,e,Et,0,i,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function Ct(a,e,t,n,i,r,s){Th.set(i,r,s).unproject(n);let o=e[a];if(o!==void 0){let l=t.getAttribute("position");for(let c=0,u=o.length;c<u;c++)l.setXYZ(o[c],Th.x,Th.y,Th.z)}}var Eh=new Dt,Cd=class extends Ot{constructor(e,t=16776960){let n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(8*3),r=new ye;r.setIndex(new Se(n,1)),r.setAttribute("position",new Se(i,3));super(r,new rt({color:t,toneMapped:!1}));this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Eh.setFromObject(this.object),Eh.isEmpty())return;let t=Eh.min,n=Eh.max,i=this.geometry.attributes.position,r=i.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=t.x,r[4]=n.y,r[5]=n.z,r[6]=t.x,r[7]=t.y,r[8]=n.z,r[9]=n.x,r[10]=t.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=t.z,r[15]=t.x,r[16]=n.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=n.x,r[22]=t.y,r[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e){return Ot.prototype.copy.call(this,e),this.object=e.object,this}},cv=class extends Ot{constructor(e,t=16776960){let n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],r=new ye;r.setIndex(new Se(n,1)),r.setAttribute("position",new pe(i,3));super(r,new rt({color:t,toneMapped:!1}));this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){let t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}},hv=class extends Gt{constructor(e,t=1,n=16776960){let i=n,r=[1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],s=new ye;s.setAttribute("position",new pe(r,3)),s.computeBoundingSphere();super(s,new rt({color:i,toneMapped:!1}));this.type="PlaneHelper",this.plane=e,this.size=t;let o=[1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],l=new ye;l.setAttribute("position",new pe(o,3)),l.computeBoundingSphere(),this.add(new Ce(l,new ct({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){let t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?gt:zi,this.lookAt(this.plane.normal),super.updateMatrixWorld(e)}},uv=new L,Ah,Ld,fv=class extends Re{constructor(e=new L(0,0,1),t=new L(0,0,0),n=1,i=16776960,r=n*.2,s=r*.2){super();this.type="ArrowHelper",Ah===void 0&&(Ah=new ye,Ah.setAttribute("position",new pe([0,0,0,0,1,0],3)),Ld=new yi(0,.5,1,5,1),Ld.translate(0,-.5,0)),this.position.copy(t),this.line=new Gt(Ah,new rt({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ce(Ld,new ct({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,r,s)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{uv.set(e.z,0,-e.x).normalize();let t=Math.acos(e.y);this.quaternion.setFromAxisAngle(uv,t)}}setLength(e,t=e*.2,n=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}},Rd=class extends Ot{constructor(e=1){let t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],i=new ye;i.setAttribute("position",new pe(t,3)),i.setAttribute("color",new pe(n,3));let r=new rt({vertexColors:!0,toneMapped:!1});super(i,r);this.type="AxesHelper"}setColors(e,t,n){let i=new ue,r=this.geometry.attributes.color.array;return i.set(e),i.toArray(r,0),i.toArray(r,3),i.set(t),i.toArray(r,6),i.toArray(r,9),i.set(n),i.toArray(r,12),i.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},dv=new Float32Array(1),lA=new Int32Array(dv.buffer),pv=class{static toHalfFloat(e){dv[0]=e;let t=lA[0],n=t>>16&32768,i=t>>12&2047,r=t>>23&255;return r<103?n:r>142?(n|=31744,n|=(r==255?0:1)&&t&8388607,n):r<113?(i|=2048,n|=(i>>114-r)+(i>>113-r&1),n):(n|=r-112<<10|i>>1,n+=i&1,n)}},Zo=4,Vr=8,Pi=Math.pow(2,Vr),mv=[.125,.215,.35,.446,.526,.582],gv=Vr-Zo+1+mv.length,Jo=20,Ci={[jt]:0,[xn]:1,[Qu]:2,[Ku]:3,[ef]:4,[tf]:5,[cc]:6},Rs=new ct({side:gt,depthWrite:!1,depthTest:!1}),cA=new Ce(new ni,Rs),Id=new sn,{_lodPlanes:vl,_sizeLods:xv,_sigmas:Ph}=uA(),vv=new ue,Dd=null,Is=(1+Math.sqrt(5))/2,$o=1/Is,yv=[new L(1,1,1),new L(-1,1,1),new L(1,1,-1),new L(-1,1,-1),new L(0,Is,$o),new L(0,Is,-$o),new L($o,0,Is),new L(-$o,0,Is),new L(Is,$o,0),new L(-Is,$o,0)];function wv(a){let e=Math.max(a.r,a.g,a.b),t=Math.min(Math.max(Math.ceil(Math.log2(e)),-128),127);return a.multiplyScalar(Math.pow(2,-t)),(t+128)/255}var _v=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=fA(Jo),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100){Dd=this._renderer.getRenderTarget();let r=this._allocateTargets();return this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){this._cubemapShader===null&&(this._cubemapShader=Sv(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){this._equirectShader===null&&(this._equirectShader=Mv(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),this._cubemapShader!==null&&this._cubemapShader.dispose(),this._equirectShader!==null&&this._equirectShader.dispose();for(let e=0;e<vl.length;e++)vl[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Dd),e.scissorTest=!1,Ch(e,0,0,e.width,e.height)}_fromTexture(e){Dd=this._renderer.getRenderTarget();let t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){let t={magFilter:Mt,minFilter:Mt,generateMipmaps:!1,type:us,format:Sg,encoding:hA(e)?e.encoding:xn,depthBuffer:!1},n=bv(t);return n.depthBuffer=!e,this._pingPongRenderTarget=bv(t),n}_compileMaterial(e){let t=new Ce(vl[0],e);this._renderer.compile(t,Id)}_sceneToCubeUV(e,t,n,i){let r=90,s=1,o=new it(r,s,t,n),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],u=this._renderer,f=u.autoClear,h=u.outputEncoding,d=u.toneMapping;u.getClearColor(vv),u.toneMapping=vr,u.outputEncoding=jt,u.autoClear=!1;let p=!1,m=e.background;if(m){if(m.isColor){Rs.color.copy(m).convertSRGBToLinear(),e.background=null;let v=wv(Rs.color);Rs.opacity=v,p=!0}}else{Rs.color.copy(vv).convertSRGBToLinear();let v=wv(Rs.color);Rs.opacity=v,p=!0}for(let v=0;v<6;v++){let x=v%3;x==0?(o.up.set(0,l[v],0),o.lookAt(c[v],0,0)):x==1?(o.up.set(0,0,l[v]),o.lookAt(0,c[v],0)):(o.up.set(0,l[v],0),o.lookAt(0,0,c[v])),Ch(i,x*Pi,v>2?Pi:0,Pi,Pi),u.setRenderTarget(i),p&&u.render(cA,o),u.render(e,o)}u.toneMapping=d,u.outputEncoding=h,u.autoClear=f}_textureToCubeUV(e,t){let n=this._renderer;e.isCubeTexture?this._cubemapShader==null&&(this._cubemapShader=Sv()):this._equirectShader==null&&(this._equirectShader=Mv());let i=e.isCubeTexture?this._cubemapShader:this._equirectShader,r=new Ce(vl[0],i),s=i.uniforms;s.envMap.value=e,e.isCubeTexture||s.texelSize.value.set(1/e.image.width,1/e.image.height),s.inputEncoding.value=Ci[e.encoding],s.outputEncoding.value=Ci[t.texture.encoding],Ch(t,0,0,3*Pi,2*Pi),n.setRenderTarget(t),n.render(r,Id)}_applyPMREM(e){let t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let i=1;i<gv;i++){let r=Math.sqrt(Ph[i]*Ph[i]-Ph[i-1]*Ph[i-1]),s=yv[(i-1)%yv.length];this._blur(e,i-1,i,r,s)}t.autoClear=n}_blur(e,t,n,i,r){let s=this._pingPongRenderTarget;this._halfBlur(e,s,t,n,i,"latitudinal",r),this._halfBlur(s,e,n,n,i,"longitudinal",r)}_halfBlur(e,t,n,i,r,s,o){let l=this._renderer,c=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let u=3,f=new Ce(vl[i],c),h=c.uniforms,d=xv[n]-1,p=isFinite(r)?Math.PI/(2*d):2*Math.PI/(2*Jo-1),m=r/p,v=isFinite(r)?1+Math.floor(u*m):Jo;v>Jo&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${Jo}`);let x=[],g=0;for(let b=0;b<Jo;++b){let S=b/m,M=Math.exp(-S*S/2);x.push(M),b==0?g+=M:b<v&&(g+=2*M)}for(let b=0;b<x.length;b++)x[b]=x[b]/g;h.envMap.value=e.texture,h.samples.value=v,h.weights.value=x,h.latitudinal.value=s==="latitudinal",o&&(h.poleAxis.value=o),h.dTheta.value=p,h.mipInt.value=Vr-n,h.inputEncoding.value=Ci[e.texture.encoding],h.outputEncoding.value=Ci[e.texture.encoding];let y=xv[i],_=3*Math.max(0,Pi-2*y),w=(i===0?0:2*Pi)+2*y*(i>Vr-Zo?i-Vr+Zo:0);Ch(t,_,w,3*y,2*y),l.setRenderTarget(t),l.render(f,Id)}};function hA(a){return a===void 0||a.type!==us?!1:a.encoding===jt||a.encoding===xn||a.encoding===cc}function uA(){let a=[],e=[],t=[],n=Vr;for(let i=0;i<gv;i++){let r=Math.pow(2,n);e.push(r);let s=1/r;i>Vr-Zo?s=mv[i-Vr+Zo-1]:i==0&&(s=0),t.push(s);let o=1/(r-1),l=-o/2,c=1+o/2,u=[l,l,c,l,c,c,l,l,c,c,l,c],f=6,h=6,d=3,p=2,m=1,v=new Float32Array(d*h*f),x=new Float32Array(p*h*f),g=new Float32Array(m*h*f);for(let _=0;_<f;_++){let w=_%3*2/3-1,b=_>2?0:-1,S=[w,b,0,w+2/3,b,0,w+2/3,b+1,0,w,b,0,w+2/3,b+1,0,w,b+1,0];v.set(S,d*h*_),x.set(u,p*h*_);let M=[_,_,_,_,_,_];g.set(M,m*h*_)}let y=new ye;y.setAttribute("position",new Se(v,d)),y.setAttribute("uv",new Se(x,p)),y.setAttribute("faceIndex",new Se(g,m)),a.push(y),n>Zo&&n--}return{_lodPlanes:a,_sizeLods:e,_sigmas:t}}function bv(a){let e=new Zt(3*Pi,3*Pi,a);return e.texture.mapping=to,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function Ch(a,e,t,n,i){a.viewport.set(e,t,n,i),a.scissor.set(e,t,n,i)}function fA(a){let e=new Float32Array(a),t=new L(0,1,0);return new Ts({name:"SphericalGaussianBlur",defines:{n:a},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:t},inputEncoding:{value:Ci[jt]},outputEncoding:{value:Ci[jt]}},vertexShader:Fd(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			${Bd()}

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:Ui,depthTest:!1,depthWrite:!1})}function Mv(){let a=new J(1,1);return new Ts({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:a},inputEncoding:{value:Ci[jt]},outputEncoding:{value:Ci[jt]}},vertexShader:Fd(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform vec2 texelSize;

			${Bd()}

			#include <common>

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				vec2 f = fract( uv / texelSize - 0.5 );
				uv -= f * texelSize;
				vec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x += texelSize.x;
				vec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.y += texelSize.y;
				vec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x -= texelSize.x;
				vec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;

				vec3 tm = mix( tl, tr, f.x );
				vec3 bm = mix( bl, br, f.x );
				gl_FragColor.rgb = mix( tm, bm, f.y );

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:Ui,depthTest:!1,depthWrite:!1})}function Sv(){return new Ts({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:Ci[jt]},outputEncoding:{value:Ci[jt]}},vertexShader:Fd(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			${Bd()}

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;
				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:Ui,depthTest:!1,depthWrite:!1})}function Fd(){return`

		precision mediump float;
		precision mediump int;

		attribute vec3 position;
		attribute vec2 uv;
		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Bd(){return`

		uniform int inputEncoding;
		uniform int outputEncoding;

		#include <encodings_pars_fragment>

		vec4 inputTexelToLinear( vec4 value ) {

			if ( inputEncoding == 0 ) {

				return value;

			} else if ( inputEncoding == 1 ) {

				return sRGBToLinear( value );

			} else if ( inputEncoding == 2 ) {

				return RGBEToLinear( value );

			} else if ( inputEncoding == 3 ) {

				return RGBMToLinear( value, 7.0 );

			} else if ( inputEncoding == 4 ) {

				return RGBMToLinear( value, 16.0 );

			} else if ( inputEncoding == 5 ) {

				return RGBDToLinear( value, 256.0 );

			} else {

				return GammaToLinear( value, 2.2 );

			}

		}

		vec4 linearToOutputTexel( vec4 value ) {

			if ( outputEncoding == 0 ) {

				return value;

			} else if ( outputEncoding == 1 ) {

				return LinearTosRGB( value );

			} else if ( outputEncoding == 2 ) {

				return LinearToRGBE( value );

			} else if ( outputEncoding == 3 ) {

				return LinearToRGBM( value, 7.0 );

			} else if ( outputEncoding == 4 ) {

				return LinearToRGBM( value, 16.0 );

			} else if ( outputEncoding == 5 ) {

				return LinearToRGBD( value, 256.0 );

			} else {

				return LinearToGamma( value, 2.2 );

			}

		}

		vec4 envMapTexelToLinear( vec4 color ) {

			return inputTexelToLinear( color );

		}
	`}var dA=0,pA=1,Nd=0,mA=1,gA=2;function xA(a){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),a}function vA(a=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),a.isMultiMaterial=!0,a.materials=a,a.clone=function(){return a.slice()},a}function yA(a,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new vi(a,e)}function wA(a){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new nl(a)}function _A(a,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new vi(a,e)}function bA(a){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new On(a)}function MA(a){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new On(a)}function SA(a){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new On(a)}function TA(a,e,t){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new L(a,e,t)}function EA(a,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new Se(a,e).setUsage(oo)}function AA(a,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Mf(a,e)}function PA(a,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Sf(a,e)}function CA(a,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Tf(a,e)}function LA(a,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Ef(a,e)}function RA(a,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new ws(a,e)}function IA(a,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Af(a,e)}function DA(a,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Wa(a,e)}function FA(a,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new pe(a,e)}function BA(a,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Cf(a,e)}rn.create=function(a,e){return console.log("THREE.Curve.create() has been deprecated"),a.prototype=Object.create(rn.prototype),a.prototype.constructor=a,a.prototype.getPoint=e,a};Ti.prototype.fromPoints=function(a){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(a)};function NA(a){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Rd(a)}function OA(a,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Cd(a,e)}function kA(a,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Ot(new Yc(a.geometry),new rt({color:e!==void 0?e:16777215}))}Pd.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};Ad.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};function zA(a,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Ot(new sh(a.geometry),new rt({color:e!==void 0?e:16777215}))}vt.prototype.extractUrlBase=function(a){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),un.extractUrlBase(a)};vt.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};function UA(a){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Pt(a)}function VA(a){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new od(a)}er.prototype.center=function(a){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(a)};er.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()};er.prototype.isIntersectionBox=function(a){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(a)};er.prototype.size=function(a){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(a)};Dt.prototype.center=function(a){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(a)};Dt.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()};Dt.prototype.isIntersectionBox=function(a){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(a)};Dt.prototype.isIntersectionSphere=function(a){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(a)};Dt.prototype.size=function(a){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(a)};En.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()};So.prototype.setFromMatrix=function(a){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(a)};Ls.prototype.center=function(a){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(a)};Ye.prototype.flattenToArrayOffset=function(a,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(a,e)};Ye.prototype.multiplyVector3=function(a){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),a.applyMatrix3(this)};Ye.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")};Ye.prototype.applyToBufferAttribute=function(a){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),a.applyMatrix3(this)};Ye.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")};Ye.prototype.getInverse=function(a){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(a).invert()};fe.prototype.extractPosition=function(a){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(a)};fe.prototype.flattenToArrayOffset=function(a,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(a,e)};fe.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new L().setFromMatrixColumn(this,3)};fe.prototype.setRotationFromQuaternion=function(a){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(a)};fe.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")};fe.prototype.multiplyVector3=function(a){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),a.applyMatrix4(this)};fe.prototype.multiplyVector4=function(a){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),a.applyMatrix4(this)};fe.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")};fe.prototype.rotateAxis=function(a){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),a.transformDirection(this)};fe.prototype.crossVector=function(a){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),a.applyMatrix4(this)};fe.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")};fe.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")};fe.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")};fe.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")};fe.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")};fe.prototype.applyToBufferAttribute=function(a){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),a.applyMatrix4(this)};fe.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")};fe.prototype.makeFrustum=function(a,e,t,n,i,r){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(a,e,n,t,i,r)};fe.prototype.getInverse=function(a){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(a).invert()};Tt.prototype.isIntersectionLine=function(a){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(a)};Ve.prototype.multiplyVector3=function(a){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),a.applyQuaternion(this)};Ve.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()};ji.prototype.isIntersectionBox=function(a){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(a)};ji.prototype.isIntersectionPlane=function(a){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(a)};ji.prototype.isIntersectionSphere=function(a){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(a)};pt.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()};pt.prototype.barycoordFromPoint=function(a,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(a,e)};pt.prototype.midpoint=function(a){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(a)};pt.prototypenormal=function(a){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(a)};pt.prototype.plane=function(a){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(a)};pt.barycoordFromPoint=function(a,e,t,n,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),pt.getBarycoord(a,e,t,n,i)};pt.normal=function(a,e,t,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),pt.getNormal(a,e,t,n)};li.prototype.extractAllPoints=function(a){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(a)};li.prototype.extrude=function(a){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Ln(this,a)};li.prototype.makeGeometry=function(a){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Ss(this,a)};J.prototype.fromAttribute=function(a,e,t){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(a,e,t)};J.prototype.distanceToManhattan=function(a){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(a)};J.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};L.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")};L.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")};L.prototype.getPositionFromMatrix=function(a){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(a)};L.prototype.getScaleFromMatrix=function(a){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(a)};L.prototype.getColumnFromMatrix=function(a,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,a)};L.prototype.applyProjection=function(a){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(a)};L.prototype.fromAttribute=function(a,e,t){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(a,e,t)};L.prototype.distanceToManhattan=function(a){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(a)};L.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};De.prototype.fromAttribute=function(a,e,t){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(a,e,t)};De.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Re.prototype.getChildByName=function(a){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(a)};Re.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")};Re.prototype.translate=function(a,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,a)};Re.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")};Re.prototype.applyMatrix=function(a){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(a)};Object.defineProperties(Re.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(a){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=a}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});Ce.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")};Object.defineProperties(Ce.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),h0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});Ji.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};it.prototype.setLens=function(a,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),e!==void 0&&(this.filmGauge=e),this.setFocalLength(a)};Object.defineProperties(Vn.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(a){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=a}},shadowCameraLeft:{set:function(a){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=a}},shadowCameraRight:{set:function(a){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=a}},shadowCameraTop:{set:function(a){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=a}},shadowCameraBottom:{set:function(a){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=a}},shadowCameraNear:{set:function(a){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=a}},shadowCameraFar:{set:function(a){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=a}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(a){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=a}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(a){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=a}},shadowMapHeight:{set:function(a){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=a}}});Object.defineProperties(Se.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===oo},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(oo)}}});Se.prototype.setDynamic=function(a){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(a===!0?oo:Gi),this};Se.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Se.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};ye.prototype.addIndex=function(a){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(a)};ye.prototype.addAttribute=function(a,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(e&&e.isBufferAttribute)&&!(e&&e.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(a,new Se(arguments[1],arguments[2]))):a==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(a,e)};ye.prototype.addDrawCall=function(a,e,t){t!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(a,e)};ye.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()};ye.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")};ye.prototype.removeAttribute=function(a){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(a)};ye.prototype.applyMatrix=function(a){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(a)};Object.defineProperties(ye.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});gi.prototype.setDynamic=function(a){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(a===!0?oo:Gi),this};gi.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};Ln.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")};Ln.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")};Ln.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")};bs.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")};ml.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this};Object.defineProperties(St.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new ue}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(a){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=a===Iu}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(a){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=a}}});Object.defineProperties(Ht.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(a){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=a}}});et.prototype.clearTarget=function(a,e,t,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(a),this.clear(e,t,n)};et.prototype.animate=function(a){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(a)};et.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()};et.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()};et.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision};et.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()};et.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")};et.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")};et.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")};et.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")};et.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")};et.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")};et.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures};et.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")};et.prototype.enableScissorTest=function(a){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(a)};et.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};et.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};et.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};et.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")};et.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")};et.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")};et.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")};et.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")};et.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")};et.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()};Object.defineProperties(et.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=a}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=a}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(a){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=a===!0?xn:jt}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}});Object.defineProperties(ex.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});function HA(a,e,t){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new qa(a,t)}Object.defineProperties(Zt.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=a}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=a}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=a}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=a}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(a){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=a}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(a){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=a}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(a){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=a}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(a){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=a}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(a){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=a}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(a){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=a}}});yh.prototype.load=function(a){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");let e=this;return new md().load(a,function(n){e.setBuffer(n)}),this};vd.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()};ja.prototype.updateCubeMap=function(a,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(a,e)};ja.prototype.clear=function(a,e,t,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(a,e,t,n)};wr.crossOrigin=void 0;wr.loadTexture=function(a,e,t,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");let i=new ai;i.setCrossOrigin(this.crossOrigin);let r=i.load(a,t,void 0,n);return e&&(r.mapping=e),r};wr.loadTextureCube=function(a,e,t,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");let i=new sd;i.setCrossOrigin(this.crossOrigin);let r=i.load(a,t,void 0,n);return e&&(r.mapping=e),r};wr.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};wr.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};function GA(){console.error("THREE.CanvasRenderer has been removed")}function WA(){console.error("THREE.JSONLoader has been removed.")}var XA={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function jA(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:ki}}));typeof window!="undefined"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=ki);var Li=new fe,Od=new Re,Lh=new L,Hn=class extends Sn{constructor(){super();this.uuid=dt.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(e){let t=new Ye().getNormalMatrix(e);for(let n=0,i=this.vertices.length;n<i;n++)this.vertices[n].applyMatrix4(e);for(let n=0,i=this.faces.length;n<i;n++){let r=this.faces[n];r.normal.applyMatrix3(t).normalize();for(let s=0,o=r.vertexNormals.length;s<o;s++)r.vertexNormals[s].applyMatrix3(t).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(e){return Li.makeRotationX(e),this.applyMatrix4(Li),this}rotateY(e){return Li.makeRotationY(e),this.applyMatrix4(Li),this}rotateZ(e){return Li.makeRotationZ(e),this.applyMatrix4(Li),this}translate(e,t,n){return Li.makeTranslation(e,t,n),this.applyMatrix4(Li),this}scale(e,t,n){return Li.makeScale(e,t,n),this.applyMatrix4(Li),this}lookAt(e){return Od.lookAt(e),Od.updateMatrix(),this.applyMatrix4(Od.matrix),this}fromBufferGeometry(e){let t=this,n=e.index!==null?e.index:void 0,i=e.attributes;if(i.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let r=i.position,s=i.normal,o=i.color,l=i.uv,c=i.uv2;c!==void 0&&(this.faceVertexUvs[1]=[]);for(let h=0;h<r.count;h++)t.vertices.push(new L().fromBufferAttribute(r,h)),o!==void 0&&t.colors.push(new ue().fromBufferAttribute(o,h));function u(h,d,p,m){let v=o===void 0?[]:[t.colors[h].clone(),t.colors[d].clone(),t.colors[p].clone()],x=s===void 0?[]:[new L().fromBufferAttribute(s,h),new L().fromBufferAttribute(s,d),new L().fromBufferAttribute(s,p)],g=new kd(h,d,p,x,v,m);t.faces.push(g),l!==void 0&&t.faceVertexUvs[0].push([new J().fromBufferAttribute(l,h),new J().fromBufferAttribute(l,d),new J().fromBufferAttribute(l,p)]),c!==void 0&&t.faceVertexUvs[1].push([new J().fromBufferAttribute(c,h),new J().fromBufferAttribute(c,d),new J().fromBufferAttribute(c,p)])}let f=e.groups;if(f.length>0)for(let h=0;h<f.length;h++){let d=f[h],p=d.start,m=d.count;for(let v=p,x=p+m;v<x;v+=3)n!==void 0?u(n.getX(v),n.getX(v+1),n.getX(v+2),d.materialIndex):u(v,v+1,v+2,d.materialIndex)}else if(n!==void 0)for(let h=0;h<n.count;h+=3)u(n.getX(h),n.getX(h+1),n.getX(h+2));else for(let h=0;h<r.count;h+=3)u(h,h+1,h+2);return this.computeFaceNormals(),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Lh).negate(),this.translate(Lh.x,Lh.y,Lh.z),this}normalize(){this.computeBoundingSphere();let e=this.boundingSphere.center,t=this.boundingSphere.radius,n=t===0?1:1/t,i=new fe;return i.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix4(i),this}computeFaceNormals(){let e=new L,t=new L;for(let n=0,i=this.faces.length;n<i;n++){let r=this.faces[n],s=this.vertices[r.a],o=this.vertices[r.b],l=this.vertices[r.c];e.subVectors(l,o),t.subVectors(s,o),e.cross(t),e.normalize(),r.normal.copy(e)}}computeVertexNormals(e=!0){let t=new Array(this.vertices.length);for(let n=0,i=this.vertices.length;n<i;n++)t[n]=new L;if(e){let n=new L,i=new L;for(let r=0,s=this.faces.length;r<s;r++){let o=this.faces[r],l=this.vertices[o.a],c=this.vertices[o.b],u=this.vertices[o.c];n.subVectors(u,c),i.subVectors(l,c),n.cross(i),t[o.a].add(n),t[o.b].add(n),t[o.c].add(n)}}else{this.computeFaceNormals();for(let n=0,i=this.faces.length;n<i;n++){let r=this.faces[n];t[r.a].add(r.normal),t[r.b].add(r.normal),t[r.c].add(r.normal)}}for(let n=0,i=this.vertices.length;n<i;n++)t[n].normalize();for(let n=0,i=this.faces.length;n<i;n++){let r=this.faces[n],s=r.vertexNormals;s.length===3?(s[0].copy(t[r.a]),s[1].copy(t[r.b]),s[2].copy(t[r.c])):(s[0]=t[r.a].clone(),s[1]=t[r.b].clone(),s[2]=t[r.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){let n=this.faces[e],i=n.vertexNormals;i.length===3?(i[0].copy(n.normal),i[1].copy(n.normal),i[2].copy(n.normal)):(i[0]=n.normal.clone(),i[1]=n.normal.clone(),i[2]=n.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let t=0,n=this.faces.length;t<n;t++){let i=this.faces[t];i.__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]);for(let r=0,s=i.vertexNormals.length;r<s;r++)i.__originalVertexNormals[r]?i.__originalVertexNormals[r].copy(i.vertexNormals[r]):i.__originalVertexNormals[r]=i.vertexNormals[r].clone()}let e=new Hn;e.faces=this.faces;for(let t=0,n=this.morphTargets.length;t<n;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];let r=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals;for(let o=0,l=this.faces.length;o<l;o++){let c=new L,u={a:new L,b:new L,c:new L};r.push(c),s.push(u)}}let i=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let r=0,s=this.faces.length;r<s;r++){let o=this.faces[r],l=i.faceNormals[r],c=i.vertexNormals[r];l.copy(o.normal),c.a.copy(o.vertexNormals[0]),c.b.copy(o.vertexNormals[1]),c.c.copy(o.vertexNormals[2])}}for(let t=0,n=this.faces.length;t<n;t++){let i=this.faces[t];i.normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals}}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Dt),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new En),this.boundingSphere.setFromPoints(this.vertices)}merge(e,t,n=0){if(!(e&&e.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}let i,r=this.vertices.length,s=this.vertices,o=e.vertices,l=this.faces,c=e.faces,u=this.colors,f=e.colors;t!==void 0&&(i=new Ye().getNormalMatrix(t));for(let h=0,d=o.length;h<d;h++){let m=o[h].clone();t!==void 0&&m.applyMatrix4(t),s.push(m)}for(let h=0,d=f.length;h<d;h++)u.push(f[h].clone());for(let h=0,d=c.length;h<d;h++){let p=c[h],m,v,x=p.vertexNormals,g=p.vertexColors,y=new kd(p.a+r,p.b+r,p.c+r);y.normal.copy(p.normal),i!==void 0&&y.normal.applyMatrix3(i).normalize();for(let _=0,w=x.length;_<w;_++)m=x[_].clone(),i!==void 0&&m.applyMatrix3(i).normalize(),y.vertexNormals.push(m);y.color.copy(p.color);for(let _=0,w=g.length;_<w;_++)v=g[_],y.vertexColors.push(v.clone());y.materialIndex=p.materialIndex+n,l.push(y)}for(let h=0,d=e.faceVertexUvs.length;h<d;h++){let p=e.faceVertexUvs[h];this.faceVertexUvs[h]===void 0&&(this.faceVertexUvs[h]=[]);for(let m=0,v=p.length;m<v;m++){let x=p[m],g=[];for(let y=0,_=x.length;y<_;y++)g.push(x[y].clone());this.faceVertexUvs[h].push(g)}}}mergeMesh(e){if(!(e&&e.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)}mergeVertices(e=4){let t={},n=[],i=[],r=Math.pow(10,e);for(let l=0,c=this.vertices.length;l<c;l++){let u=this.vertices[l],f=Math.round(u.x*r)+"_"+Math.round(u.y*r)+"_"+Math.round(u.z*r);t[f]===void 0?(t[f]=l,n.push(this.vertices[l]),i[l]=n.length-1):i[l]=i[t[f]]}let s=[];for(let l=0,c=this.faces.length;l<c;l++){let u=this.faces[l];u.a=i[u.a],u.b=i[u.b],u.c=i[u.c];let f=[u.a,u.b,u.c];for(let h=0;h<3;h++)if(f[h]===f[(h+1)%3]){s.push(l);break}}for(let l=s.length-1;l>=0;l--){let c=s[l];this.faces.splice(c,1);for(let u=0,f=this.faceVertexUvs.length;u<f;u++)this.faceVertexUvs[u].splice(c,1)}let o=this.vertices.length-n.length;return this.vertices=n,o}setFromPoints(e){this.vertices=[];for(let t=0,n=e.length;t<n;t++){let i=e[t];this.vertices.push(new L(i.x,i.y,i.z||0))}return this}sortFacesByMaterialIndex(){let e=this.faces,t=e.length;for(let l=0;l<t;l++)e[l]._id=l;function n(l,c){return l.materialIndex-c.materialIndex}e.sort(n);let i=this.faceVertexUvs[0],r=this.faceVertexUvs[1],s,o;i&&i.length===t&&(s=[]),r&&r.length===t&&(o=[]);for(let l=0;l<t;l++){let c=e[l]._id;s&&s.push(i[c]),o&&o.push(r[c])}s&&(this.faceVertexUvs[0]=s),o&&(this.faceVertexUvs[1]=o)}toJSON(){let e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.parameters!==void 0){let p=this.parameters;for(let m in p)p[m]!==void 0&&(e[m]=p[m]);return e}let t=[];for(let p=0;p<this.vertices.length;p++){let m=this.vertices[p];t.push(m.x,m.y,m.z)}let n=[],i=[],r={},s=[],o={},l=[],c={};for(let p=0;p<this.faces.length;p++){let m=this.faces[p],v=!0,x=!1,g=this.faceVertexUvs[0][p]!==void 0,y=m.normal.length()>0,_=m.vertexNormals.length>0,w=m.color.r!==1||m.color.g!==1||m.color.b!==1,b=m.vertexColors.length>0,S=0;if(S=u(S,0,0),S=u(S,1,v),S=u(S,2,x),S=u(S,3,g),S=u(S,4,y),S=u(S,5,_),S=u(S,6,w),S=u(S,7,b),n.push(S),n.push(m.a,m.b,m.c),n.push(m.materialIndex),g){let M=this.faceVertexUvs[0][p];n.push(d(M[0]),d(M[1]),d(M[2]))}if(y&&n.push(f(m.normal)),_){let M=m.vertexNormals;n.push(f(M[0]),f(M[1]),f(M[2]))}if(w&&n.push(h(m.color)),b){let M=m.vertexColors;n.push(h(M[0]),h(M[1]),h(M[2]))}}function u(p,m,v){return v?p|1<<m:p&~(1<<m)}function f(p){let m=p.x.toString()+p.y.toString()+p.z.toString();return r[m]!==void 0||(r[m]=i.length/3,i.push(p.x,p.y,p.z)),r[m]}function h(p){let m=p.r.toString()+p.g.toString()+p.b.toString();return o[m]!==void 0||(o[m]=s.length,s.push(p.getHex())),o[m]}function d(p){let m=p.x.toString()+p.y.toString();return c[m]!==void 0||(c[m]=l.length/2,l.push(p.x,p.y)),c[m]}return e.data={},e.data.vertices=t,e.data.normals=i,s.length>0&&(e.data.colors=s),l.length>0&&(e.data.uvs=[l]),e.data.faces=n,e}clone(){return new Hn().copy(this)}copy(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;let t=e.vertices;for(let h=0,d=t.length;h<d;h++)this.vertices.push(t[h].clone());let n=e.colors;for(let h=0,d=n.length;h<d;h++)this.colors.push(n[h].clone());let i=e.faces;for(let h=0,d=i.length;h<d;h++)this.faces.push(i[h].clone());for(let h=0,d=e.faceVertexUvs.length;h<d;h++){let p=e.faceVertexUvs[h];this.faceVertexUvs[h]===void 0&&(this.faceVertexUvs[h]=[]);for(let m=0,v=p.length;m<v;m++){let x=p[m],g=[];for(let y=0,_=x.length;y<_;y++){let w=x[y];g.push(w.clone())}this.faceVertexUvs[h].push(g)}}let r=e.morphTargets;for(let h=0,d=r.length;h<d;h++){let p={};if(p.name=r[h].name,r[h].vertices!==void 0){p.vertices=[];for(let m=0,v=r[h].vertices.length;m<v;m++)p.vertices.push(r[h].vertices[m].clone())}if(r[h].normals!==void 0){p.normals=[];for(let m=0,v=r[h].normals.length;m<v;m++)p.normals.push(r[h].normals[m].clone())}this.morphTargets.push(p)}let s=e.morphNormals;for(let h=0,d=s.length;h<d;h++){let p={};if(s[h].vertexNormals!==void 0){p.vertexNormals=[];for(let m=0,v=s[h].vertexNormals.length;m<v;m++){let x=s[h].vertexNormals[m],g={};g.a=x.a.clone(),g.b=x.b.clone(),g.c=x.c.clone(),p.vertexNormals.push(g)}}if(s[h].faceNormals!==void 0){p.faceNormals=[];for(let m=0,v=s[h].faceNormals.length;m<v;m++)p.faceNormals.push(s[h].faceNormals[m].clone())}this.morphNormals.push(p)}let o=e.skinWeights;for(let h=0,d=o.length;h<d;h++)this.skinWeights.push(o[h].clone());let l=e.skinIndices;for(let h=0,d=l.length;h<d;h++)this.skinIndices.push(l[h].clone());let c=e.lineDistances;for(let h=0,d=c.length;h<d;h++)this.lineDistances.push(c[h]);let u=e.boundingBox;u!==null&&(this.boundingBox=u.clone());let f=e.boundingSphere;return f!==null&&(this.boundingSphere=f.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}toBufferGeometry(){let e=new Tv().fromGeometry(this),t=new ye,n=new Float32Array(e.vertices.length*3);if(t.setAttribute("position",new Se(n,3).copyVector3sArray(e.vertices)),e.normals.length>0){let i=new Float32Array(e.normals.length*3);t.setAttribute("normal",new Se(i,3).copyVector3sArray(e.normals))}if(e.colors.length>0){let i=new Float32Array(e.colors.length*3);t.setAttribute("color",new Se(i,3).copyColorsArray(e.colors))}if(e.uvs.length>0){let i=new Float32Array(e.uvs.length*2);t.setAttribute("uv",new Se(i,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){let i=new Float32Array(e.uvs2.length*2);t.setAttribute("uv2",new Se(i,2).copyVector2sArray(e.uvs2))}t.groups=e.groups;for(let i in e.morphTargets){let r=[],s=e.morphTargets[i];for(let o=0,l=s.length;o<l;o++){let c=s[o],u=new pe(c.data.length*3,3);u.name=c.name,r.push(u.copyVector3sArray(c.data))}t.morphAttributes[i]=r}if(e.skinIndices.length>0){let i=new pe(e.skinIndices.length*4,4);t.setAttribute("skinIndex",i.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){let i=new pe(e.skinWeights.length*4,4);t.setAttribute("skinWeight",i.copyVector4sArray(e.skinWeights))}return e.boundingSphere!==null&&(t.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(t.boundingBox=e.boundingBox.clone()),t}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(e){let t=new ye,n=e.geometry;if(e.isPoints||e.isLine){let i=new pe(n.vertices.length*3,3),r=new pe(n.colors.length*3,3);if(t.setAttribute("position",i.copyVector3sArray(n.vertices)),t.setAttribute("color",r.copyColorsArray(n.colors)),n.lineDistances&&n.lineDistances.length===n.vertices.length){let s=new pe(n.lineDistances.length,1);t.setAttribute("lineDistance",s.copyArray(n.lineDistances))}n.boundingSphere!==null&&(t.boundingSphere=n.boundingSphere.clone()),n.boundingBox!==null&&(t.boundingBox=n.boundingBox.clone())}else e.isMesh&&(t=n.toBufferGeometry());return t}};Hn.prototype.isGeometry=!0;var Tv=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){let t=[],n,i,r,s=e.faces;for(i=0;i<s.length;i++){let o=s[i];o.materialIndex!==r&&(r=o.materialIndex,n!==void 0&&(n.count=i*3-n.start,t.push(n)),n={start:i*3,materialIndex:r})}n!==void 0&&(n.count=i*3-n.start,t.push(n)),this.groups=t}fromGeometry(e){let t=e.faces,n=e.vertices,i=e.faceVertexUvs,r=i[0]&&i[0].length>0,s=i[1]&&i[1].length>0,o=e.morphTargets,l=o.length,c;if(l>0){c=[];for(let x=0;x<l;x++)c[x]={name:o[x].name,data:[]};this.morphTargets.position=c}let u=e.morphNormals,f=u.length,h;if(f>0){h=[];for(let x=0;x<f;x++)h[x]={name:u[x].name,data:[]};this.morphTargets.normal=h}let d=e.skinIndices,p=e.skinWeights,m=d.length===n.length,v=p.length===n.length;n.length>0&&t.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let x=0;x<t.length;x++){let g=t[x];this.vertices.push(n[g.a],n[g.b],n[g.c]);let y=g.vertexNormals;if(y.length===3)this.normals.push(y[0],y[1],y[2]);else{let w=g.normal;this.normals.push(w,w,w)}let _=g.vertexColors;if(_.length===3)this.colors.push(_[0],_[1],_[2]);else{let w=g.color;this.colors.push(w,w,w)}if(r===!0){let w=i[0][x];w!==void 0?this.uvs.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",x),this.uvs.push(new J,new J,new J))}if(s===!0){let w=i[1][x];w!==void 0?this.uvs2.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",x),this.uvs2.push(new J,new J,new J))}for(let w=0;w<l;w++){let b=o[w].vertices;c[w].data.push(b[g.a],b[g.b],b[g.c])}for(let w=0;w<f;w++){let b=u[w].vertexNormals[x];h[w].data.push(b.a,b.b,b.c)}m&&this.skinIndices.push(d[g.a],d[g.b],d[g.c]),v&&this.skinWeights.push(p[g.a],p[g.b],p[g.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this}},kd=class{constructor(e,t,n,i,r,s=0){this.a=e,this.b=t,this.c=n,this.normal=i&&i.isVector3?i:new L,this.vertexNormals=Array.isArray(i)?i:[],this.color=r&&r.isColor?r:new ue,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=s}clone(){return new this.constructor().copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}};var zd=class{constructor(e,t,n,i,r,s=0){this.a=e,this.b=t,this.c=n,this.normal=i&&i.isVector3?i:new L,this.vertexNormals=Array.isArray(i)?i:[],this.color=r&&r.isColor?r:new ue,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=s}clone(){return new this.constructor().copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}};var Ds=class extends vt{constructor(e){super(e);this.defaultDPI=90,this.defaultUnit="px"}load(e,t,n,i){let r=this,s=new Pt(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,function(o){try{t(r.parse(o))}catch(l){i?i(l):console.error(l),r.manager.itemError(e)}},n,i)}parse(e){let t=this;function n(G,k){if(G.nodeType!==1)return;let B=_(G),H=!0,W=null;switch(G.nodeName){case"svg":break;case"style":r(G);break;case"g":k=p(G,k);break;case"path":k=p(G,k),G.hasAttribute("d")&&(W=i(G));break;case"rect":k=p(G,k),W=l(G);break;case"polygon":k=p(G,k),W=c(G);break;case"polyline":k=p(G,k),W=u(G);break;case"circle":k=p(G,k),W=f(G);break;case"ellipse":k=p(G,k),W=h(G);break;case"line":k=p(G,k),W=d(G);break;case"defs":H=!1;break;case"use":k=p(G,k);let X=G.href.baseVal.substring(1),te=G.viewportElement.getElementById(X);te?n(te,k):console.warn("SVGLoader: 'use node' references non-existent node id: "+X);break;default:}if(W&&(k.fill!==void 0&&k.fill!=="none"&&W.color.setStyle(k.fill),b(W,j),E.push(W),W.userData={node:G,style:k}),H){let X=G.childNodes;for(let te=0;te<X.length;te++)n(X[te],k)}B&&(I.pop(),I.length>0?j.copy(I[I.length-1]):j.identity())}function i(G){let k=new hi,B=new J,H=new J,W=new J,X=!0,te=!1,ae=G.getAttribute("d").match(/[a-df-z][^a-df-z]*/ig);for(let ce=0,q=ae.length;ce<q;ce++){let re=ae[ce],Q=re.charAt(0),oe=re.substr(1).trim();X===!0&&(te=!0,X=!1);let V;switch(Q){case"M":V=v(oe);for(let P=0,N=V.length;P<N;P+=2)B.x=V[P+0],B.y=V[P+1],H.x=B.x,H.y=B.y,P===0?k.moveTo(B.x,B.y):k.lineTo(B.x,B.y),P===0&&te===!0&&W.copy(B);break;case"H":V=v(oe);for(let P=0,N=V.length;P<N;P++)B.x=V[P],H.x=B.x,H.y=B.y,k.lineTo(B.x,B.y),P===0&&te===!0&&W.copy(B);break;case"V":V=v(oe);for(let P=0,N=V.length;P<N;P++)B.y=V[P],H.x=B.x,H.y=B.y,k.lineTo(B.x,B.y),P===0&&te===!0&&W.copy(B);break;case"L":V=v(oe);for(let P=0,N=V.length;P<N;P+=2)B.x=V[P+0],B.y=V[P+1],H.x=B.x,H.y=B.y,k.lineTo(B.x,B.y),P===0&&te===!0&&W.copy(B);break;case"C":V=v(oe);for(let P=0,N=V.length;P<N;P+=6)k.bezierCurveTo(V[P+0],V[P+1],V[P+2],V[P+3],V[P+4],V[P+5]),H.x=V[P+2],H.y=V[P+3],B.x=V[P+4],B.y=V[P+5],P===0&&te===!0&&W.copy(B);break;case"S":V=v(oe);for(let P=0,N=V.length;P<N;P+=4)k.bezierCurveTo(m(B.x,H.x),m(B.y,H.y),V[P+0],V[P+1],V[P+2],V[P+3]),H.x=V[P+0],H.y=V[P+1],B.x=V[P+2],B.y=V[P+3],P===0&&te===!0&&W.copy(B);break;case"Q":V=v(oe);for(let P=0,N=V.length;P<N;P+=4)k.quadraticCurveTo(V[P+0],V[P+1],V[P+2],V[P+3]),H.x=V[P+0],H.y=V[P+1],B.x=V[P+2],B.y=V[P+3],P===0&&te===!0&&W.copy(B);break;case"T":V=v(oe);for(let P=0,N=V.length;P<N;P+=2){let ee=m(B.x,H.x),se=m(B.y,H.y);k.quadraticCurveTo(ee,se,V[P+0],V[P+1]),H.x=ee,H.y=se,B.x=V[P+0],B.y=V[P+1],P===0&&te===!0&&W.copy(B)}break;case"A":V=v(oe,[3,4],7);for(let P=0,N=V.length;P<N;P+=7){if(V[P+5]==B.x&&V[P+6]==B.y)continue;let ee=B.clone();B.x=V[P+5],B.y=V[P+6],H.x=B.x,H.y=B.y,s(k,V[P],V[P+1],V[P+2],V[P+3],V[P+4],ee,B),P===0&&te===!0&&W.copy(B)}break;case"m":V=v(oe);for(let P=0,N=V.length;P<N;P+=2)B.x+=V[P+0],B.y+=V[P+1],H.x=B.x,H.y=B.y,P===0?k.moveTo(B.x,B.y):k.lineTo(B.x,B.y),P===0&&te===!0&&W.copy(B);break;case"h":V=v(oe);for(let P=0,N=V.length;P<N;P++)B.x+=V[P],H.x=B.x,H.y=B.y,k.lineTo(B.x,B.y),P===0&&te===!0&&W.copy(B);break;case"v":V=v(oe);for(let P=0,N=V.length;P<N;P++)B.y+=V[P],H.x=B.x,H.y=B.y,k.lineTo(B.x,B.y),P===0&&te===!0&&W.copy(B);break;case"l":V=v(oe);for(let P=0,N=V.length;P<N;P+=2)B.x+=V[P+0],B.y+=V[P+1],H.x=B.x,H.y=B.y,k.lineTo(B.x,B.y),P===0&&te===!0&&W.copy(B);break;case"c":V=v(oe);for(let P=0,N=V.length;P<N;P+=6)k.bezierCurveTo(B.x+V[P+0],B.y+V[P+1],B.x+V[P+2],B.y+V[P+3],B.x+V[P+4],B.y+V[P+5]),H.x=B.x+V[P+2],H.y=B.y+V[P+3],B.x+=V[P+4],B.y+=V[P+5],P===0&&te===!0&&W.copy(B);break;case"s":V=v(oe);for(let P=0,N=V.length;P<N;P+=4)k.bezierCurveTo(m(B.x,H.x),m(B.y,H.y),B.x+V[P+0],B.y+V[P+1],B.x+V[P+2],B.y+V[P+3]),H.x=B.x+V[P+0],H.y=B.y+V[P+1],B.x+=V[P+2],B.y+=V[P+3],P===0&&te===!0&&W.copy(B);break;case"q":V=v(oe);for(let P=0,N=V.length;P<N;P+=4)k.quadraticCurveTo(B.x+V[P+0],B.y+V[P+1],B.x+V[P+2],B.y+V[P+3]),H.x=B.x+V[P+0],H.y=B.y+V[P+1],B.x+=V[P+2],B.y+=V[P+3],P===0&&te===!0&&W.copy(B);break;case"t":V=v(oe);for(let P=0,N=V.length;P<N;P+=2){let ee=m(B.x,H.x),se=m(B.y,H.y);k.quadraticCurveTo(ee,se,B.x+V[P+0],B.y+V[P+1]),H.x=ee,H.y=se,B.x=B.x+V[P+0],B.y=B.y+V[P+1],P===0&&te===!0&&W.copy(B)}break;case"a":V=v(oe,[3,4],7);for(let P=0,N=V.length;P<N;P+=7){if(V[P+5]==0&&V[P+6]==0)continue;let ee=B.clone();B.x+=V[P+5],B.y+=V[P+6],H.x=B.x,H.y=B.y,s(k,V[P],V[P+1],V[P+2],V[P+3],V[P+4],ee,B),P===0&&te===!0&&W.copy(B)}break;case"Z":case"z":k.currentPath.autoClose=!0,k.currentPath.curves.length>0&&(B.copy(W),k.currentPath.currentPoint.copy(B),X=!0);break;default:console.warn(re)}te=!1}return k}function r(G){if(!(!G.sheet||!G.sheet.cssRules||!G.sheet.cssRules.length))for(let k=0;k<G.sheet.cssRules.length;k++){let B=G.sheet.cssRules[k];if(B.type!==1)continue;let H=B.selectorText.split(/,/gm).filter(Boolean).map(W=>W.trim());for(let W=0;W<H.length;W++)A[H[W]]=Object.assign(A[H[W]]||{},B.style)}}function s(G,k,B,H,W,X,te,he){if(k==0||B==0){G.lineTo(he.x,he.y);return}H=H*Math.PI/180,k=Math.abs(k),B=Math.abs(B);let ae=(te.x-he.x)/2,ce=(te.y-he.y)/2,q=Math.cos(H)*ae+Math.sin(H)*ce,re=-Math.sin(H)*ae+Math.cos(H)*ce,Q=k*k,oe=B*B,V=q*q,P=re*re,N=V/Q+P/oe;if(N>1){let ge=Math.sqrt(N);k=ge*k,B=ge*B,Q=k*k,oe=B*B}let ee=Q*P+oe*V,se=(Q*oe-ee)/ee,me=Math.sqrt(Math.max(0,se));W===X&&(me=-me);let ve=me*k*re/B,Te=-me*B*q/k,Ee=Math.cos(H)*ve-Math.sin(H)*Te+(te.x+he.x)/2,Ie=Math.sin(H)*ve+Math.cos(H)*Te+(te.y+he.y)/2,Me=o(1,0,(q-ve)/k,(re-Te)/B),Y=o((q-ve)/k,(re-Te)/B,(-q-ve)/k,(-re-Te)/B)%(Math.PI*2);G.currentPath.absellipse(Ee,Ie,k,B,Me,Me+Y,X===0,H)}function o(G,k,B,H){let W=G*B+k*H,X=Math.sqrt(G*G+k*k)*Math.sqrt(B*B+H*H),te=Math.acos(Math.max(-1,Math.min(1,W/X)));return G*H-k*B<0&&(te=-te),te}function l(G){let k=y(G.getAttribute("x")||0),B=y(G.getAttribute("y")||0),H=y(G.getAttribute("rx")||0),W=y(G.getAttribute("ry")||0),X=y(G.getAttribute("width")),te=y(G.getAttribute("height")),he=new hi;return he.moveTo(k+2*H,B),he.lineTo(k+X-2*H,B),(H!==0||W!==0)&&he.bezierCurveTo(k+X,B,k+X,B,k+X,B+2*W),he.lineTo(k+X,B+te-2*W),(H!==0||W!==0)&&he.bezierCurveTo(k+X,B+te,k+X,B+te,k+X-2*H,B+te),he.lineTo(k+2*H,B+te),(H!==0||W!==0)&&he.bezierCurveTo(k,B+te,k,B+te,k,B+te-2*W),he.lineTo(k,B+2*W),(H!==0||W!==0)&&he.bezierCurveTo(k,B,k,B,k+2*H,B),he}function c(G){function k(X,te,he){let ae=y(te),ce=y(he);W===0?H.moveTo(ae,ce):H.lineTo(ae,ce),W++}let B=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,H=new hi,W=0;return G.getAttribute("points").replace(B,k),H.currentPath.autoClose=!0,H}function u(G){function k(X,te,he){let ae=y(te),ce=y(he);W===0?H.moveTo(ae,ce):H.lineTo(ae,ce),W++}let B=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,H=new hi,W=0;return G.getAttribute("points").replace(B,k),H.currentPath.autoClose=!1,H}function f(G){let k=y(G.getAttribute("cx")||0),B=y(G.getAttribute("cy")||0),H=y(G.getAttribute("r")||0),W=new Ti;W.absarc(k,B,H,0,Math.PI*2);let X=new hi;return X.subPaths.push(W),X}function h(G){let k=y(G.getAttribute("cx")||0),B=y(G.getAttribute("cy")||0),H=y(G.getAttribute("rx")||0),W=y(G.getAttribute("ry")||0),X=new Ti;X.absellipse(k,B,H,W,0,Math.PI*2);let te=new hi;return te.subPaths.push(X),te}function d(G){let k=y(G.getAttribute("x1")||0),B=y(G.getAttribute("y1")||0),H=y(G.getAttribute("x2")||0),W=y(G.getAttribute("y2")||0),X=new hi;return X.moveTo(k,B),X.lineTo(H,W),X.currentPath.autoClose=!1,X}function p(G,k){k=Object.assign({},k);let B={};if(G.hasAttribute("class")){let te=G.getAttribute("class").split(/\s/).filter(Boolean).map(he=>he.trim());for(let he=0;he<te.length;he++)B=Object.assign(B,A["."+te[he]])}G.hasAttribute("id")&&(B=Object.assign(B,A["#"+G.getAttribute("id")]));function H(te,he,ae){ae===void 0&&(ae=function(q){return q.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),q}),G.hasAttribute(te)&&(k[he]=ae(G.getAttribute(te))),B[te]&&(k[he]=ae(B[te])),G.style&&G.style[te]!==""&&(k[he]=ae(G.style[te]))}function W(te){return Math.max(0,Math.min(1,y(te)))}function X(te){return Math.max(0,y(te))}return H("fill","fill"),H("fill-opacity","fillOpacity",W),H("opacity","opacity",W),H("stroke","stroke"),H("stroke-opacity","strokeOpacity",W),H("stroke-width","strokeWidth",X),H("stroke-linejoin","strokeLineJoin"),H("stroke-linecap","strokeLineCap"),H("stroke-miterlimit","strokeMiterLimit",X),H("visibility","visibility"),k}function m(G,k){return G-(k-G)}function v(G,k,B){if(typeof G!="string")throw new TypeError("Invalid input: "+typeof G);let H={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},W=0,X=1,te=2,he=3,ae=W,ce=!0,q="",re="",Q=[];function oe(ee,se,me){let ve=new SyntaxError('Unexpected character "'+ee+'" at index '+se+".");throw ve.partial=me,ve}function V(){q!==""&&(re===""?Q.push(Number(q)):Q.push(Number(q)*Math.pow(10,Number(re)))),q="",re=""}let P,N=G.length;for(let ee=0;ee<N;ee++){if(P=G[ee],Array.isArray(k)&&k.includes(Q.length%B)&&H.FLAGS.test(P)){ae=X,q=P,V();continue}if(ae===W){if(H.WHITESPACE.test(P))continue;if(H.DIGIT.test(P)||H.SIGN.test(P)){ae=X,q=P;continue}if(H.POINT.test(P)){ae=te,q=P;continue}H.COMMA.test(P)&&(ce&&oe(P,ee,Q),ce=!0)}if(ae===X){if(H.DIGIT.test(P)){q+=P;continue}if(H.POINT.test(P)){q+=P,ae=te;continue}if(H.EXP.test(P)){ae=he;continue}H.SIGN.test(P)&&q.length===1&&H.SIGN.test(q[0])&&oe(P,ee,Q)}if(ae===te){if(H.DIGIT.test(P)){q+=P;continue}if(H.EXP.test(P)){ae=he;continue}H.POINT.test(P)&&q[q.length-1]==="."&&oe(P,ee,Q)}if(ae===he){if(H.DIGIT.test(P)){re+=P;continue}if(H.SIGN.test(P)){if(re===""){re+=P;continue}re.length===1&&H.SIGN.test(re)&&oe(P,ee,Q)}}H.WHITESPACE.test(P)?(V(),ae=W,ce=!1):H.COMMA.test(P)?(V(),ae=W,ce=!0):H.SIGN.test(P)?(V(),ae=X,q=P):H.POINT.test(P)?(V(),ae=te,q=P):oe(P,ee,Q)}return V(),Q}let x=["mm","cm","in","pt","pc","px"],g={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:72/6,pc:1,px:-1},px:{px:1}};function y(G){let k="px";if(typeof G=="string"||G instanceof String)for(let H=0,W=x.length;H<W;H++){let X=x[H];if(G.endsWith(X)){k=X,G=G.substring(0,G.length-X.length);break}}let B;return k==="px"&&t.defaultUnit!=="px"?B=g.in[t.defaultUnit]/t.defaultDPI:(B=g[k][t.defaultUnit],B<0&&(B=g[k].in*t.defaultDPI)),B*parseFloat(G)}function _(G){if(!(G.hasAttribute("transform")||G.nodeName==="use"&&(G.hasAttribute("x")||G.hasAttribute("y"))))return null;let k=w(G);return I.length>0&&k.premultiply(I[I.length-1]),j.copy(k),I.push(k),k}function w(G){let k=new Ye,B=C;if(G.nodeName==="use"&&(G.hasAttribute("x")||G.hasAttribute("y"))){let H=y(G.getAttribute("x")),W=y(G.getAttribute("y"));k.translate(H,W)}if(G.hasAttribute("transform")){let H=G.getAttribute("transform").split(")");for(let W=H.length-1;W>=0;W--){let X=H[W].trim();if(X==="")continue;let te=X.indexOf("("),he=X.length;if(te>0&&te<he){let ae=X.substr(0,te),ce=v(X.substr(te+1,he-te-1));switch(B.identity(),ae){case"translate":if(ce.length>=1){let q=ce[0],re=q;ce.length>=2&&(re=ce[1]),B.translate(q,re)}break;case"rotate":if(ce.length>=1){let q=0,re=0,Q=0;q=-ce[0]*Math.PI/180,ce.length>=3&&(re=ce[1],Q=ce[2]),R.identity().translate(-re,-Q),D.identity().rotate(q),F.multiplyMatrices(D,R),R.identity().translate(re,Q),B.multiplyMatrices(R,F)}break;case"scale":if(ce.length>=1){let q=ce[0],re=q;ce.length>=2&&(re=ce[1]),B.scale(q,re)}break;case"skewX":ce.length===1&&B.set(1,Math.tan(ce[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":ce.length===1&&B.set(1,0,0,Math.tan(ce[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":ce.length===6&&B.set(ce[0],ce[2],ce[4],ce[1],ce[3],ce[5],0,0,1);break}}k.premultiply(B)}}return k}function b(G,k){function B(X){U.set(X.x,X.y,1).applyMatrix3(k),X.set(U.x,U.y)}let H=S(k),W=G.subPaths;for(let X=0,te=W.length;X<te;X++){let ae=W[X].curves;for(let ce=0;ce<ae.length;ce++){let q=ae[ce];q.isLineCurve?(B(q.v1),B(q.v2)):q.isCubicBezierCurve?(B(q.v0),B(q.v1),B(q.v2),B(q.v3)):q.isQuadraticBezierCurve?(B(q.v0),B(q.v1),B(q.v2)):q.isEllipseCurve&&(H&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),O.set(q.aX,q.aY),B(O),q.aX=O.x,q.aY=O.y,q.xRadius*=M(k),q.yRadius*=T(k))}}}function S(G){return G.elements[1]!==0||G.elements[3]!==0}function M(G){let k=G.elements;return Math.sqrt(k[0]*k[0]+k[1]*k[1])}function T(G){let k=G.elements;return Math.sqrt(k[3]*k[3]+k[4]*k[4])}let E=[],A={},I=[],C=new Ye,R=new Ye,D=new Ye,F=new Ye,O=new J,U=new L,j=new Ye,Z=new DOMParser().parseFromString(e,"image/svg+xml");return n(Z.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:E,xml:Z.documentElement}}static createShapes(e){let t=999999999,n={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},i={loc:n.ORIGIN,t:0};function r(v,x,g,y){let _=v.x,w=x.x,b=g.x,S=y.x,M=v.y,T=x.y,E=g.y,A=y.y,I=(S-b)*(M-E)-(A-E)*(_-b),C=(w-_)*(M-E)-(T-M)*(_-b),R=(A-E)*(w-_)-(S-b)*(T-M),D=I/R,F=C/R;if(R===0&&I!==0||D<=0||D>=1||F<0||F>1)return null;if(I===0&&R===0){for(let O=0;O<2;O++)if(s(O===0?g:y,v,x),i.loc==n.ORIGIN){let U=O===0?g:y;return{x:U.x,y:U.y,t:i.t}}else if(i.loc==n.BETWEEN){let U=+(_+i.t*(w-_)).toPrecision(10),j=+(M+i.t*(T-M)).toPrecision(10);return{x:U,y:j,t:i.t}}return null}else{for(let j=0;j<2;j++)if(s(j===0?g:y,v,x),i.loc==n.ORIGIN){let Z=j===0?g:y;return{x:Z.x,y:Z.y,t:i.t}}let O=+(_+D*(w-_)).toPrecision(10),U=+(M+D*(T-M)).toPrecision(10);return{x:O,y:U,t:D}}}function s(v,x,g){let y=g.x-x.x,_=g.y-x.y,w=v.x-x.x,b=v.y-x.y,S=y*b-w*_;if(v.x===x.x&&v.y===x.y){i.loc=n.ORIGIN,i.t=0;return}if(v.x===g.x&&v.y===g.y){i.loc=n.DESTINATION,i.t=1;return}if(S<-Number.EPSILON){i.loc=n.LEFT;return}if(S>Number.EPSILON){i.loc=n.RIGHT;return}if(y*w<0||_*b<0){i.loc=n.BEHIND;return}if(Math.sqrt(y*y+_*_)<Math.sqrt(w*w+b*b)){i.loc=n.BEYOND;return}let M;y!==0?M=w/y:M=b/_,i.loc=n.BETWEEN,i.t=M}function o(v,x){let g=[],y=[];for(let _=1;_<v.length;_++){let w=v[_-1],b=v[_];for(let S=1;S<x.length;S++){let M=x[S-1],T=x[S],E=r(w,b,M,T);E!==null&&g.find(A=>A.t<=E.t+Number.EPSILON&&A.t>=E.t-Number.EPSILON)===void 0&&(g.push(E),y.push(new J(E.x,E.y)))}}return y}function l(v,x,g){let y=new J;x.getCenter(y);let _=[];return g.forEach(w=>{w.boundingBox.containsPoint(y)&&o(v,w.points).forEach(S=>{_.push({identifier:w.identifier,isCW:w.isCW,point:S})})}),_.sort((w,b)=>w.point.x-b.point.x),_}function c(v,x,g,y,_){(_==null||_==="")&&(_="nonzero");let w=new J;v.boundingBox.getCenter(w);let b=[new J(g,w.y),new J(y,w.y)],S=l(b,v.boundingBox,x);S.sort((C,R)=>C.point.x-R.point.x);let M=[],T=[];S.forEach(C=>{C.identifier===v.identifier?M.push(C):T.push(C)});let E=M[0].point.x,A=[],I=0;for(;I<T.length&&T[I].point.x<E;)A.length>0&&A[A.length-1]===T[I].identifier?A.pop():A.push(T[I].identifier),I++;if(A.push(v.identifier),_==="evenodd"){let C=A.length%2==0,R=A[A.length-2];return{identifier:v.identifier,isHole:C,for:R}}else if(_==="nonzero"){let C=!0,R=null,D=null;for(let F=0;F<A.length;F++){let O=A[F];C?(D=x[O].isCW,C=!1,R=O):D!==x[O].isCW&&(D=x[O].isCW,C=!0)}return{identifier:v.identifier,isHole:C,for:R}}else console.warn('fill-rule: "'+_+'" is currently not implemented.')}let u=0,f=t,h=-t,d=e.subPaths.map(v=>{let x=v.getPoints(),g=-t,y=t,_=-t,w=t;for(let b=0;b<x.length;b++){let S=x[b];S.y>g&&(g=S.y),S.y<y&&(y=S.y),S.x>_&&(_=S.x),S.x<w&&(w=S.x)}return h<=_&&(h=_+1),f>=w&&(f=w-1),{points:x,isCW:Cn.isClockWise(x),identifier:u++,boundingBox:new er(new J(w,y),new J(_,g))}});d=d.filter(v=>v.points.length>1);let p=d.map(v=>c(v,d,f,h,e.userData.style.fillRule)),m=[];return d.forEach(v=>{if(!p[v.identifier].isHole){let g=new li(v.points);p.filter(_=>_.isHole&&_.for===v.identifier).forEach(_=>{let w=d[_.identifier];g.holes.push(new Ti(w.points))}),m.push(g)}}),m}static getStrokeStyle(e,t,n,i,r){return e=e!==void 0?e:1,t=t!==void 0?t:"#000",n=n!==void 0?n:"miter",i=i!==void 0?i:"butt",r=r!==void 0?r:4,{strokeColor:t,strokeWidth:e,strokeLineJoin:n,strokeLineCap:i,strokeMiterLimit:r}}static pointsToStroke(e,t,n,i){let r=[],s=[],o=[];if(Ds.pointsToStrokeWithBuffers(e,t,n,i,r,s,o)===0)return null;let l=new ye;return l.setAttribute("position",new pe(r,3)),l.setAttribute("normal",new pe(s,3)),l.setAttribute("uv",new pe(o,2)),l}static pointsToStrokeWithBuffers(e,t,n,i,r,s,o,l){let c=new J,u=new J,f=new J,h=new J,d=new J,p=new J,m=new J,v=new J,x=new J,g=new J,y=new J,_=new J,w=new J,b=new J,S=new J,M=new J,T=new J;n=n!==void 0?n:12,i=i!==void 0?i:.001,l=l!==void 0?l:0,e=re(e);let E=e.length;if(E<2)return 0;let A=e[0].equals(e[E-1]),I,C=e[0],R,D=t.strokeWidth/2,F=1/(E-1),O=0,U,j,Z,K,G=!1,k=0,B=l*3,H=l*2;W(e[0],e[1],c).multiplyScalar(D),v.copy(e[0]).sub(c),x.copy(e[0]).add(c),g.copy(v),y.copy(x);for(let Q=1;Q<E;Q++){I=e[Q],Q===E-1?A?R=e[1]:R=void 0:R=e[Q+1];let oe=c;if(W(C,I,oe),f.copy(oe).multiplyScalar(D),_.copy(I).sub(f),w.copy(I).add(f),U=O+F,j=!1,R!==void 0){W(I,R,u),f.copy(u).multiplyScalar(D),b.copy(I).sub(f),S.copy(I).add(f),Z=!0,f.subVectors(R,C),oe.dot(f)<0&&(Z=!1),Q===1&&(G=Z),f.subVectors(R,I),f.normalize();let V=Math.abs(oe.dot(f));if(V!==0){let P=D/V;f.multiplyScalar(-P),h.subVectors(I,C),d.copy(h).setLength(P).add(f),M.copy(d).negate();let N=d.length(),ee=h.length();h.divideScalar(ee),p.subVectors(R,I);let se=p.length();switch(p.divideScalar(se),h.dot(M)<ee&&p.dot(M)<se&&(j=!0),T.copy(d).add(I),M.add(I),K=!1,j?Z?(S.copy(M),w.copy(M)):(b.copy(M),_.copy(M)):he(),t.strokeLineJoin){case"bevel":ae(Z,j,U);break;case"round":ce(Z,j),Z?te(I,_,b,U,0):te(I,S,w,U,1);break;case"miter":case"miter-clip":default:let me=D*t.strokeMiterLimit/N;if(me<1)if(t.strokeLineJoin!=="miter-clip"){ae(Z,j,U);break}else ce(Z,j),Z?(p.subVectors(T,_).multiplyScalar(me).add(_),m.subVectors(T,b).multiplyScalar(me).add(b),X(_,U,0),X(p,U,0),X(I,U,.5),X(I,U,.5),X(p,U,0),X(m,U,0),X(I,U,.5),X(m,U,0),X(b,U,0)):(p.subVectors(T,w).multiplyScalar(me).add(w),m.subVectors(T,S).multiplyScalar(me).add(S),X(w,U,1),X(p,U,1),X(I,U,.5),X(I,U,.5),X(p,U,1),X(m,U,1),X(I,U,.5),X(m,U,1),X(S,U,1));else j?(Z?(X(x,O,1),X(v,O,0),X(T,U,0),X(x,O,1),X(T,U,0),X(M,U,1)):(X(x,O,1),X(v,O,0),X(T,U,1),X(v,O,0),X(M,U,0),X(T,U,1)),Z?b.copy(T):S.copy(T)):Z?(X(_,U,0),X(T,U,0),X(I,U,.5),X(I,U,.5),X(T,U,0),X(b,U,0)):(X(w,U,1),X(T,U,1),X(I,U,.5),X(I,U,.5),X(T,U,1),X(S,U,1)),K=!0;break}}else he()}else he();!A&&Q===E-1&&q(e[0],g,y,Z,!0,O),O=U,C=I,v.copy(b),x.copy(S)}if(!A)q(I,_,w,Z,!1,U);else if(j&&r){let Q=T,oe=M;G!==Z&&(Q=M,oe=T),Z?(K||G)&&(oe.toArray(r,0*3),oe.toArray(r,3*3),K&&Q.toArray(r,1*3)):(K||!G)&&(oe.toArray(r,1*3),oe.toArray(r,3*3),K&&Q.toArray(r,0*3))}return k;function W(Q,oe,V){return V.subVectors(oe,Q),V.set(-V.y,V.x).normalize()}function X(Q,oe,V){r&&(r[B]=Q.x,r[B+1]=Q.y,r[B+2]=0,s&&(s[B]=0,s[B+1]=0,s[B+2]=1),B+=3,o&&(o[H]=oe,o[H+1]=V,H+=2)),k+=3}function te(Q,oe,V,P,N){c.copy(oe).sub(Q).normalize(),u.copy(V).sub(Q).normalize();let ee=Math.PI,se=c.dot(u);Math.abs(se)<1&&(ee=Math.abs(Math.acos(se))),ee/=n,f.copy(oe);for(let me=0,ve=n-1;me<ve;me++)h.copy(f).rotateAround(Q,ee),X(f,P,N),X(h,P,N),X(Q,P,.5),f.copy(h);X(h,P,N),X(V,P,N),X(Q,P,.5)}function he(){X(x,O,1),X(v,O,0),X(_,U,0),X(x,O,1),X(_,U,1),X(w,U,0)}function ae(Q,oe,V){oe?Q?(X(x,O,1),X(v,O,0),X(_,U,0),X(x,O,1),X(_,U,0),X(M,U,1),X(_,V,0),X(b,V,0),X(M,V,.5)):(X(x,O,1),X(v,O,0),X(w,U,1),X(v,O,0),X(M,U,0),X(w,U,1),X(w,V,1),X(S,V,0),X(M,V,.5)):Q?(X(_,V,0),X(b,V,0),X(I,V,.5)):(X(w,V,1),X(S,V,0),X(I,V,.5))}function ce(Q,oe){oe&&(Q?(X(x,O,1),X(v,O,0),X(_,U,0),X(x,O,1),X(_,U,0),X(M,U,1),X(_,O,0),X(I,U,.5),X(M,U,1),X(I,U,.5),X(b,O,0),X(M,U,1)):(X(x,O,1),X(v,O,0),X(w,U,1),X(v,O,0),X(M,U,0),X(w,U,1),X(w,O,1),X(M,U,0),X(I,U,.5),X(I,U,.5),X(M,U,0),X(S,O,1)))}function q(Q,oe,V,P,N,ee){switch(t.strokeLineCap){case"round":N?te(Q,V,oe,ee,.5):te(Q,oe,V,ee,.5);break;case"square":if(N)c.subVectors(oe,Q),u.set(c.y,-c.x),f.addVectors(c,u).add(Q),h.subVectors(u,c).add(Q),P?(f.toArray(r,1*3),h.toArray(r,0*3),h.toArray(r,3*3)):(f.toArray(r,1*3),f.toArray(r,3*3),h.toArray(r,0*3));else{c.subVectors(V,Q),u.set(c.y,-c.x),f.addVectors(c,u).add(Q),h.subVectors(u,c).add(Q);let se=r.length;P?(f.toArray(r,se-1*3),h.toArray(r,se-2*3),h.toArray(r,se-4*3)):(f.toArray(r,se-2*3),h.toArray(r,se-1*3),h.toArray(r,se-4*3))}break;case"butt":default:break}}function re(Q){let oe=!1;for(let P=1,N=Q.length-1;P<N;P++)if(Q[P].distanceTo(Q[P+1])<i){oe=!0;break}if(!oe)return Q;let V=[];V.push(Q[0]);for(let P=1,N=Q.length-1;P<N;P++)Q[P].distanceTo(Q[P+1])>=i&&V.push(Q[P]);return V.push(Q[Q.length-1]),V}}};var Ud=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){let t=[],n,i,r,s=e.faces;for(i=0;i<s.length;i++){let o=s[i];o.materialIndex!==r&&(r=o.materialIndex,n!==void 0&&(n.count=i*3-n.start,t.push(n)),n={start:i*3,materialIndex:r})}n!==void 0&&(n.count=i*3-n.start,t.push(n)),this.groups=t}fromGeometry(e){let t=e.faces,n=e.vertices,i=e.faceVertexUvs,r=i[0]&&i[0].length>0,s=i[1]&&i[1].length>0,o=e.morphTargets,l=o.length,c;if(l>0){c=[];for(let x=0;x<l;x++)c[x]={name:o[x].name,data:[]};this.morphTargets.position=c}let u=e.morphNormals,f=u.length,h;if(f>0){h=[];for(let x=0;x<f;x++)h[x]={name:u[x].name,data:[]};this.morphTargets.normal=h}let d=e.skinIndices,p=e.skinWeights,m=d.length===n.length,v=p.length===n.length;n.length>0&&t.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let x=0;x<t.length;x++){let g=t[x];this.vertices.push(n[g.a],n[g.b],n[g.c]);let y=g.vertexNormals;if(y.length===3)this.normals.push(y[0],y[1],y[2]);else{let w=g.normal;this.normals.push(w,w,w)}let _=g.vertexColors;if(_.length===3)this.colors.push(_[0],_[1],_[2]);else{let w=g.color;this.colors.push(w,w,w)}if(r===!0){let w=i[0][x];w!==void 0?this.uvs.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",x),this.uvs.push(new J,new J,new J))}if(s===!0){let w=i[1][x];w!==void 0?this.uvs2.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",x),this.uvs2.push(new J,new J,new J))}for(let w=0;w<l;w++){let b=o[w].vertices;c[w].data.push(b[g.a],b[g.b],b[g.c])}for(let w=0;w<f;w++){let b=u[w].vertexNormals[x];h[w].data.push(b.a,b.b,b.c)}m&&this.skinIndices.push(d[g.a],d[g.b],d[g.c]),v&&this.skinWeights.push(p[g.a],p[g.b],p[g.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this}};var Rh=(a,e)=>{let t=new Ud().fromGeometry(e);return qA(a,t)},qA=(a,e)=>{var t,n;let i=new Float32Array(e.vertices.length*3);if(a.setAttribute("position",new Se(i,3).copyVector3sArray(e.vertices)),e.normals.length>0){let r=new Float32Array(e.normals.length*3);a.setAttribute("normal",new Se(r,3).copyVector3sArray(e.normals))}if(e.colors.length>0){let r=new Float32Array(e.colors.length*3);a.setAttribute("color",new Se(r,3).copyColorsArray(e.colors))}if(e.uvs.length>0){let r=new Float32Array(e.uvs.length*2);a.setAttribute("uv",new Se(r,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){let r=new Float32Array(e.uvs2.length*2);a.setAttribute("uv2",new Se(r,2).copyVector2sArray(e.uvs2))}a.groups=e.groups;for(let r in e.morphTargets){let s=[],o=e.morphTargets[r];for(let l=0,c=o.length;l<c;l++){let u=o[l],f=new pe(u.data.length*3,3);f.name=u.name,s.push(f.copyVector3sArray(u.data))}a.morphAttributes[r]=s}if(e.skinIndices.length>0){let r=new pe(e.skinIndices.length*4,4);a.setAttribute("skinIndex",r.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){let r=new pe(e.skinWeights.length*4,4);a.setAttribute("skinWeight",r.copyVector4sArray(e.skinWeights))}return e.boundingSphere!==null&&(a.boundingSphere=(t=e.boundingSphere)===null||t===void 0?void 0:t.clone()),e.boundingBox!==null&&(a.boundingBox=(n=e.boundingBox)===null||n===void 0?void 0:n.clone()),a};var tr=class{constructor(e,t){this.camera=e,this.renderer=t}static geometryToBufferGeometry(e){return e.isGeometry?Rh(new ye,e):e}static bufferGeometryToGeometry(e){return e.isBufferGeometry?new Hn().fromBufferGeometry(e):e}fromSVGtoShape(e,t=!1,n){if(e){let i=new Ds,r=[];return i.parse(e).paths.forEach(s=>{s.toShapes(t,n).forEach(o=>{r.push(o)})}),r}return[]}from3dto2d(e){let t=new L(e.x,e.y,e.z),n=this.renderer.domElement;this.camera.updateMatrixWorld(),t.project(this.camera);let i=Math.round((t.x+1)*(n.width/2)),r=Math.round((-t.y+1)*(n.height/2));return new J(i,r)}from2dto3d(e,t,n){var i;if(!this.tmpPlane){let l=new tn(1e4,1e4),c=new ct({transparent:!0,opacity:.25});this.tmpPlane=new Ce(l,c),this.tmpPlane.name="_tmp_raycast_plane"}this.tmpRaycaster||(this.tmpRaycaster=new Yo),this.tmpVector3||(this.tmpVector3=new L);let r;this.tmpPlane.setRotationFromEuler(this.camera.rotation);let s=this.camera.position;this.tmpPlane.position.set(s.x,s.y,s.z),this.camera.getWorldDirection(this.tmpVector3),this.tmpPlane.position.add(this.tmpVector3.clone().multiplyScalar(n)),this.tmpPlane.updateMatrix(),this.tmpPlane.updateMatrixWorld(!0),this.tmpRaycaster.setFromCamera({x:e,y:t},this.camera);let o=this.tmpRaycaster.intersectObjects([this.tmpPlane]);return((i=o[0])===null||i===void 0?void 0:i.object.name)==="_tmp_raycast_plane"&&(r=o[0].point),r}};var Vd=class{static toGeometry(e,t){e.geometry=tr.bufferGeometryToGeometry(e.geometry),t.geometry=tr.bufferGeometryToGeometry(t.geometry)}static toBufferGeometry(e){e.geometry=tr.geometryToBufferGeometry(e.geometry)}static union(e,t){this.toGeometry(e,t);let n=this.doCSG(e,t,"union");return this.toBufferGeometry(n),n}static subtract(e,t){this.toGeometry(e,t);let n=this.doCSG(e,t,"subtract");return this.toBufferGeometry(n),n}static intersect(e,t){this.toGeometry(e,t);let n=this.doCSG(e,t,"intersect");return this.toBufferGeometry(n),n}static doCSG(e,t,n){e.updateMatrix(),t.updateMatrix();let i=We.fromMesh(e),r=We.fromMesh(t),s=i[n](r);return We.toMesh(s,e.matrix)}};var We=class{constructor(){this.polygons=[]}static fromPolygons(e){let t=new We;return t.polygons=e,t}static fromGeometry(e){e.isBufferGeometry&&(e=new Hn().fromBufferGeometry(e));let t=e.faces,n=e.vertices,i=[],r=["a","b","c"];for(let s=0;s<t.length;s++){let o=t[s],l=[];for(let c=0;c<3;c++){let u=e.faceVertexUvs[0][s]!==void 0&&e.faceVertexUvs[0][s][c]!==void 0?e.faceVertexUvs[0][s][c]:void 0;l.push(new yl(n[o[r[c]]],o.vertexNormals[c],u))}i.push(new Ko(l))}return We.fromPolygons(i)}static fromMesh(e){let t=We.fromGeometry(e.geometry);We._tmpm3.getNormalMatrix(e.matrix);for(let n of t.polygons)for(let i of n.vertices)i.pos.applyMatrix4(e.matrix),i.normal.applyMatrix3(We._tmpm3);return t}static toMesh(e,t){let n=new Hn,i=e.polygons,r=n.vertices,s=n.faceVertexUvs[0];for(let c of i){let u=c.vertices,f=r.length,h=u.length;for(let d of u)r.push(new L().copy(d.pos));for(let d=3;d<=h;d++){let p=new zd(f,f+d-2,f+d-1),m=[];s.push(m);let v=p.vertexNormals;v.push(new L().copy(u[0].normal)),v.push(new L().copy(u[d-2].normal)),v.push(new L().copy(u[d-1].normal)),u[0].uv&&u[d-2].uv&&u[d-1].uv&&(m.push(new L().copy(u[0].uv)),m.push(new L().copy(u[d-2].uv)),m.push(new L().copy(u[d-1].uv))),p.normal=new L().copy(c.plane.normal),n.faces.push(p)}}let o=parseInt(ki)>=123?new fe().copy(t).invert():new fe().getInverse(t);n.applyMatrix4(o),n.verticesNeedUpdate=n.elementsNeedUpdate=n.normalsNeedUpdate=!0,n.computeBoundingSphere(),n.computeBoundingBox();let l=new Ce(n);return l.matrix.copy(t),l.matrix.decompose(l.position,l.rotation,l.scale),l.updateMatrixWorld(),l}static iEval(e,t=0){var n;if(typeof e=="string")We.currentOp=e;else if(e instanceof Array)for(let i of e)We.iEval(i,0);else if(typeof e=="object"){let i=We.currentOp;e.updateMatrix(),e.updateMatrixWorld(),We.sourceMesh?(We.nextPrim=We.fromMesh(e),We.currentPrim=We.currentPrim[i](We.nextPrim)):We.currentPrim=We.fromMesh(We.sourceMesh=e),We.doRemove&&((n=e==null?void 0:e.parent)===null||n===void 0||n.remove(e))}}static eval(e,t){delete We.currentOp,delete We.sourceMesh,We.doRemove=t,We.iEval(e);let n=We.toMesh(We.currentPrim,We.sourceMesh.matrix);return n.material=We.sourceMesh.material,n.castShadow=n.receiveShadow=!0,n}clone(){let e=new We;return e.polygons=this.polygons.map(t=>t.clone()),e}toPolygons(){return this.polygons}union(e){let t=new ui(this.clone().polygons),n=new ui(e.clone().polygons);return t.clipTo(n),n.clipTo(t),n.invert(),n.clipTo(t),n.invert(),t.build(n.allPolygons()),We.fromPolygons(t.allPolygons())}subtract(e){let t=new ui(this.clone().polygons),n=new ui(e.clone().polygons);return t.invert(),t.clipTo(n),n.clipTo(t),n.invert(),n.clipTo(t),n.invert(),t.build(n.allPolygons()),t.invert(),We.fromPolygons(t.allPolygons())}intersect(e){let t=new ui(this.clone().polygons),n=new ui(e.clone().polygons);return t.invert(),n.clipTo(t),n.invert(),t.clipTo(n),n.clipTo(t),t.build(n.allPolygons()),t.invert(),We.fromPolygons(t.allPolygons())}inverse(){let e=this.clone();return e.polygons.map(t=>{t.flip()}),e}};We._tmpm3=new Ye;var Qo=class extends L{constructor(e,t,n){if(arguments.length===3)super(e,t,n);else if(Array.isArray(e))super(e[0],e[1],e[2]);else if(typeof e=="object")this.copy(e);else throw new Error("Invalid constructor to vector")}clone(){return new Qo(this.x,this.y,this.z)}negated(){return this.clone().multiplyScalar(-1)}plus(e){return this.clone().add(e)}minus(e){return this.clone().sub(e)}times(e){return this.clone().multiplyScalar(e)}dividedBy(e){return this.clone().divideScalar(e)}lerp(e,t){return this.plus(e.minus(this).times(t))}unit(){return this.dividedBy(this.length())}cross(e,t){return L.prototype.cross.call(this.clone(),e)}},yl=class{constructor(e,t,n){this.pos=new Qo(e.x,e.y,e.z),this.normal=new Qo(t.x,t.y,t.z),n&&(this.uv=new Qo(n.x,n.y,n.z))}clone(){return new yl(this.pos.clone(),this.normal.clone(),this.uv?this.uv.clone():void 0)}flip(){this.normal=this.normal.negated()}interpolate(e,t){return new yl(this.pos.lerp(e.pos,t),this.normal.lerp(e.normal,t),this.uv?this.uv.lerp(e.uv,t):void 0)}},Hr=class{constructor(e,t){this.normal=e,this.w=t}static fromPoints(e,t,n){let i=t.minus(e).cross(n.minus(e)).unit();return new Hr(i,i.dot(e))}clone(){return new Hr(this.normal.clone(),this.w)}flip(){this.normal=this.normal.negated(),this.w=-this.w}splitPolygon(e,t,n,i,r){let s=0,o=1,l=2,c=3,u=0,f=[];for(let h of e.vertices){let d=this.normal.dot(h.pos)-this.w,p=d<-Hr.EPSILON?l:d>Hr.EPSILON?o:s;u|=p,f.push(p)}switch(u){case s:this.normal.dot(e.plane.normal)>0?t.push(e):n.push(e);break;case o:i.push(e);break;case l:r.push(e);break;case c:let h=[],d=[];for(let p=0;p<e.vertices.length;p++){let m=(p+1)%e.vertices.length,v=f[p],x=f[m],g=e.vertices[p],y=e.vertices[m];if(v!==l&&h.push(g),v!==o&&d.push(v!==l?g.clone():g),(v|x)===c){let _=(this.w-this.normal.dot(g.pos))/this.normal.dot(y.pos.minus(g.pos)),w=g.interpolate(y,_);h.push(w),d.push(w.clone())}}h.length>=3&&i.push(new Ko(h,e.shared)),d.length>=3&&r.push(new Ko(d,e.shared));break}}};Hr.EPSILON=1e-5;var Ko=class{constructor(e,t=null){this.vertices=e,this.shared=t,this.plane=Hr.fromPoints(e[0].pos,e[1].pos,e[2].pos)}clone(){let e=this.vertices.map(t=>t.clone());return new Ko(e,this.shared)}flip(){this.vertices.reverse().map(e=>{e.flip()}),this.plane.flip()}},ui=class{constructor(e){delete this.plane,delete this.front,delete this.back,this.polygons=[],e&&this.build(e)}clone(){let e=new ui;return e.plane=this.plane&&this.plane.clone(),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.polygons=this.polygons.map(t=>t.clone()),e}invert(){for(let t of this.polygons)t.flip();this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();let e=this.front;this.front=this.back,this.back=e}clipPolygons(e){if(!this.plane)return e.slice();let t=[],n=[];for(let i of e)this.plane.splitPolygon(i,t,n,t,n);return this.front&&(t=this.front.clipPolygons(t)),n=this.back?this.back.clipPolygons(n):[],t.concat(n)}clipTo(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)}allPolygons(){let e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e}build(e){if(!e.length)return;this.plane||(this.plane=e[0].plane.clone());let t=[],n=[];for(let i of e)this.plane.splitPolygon(i,this.polygons,this.polygons,t,n);t.length&&(this.front||(this.front=new ui),this.front.build(t)),n.length&&(this.back||(this.back=new ui),this.back.build(n))}};var up={};Um(up,{AsyncCompress:()=>JA,AsyncDecompress:()=>e2,AsyncDeflate:()=>qv,AsyncGunzip:()=>Zv,AsyncGzip:()=>JA,AsyncInflate:()=>tp,AsyncUnzipInflate:()=>u2,AsyncUnzlib:()=>$v,AsyncZipDeflate:()=>o2,AsyncZlib:()=>QA,Compress:()=>ip,DecodeUTF8:()=>i2,Decompress:()=>Kv,Deflate:()=>Ii,EncodeUTF8:()=>r2,Gunzip:()=>kh,Gzip:()=>ip,Inflate:()=>vn,Unzip:()=>f2,UnzipInflate:()=>h2,UnzipPassThrough:()=>ay,Unzlib:()=>Uh,Zip:()=>a2,ZipDeflate:()=>s2,ZipPassThrough:()=>Pl,Zlib:()=>sp,compress:()=>$A,compressSync:()=>rp,decompress:()=>t2,decompressSync:()=>n2,deflate:()=>Yv,deflateSync:()=>El,gunzip:()=>Jv,gunzipSync:()=>zh,gzip:()=>$A,gzipSync:()=>rp,inflate:()=>np,inflateSync:()=>ha,strFromU8:()=>cp,strToU8:()=>Wr,unzip:()=>d2,unzipSync:()=>p2,unzlib:()=>Qv,unzlibSync:()=>Al,zip:()=>l2,zipSync:()=>c2,zlib:()=>KA,zlibSync:()=>op});var Ev={},Hd=function(a){return URL.createObjectURL(new Blob([a],{type:"text/javascript"}))},Av=function(a){return new Worker(a)};try{URL.revokeObjectURL(Hd(""))}catch(a){Hd=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},Av=function(e){return new Worker(e,{type:"module"})}}var YA=function(a,e,t,n,i){var r=Av(Ev[e]||(Ev[e]=Hd(a)));return r.onerror=function(s){return i(s.error,null)},r.onmessage=function(s){return i(null,s.data)},r.postMessage(t,n),r},Xe=Uint8Array,Wt=Uint16Array,nr=Uint32Array,ea=new Xe([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ta=new Xe([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),wl=new Xe([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Pv=function(a,e){for(var t=new Wt(31),n=0;n<31;++n)t[n]=e+=1<<a[n-1];for(var i=new nr(t[30]),n=1;n<30;++n)for(var r=t[n];r<t[n+1];++r)i[r]=r-t[n]<<5|n;return[t,i]},Cv=Pv(ea,2),Gd=Cv[0],Ih=Cv[1];Gd[28]=258,Ih[258]=28;var Lv=Pv(ta,0),Rv=Lv[0],Wd=Lv[1],_l=new Wt(32768);for($e=0;$e<32768;++$e)ir=($e&43690)>>>1|($e&21845)<<1,ir=(ir&52428)>>>2|(ir&13107)<<2,ir=(ir&61680)>>>4|(ir&3855)<<4,_l[$e]=((ir&65280)>>>8|(ir&255)<<8)>>>1;var ir,$e,Gn=function(a,e,t){for(var n=a.length,i=0,r=new Wt(e);i<n;++i)++r[a[i]-1];var s=new Wt(e);for(i=0;i<e;++i)s[i]=s[i-1]+r[i-1]<<1;var o;if(t){o=new Wt(1<<e);var l=15-e;for(i=0;i<n;++i)if(a[i])for(var c=i<<4|a[i],u=e-a[i],f=s[a[i]-1]++<<u,h=f|(1<<u)-1;f<=h;++f)o[_l[f]>>>l]=c}else for(o=new Wt(n),i=0;i<n;++i)a[i]&&(o[i]=_l[s[a[i]-1]++]>>>15-a[i]);return o},rr=new Xe(288);for($e=0;$e<144;++$e)rr[$e]=8;var $e;for($e=144;$e<256;++$e)rr[$e]=9;var $e;for($e=256;$e<280;++$e)rr[$e]=7;var $e;for($e=280;$e<288;++$e)rr[$e]=8;var $e,na=new Xe(32);for($e=0;$e<32;++$e)na[$e]=5;var $e,Iv=Gn(rr,9,0),Dv=Gn(rr,9,1),Fv=Gn(na,5,0),Bv=Gn(na,5,1),Dh=function(a){for(var e=a[0],t=1;t<a.length;++t)a[t]>e&&(e=a[t]);return e},Wn=function(a,e,t){var n=e/8|0;return(a[n]|a[n+1]<<8)>>(e&7)&t},Fh=function(a,e){var t=e/8|0;return(a[t]|a[t+1]<<8|a[t+2]<<16)>>(e&7)},bl=function(a){return(a/8|0)+(a&7&&1)},Xn=function(a,e,t){(e==null||e<0)&&(e=0),(t==null||t>a.length)&&(t=a.length);var n=new(a instanceof Wt?Wt:a instanceof nr?nr:Xe)(t-e);return n.set(a.subarray(e,t)),n},Ml=function(a,e,t){var n=a.length;if(!n||t&&!t.l&&n<5)return e||new Xe(0);var i=!e||t,r=!t||t.i;t||(t={}),e||(e=new Xe(n*3));var s=function(W){var X=e.length;if(W>X){var te=new Xe(Math.max(X*2,W));te.set(e),e=te}},o=t.f||0,l=t.p||0,c=t.b||0,u=t.l,f=t.d,h=t.m,d=t.n,p=n*8;do{if(!u){t.f=o=Wn(a,l,1);var m=Wn(a,l+1,3);if(l+=3,m)if(m==1)u=Dv,f=Bv,h=9,d=5;else if(m==2){var y=Wn(a,l,31)+257,_=Wn(a,l+10,15)+4,w=y+Wn(a,l+5,31)+1;l+=14;for(var b=new Xe(w),S=new Xe(19),M=0;M<_;++M)S[wl[M]]=Wn(a,l+M*3,7);l+=_*3;for(var T=Dh(S),E=(1<<T)-1,A=Gn(S,T,1),M=0;M<w;){var I=A[Wn(a,l,E)];l+=I&15;var v=I>>>4;if(v<16)b[M++]=v;else{var C=0,R=0;for(v==16?(R=3+Wn(a,l,3),l+=2,C=b[M-1]):v==17?(R=3+Wn(a,l,7),l+=3):v==18&&(R=11+Wn(a,l,127),l+=7);R--;)b[M++]=C}}var D=b.subarray(0,y),F=b.subarray(y);h=Dh(D),d=Dh(F),u=Gn(D,h,1),f=Gn(F,d,1)}else throw"invalid block type";else{var v=bl(l)+4,x=a[v-4]|a[v-3]<<8,g=v+x;if(g>n){if(r)throw"unexpected EOF";break}i&&s(c+x),e.set(a.subarray(v,g),c),t.b=c+=x,t.p=l=g*8;continue}if(l>p){if(r)throw"unexpected EOF";break}}i&&s(c+131072);for(var O=(1<<h)-1,U=(1<<d)-1,j=l;;j=l){var C=u[Fh(a,l)&O],Z=C>>>4;if(l+=C&15,l>p){if(r)throw"unexpected EOF";break}if(!C)throw"invalid length/literal";if(Z<256)e[c++]=Z;else if(Z==256){j=l,u=null;break}else{var K=Z-254;if(Z>264){var M=Z-257,G=ea[M];K=Wn(a,l,(1<<G)-1)+Gd[M],l+=G}var k=f[Fh(a,l)&U],B=k>>>4;if(!k)throw"invalid distance";l+=k&15;var F=Rv[B];if(B>3){var G=ta[B];F+=Fh(a,l)&(1<<G)-1,l+=G}if(l>p){if(r)throw"unexpected EOF";break}i&&s(c+131072);for(var H=c+K;c<H;c+=4)e[c]=e[c-F],e[c+1]=e[c+1-F],e[c+2]=e[c+2-F],e[c+3]=e[c+3-F];c=H}}t.l=u,t.p=j,t.b=c,u&&(o=1,t.m=h,t.d=f,t.n=d)}while(!o);return c==e.length?e:Xn(e,0,c)},Ri=function(a,e,t){t<<=e&7;var n=e/8|0;a[n]|=t,a[n+1]|=t>>>8},ia=function(a,e,t){t<<=e&7;var n=e/8|0;a[n]|=t,a[n+1]|=t>>>8,a[n+2]|=t>>>16},Bh=function(a,e){for(var t=[],n=0;n<a.length;++n)a[n]&&t.push({s:n,f:a[n]});var i=t.length,r=t.slice();if(!i)return[sr,0];if(i==1){var s=new Xe(t[0].s+1);return s[t[0].s]=1,[s,1]}t.sort(function(w,b){return w.f-b.f}),t.push({s:-1,f:25001});var o=t[0],l=t[1],c=0,u=1,f=2;for(t[0]={s:-1,f:o.f+l.f,l:o,r:l};u!=i-1;)o=t[t[c].f<t[f].f?c++:f++],l=t[c!=u&&t[c].f<t[f].f?c++:f++],t[u++]={s:-1,f:o.f+l.f,l:o,r:l};for(var h=r[0].s,n=1;n<i;++n)r[n].s>h&&(h=r[n].s);var d=new Wt(h+1),p=Nh(t[u-1],d,0);if(p>e){var n=0,m=0,v=p-e,x=1<<v;for(r.sort(function(b,S){return d[S.s]-d[b.s]||b.f-S.f});n<i;++n){var g=r[n].s;if(d[g]>e)m+=x-(1<<p-d[g]),d[g]=e;else break}for(m>>>=v;m>0;){var y=r[n].s;d[y]<e?m-=1<<e-d[y]++-1:++n}for(;n>=0&&m;--n){var _=r[n].s;d[_]==e&&(--d[_],++m)}p=e}return[new Xe(d),p]},Nh=function(a,e,t){return a.s==-1?Math.max(Nh(a.l,e,t+1),Nh(a.r,e,t+1)):e[a.s]=t},Xd=function(a){for(var e=a.length;e&&!a[--e];);for(var t=new Wt(++e),n=0,i=a[0],r=1,s=function(l){t[n++]=l},o=1;o<=e;++o)if(a[o]==i&&o!=e)++r;else{if(!i&&r>2){for(;r>138;r-=138)s(32754);r>2&&(s(r>10?r-11<<5|28690:r-3<<5|12305),r=0)}else if(r>3){for(s(i),--r;r>6;r-=6)s(8304);r>2&&(s(r-3<<5|8208),r=0)}for(;r--;)s(i);r=1,i=a[o]}return[t.subarray(0,n),e]},ra=function(a,e){for(var t=0,n=0;n<e.length;++n)t+=a[n]*e[n];return t},Sl=function(a,e,t){var n=t.length,i=bl(e+2);a[i]=n&255,a[i+1]=n>>>8,a[i+2]=a[i]^255,a[i+3]=a[i+1]^255;for(var r=0;r<n;++r)a[i+r+4]=t[r];return(i+4+n)*8},jd=function(a,e,t,n,i,r,s,o,l,c,u){Ri(e,u++,t),++i[256];for(var f=Bh(i,15),h=f[0],d=f[1],p=Bh(r,15),m=p[0],v=p[1],x=Xd(h),g=x[0],y=x[1],_=Xd(m),w=_[0],b=_[1],S=new Wt(19),M=0;M<g.length;++M)S[g[M]&31]++;for(var M=0;M<w.length;++M)S[w[M]&31]++;for(var T=Bh(S,7),E=T[0],A=T[1],I=19;I>4&&!E[wl[I-1]];--I);var C=c+5<<3,R=ra(i,rr)+ra(r,na)+s,D=ra(i,h)+ra(r,m)+s+14+3*I+ra(S,E)+(2*S[16]+3*S[17]+7*S[18]);if(C<=R&&C<=D)return Sl(e,u,a.subarray(l,l+c));var F,O,U,j;if(Ri(e,u,1+(D<R)),u+=2,D<R){F=Gn(h,d,0),O=h,U=Gn(m,v,0),j=m;var Z=Gn(E,A,0);Ri(e,u,y-257),Ri(e,u+5,b-1),Ri(e,u+10,I-4),u+=14;for(var M=0;M<I;++M)Ri(e,u+3*M,E[wl[M]]);u+=3*I;for(var K=[g,w],G=0;G<2;++G)for(var k=K[G],M=0;M<k.length;++M){var B=k[M]&31;Ri(e,u,Z[B]),u+=E[B],B>15&&(Ri(e,u,k[M]>>>5&127),u+=k[M]>>>12)}}else F=Iv,O=rr,U=Fv,j=na;for(var M=0;M<o;++M)if(n[M]>255){var B=n[M]>>>18&31;ia(e,u,F[B+257]),u+=O[B+257],B>7&&(Ri(e,u,n[M]>>>23&31),u+=ea[B]);var H=n[M]&31;ia(e,u,U[H]),u+=j[H],H>3&&(ia(e,u,n[M]>>>5&8191),u+=ta[H])}else ia(e,u,F[n[M]]),u+=O[n[M]];return ia(e,u,F[256]),u+O[256]},Nv=new nr([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),sr=new Xe(0),Ov=function(a,e,t,n,i,r){var s=a.length,o=new Xe(n+s+5*(1+Math.ceil(s/7e3))+i),l=o.subarray(n,o.length-i),c=0;if(!e||s<8)for(var u=0;u<=s;u+=65535){var f=u+65535;f<s?c=Sl(l,c,a.subarray(u,f)):(l[u]=r,c=Sl(l,c,a.subarray(u,s)))}else{for(var h=Nv[e-1],d=h>>>13,p=h&8191,m=(1<<t)-1,v=new Wt(32768),x=new Wt(m+1),g=Math.ceil(t/3),y=2*g,_=function(Q){return(a[Q]^a[Q+1]<<g^a[Q+2]<<y)&m},w=new nr(25e3),b=new Wt(288),S=new Wt(32),M=0,T=0,u=0,E=0,A=0,I=0;u<s;++u){var C=_(u),R=u&32767,D=x[C];if(v[R]=D,x[C]=R,A<=u){var F=s-u;if((M>7e3||E>24576)&&F>423){c=jd(a,l,0,w,b,S,T,E,I,u-I,c),E=M=T=0,I=u;for(var O=0;O<286;++O)b[O]=0;for(var O=0;O<30;++O)S[O]=0}var U=2,j=0,Z=p,K=R-D&32767;if(F>2&&C==_(u-K))for(var G=Math.min(d,F)-1,k=Math.min(32767,u),B=Math.min(258,F);K<=k&&--Z&&R!=D;){if(a[u+U]==a[u+U-K]){for(var H=0;H<B&&a[u+H]==a[u+H-K];++H);if(H>U){if(U=H,j=K,H>G)break;for(var W=Math.min(K,H-2),X=0,O=0;O<W;++O){var te=u-K+O+32768&32767,he=v[te],ae=te-he+32768&32767;ae>X&&(X=ae,D=te)}}}R=D,D=v[R],K+=R-D+32768&32767}if(j){w[E++]=268435456|Ih[U]<<18|Wd[j];var ce=Ih[U]&31,q=Wd[j]&31;T+=ea[ce]+ta[q],++b[257+ce],++S[q],A=u+U,++M}else w[E++]=a[u],++b[a[u]]}}c=jd(a,l,r,w,b,S,T,E,I,u-I,c),!r&&c&7&&(c=Sl(l,c+1,sr))}return Xn(o,0,n+bl(c)+i)},kv=function(){for(var a=new nr(256),e=0;e<256;++e){for(var t=e,n=9;--n;)t=(t&1&&3988292384)^t>>>1;a[e]=t}return a}(),sa=function(){var a=-1;return{p:function(e){for(var t=a,n=0;n<e.length;++n)t=kv[t&255^e[n]]^t>>>8;a=t},d:function(){return~a}}},qd=function(){var a=1,e=0;return{p:function(t){for(var n=a,i=e,r=t.length,s=0;s!=r;){for(var o=Math.min(s+2655,r);s<o;++s)i+=n+=t[s];n=(n&65535)+15*(n>>16),i=(i&65535)+15*(i>>16)}a=n,e=i},d:function(){return a%=65521,e%=65521,(a&255)<<24|a>>>8<<16|(e&255)<<8|e>>>8}}},Fs=function(a,e,t,n,i){return Ov(a,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(a.length)))*1.5):12+e.mem,t,n,!i)},Tl=function(a,e){var t={};for(var n in a)t[n]=a[n];for(var n in e)t[n]=e[n];return t},zv=function(a,e,t){for(var n=a(),i=a.toString(),r=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/ /g,"").split(","),s=0;s<n.length;++s){var o=n[s],l=r[s];if(typeof o=="function"){e+=";"+l+"=";var c=o.toString();if(o.prototype)if(c.indexOf("[native code]")!=-1){var u=c.indexOf(" ",8)+1;e+=c.slice(u,c.indexOf("(",u))}else{e+=c;for(var f in o.prototype)e+=";"+l+".prototype."+f+"="+o.prototype[f].toString()}else e+=c}else t[l]=o}return[e,t]},Oh=[],ZA=function(a){var e=[];for(var t in a)(a[t]instanceof Xe||a[t]instanceof Wt||a[t]instanceof nr)&&e.push((a[t]=new a[t].constructor(a[t])).buffer);return e},Uv=function(a,e,t,n){var i;if(!Oh[t]){for(var r="",s={},o=a.length-1,l=0;l<o;++l)i=zv(a[l],r,s),r=i[0],s=i[1];Oh[t]=zv(a[o],r,s)}var c=Tl({},Oh[t][1]);return YA(Oh[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,c,ZA(c),n)},oa=function(){return[Xe,Wt,nr,ea,ta,wl,Gd,Rv,Dv,Bv,_l,Gn,Dh,Wn,Fh,bl,Xn,Ml,ha,Gr,Yd]},aa=function(){return[Xe,Wt,nr,ea,ta,wl,Ih,Wd,Iv,rr,Fv,na,_l,Nv,sr,Gn,Ri,ia,Bh,Nh,Xd,ra,Sl,jd,bl,Xn,Ov,Fs,El,Gr]},Vv=function(){return[Jd,Qd,tt,sa,kv]},Hv=function(){return[$d,Xv]},Gv=function(){return[Kd,tt,qd]},Wv=function(){return[jv]},Gr=function(a){return postMessage(a,[a.buffer])},Yd=function(a){return a&&a.size&&new Xe(a.size)},la=function(a,e,t,n,i,r){var s=Uv(t,n,i,function(o,l){s.terminate(),r(o,l)});return s.postMessage([a,e],e.consume?[a.buffer]:[]),function(){s.terminate()}},jn=function(a){return a.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(e){return a.push(e.data[0],e.data[1])}},ca=function(a,e,t,n,i){var r,s=Uv(a,n,i,function(o,l){o?(s.terminate(),e.ondata.call(e,o)):(l[1]&&s.terminate(),e.ondata.call(e,o,l[0],l[1]))});s.postMessage(t),e.push=function(o,l){if(r)throw"stream finished";if(!e.ondata)throw"no stream handler";s.postMessage([o,r=l],[o.buffer])},e.terminate=function(){s.terminate()}},fn=function(a,e){return a[e]|a[e+1]<<8},Rt=function(a,e){return(a[e]|a[e+1]<<8|a[e+2]<<16|a[e+3]<<24)>>>0},Zd=function(a,e){return Rt(a,e)+Rt(a,e+4)*4294967296},tt=function(a,e,t){for(;t;++e)a[e]=t,t>>>=8},Jd=function(a,e){var t=e.filename;if(a[0]=31,a[1]=139,a[2]=8,a[8]=e.level<2?4:e.level==9?2:0,a[9]=3,e.mtime!=0&&tt(a,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){a[3]=8;for(var n=0;n<=t.length;++n)a[n+10]=t.charCodeAt(n)}},$d=function(a){if(a[0]!=31||a[1]!=139||a[2]!=8)throw"invalid gzip data";var e=a[3],t=10;e&4&&(t+=a[10]|(a[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!a[t++]);return t+(e&2)},Xv=function(a){var e=a.length;return(a[e-4]|a[e-3]<<8|a[e-2]<<16|a[e-1]<<24)>>>0},Qd=function(a){return 10+(a.filename&&a.filename.length+1||0)},Kd=function(a,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;a[0]=120,a[1]=n<<6|(n?32-2*n:1)},jv=function(a){if((a[0]&15)!=8||a[0]>>>4>7||(a[0]<<8|a[1])%31)throw"invalid zlib data";if(a[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function ep(a,e){return!e&&typeof a=="function"&&(e=a,a={}),this.ondata=e,a}var Ii=function(){function a(e,t){!t&&typeof e=="function"&&(t=e,e={}),this.ondata=t,this.o=e||{}}return a.prototype.p=function(e,t){this.ondata(Fs(e,this.o,0,0,!t),t)},a.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},a}();var qv=function(){function a(e,t){ca([aa,function(){return[jn,Ii]}],this,ep.call(this,e,t),function(n){var i=new Ii(n.data);onmessage=jn(i)},6)}return a}();function Yv(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return la(a,e,[aa],function(n){return Gr(El(n.data[0],n.data[1]))},0,t)}function El(a,e){return Fs(a,e||{},0,0)}var vn=function(){function a(e){this.s={},this.p=new Xe(0),this.ondata=e}return a.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,n=new Xe(t+e.length);n.set(this.p),n.set(e,t),this.p=n},a.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=Ml(this.p,this.o,this.s);this.ondata(Xn(n,t,this.s.b),this.d),this.o=Xn(n,this.s.b-32768),this.s.b=this.o.length,this.p=Xn(this.p,this.s.p/8|0),this.s.p&=7},a.prototype.push=function(e,t){this.e(e),this.c(t)},a}();var tp=function(){function a(e){this.ondata=e,ca([oa,function(){return[jn,vn]}],this,0,function(){var t=new vn;onmessage=jn(t)},7)}return a}();function np(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return la(a,e,[oa],function(n){return Gr(ha(n.data[0],Yd(n.data[1])))},1,t)}function ha(a,e){return Ml(a,e)}var ip=function(){function a(e,t){this.c=sa(),this.l=0,this.v=1,Ii.call(this,e,t)}return a.prototype.push=function(e,t){Ii.prototype.push.call(this,e,t)},a.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=Fs(e,this.o,this.v&&Qd(this.o),t&&8,!t);this.v&&(Jd(n,this.o),this.v=0),t&&(tt(n,n.length-8,this.c.d()),tt(n,n.length-4,this.l)),this.ondata(n,t)},a}();var JA=function(){function a(e,t){ca([aa,Vv,function(){return[jn,Ii,ip]}],this,ep.call(this,e,t),function(n){var i=new ip(n.data);onmessage=jn(i)},8)}return a}();function $A(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return la(a,e,[aa,Vv,function(){return[rp]}],function(n){return Gr(rp(n.data[0],n.data[1]))},2,t)}function rp(a,e){e||(e={});var t=sa(),n=a.length;t.p(a);var i=Fs(a,e,Qd(e),8),r=i.length;return Jd(i,e),tt(i,r-8,t.d()),tt(i,r-4,n),i}var kh=function(){function a(e){this.v=1,vn.call(this,e)}return a.prototype.push=function(e,t){if(vn.prototype.e.call(this,e),this.v){var n=this.p.length>3?$d(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}vn.prototype.c.call(this,t)},a}();var Zv=function(){function a(e){this.ondata=e,ca([oa,Hv,function(){return[jn,vn,kh]}],this,0,function(){var t=new kh;onmessage=jn(t)},9)}return a}();function Jv(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return la(a,e,[oa,Hv,function(){return[zh]}],function(n){return Gr(zh(n.data[0]))},3,t)}function zh(a,e){return Ml(a.subarray($d(a),-8),e||new Xe(Xv(a)))}var sp=function(){function a(e,t){this.c=qd(),this.v=1,Ii.call(this,e,t)}return a.prototype.push=function(e,t){Ii.prototype.push.call(this,e,t)},a.prototype.p=function(e,t){this.c.p(e);var n=Fs(e,this.o,this.v&&2,t&&4,!t);this.v&&(Kd(n,this.o),this.v=0),t&&tt(n,n.length-4,this.c.d()),this.ondata(n,t)},a}();var QA=function(){function a(e,t){ca([aa,Gv,function(){return[jn,Ii,sp]}],this,ep.call(this,e,t),function(n){var i=new sp(n.data);onmessage=jn(i)},10)}return a}();function KA(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return la(a,e,[aa,Gv,function(){return[op]}],function(n){return Gr(op(n.data[0],n.data[1]))},4,t)}function op(a,e){e||(e={});var t=qd();t.p(a);var n=Fs(a,e,2,4);return Kd(n,e),tt(n,n.length-4,t.d()),n}var Uh=function(){function a(e){this.v=1,vn.call(this,e)}return a.prototype.push=function(e,t){if(vn.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}vn.prototype.c.call(this,t)},a}();var $v=function(){function a(e){this.ondata=e,ca([oa,Wv,function(){return[jn,vn,Uh]}],this,0,function(){var t=new Uh;onmessage=jn(t)},11)}return a}();function Qv(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return la(a,e,[oa,Wv,function(){return[Al]}],function(n){return Gr(Al(n.data[0],Yd(n.data[1])))},5,t)}function Al(a,e){return Ml((jv(a),a.subarray(2,-4)),e)}var Kv=function(){function a(e){this.G=kh,this.I=vn,this.Z=Uh,this.ondata=e}return a.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new Xe(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var i=this,r=function(){i.ondata.apply(i,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(r):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(r):new this.Z(r),this.s.push(this.p,t),this.p=null}}},a}();var e2=function(){function a(e){this.G=Zv,this.I=tp,this.Z=$v,this.ondata=e}return a.prototype.push=function(e,t){Kv.prototype.push.call(this,e,t)},a}();function t2(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return a[0]==31&&a[1]==139&&a[2]==8?Jv(a,e,t):(a[0]&15)!=8||a[0]>>4>7||(a[0]<<8|a[1])%31?np(a,e,t):Qv(a,e,t)}function n2(a,e){return a[0]==31&&a[1]==139&&a[2]==8?zh(a,e):(a[0]&15)!=8||a[0]>>4>7||(a[0]<<8|a[1])%31?ha(a,e):Al(a,e)}var ap=function(a,e,t,n){for(var i in a){var r=a[i],s=e+i;r instanceof Xe?t[s]=[r,n]:Array.isArray(r)?t[s]=[r[0],Tl(n,r[1])]:ap(r,s+"/",t,n)}},ey=typeof TextEncoder!="undefined"&&new TextEncoder,lp=typeof TextDecoder!="undefined"&&new TextDecoder,ty=0;try{lp.decode(sr,{stream:!0}),ty=1}catch(a){}var ny=function(a){for(var e="",t=0;;){var n=a[t++],i=(n>127)+(n>223)+(n>239);if(t+i>a.length)return[e,Xn(a,t-1)];i?i==3?(n=((n&15)<<18|(a[t++]&63)<<12|(a[t++]&63)<<6|a[t++]&63)-65536,e+=String.fromCharCode(55296|n>>10,56320|n&1023)):i&1?e+=String.fromCharCode((n&31)<<6|a[t++]&63):e+=String.fromCharCode((n&15)<<12|(a[t++]&63)<<6|a[t++]&63):e+=String.fromCharCode(n)}},i2=function(){function a(e){this.ondata=e,ty?this.t=new TextDecoder:this.p=sr}return a.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}return}if(!this.p)throw"stream finished";var n=new Xe(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length);var i=ny(n),r=i[0],s=i[1];if(t){if(s.length)throw"invalid utf-8 data";this.p=null}else this.p=s;this.ondata(r,t)},a}();var r2=function(){function a(e){this.ondata=e}return a.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(Wr(e),this.d=t||!1)},a}();function Wr(a,e){if(e){for(var t=new Xe(a.length),n=0;n<a.length;++n)t[n]=a.charCodeAt(n);return t}if(ey)return ey.encode(a);for(var i=a.length,r=new Xe(a.length+(a.length>>1)),s=0,o=function(u){r[s++]=u},n=0;n<i;++n){if(s+5>r.length){var l=new Xe(s+8+(i-n<<1));l.set(r),r=l}var c=a.charCodeAt(n);c<128||e?o(c):c<2048?(o(192|c>>6),o(128|c&63)):c>55295&&c<57344?(c=65536+(c&1023<<10)|a.charCodeAt(++n)&1023,o(240|c>>18),o(128|c>>12&63),o(128|c>>6&63),o(128|c&63)):(o(224|c>>12),o(128|c>>6&63),o(128|c&63))}return Xn(r,0,s)}function cp(a,e){if(e){for(var t="",n=0;n<a.length;n+=16384)t+=String.fromCharCode.apply(null,a.subarray(n,n+16384));return t}else{if(lp)return lp.decode(a);var i=ny(a),r=i[0],s=i[1];if(s.length)throw"invalid utf-8 data";return r}}var iy=function(a){return a==1?3:a<6?2:a==9?1:0},ry=function(a,e){return e+30+fn(a,e+26)+fn(a,e+28)},sy=function(a,e,t){var n=fn(a,e+28),i=cp(a.subarray(e+46,e+46+n),!(fn(a,e+8)&2048)),r=e+46+n,s=Rt(a,e+20),o=t&&s==4294967295?oy(a,r):[s,Rt(a,e+24),Rt(a,e+42)],l=o[0],c=o[1],u=o[2];return[fn(a,e+10),l,c,i,r+fn(a,e+30)+fn(a,e+32),u]},oy=function(a,e){for(;fn(a,e)!=1;e+=4+fn(a,e+2));return[Zd(a,e+12),Zd(a,e+4),Zd(a,e+20)]},Xr=function(a){var e=0;if(a)for(var t in a){var n=a[t].length;if(n>65535)throw"extra field too long";e+=n+4}return e},ua=function(a,e,t,n,i,r,s,o){var l=n.length,c=t.extra,u=o&&o.length,f=Xr(c);tt(a,e,s!=null?33639248:67324752),e+=4,s!=null&&(a[e++]=20,a[e++]=t.os),a[e]=20,e+=2,a[e++]=t.flag<<1|(r==null&&8),a[e++]=i&&8,a[e++]=t.compression&255,a[e++]=t.compression>>8;var h=new Date(t.mtime==null?Date.now():t.mtime),d=h.getFullYear()-1980;if(d<0||d>119)throw"date not in range 1980-2099";if(tt(a,e,d<<25|h.getMonth()+1<<21|h.getDate()<<16|h.getHours()<<11|h.getMinutes()<<5|h.getSeconds()>>>1),e+=4,r!=null&&(tt(a,e,t.crc),tt(a,e+4,r),tt(a,e+8,t.size)),tt(a,e+12,l),tt(a,e+14,f),e+=16,s!=null&&(tt(a,e,u),tt(a,e+6,t.attrs),tt(a,e+10,s),e+=14),a.set(n,e),e+=l,f)for(var p in c){var m=c[p],v=m.length;tt(a,e,+p),tt(a,e+2,v),a.set(m,e+4),e+=4+v}return u&&(a.set(o,e),e+=u),e},hp=function(a,e,t,n,i){tt(a,e,101010256),tt(a,e+8,t),tt(a,e+10,t),tt(a,e+12,n),tt(a,e+16,i)},Pl=function(){function a(e){this.filename=e,this.c=sa(),this.size=0,this.compression=0}return a.prototype.process=function(e,t){this.ondata(null,e,t)},a.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},a}();var s2=function(){function a(e,t){var n=this;t||(t={}),Pl.call(this,e),this.d=new Ii(t,function(i,r){n.ondata(null,i,r)}),this.compression=8,this.flag=iy(t.level)}return a.prototype.process=function(e,t){try{this.d.push(e,t)}catch(n){this.ondata(n,null,t)}},a.prototype.push=function(e,t){Pl.prototype.push.call(this,e,t)},a}();var o2=function(){function a(e,t){var n=this;t||(t={}),Pl.call(this,e),this.d=new qv(t,function(i,r,s){n.ondata(i,r,s)}),this.compression=8,this.flag=iy(t.level),this.terminate=this.d.terminate}return a.prototype.process=function(e,t){this.d.push(e,t)},a.prototype.push=function(e,t){Pl.prototype.push.call(this,e,t)},a}();var a2=function(){function a(e){this.ondata=e,this.u=[],this.d=1}return a.prototype.add=function(e){var t=this;if(this.d&2)throw"stream finished";var n=Wr(e.filename),i=n.length,r=e.comment,s=r&&Wr(r),o=i!=e.filename.length||s&&r.length!=s.length,l=i+Xr(e.extra)+30;if(i>65535)throw"filename too long";var c=new Xe(l);ua(c,0,e,n,o);var u=[c],f=function(){for(var v=0,x=u;v<x.length;v++){var g=x[v];t.ondata(null,g,!1)}u=[]},h=this.d;this.d=0;var d=this.u.length,p=Tl(e,{f:n,u:o,o:s,t:function(){e.terminate&&e.terminate()},r:function(){if(f(),h){var v=t.u[d+1];v?v.r():t.d=1}h=1}}),m=0;e.ondata=function(v,x,g){if(v)t.ondata(v,x,g),t.terminate();else if(m+=x.length,u.push(x),g){var y=new Xe(16);tt(y,0,134695760),tt(y,4,e.crc),tt(y,8,m),tt(y,12,e.size),u.push(y),p.c=m,p.b=l+m+16,p.crc=e.crc,p.size=e.size,h&&p.r(),h=1}else h&&f()},this.u.push(p)},a.prototype.end=function(){var e=this;if(this.d&2)throw this.d&1?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){!(e.d&1)||(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},a.prototype.e=function(){for(var e=0,t=0,n=0,i=0,r=this.u;i<r.length;i++){var s=r[i];n+=46+s.f.length+Xr(s.extra)+(s.o?s.o.length:0)}for(var o=new Xe(n+22),l=0,c=this.u;l<c.length;l++){var s=c[l];ua(o,e,s,s.f,s.u,s.c,t,s.o),e+=46+s.f.length+Xr(s.extra)+(s.o?s.o.length:0),t+=s.b}hp(o,e,this.u.length,n,t),this.ondata(null,o,!0),this.d=2},a.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++){var n=t[e];n.t()}this.d=2},a}();function l2(a,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";var n={};ap(a,"",n,e);var i=Object.keys(n),r=i.length,s=0,o=0,l=r,c=new Array(r),u=[],f=function(){for(var m=0;m<u.length;++m)u[m]()},h=function(){var m=new Xe(o+22),v=s,x=o-s;o=0;for(var g=0;g<l;++g){var y=c[g];try{var _=y.c.length;ua(m,o,y,y.f,y.u,_);var w=30+y.f.length+Xr(y.extra),b=o+w;m.set(y.c,b),ua(m,s,y,y.f,y.u,_,o,y.m),s+=16+w+(y.m?y.m.length:0),o=b+_}catch(S){return t(S,null)}}hp(m,s,c.length,x,v),t(null,m)};r||h();for(var d=function(m){var v=i[m],x=n[v],g=x[0],y=x[1],_=sa(),w=g.length;_.p(g);var b=Wr(v),S=b.length,M=y.comment,T=M&&Wr(M),E=T&&T.length,A=Xr(y.extra),I=y.level==0?0:8,C=function(R,D){if(R)f(),t(R,null);else{var F=D.length;c[m]=Tl(y,{size:w,crc:_.d(),c:D,f:b,m:T,u:S!=v.length||T&&M.length!=E,compression:I}),s+=30+S+A+F,o+=76+2*(S+A)+(E||0)+F,--r||h()}};if(S>65535&&C("filename too long",null),!I)C(null,g);else if(w<16e4)try{C(null,El(g,y))}catch(R){C(R,null)}else u.push(Yv(g,y,C))},p=0;p<l;++p)d(p);return f}function c2(a,e){e||(e={});var t={},n=[];ap(a,"",t,e);var i=0,r=0;for(var s in t){var o=t[s],l=o[0],c=o[1],u=c.level==0?0:8,f=Wr(s),h=f.length,d=c.comment,p=d&&Wr(d),m=p&&p.length,v=Xr(c.extra);if(h>65535)throw"filename too long";var x=u?El(l,c):l,g=x.length,y=sa();y.p(l),n.push(Tl(c,{size:l.length,crc:y.d(),c:x,f,m:p,u:h!=s.length||p&&d.length!=m,o:i,compression:u})),i+=30+h+v+g,r+=76+2*(h+v)+(m||0)+g}for(var _=new Xe(r+22),w=i,b=r-i,S=0;S<n.length;++S){var f=n[S];ua(_,f.o,f,f.f,f.u,f.c.length);var M=30+f.f.length+Xr(f.extra);_.set(f.c,f.o+M),ua(_,i,f,f.f,f.u,f.c.length,f.o,f.m),i+=16+M+(f.m?f.m.length:0)}return hp(_,i,n.length,b,w),_}var ay=function(){function a(){}return a.prototype.push=function(e,t){this.ondata(null,e,t)},a.compression=0,a}();var h2=function(){function a(){var e=this;this.i=new vn(function(t,n){e.ondata(null,t,n)})}return a.prototype.push=function(e,t){try{this.i.push(e,t)}catch(n){this.ondata(n,e,t)}},a.compression=8,a}();var u2=function(){function a(e,t){var n=this;t<32e4?this.i=new vn(function(i,r){n.ondata(null,i,r)}):(this.i=new tp(function(i,r,s){n.ondata(i,r,s)}),this.terminate=this.i.terminate)}return a.prototype.push=function(e,t){this.i.terminate&&(e=Xn(e,0)),this.i.push(e,t)},a.compression=8,a}();var f2=function(){function a(e){this.onfile=e,this.k=[],this.o={0:ay},this.p=sr}return a.prototype.push=function(e,t){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var i=Math.min(this.c,e.length),r=e.subarray(0,i);if(this.c-=i,this.d?this.d.push(r,!this.c):this.k[0].push(r),e=e.subarray(i),e.length)return this.push(e,t)}else{var s=0,o=0,l=void 0,c=void 0;this.p.length?e.length?(c=new Xe(this.p.length+e.length),c.set(this.p),c.set(e,this.p.length)):c=this.p:c=e;for(var u=c.length,f=this.c,h=f&&this.d,d=function(){var x,g=Rt(c,o);if(g==67324752){s=1,l=o,p.d=null,p.c=0;var y=fn(c,o+6),_=fn(c,o+8),w=y&2048,b=y&8,S=fn(c,o+26),M=fn(c,o+28);if(u>o+30+S+M){var T=[];p.k.unshift(T),s=2;var E=Rt(c,o+18),A=Rt(c,o+22),I=cp(c.subarray(o+30,o+=30+S),!w);E==4294967295?(x=b?[-2]:oy(c,o),E=x[0],A=x[1]):b&&(E=-1),o+=M,p.c=E;var C,R={name:I,compression:_,start:function(){if(!R.ondata)throw"no callback";if(!E)R.ondata(null,sr,!0);else{var D=n.o[_];if(!D)throw"unknown compression type "+_;C=E<0?new D(I):new D(I,E,A),C.ondata=function(j,Z,K){R.ondata(j,Z,K)};for(var F=0,O=T;F<O.length;F++){var U=O[F];C.push(U,!1)}n.k[0]==T&&n.c?n.d=C:C.push(sr,!0)}},terminate:function(){C&&C.terminate&&C.terminate()}};E>=0&&(R.size=E,R.originalSize=A),p.onfile(R)}return"break"}else if(f){if(g==134695760)return l=o+=12+(f==-2&&8),s=3,p.c=0,"break";if(g==33639248)return l=o-=4,s=3,p.c=0,"break"}},p=this;o<u-4;++o){var m=d();if(m==="break")break}if(this.p=sr,f<0){var v=s?c.subarray(0,l-12-(f==-2&&8)-(Rt(c,l-16)==134695760&&4)):c.subarray(0,o);h?h.push(v,!!s):this.k[+(s==2)].push(v)}if(s&2)return this.push(c.subarray(o),t);this.p=c.subarray(o)}if(t){if(this.c)throw"invalid zip file";this.p=null}},a.prototype.register=function(e){this.o[e.compression]=e},a}();function d2(a,e){if(typeof e!="function")throw"no callback";for(var t=[],n=function(){for(var h=0;h<t.length;++h)t[h]()},i={},r=a.length-22;Rt(a,r)!=101010256;--r)if(!r||a.length-r>65558){e("invalid zip file",null);return}var s=fn(a,r+8);s||e(null,{});var o=s,l=Rt(a,r+16),c=l==4294967295;if(c){if(r=Rt(a,r-12),Rt(a,r)!=101075792){e("invalid zip file",null);return}o=s=Rt(a,r+32),l=Rt(a,r+48)}for(var u=function(h){var d=sy(a,l,c),p=d[0],m=d[1],v=d[2],x=d[3],g=d[4],y=d[5],_=ry(a,y);l=g;var w=function(S,M){S?(n(),e(S,null)):(i[x]=M,--s||e(null,i))};if(!p)w(null,Xn(a,_,_+m));else if(p==8){var b=a.subarray(_,_+m);if(m<32e4)try{w(null,ha(b,new Xe(v)))}catch(S){w(S,null)}else t.push(np(b,{size:v},w))}else w("unknown compression type "+p,null)},f=0;f<o;++f)u(f);return n}function p2(a){for(var e={},t=a.length-22;Rt(a,t)!=101010256;--t)if(!t||a.length-t>65558)throw"invalid zip file";var n=fn(a,t+8);if(!n)return{};var i=Rt(a,t+16),r=i==4294967295;if(r){if(t=Rt(a,t-12),Rt(a,t)!=101075792)throw"invalid zip file";n=Rt(a,t+32),i=Rt(a,t+48)}for(var s=0;s<n;++s){var o=sy(a,i,r),l=o[0],c=o[1],u=o[2],f=o[3],h=o[4],d=o[5],p=ry(a,d);if(i=h,!l)e[f]=Xn(a,p,p+c);else if(l==8)e[f]=ha(a.subarray(p,p+c),new Xe(u));else throw"unknown compression type "+l}return e}var Vh=class{static findSpan(e,t,n){let i=n.length-e-1;if(t>=n[i])return i-1;if(t<=n[e])return e;let r=e,s=i,o=Math.floor((r+s)/2);for(;t<n[o]||t>=n[o+1];)t<n[o]?s=o:r=o,o=Math.floor((r+s)/2);return o}static calcBasisFunctions(e,t,n,i){let r=[],s=[],o=[];r[0]=1;for(let l=1;l<=n;++l){s[l]=t-i[e+1-l],o[l]=i[e+l]-t;let c=0;for(let u=0;u<l;++u){let f=o[u+1],h=s[l-u],d=r[u]/(f+h);r[u]=c+f*d,c=h*d}r[l]=c}return r}static calcBSplinePoint(e,t,n,i){let r=this.findSpan(e,i,t),s=this.calcBasisFunctions(r,i,e,t),o=new De(0,0,0,0);for(let l=0;l<=e;++l){let c=n[r-e+l],u=s[l],f=c.w*u;o.x+=c.x*f,o.y+=c.y*f,o.z+=c.z*f,o.w+=c.w*u}return o}static calcBasisFunctionDerivatives(e,t,n,i,r){let s=[];for(let h=0;h<=n;++h)s[h]=0;let o=[];for(let h=0;h<=i;++h)o[h]=s.slice(0);let l=[];for(let h=0;h<=n;++h)l[h]=s.slice(0);l[0][0]=1;let c=s.slice(0),u=s.slice(0);for(let h=1;h<=n;++h){c[h]=t-r[e+1-h],u[h]=r[e+h]-t;let d=0;for(let p=0;p<h;++p){let m=u[p+1],v=c[h-p];l[h][p]=m+v;let x=l[p][h-1]/l[h][p];l[p][h]=d+m*x,d=v*x}l[h][h]=d}for(let h=0;h<=n;++h)o[0][h]=l[h][n];for(let h=0;h<=n;++h){let d=0,p=1,m=[];for(let v=0;v<=n;++v)m[v]=s.slice(0);m[0][0]=1;for(let v=1;v<=i;++v){let x=0,g=h-v,y=n-v;h>=v&&(m[p][0]=m[d][0]/l[y+1][g],x=m[p][0]*l[g][y]);let _=g>=-1?1:-g,w=h-1<=y?v-1:n-h;for(let S=_;S<=w;++S)m[p][S]=(m[d][S]-m[d][S-1])/l[y+1][g+S],x+=m[p][S]*l[g+S][y];h<=y&&(m[p][v]=-m[d][v-1]/l[y+1][h],x+=m[p][v]*l[h][y]),o[v][h]=x;let b=d;d=p,p=b}}let f=n;for(let h=1;h<=i;++h){for(let d=0;d<=n;++d)o[h][d]*=f;f*=n-h}return o}static calcBSplineDerivatives(e,t,n,i,r){let s=r<e?r:e,o=[],l=this.findSpan(e,i,t),c=this.calcBasisFunctionDerivatives(l,i,e,s,t),u=[];for(let f=0;f<n.length;++f){let h=n[f].clone(),d=h.w;h.x*=d,h.y*=d,h.z*=d,u[f]=h}for(let f=0;f<=s;++f){let h=u[l-e].clone().multiplyScalar(c[f][0]);for(let d=1;d<=e;++d)h.add(u[l-e+d].clone().multiplyScalar(c[f][d]));o[f]=h}for(let f=s+1;f<=r+1;++f)o[f]=new De(0,0,0);return o}static calcKoverI(e,t){let n=1;for(let r=2;r<=e;++r)n*=r;let i=1;for(let r=2;r<=t;++r)i*=r;for(let r=2;r<=e-t;++r)i*=r;return n/i}static calcRationalCurveDerivatives(e){let t=e.length,n=[],i=[];for(let s=0;s<t;++s){let o=e[s];n[s]=new L(o.x,o.y,o.z),i[s]=o.w}let r=[];for(let s=0;s<t;++s){let o=n[s].clone();for(let l=1;l<=s;++l)o.sub(r[s-l].clone().multiplyScalar(this.calcKoverI(s,l)*i[l]));r[s]=o.divideScalar(i[0])}return r}static calcNURBSDerivatives(e,t,n,i,r){let s=this.calcBSplineDerivatives(e,t,n,i,r);return this.calcRationalCurveDerivatives(s)}static calcSurfacePoint(e,t,n,i,r,s,o,l){let c=this.findSpan(e,s,n),u=this.findSpan(t,o,i),f=this.calcBasisFunctions(c,s,e,n),h=this.calcBasisFunctions(u,o,t,i),d=[];for(let m=0;m<=t;++m){d[m]=new De(0,0,0,0);for(let v=0;v<=e;++v){let x=r[c-e+v][u-t+m].clone(),g=x.w;x.x*=g,x.y*=g,x.z*=g,d[m].add(x.multiplyScalar(f[v]))}}let p=new De(0,0,0,0);for(let m=0;m<=t;++m)p.add(d[m].multiplyScalar(h[m]));p.divideScalar(p.w),l.set(p.x,p.y,p.z)}};var Hh=class extends rn{constructor(e,t,n,i,r){super();this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=i||0,this.endKnot=r||this.knots.length-1;for(let s=0;s<n.length;++s){let o=n[s];this.controlPoints[s]=new De(o.x,o.y,o.z,o.w)}}getPoint(e,t=new L){let n=t,i=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=Vh.calcBSplinePoint(this.degree,this.knots,this.controlPoints,i);return r.w!==1&&r.divideScalar(r.w),n.set(r.x,r.y,r.z)}getTangent(e,t=new L){let n=t,i=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),r=Vh.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,i,1);return n.copy(r[1]).normalize(),n}};var He,It,on,fp=class extends vt{constructor(e){super(e)}load(e,t,n,i){let r=this,s=r.path===""?un.extractUrlBase(e):r.path,o=new Pt(this.manager);o.setPath(r.path),o.setResponseType("arraybuffer"),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,function(l){try{t(r.parse(l,s))}catch(c){i?i(c):console.error(c),r.manager.itemError(e)}},n,i)}parse(e,t){if(m2(e))He=new fy().parse(e);else{let i=gy(e);if(!g2(i))throw new Error("THREE.FBXLoader: Unknown format.");if(dy(i)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+dy(i));He=new uy().parse(i)}let n=new ai(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new ly(n,this.manager).parse(He)}},ly=class{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){It=this.parseConnections();let e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),i=this.parseDeformers(),r=new cy().parse(i);return this.parseScene(i,r,n),on}parseConnections(){let e=new Map;return"Connections"in He&&He.Connections.connections.forEach(function(n){let i=n[0],r=n[1],s=n[2];e.has(i)||e.set(i,{parents:[],children:[]});let o={ID:r,relationship:s};e.get(i).parents.push(o),e.has(r)||e.set(r,{parents:[],children:[]});let l={ID:i,relationship:s};e.get(r).children.push(l)}),e}parseImages(){let e={},t={};if("Video"in He.Objects){let n=He.Objects.Video;for(let i in n){let r=n[i],s=parseInt(i);if(e[s]=r.RelativeFilename||r.Filename,"Content"in r){let o=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,l=typeof r.Content=="string"&&r.Content!=="";if(o||l){let c=this.parseImage(n[i]);t[r.RelativeFilename||r.Filename]=c}}}}for(let n in e){let i=e[n];t[i]!==void 0?e[n]=t[i]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){let t=e.Content,n=e.RelativeFilename||e.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase(),r;switch(i){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),r="image/tga";break;default:console.warn('FBXLoader: Image type "'+i+'" is not supported.');return}if(typeof t=="string")return"data:"+r+";base64,"+t;{let s=new Uint8Array(t);return window.URL.createObjectURL(new Blob([s],{type:r}))}}parseTextures(e){let t=new Map;if("Texture"in He.Objects){let n=He.Objects.Texture;for(let i in n){let r=this.parseTexture(n[i],e);t.set(parseInt(i),r)}}return t}parseTexture(e,t){let n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;let i=e.WrapModeU,r=e.WrapModeV,s=i!==void 0?i.value:0,o=r!==void 0?r.value:0;if(n.wrapS=s===0?Nt:bt,n.wrapT=o===0?Nt:bt,"Scaling"in e){let l=e.Scaling.value;n.repeat.x=l[0],n.repeat.y=l[1]}return n}loadTexture(e,t){let n,i=this.textureLoader.path,r=It.get(e.id).children;r!==void 0&&r.length>0&&t[r[0].ID]!==void 0&&(n=t[r[0].ID],(n.indexOf("blob:")===0||n.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let s,o=e.FileName.slice(-3).toLowerCase();if(o==="tga"){let l=this.manager.getHandler(".tga");l===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),s=new lt):(l.setPath(this.textureLoader.path),s=l.load(n))}else o==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),s=new lt):s=this.textureLoader.load(n);return this.textureLoader.setPath(i),s}parseMaterials(e){let t=new Map;if("Material"in He.Objects){let n=He.Objects.Material;for(let i in n){let r=this.parseMaterial(n[i],e);r!==null&&t.set(parseInt(i),r)}}return t}parseMaterial(e,t){let n=e.id,i=e.attrName,r=e.ShadingModel;if(typeof r=="object"&&(r=r.value),!It.has(n))return null;let s=this.parseParameters(e,t,n),o;switch(r.toLowerCase()){case"phong":o=new kn;break;case"lambert":o=new _i;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',r),o=new kn;break}return o.setValues(s),o.name=i,o}parseParameters(e,t,n){let i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=new ue().fromArray(e.Diffuse.value):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(i.color=new ue().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=new ue().fromArray(e.Emissive.value):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(i.emissive=new ue().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=new ue().fromArray(e.Specular.value):e.SpecularColor&&e.SpecularColor.type==="Color"&&(i.specular=new ue().fromArray(e.SpecularColor.value));let r=this;return It.get(n).children.forEach(function(s){let o=s.relationship;switch(o){case"Bump":i.bumpMap=r.getTexture(t,s.ID);break;case"Maya|TEX_ao_map":i.aoMap=r.getTexture(t,s.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=r.getTexture(t,s.ID),i.map.encoding=xn;break;case"DisplacementColor":i.displacementMap=r.getTexture(t,s.ID);break;case"EmissiveColor":i.emissiveMap=r.getTexture(t,s.ID),i.emissiveMap.encoding=xn;break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=r.getTexture(t,s.ID);break;case"ReflectionColor":i.envMap=r.getTexture(t,s.ID),i.envMap.mapping=eo,i.envMap.encoding=xn;break;case"SpecularColor":i.specularMap=r.getTexture(t,s.ID),i.specularMap.encoding=xn;break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=r.getTexture(t,s.ID),i.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",o);break}}),i}getTexture(e,t){return"LayeredTexture"in He.Objects&&t in He.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=It.get(t).children[0].ID),e.get(t)}parseDeformers(){let e={},t={};if("Deformer"in He.Objects){let n=He.Objects.Deformer;for(let i in n){let r=n[i],s=It.get(parseInt(i));if(r.attrType==="Skin"){let o=this.parseSkeleton(s,n);o.ID=i,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),o.geometryID=s.parents[0].ID,e[i]=o}else if(r.attrType==="BlendShape"){let o={id:i};o.rawTargets=this.parseMorphTargets(s,n),o.id=i,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[i]=o}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){let n=[];return e.children.forEach(function(i){let r=t[i.ID];if(r.attrType!=="Cluster")return;let s={ID:i.ID,indices:[],weights:[],transformLink:new fe().fromArray(r.TransformLink.a)};"Indexes"in r&&(s.indices=r.Indexes.a,s.weights=r.Weights.a),n.push(s)}),{rawBones:n,bones:[]}}parseMorphTargets(e,t){let n=[];for(let i=0;i<e.children.length;i++){let r=e.children[i],s=t[r.ID],o={name:s.attrName,initialWeight:s.DeformPercent,id:s.id,fullWeights:s.FullWeights.a};if(s.attrType!=="BlendShapeChannel")return;o.geoID=It.get(parseInt(r.ID)).children.filter(function(l){return l.relationship===void 0})[0].ID,n.push(o)}return n}parseScene(e,t,n){on=new Jt;let i=this.parseModels(e.skeletons,t,n),r=He.Objects.Model,s=this;i.forEach(function(l){let c=r[l.ID];s.setLookAtProperties(l,c),It.get(l.ID).parents.forEach(function(f){let h=i.get(f.ID);h!==void 0&&h.add(l)}),l.parent===null&&on.add(l)}),this.bindSkeleton(e.skeletons,t,i),this.createAmbientLight(),this.setupMorphMaterials(),on.traverse(function(l){if(l.userData.transformData){l.parent&&(l.userData.transformData.parentMatrix=l.parent.matrix,l.userData.transformData.parentMatrixWorld=l.parent.matrixWorld);let c=py(l.userData.transformData);l.applyMatrix4(c),l.updateWorldMatrix()}});let o=new hy().parse();on.children.length===1&&on.children[0].isGroup&&(on.children[0].animations=o,on=on.children[0]),on.animations=o}parseModels(e,t,n){let i=new Map,r=He.Objects.Model;for(let s in r){let o=parseInt(s),l=r[s],c=It.get(o),u=this.buildSkeleton(c,e,o,l.attrName);if(!u){switch(l.attrType){case"Camera":u=this.createCamera(c);break;case"Light":u=this.createLight(c);break;case"Mesh":u=this.createMesh(c,t,n);break;case"NurbsCurve":u=this.createCurve(c,t);break;case"LimbNode":case"Root":u=new xi;break;case"Null":default:u=new Jt;break}u.name=l.attrName?Oe.sanitizeNodeName(l.attrName):"",u.ID=o}this.getTransformData(u,l),i.set(o,u)}return i}buildSkeleton(e,t,n,i){let r=null;return e.parents.forEach(function(s){for(let o in t){let l=t[o];l.rawBones.forEach(function(c,u){if(c.ID===s.ID){let f=r;r=new xi,r.matrixWorld.copy(c.transformLink),r.name=i?Oe.sanitizeNodeName(i):"",r.ID=n,l.bones[u]=r,f!==null&&r.add(f)}})}}),r}createCamera(e){let t,n;if(e.children.forEach(function(i){let r=He.Objects.NodeAttribute[i.ID];r!==void 0&&(n=r)}),n===void 0)t=new Re;else{let i=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(i=1);let r=1;n.NearPlane!==void 0&&(r=n.NearPlane.value/1e3);let s=1e3;n.FarPlane!==void 0&&(s=n.FarPlane.value/1e3);let o=window.innerWidth,l=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(o=n.AspectWidth.value,l=n.AspectHeight.value);let c=o/l,u=45;n.FieldOfView!==void 0&&(u=n.FieldOfView.value);let f=n.FocalLength?n.FocalLength.value:null;switch(i){case 0:t=new it(u,c,r,s),f!==null&&t.setFocalLength(f);break;case 1:t=new sn(-o/2,o/2,l/2,-l/2,r,s);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+i+"."),t=new Re;break}}return t}createLight(e){let t,n;if(e.children.forEach(function(i){let r=He.Objects.NodeAttribute[i.ID];r!==void 0&&(n=r)}),n===void 0)t=new Re;else{let i;n.LightType===void 0?i=0:i=n.LightType.value;let r=16777215;n.Color!==void 0&&(r=new ue().fromArray(n.Color.value));let s=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(s=0);let o=0;n.FarAttenuationEnd!==void 0&&(n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?o=0:o=n.FarAttenuationEnd.value);let l=1;switch(i){case 0:t=new ci(r,s,o,l);break;case 1:t=new Ai(r,s);break;case 2:let c=Math.PI/3;n.InnerAngle!==void 0&&(c=dt.degToRad(n.InnerAngle.value));let u=0;n.OuterAngle!==void 0&&(u=dt.degToRad(n.OuterAngle.value),u=Math.max(u,1)),t=new Ei(r,s,o,c,u,l);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new ci(r,s);break}n.CastShadows!==void 0&&n.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,n){let i,r=null,s=null,o=[];return e.children.forEach(function(l){t.has(l.ID)&&(r=t.get(l.ID)),n.has(l.ID)&&o.push(n.get(l.ID))}),o.length>1?s=o:o.length>0?s=o[0]:(s=new kn({color:13421772}),o.push(s)),"color"in r.attributes&&o.forEach(function(l){l.vertexColors=!0}),r.FBX_Deformer?(i=new Ji(r,s),i.normalizeSkinWeights()):i=new Ce(r,s),i}createCurve(e,t){let n=e.children.reduce(function(r,s){return t.has(s.ID)&&(r=t.get(s.ID)),r},null),i=new rt({color:3342591,linewidth:1});return new Gt(n,i)}getTransformData(e,t){let n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?n.eulerOrder=my(t.RotationOrder.value):n.eulerOrder="ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&It.get(e.ID).children.forEach(function(i){if(i.relationship==="LookAtProperty"){let r=He.Objects.Model[i.ID];if("Lcl_Translation"in r){let s=r.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(s),on.add(e.target)):e.lookAt(new L().fromArray(s))}}})}bindSkeleton(e,t,n){let i=this.parsePoseNodes();for(let r in e){let s=e[r];It.get(parseInt(s.ID)).parents.forEach(function(l){if(t.has(l.ID)){let c=l.ID;It.get(c).parents.forEach(function(f){n.has(f.ID)&&n.get(f.ID).bind(new $i(s.bones),i[f.ID])})}})}}parsePoseNodes(){let e={};if("Pose"in He.Objects){let t=He.Objects.Pose;for(let n in t)if(t[n].attrType==="BindPose"){let i=t[n].PoseNode;Array.isArray(i)?i.forEach(function(r){e[r.Node]=new fe().fromArray(r.Matrix.a)}):e[i.Node]=new fe().fromArray(i.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in He&&"AmbientColor"in He.GlobalSettings){let e=He.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],i=e[2];if(t!==0||n!==0||i!==0){let r=new ue(t,n,i);on.add(new kr(r,1))}}}setupMorphMaterials(){let e=this;on.traverse(function(t){t.isMesh&&t.geometry.morphAttributes.position&&t.geometry.morphAttributes.position.length&&(Array.isArray(t.material)?t.material.forEach(function(n,i){e.setupMorphMaterial(t,n,i)}):e.setupMorphMaterial(t,t.material))})}setupMorphMaterial(e,t,n){let i=e.uuid,r=t.uuid,s=!1;if(on.traverse(function(o){o.isMesh&&(Array.isArray(o.material)?o.material.forEach(function(l){l.uuid===r&&o.uuid!==i&&(s=!0)}):o.material.uuid===r&&o.uuid!==i&&(s=!0))}),s===!0){let o=t.clone();o.morphTargets=!0,n===void 0?e.material=o:e.material[n]=o}else t.morphTargets=!0}},cy=class{parse(e){let t=new Map;if("Geometry"in He.Objects){let n=He.Objects.Geometry;for(let i in n){let r=It.get(parseInt(i)),s=this.parseGeometry(r,n[i],e);t.set(parseInt(i),s)}}return t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){let i=n.skeletons,r=[],s=e.parents.map(function(f){return He.Objects.Model[f.ID]});if(s.length===0)return;let o=e.children.reduce(function(f,h){return i[h.ID]!==void 0&&(f=i[h.ID]),f},null);e.children.forEach(function(f){n.morphTargets[f.ID]!==void 0&&r.push(n.morphTargets[f.ID])});let l=s[0],c={};"RotationOrder"in l&&(c.eulerOrder=my(l.RotationOrder.value)),"InheritType"in l&&(c.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(c.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(c.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(c.scale=l.GeometricScaling.value);let u=py(c);return this.genGeometry(t,o,r,u)}genGeometry(e,t,n,i){let r=new ye;e.attrName&&(r.name=e.attrName);let s=this.parseGeoNode(e,t),o=this.genBuffers(s),l=new pe(o.vertex,3);if(l.applyMatrix4(i),r.setAttribute("position",l),o.colors.length>0&&r.setAttribute("color",new pe(o.colors,3)),t&&(r.setAttribute("skinIndex",new ws(o.weightsIndices,4)),r.setAttribute("skinWeight",new pe(o.vertexWeights,4)),r.FBX_Deformer=t),o.normal.length>0){let c=new Ye().getNormalMatrix(i),u=new pe(o.normal,3);u.applyNormalMatrix(c),r.setAttribute("normal",u)}if(o.uvs.forEach(function(c,u){let f="uv"+(u+1).toString();u===0&&(f="uv"),r.setAttribute(f,new pe(o.uvs[u],2))}),s.material&&s.material.mappingType!=="AllSame"){let c=o.materialIndex[0],u=0;if(o.materialIndex.forEach(function(f,h){f!==c&&(r.addGroup(u,h-u,c),c=f,u=h)}),r.groups.length>0){let f=r.groups[r.groups.length-1],h=f.start+f.count;h!==o.materialIndex.length&&r.addGroup(h,o.materialIndex.length-h,c)}r.groups.length===0&&r.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(r,e,n,i),r}parseGeoNode(e,t){let n={};if(n.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],n.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let i=0;for(;e.LayerElementUV[i];)e.LayerElementUV[i].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[i])),i++}return n.weightTable={},t!==null&&(n.skeleton=t,t.rawBones.forEach(function(i,r){i.indices.forEach(function(s,o){n.weightTable[s]===void 0&&(n.weightTable[s]=[]),n.weightTable[s].push({id:r,weight:i.weights[o]})})})),n}genBuffers(e){let t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},n=0,i=0,r=!1,s=[],o=[],l=[],c=[],u=[],f=[],h=this;return e.vertexIndices.forEach(function(d,p){let m,v=!1;d<0&&(d=d^-1,v=!0);let x=[],g=[];if(s.push(d*3,d*3+1,d*3+2),e.color){let y=Gh(p,n,d,e.color);l.push(y[0],y[1],y[2])}if(e.skeleton){if(e.weightTable[d]!==void 0&&e.weightTable[d].forEach(function(y){g.push(y.weight),x.push(y.id)}),g.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);let y=[0,0,0,0],_=[0,0,0,0];g.forEach(function(w,b){let S=w,M=x[b];_.forEach(function(T,E,A){if(S>T){A[E]=S,S=T;let I=y[E];y[E]=M,M=I}})}),x=y,g=_}for(;g.length<4;)g.push(0),x.push(0);for(let y=0;y<4;++y)u.push(g[y]),f.push(x[y])}if(e.normal){let y=Gh(p,n,d,e.normal);o.push(y[0],y[1],y[2])}e.material&&e.material.mappingType!=="AllSame"&&(m=Gh(p,n,d,e.material)[0]),e.uv&&e.uv.forEach(function(y,_){let w=Gh(p,n,d,y);c[_]===void 0&&(c[_]=[]),c[_].push(w[0]),c[_].push(w[1])}),i++,v&&(h.genFace(t,e,s,m,o,l,c,u,f,i),n++,i=0,s=[],o=[],l=[],c=[],u=[],f=[])}),t}genFace(e,t,n,i,r,s,o,l,c,u){for(let f=2;f<u;f++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[(f-1)*3]]),e.vertex.push(t.vertexPositions[n[(f-1)*3+1]]),e.vertex.push(t.vertexPositions[n[(f-1)*3+2]]),e.vertex.push(t.vertexPositions[n[f*3]]),e.vertex.push(t.vertexPositions[n[f*3+1]]),e.vertex.push(t.vertexPositions[n[f*3+2]]),t.skeleton&&(e.vertexWeights.push(l[0]),e.vertexWeights.push(l[1]),e.vertexWeights.push(l[2]),e.vertexWeights.push(l[3]),e.vertexWeights.push(l[(f-1)*4]),e.vertexWeights.push(l[(f-1)*4+1]),e.vertexWeights.push(l[(f-1)*4+2]),e.vertexWeights.push(l[(f-1)*4+3]),e.vertexWeights.push(l[f*4]),e.vertexWeights.push(l[f*4+1]),e.vertexWeights.push(l[f*4+2]),e.vertexWeights.push(l[f*4+3]),e.weightsIndices.push(c[0]),e.weightsIndices.push(c[1]),e.weightsIndices.push(c[2]),e.weightsIndices.push(c[3]),e.weightsIndices.push(c[(f-1)*4]),e.weightsIndices.push(c[(f-1)*4+1]),e.weightsIndices.push(c[(f-1)*4+2]),e.weightsIndices.push(c[(f-1)*4+3]),e.weightsIndices.push(c[f*4]),e.weightsIndices.push(c[f*4+1]),e.weightsIndices.push(c[f*4+2]),e.weightsIndices.push(c[f*4+3])),t.color&&(e.colors.push(s[0]),e.colors.push(s[1]),e.colors.push(s[2]),e.colors.push(s[(f-1)*3]),e.colors.push(s[(f-1)*3+1]),e.colors.push(s[(f-1)*3+2]),e.colors.push(s[f*3]),e.colors.push(s[f*3+1]),e.colors.push(s[f*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(i),e.materialIndex.push(i),e.materialIndex.push(i)),t.normal&&(e.normal.push(r[0]),e.normal.push(r[1]),e.normal.push(r[2]),e.normal.push(r[(f-1)*3]),e.normal.push(r[(f-1)*3+1]),e.normal.push(r[(f-1)*3+2]),e.normal.push(r[f*3]),e.normal.push(r[f*3+1]),e.normal.push(r[f*3+2])),t.uv&&t.uv.forEach(function(h,d){e.uvs[d]===void 0&&(e.uvs[d]=[]),e.uvs[d].push(o[d][0]),e.uvs[d].push(o[d][1]),e.uvs[d].push(o[d][(f-1)*2]),e.uvs[d].push(o[d][(f-1)*2+1]),e.uvs[d].push(o[d][f*2]),e.uvs[d].push(o[d][f*2+1])})}addMorphTargets(e,t,n,i){if(n.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];let r=this;n.forEach(function(s){s.rawTargets.forEach(function(o){let l=He.Objects.Geometry[o.geoID];l!==void 0&&r.genMorphGeometry(e,t,l,i,o.name)})})}genMorphGeometry(e,t,n,i,r){let s=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],o=n.Vertices!==void 0?n.Vertices.a:[],l=n.Indexes!==void 0?n.Indexes.a:[],c=e.attributes.position.count*3,u=new Float32Array(c);for(let p=0;p<l.length;p++){let m=l[p]*3;u[m]=o[p*3],u[m+1]=o[p*3+1],u[m+2]=o[p*3+2]}let f={vertexIndices:s,vertexPositions:u},h=this.genBuffers(f),d=new pe(h.vertex,3);d.name=r||n.attrName,d.applyMatrix4(i),e.morphAttributes.position.push(d)}parseNormals(e){let t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Normals.a,r=[];return n==="IndexToDirect"&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:i,indices:r,mappingType:t,referenceType:n}}parseUVs(e){let t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.UV.a,r=[];return n==="IndexToDirect"&&(r=e.UVIndex.a),{dataSize:2,buffer:i,indices:r,mappingType:t,referenceType:n}}parseVertexColors(e){let t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Colors.a,r=[];return n==="IndexToDirect"&&(r=e.ColorIndex.a),{dataSize:4,buffer:i,indices:r,mappingType:t,referenceType:n}}parseMaterialIndices(e){let t=e.MappingInformationType,n=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};let i=e.Materials.a,r=[];for(let s=0;s<i.length;++s)r.push(s);return{dataSize:1,buffer:i,indices:r,mappingType:t,referenceType:n}}parseNurbsGeometry(e){if(Hh===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new ye;let t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new ye;let n=t-1,i=e.KnotVector.a,r=[],s=e.Points.a;for(let d=0,p=s.length;d<p;d+=4)r.push(new De().fromArray(s,d));let o,l;if(e.Form==="Closed")r.push(r[0]);else if(e.Form==="Periodic"){o=n,l=i.length-1-o;for(let d=0;d<n;++d)r.push(r[d])}let u=new Hh(n,i,r,o,l).getPoints(r.length*7),f=new Float32Array(u.length*3);u.forEach(function(d,p){d.toArray(f,p*3)});let h=new ye;return h.setAttribute("position",new Se(f,3)),h}},hy=class{parse(){let e=[],t=this.parseClips();if(t!==void 0)for(let n in t){let i=t[n],r=this.addClip(i);e.push(r)}return e}parseClips(){if(He.Objects.AnimationCurve===void 0)return;let e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);let t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){let e=He.Objects.AnimationCurveNode,t=new Map;for(let n in e){let i=e[n];if(i.attrName.match(/S|R|T|DeformPercent/)!==null){let r={id:i.id,attr:i.attrName,curves:{}};t.set(r.id,r)}}return t}parseAnimationCurves(e){let t=He.Objects.AnimationCurve;for(let n in t){let i={id:t[n].id,times:t[n].KeyTime.a.map(x2),values:t[n].KeyValueFloat.a},r=It.get(i.id);if(r!==void 0){let s=r.parents[0].ID,o=r.parents[0].relationship;o.match(/X/)?e.get(s).curves.x=i:o.match(/Y/)?e.get(s).curves.y=i:o.match(/Z/)?e.get(s).curves.z=i:o.match(/d|DeformPercent/)&&e.has(s)&&(e.get(s).curves.morph=i)}}}parseAnimationLayers(e){let t=He.Objects.AnimationLayer,n=new Map;for(let i in t){let r=[],s=It.get(parseInt(i));s!==void 0&&(s.children.forEach(function(l,c){if(e.has(l.ID)){let u=e.get(l.ID);if(u.curves.x!==void 0||u.curves.y!==void 0||u.curves.z!==void 0){if(r[c]===void 0){let f=It.get(l.ID).parents.filter(function(h){return h.relationship!==void 0})[0].ID;if(f!==void 0){let h=He.Objects.Model[f.toString()];if(h===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",l);return}let d={modelName:h.attrName?Oe.sanitizeNodeName(h.attrName):"",ID:h.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};on.traverse(function(p){p.ID===h.id&&(d.transform=p.matrix,p.userData.transformData&&(d.eulerOrder=p.userData.transformData.eulerOrder))}),d.transform||(d.transform=new fe),"PreRotation"in h&&(d.preRotation=h.PreRotation.value),"PostRotation"in h&&(d.postRotation=h.PostRotation.value),r[c]=d}}r[c]&&(r[c][u.attr]=u)}else if(u.curves.morph!==void 0){if(r[c]===void 0){let f=It.get(l.ID).parents.filter(function(x){return x.relationship!==void 0})[0].ID,h=It.get(f).parents[0].ID,d=It.get(h).parents[0].ID,p=It.get(d).parents[0].ID,m=He.Objects.Model[p],v={modelName:m.attrName?Oe.sanitizeNodeName(m.attrName):"",morphName:He.Objects.Deformer[f].attrName};r[c]=v}r[c][u.attr]=u}}}),n.set(parseInt(i),r))}return n}parseAnimStacks(e){let t=He.Objects.AnimationStack,n={};for(let i in t){let r=It.get(parseInt(i)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");let s=e.get(r[0].ID);n[i]={name:t[i].attrName,layer:s}}return n}addClip(e){let t=[],n=this;return e.layer.forEach(function(i){t=t.concat(n.generateTracks(i))}),new Si(e.name,-1,t)}generateTracks(e){let t=[],n=new L,i=new Ve,r=new L;if(e.transform&&e.transform.decompose(n,i,r),n=n.toArray(),i=new Ut().setFromQuaternion(i,e.eulerOrder).toArray(),r=r.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){let s=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");s!==void 0&&t.push(s)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){let s=this.generateRotationTrack(e.modelName,e.R.curves,i,e.preRotation,e.postRotation,e.eulerOrder);s!==void 0&&t.push(s)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){let s=this.generateVectorTrack(e.modelName,e.S.curves,r,"scale");s!==void 0&&t.push(s)}if(e.DeformPercent!==void 0){let s=this.generateMorphTrack(e);s!==void 0&&t.push(s)}return t}generateVectorTrack(e,t,n,i){let r=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(r,t,n);return new Mi(e+"."+i,r,s)}generateRotationTrack(e,t,n,i,r,s){t.x!==void 0&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(dt.degToRad)),t.y!==void 0&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(dt.degToRad)),t.z!==void 0&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(dt.degToRad));let o=this.getTimesForAllAxes(t),l=this.getKeyframeTrackValues(o,t,n);i!==void 0&&(i=i.map(dt.degToRad),i.push(s),i=new Ut().fromArray(i),i=new Ve().setFromEuler(i)),r!==void 0&&(r=r.map(dt.degToRad),r.push(s),r=new Ut().fromArray(r),r=new Ve().setFromEuler(r).invert());let c=new Ve,u=new Ut,f=[];for(let h=0;h<l.length;h+=3)u.set(l[h],l[h+1],l[h+2],s),c.setFromEuler(u),i!==void 0&&c.premultiply(i),r!==void 0&&c.multiply(r),c.toArray(f,h/3*4);return new si(e+".quaternion",o,f)}generateMorphTrack(e){let t=e.DeformPercent.curves.morph,n=t.values.map(function(r){return r/100}),i=on.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new bi(e.modelName+".morphTargetInfluences["+i+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(n,i){return n-i}),t.length>1){let n=1,i=t[0];for(let r=1;r<t.length;r++){let s=t[r];s!==i&&(t[n]=s,i=s,n++)}t=t.slice(0,n)}return t}getKeyframeTrackValues(e,t,n){let i=n,r=[],s=-1,o=-1,l=-1;return e.forEach(function(c){if(t.x&&(s=t.x.times.indexOf(c)),t.y&&(o=t.y.times.indexOf(c)),t.z&&(l=t.z.times.indexOf(c)),s!==-1){let u=t.x.values[s];r.push(u),i[0]=u}else r.push(i[0]);if(o!==-1){let u=t.y.values[o];r.push(u),i[1]=u}else r.push(i[1]);if(l!==-1){let u=t.z.values[l];r.push(u),i[2]=u}else r.push(i[2])}),r}interpolateRotations(e){for(let t=1;t<e.values.length;t++){let n=e.values[t-1],i=e.values[t]-n,r=Math.abs(i);if(r>=180){let s=r/180,o=i/s,l=n+o,c=e.times[t-1],f=(e.times[t]-c)/s,h=c+f,d=[],p=[];for(;h<e.times[t];)d.push(h),h+=f,p.push(l),l+=o;e.times=xy(e.times,t,d),e.values=xy(e.values,t,p)}}}},uy=class{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new pp,this.nodeStack=[],this.currentProp=[],this.currentPropName="";let t=this,n=e.split(/[\r\n]+/);return n.forEach(function(i,r){let s=i.match(/^[\s\t]*;/),o=i.match(/^[\s\t]*$/);if(s||o)return;let l=i.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),c=i.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),u=i.match("^\\t{"+(t.currentIndent-1)+"}}");l?t.parseNodeBegin(i,l):c?t.parseNodeProperty(i,c,n[++r]):u?t.popStack():i.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(i)}),this.allNodes}parseNodeBegin(e,t){let n=t[1].trim().replace(/^"/,"").replace(/"$/,""),i=t[2].split(",").map(function(l){return l.trim().replace(/^"/,"").replace(/"$/,"")}),r={name:n},s=this.parseNodeAttr(i),o=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,r):n in o?(n==="PoseNode"?o.PoseNode.push(r):o[n].id!==void 0&&(o[n]={},o[n][o[n].id]=o[n]),s.id!==""&&(o[n][s.id]=r)):typeof s.id=="number"?(o[n]={},o[n][s.id]=r):n!=="Properties70"&&(n==="PoseNode"?o[n]=[r]:o[n]=r),typeof s.id=="number"&&(r.id=s.id),s.name!==""&&(r.attrName=s.name),s.type!==""&&(r.attrType=s.type),this.pushStack(r)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",i="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),i=e[2]),{id:t,name:n,type:i}}parseNodeProperty(e,t,n){let i=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();i==="Content"&&r===","&&(r=n.replace(/"/g,"").replace(/,$/,"").trim());let s=this.getCurrentNode();if(s.name==="Properties70"){this.parseNodeSpecialProperty(e,i,r);return}if(i==="C"){let l=r.split(",").slice(1),c=parseInt(l[0]),u=parseInt(l[1]),f=r.split(",").slice(3);f=f.map(function(h){return h.trim().replace(/^"/,"")}),i="connections",r=[c,u],y2(r,f),s[i]===void 0&&(s[i]=[])}i==="Node"&&(s.id=r),i in s&&Array.isArray(s[i])?s[i].push(r):i!=="a"?s[i]=r:s.a=r,this.setCurrentProp(s,i),i==="a"&&r.slice(-1)!==","&&(s.a=gp(r))}parseNodePropertyContinued(e){let t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=gp(t.a))}parseNodeSpecialProperty(e,t,n){let i=n.split('",').map(function(u){return u.trim().replace(/^\"/,"").replace(/\s/,"_")}),r=i[0],s=i[1],o=i[2],l=i[3],c=i[4];switch(s){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=gp(c);break}this.getPrevNode()[r]={type:s,type2:o,flag:l,value:c},this.setCurrentProp(this.getPrevNode(),r)}},fy=class{parse(e){let t=new dp(e);t.skip(23);let n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);let i=new pp;for(;!this.endOfContent(t);){let r=this.parseNode(t,n);r!==null&&i.add(r.name,r)}return i}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&~15)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){let n={},i=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();let s=e.getUint8(),o=e.getString(s);if(i===0)return null;let l=[];for(let h=0;h<r;h++)l.push(this.parseProperty(e));let c=l.length>0?l[0]:"",u=l.length>1?l[1]:"",f=l.length>2?l[2]:"";for(n.singleProperty=r===1&&e.getOffset()===i;i>e.getOffset();){let h=this.parseNode(e,t);h!==null&&this.parseSubNode(o,n,h)}return n.propertyList=l,typeof c=="number"&&(n.id=c),u!==""&&(n.attrName=u),f!==""&&(n.attrType=f),o!==""&&(n.name=o),n}parseSubNode(e,t,n){if(n.singleProperty===!0){let i=n.propertyList[0];Array.isArray(i)?(t[n.name]=n,n.a=i):t[n.name]=i}else if(e==="Connections"&&n.name==="C"){let i=[];n.propertyList.forEach(function(r,s){s!==0&&i.push(r)}),t.connections===void 0&&(t.connections=[]),t.connections.push(i)}else if(n.name==="Properties70")Object.keys(n).forEach(function(r){t[r]=n[r]});else if(e==="Properties70"&&n.name==="P"){let i=n.propertyList[0],r=n.propertyList[1],s=n.propertyList[2],o=n.propertyList[3],l;i.indexOf("Lcl ")===0&&(i=i.replace("Lcl ","Lcl_")),r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),r==="Color"||r==="ColorRGB"||r==="Vector"||r==="Vector3D"||r.indexOf("Lcl_")===0?l=[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:l=n.propertyList[4],t[i]={type:r,type2:s,flag:o,value:l}}else t[n.name]===void 0?typeof n.id=="number"?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:n.name==="PoseNode"?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):t[n.name][n.id]===void 0&&(t[n.name][n.id]=n)}parseProperty(e){let t=e.getString(1),n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":let i=e.getUint32(),r=e.getUint32(),s=e.getUint32();if(r===0)switch(t){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}typeof up=="undefined"&&console.error("THREE.FBXLoader: External library fflate.min.js required.");let o=Al(new Uint8Array(e.getArrayBuffer(s))),l=new dp(o.buffer);switch(t){case"b":case"c":return l.getBooleanArray(i);case"d":return l.getFloat64Array(i);case"f":return l.getFloat32Array(i);case"i":return l.getInt32Array(i);case"l":return l.getInt64Array(i)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}},dp=class{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)==1}getBooleanArray(e){let t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){let e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){let e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){let e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){let t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){let e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){let t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){let e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){let t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){let e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){let t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){let t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let i=0;i<e;i++)t[i]=this.getUint8();let n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),un.decodeText(new Uint8Array(t))}},pp=class{add(e,t){this[e]=t}};function m2(a){let e="Kaydara FBX Binary  \0";return a.byteLength>=e.length&&e===gy(a,0,e.length)}function g2(a){let e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],t=0;function n(i){let r=a[i-1];return a=a.slice(t+i),t++,r}for(let i=0;i<e.length;++i)if(n(1)===e[i])return!1;return!0}function dy(a){let e=/FBXVersion: (\d+)/,t=a.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function x2(a){return a/46186158e3}var v2=[];function Gh(a,e,t,n){let i;switch(n.mappingType){case"ByPolygonVertex":i=a;break;case"ByPolygon":i=e;break;case"ByVertice":i=t;break;case"AllSame":i=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(i=n.indices[i]);let r=i*n.dataSize,s=r+n.dataSize;return w2(v2,n.buffer,r,s)}var mp=new Ut,fa=new L;function py(a){let e=new fe,t=new fe,n=new fe,i=new fe,r=new fe,s=new fe,o=new fe,l=new fe,c=new fe,u=new fe,f=new fe,h=new fe,d=a.inheritType?a.inheritType:0;if(a.translation&&e.setPosition(fa.fromArray(a.translation)),a.preRotation){let E=a.preRotation.map(dt.degToRad);E.push(a.eulerOrder),t.makeRotationFromEuler(mp.fromArray(E))}if(a.rotation){let E=a.rotation.map(dt.degToRad);E.push(a.eulerOrder),n.makeRotationFromEuler(mp.fromArray(E))}if(a.postRotation){let E=a.postRotation.map(dt.degToRad);E.push(a.eulerOrder),i.makeRotationFromEuler(mp.fromArray(E)),i.invert()}a.scale&&r.scale(fa.fromArray(a.scale)),a.scalingOffset&&o.setPosition(fa.fromArray(a.scalingOffset)),a.scalingPivot&&s.setPosition(fa.fromArray(a.scalingPivot)),a.rotationOffset&&l.setPosition(fa.fromArray(a.rotationOffset)),a.rotationPivot&&c.setPosition(fa.fromArray(a.rotationPivot)),a.parentMatrixWorld&&(f.copy(a.parentMatrix),u.copy(a.parentMatrixWorld));let p=t.clone().multiply(n).multiply(i),m=new fe;m.extractRotation(u);let v=new fe;v.copyPosition(u);let x=v.clone().invert().multiply(u),g=m.clone().invert().multiply(x),y=r,_=new fe;if(d===0)_.copy(m).multiply(p).multiply(g).multiply(y);else if(d===1)_.copy(m).multiply(g).multiply(p).multiply(y);else{let A=new fe().scale(new L().setFromMatrixScale(f)).clone().invert(),I=g.clone().multiply(A);_.copy(m).multiply(p).multiply(I).multiply(y)}let w=c.clone().invert(),b=s.clone().invert(),S=e.clone().multiply(l).multiply(c).multiply(t).multiply(n).multiply(i).multiply(w).multiply(o).multiply(s).multiply(r).multiply(b),M=new fe().copyPosition(S),T=u.clone().multiply(M);return h.copyPosition(T),S=h.clone().multiply(_),S.premultiply(u.invert()),S}function my(a){a=a||0;let e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return a===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[a]}function gp(a){return a.split(",").map(function(t){return parseFloat(t)})}function gy(a,e,t){return e===void 0&&(e=0),t===void 0&&(t=a.byteLength),un.decodeText(new Uint8Array(a,e,t))}function y2(a,e){for(let t=0,n=a.length,i=e.length;t<i;t++,n++)a[n]=e[t]}function w2(a,e,t,n){for(let i=t,r=0;i<n;i++,r++)a[r]=e[i];return a}function xy(a,e,t){return a.slice(0,e).concat(t).concat(a.slice(e))}var Bs=class extends vt{constructor(e){super(e);this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new wy(t)}),this.register(function(t){return new by(t)}),this.register(function(t){return new My(t)}),this.register(function(t){return new _y(t)}),this.register(function(t){return new vy(t)}),this.register(function(t){return new Sy(t)})}load(e,t,n,i){let r=this,s;this.resourcePath!==""?s=this.resourcePath:this.path!==""?s=this.path:s=un.extractUrlBase(e),this.manager.itemStart(e);let o=function(c){i?i(c):console.error(c),r.manager.itemError(e),r.manager.itemEnd(e)},l=new Pt(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{r.parse(c,s,function(u){t(u),r.manager.itemEnd(e)},o)}catch(u){o(u)}},n,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i){let r,s={},o={};if(typeof e=="string")r=e;else if(un.decodeText(new Uint8Array(e,0,4))===Ty){try{s[Qe.KHR_BINARY_GLTF]=new Ay(e)}catch(f){i&&i(f);return}r=s[Qe.KHR_BINARY_GLTF].content}else r=un.decodeText(new Uint8Array(e));let l=JSON.parse(r);if(l.asset===void 0||l.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let c=new Oy(l,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){let f=this.pluginCallbacks[u](c);o[f.name]=f,s[f.name]=!0}if(l.extensionsUsed)for(let u=0;u<l.extensionsUsed.length;++u){let f=l.extensionsUsed[u],h=l.extensionsRequired||[];switch(f){case Qe.KHR_MATERIALS_UNLIT:s[f]=new yy;break;case Qe.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:s[f]=new Ly;break;case Qe.KHR_DRACO_MESH_COMPRESSION:s[f]=new Py(l,this.dracoLoader);break;case Qe.KHR_TEXTURE_TRANSFORM:s[f]=new Cy;break;case Qe.KHR_MESH_QUANTIZATION:s[f]=new Ry;break;default:h.indexOf(f)>=0&&o[f]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+f+'".')}}c.setExtensions(s),c.setPlugins(o),c.parse(n,i)}};function _2(){let a={};return{get:function(e){return a[e]},add:function(e,t){a[e]=t},remove:function(e){delete a[e]},removeAll:function(){a={}}}}var Qe={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"},vy=class{constructor(e){this.parser=e,this.name=Qe.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let e=this.parser,t=this.parser.json.nodes||[];for(let n=0,i=t.length;n<i;n++){let r=t[n];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){let t=this.parser,n="light:"+e,i=t.cache.get(n);if(i)return i;let r=t.json,l=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e],c,u=new ue(16777215);l.color!==void 0&&u.fromArray(l.color);let f=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new Ai(u),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new ci(u),c.distance=f;break;case"spot":c=new Ei(u),c.distance=f,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,l.intensity!==void 0&&(c.intensity=l.intensity),c.name=t.createUniqueName(l.name||"light_"+e),i=Promise.resolve(c),t.cache.add(n,i),i}createNodeAttachment(e){let t=this,n=this.parser,r=n.json.nodes[e],o=(r.extensions&&r.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(l){return n._getNodeRef(t.cache,o,l)})}},yy=class{constructor(){this.name=Qe.KHR_MATERIALS_UNLIT}getMaterialType(){return ct}extendParams(e,t,n){let i=[];e.color=new ue(1,1,1),e.opacity=1;let r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){let s=r.baseColorFactor;e.color.fromArray(s),e.opacity=s[3]}r.baseColorTexture!==void 0&&i.push(n.assignTexture(e,"map",r.baseColorTexture))}return Promise.all(i)}},wy=class{constructor(e){this.parser=e,this.name=Qe.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){let n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Qi}extendMaterialParams(e,t){let n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let r=[],s=i.extensions[this.name];if(s.clearcoatFactor!==void 0&&(t.clearcoat=s.clearcoatFactor),s.clearcoatTexture!==void 0&&r.push(n.assignTexture(t,"clearcoatMap",s.clearcoatTexture)),s.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=s.clearcoatRoughnessFactor),s.clearcoatRoughnessTexture!==void 0&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),s.clearcoatNormalTexture!==void 0&&(r.push(n.assignTexture(t,"clearcoatNormalMap",s.clearcoatNormalTexture)),s.clearcoatNormalTexture.scale!==void 0)){let o=s.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new J(o,-o)}return Promise.all(r)}},_y=class{constructor(e){this.parser=e,this.name=Qe.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){let n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Qi}extendMaterialParams(e,t){let n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let r=[],s=i.extensions[this.name];return s.transmissionFactor!==void 0&&(t.transmission=s.transmissionFactor),s.transmissionTexture!==void 0&&r.push(n.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(r)}},by=class{constructor(e){this.parser=e,this.name=Qe.KHR_TEXTURE_BASISU}loadTexture(e){let t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;let r=i.extensions[this.name],s=n.images[r.source],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s,o)}},My=class{constructor(e){this.parser=e,this.name=Qe.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){let t=this.name,n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[t])return null;let s=r.extensions[t],o=i.images[s.source],l=n.textureLoader;if(o.uri){let c=n.options.manager.getHandler(o.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return n.loadTextureImage(e,o,l);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}},Sy=class{constructor(e){this.name=Qe.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){let t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){let i=n.extensions[this.name],r=this.parser.getDependency("buffer",i.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([r,s.ready]).then(function(o){let l=i.byteOffset||0,c=i.byteLength||0,u=i.count,f=i.byteStride,h=new ArrayBuffer(u*f),d=new Uint8Array(o[0],l,c);return s.decodeGltfBuffer(new Uint8Array(h),u,f,d,i.mode,i.filter),h})}else return null}},Ty="glTF",Cl=12,Ey={JSON:1313821514,BIN:5130562},Ay=class{constructor(e){this.name=Qe.KHR_BINARY_GLTF,this.content=null,this.body=null;let t=new DataView(e,0,Cl);if(this.header={magic:un.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Ty)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");let n=this.header.length-Cl,i=new DataView(e,Cl),r=0;for(;r<n;){let s=i.getUint32(r,!0);r+=4;let o=i.getUint32(r,!0);if(r+=4,o===Ey.JSON){let l=new Uint8Array(e,Cl+r,s);this.content=un.decodeText(l)}else if(o===Ey.BIN){let l=Cl+r;this.body=e.slice(l,l+s)}r+=s}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}},Py=class{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Qe.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){let n=this.json,i=this.dracoLoader,r=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,o={},l={},c={};for(let u in s){let f=xp[u]||u.toLowerCase();o[f]=s[u]}for(let u in e.attributes){let f=xp[u]||u.toLowerCase();if(s[u]!==void 0){let h=n.accessors[e.attributes[u]],d=Ll[h.componentType];c[f]=d,l[f]=h.normalized===!0}}return t.getDependency("bufferView",r).then(function(u){return new Promise(function(f){i.decodeDracoFile(u,function(h){for(let d in h.attributes){let p=h.attributes[d],m=l[d];m!==void 0&&(p.normalized=m)}f(h)},o,c)})})}},Cy=class{constructor(){this.name=Qe.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return t.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}},Wh=class extends Rn{constructor(e){super();this.isGLTFSpecularGlossinessMaterial=!0;let t=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),n=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	texelSpecular = sRGBToLinear( texelSpecular );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),r=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),s=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),o={specular:{value:new ue().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=o,this.onBeforeCompile=function(l){for(let c in o)l.uniforms[c]=o[c];l.fragmentShader=l.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",r).replace("#include <lights_physical_fragment>",s)},Object.defineProperties(this,{specular:{get:function(){return o.specular.value},set:function(l){o.specular.value=l}},specularMap:{get:function(){return o.specularMap.value},set:function(l){o.specularMap.value=l,l?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return o.glossiness.value},set:function(l){o.glossiness.value=l}},glossinessMap:{get:function(){return o.glossinessMap.value},set:function(l){o.glossinessMap.value=l,l?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}},Ly=class{constructor(){this.name=Qe.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return Wh}extendParams(e,t,n){let i=t.extensions[this.name];e.color=new ue(1,1,1),e.opacity=1;let r=[];if(Array.isArray(i.diffuseFactor)){let s=i.diffuseFactor;e.color.fromArray(s),e.opacity=s[3]}if(i.diffuseTexture!==void 0&&r.push(n.assignTexture(e,"map",i.diffuseTexture)),e.emissive=new ue(0,0,0),e.glossiness=i.glossinessFactor!==void 0?i.glossinessFactor:1,e.specular=new ue(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),i.specularGlossinessTexture!==void 0){let s=i.specularGlossinessTexture;r.push(n.assignTexture(e,"glossinessMap",s)),r.push(n.assignTexture(e,"specularMap",s))}return Promise.all(r)}createMaterial(e){let t=new Wh(e);return t.fog=!0,t.color=e.color,t.map=e.map===void 0?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=e.aoMap===void 0?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,t.bumpMap=e.bumpMap===void 0?null:e.bumpMap,t.bumpScale=1,t.normalMap=e.normalMap===void 0?null:e.normalMap,t.normalMapType=Hi,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=e.specularMap===void 0?null:e.specularMap,t.specular=e.specular,t.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=e.envMap===void 0?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}},Ry=class{constructor(){this.name=Qe.KHR_MESH_QUANTIZATION}},Ns=class extends zn{constructor(e,t,n,i){super(e,t,n,i)}copySampleValue_(e){let t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i*3+i;for(let s=0;s!==i;s++)t[s]=n[r+s];return t}};Ns.prototype.beforeStart_=Ns.prototype.copySampleValue_;Ns.prototype.afterEnd_=Ns.prototype.copySampleValue_;Ns.prototype.interpolate_=function(a,e,t,n){let i=this.resultBuffer,r=this.sampleValues,s=this.valueSize,o=s*2,l=s*3,c=n-e,u=(t-e)/c,f=u*u,h=f*u,d=a*l,p=d-l,m=-2*h+3*f,v=h-f,x=1-m,g=v-f+u;for(let y=0;y!==s;y++){let _=r[p+y+s],w=r[p+y+o]*c,b=r[d+y+s],S=r[d+y]*c;i[y]=x*_+g*w+m*b+v*S}return i};var or={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Ll={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Iy={9728:Mt,9729:Ke,9984:no,9985:Ba,9986:io,9987:mi},Dy={33071:bt,33648:hs,10497:Nt},Fy={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},xp={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},jr={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},b2={CUBICSPLINE:void 0,LINEAR:yr,STEP:ps},vp={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function By(a,e){return typeof a!="string"||a===""?"":(/^https?:\/\//i.test(e)&&/^\//.test(a)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(a)||/^data:.*,.*$/i.test(a)||/^blob:.*$/i.test(a)?a:e+a)}function M2(a){return a.DefaultMaterial===void 0&&(a.DefaultMaterial=new Rn({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:zi})),a.DefaultMaterial}function Rl(a,e,t){for(let n in t.extensions)a[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function Os(a,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(a.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function S2(a,e,t){let n=!1,i=!1;for(let o=0,l=e.length;o<l;o++){let c=e[o];if(c.POSITION!==void 0&&(n=!0),c.NORMAL!==void 0&&(i=!0),n&&i)break}if(!n&&!i)return Promise.resolve(a);let r=[],s=[];for(let o=0,l=e.length;o<l;o++){let c=e[o];if(n){let u=c.POSITION!==void 0?t.getDependency("accessor",c.POSITION):a.attributes.position;r.push(u)}if(i){let u=c.NORMAL!==void 0?t.getDependency("accessor",c.NORMAL):a.attributes.normal;s.push(u)}}return Promise.all([Promise.all(r),Promise.all(s)]).then(function(o){let l=o[0],c=o[1];return n&&(a.morphAttributes.position=l),i&&(a.morphAttributes.normal=c),a.morphTargetsRelative=!0,a})}function T2(a,e){if(a.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)a.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){let t=e.extras.targetNames;if(a.morphTargetInfluences.length===t.length){a.morphTargetDictionary={};for(let n=0,i=t.length;n<i;n++)a.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function E2(a){let e=a.extensions&&a.extensions[Qe.KHR_DRACO_MESH_COMPRESSION],t;return e?t="draco:"+e.bufferView+":"+e.indices+":"+Ny(e.attributes):t=a.indices+":"+Ny(a.attributes)+":"+a.mode,t}function Ny(a){let e="",t=Object.keys(a).sort();for(let n=0,i=t.length;n<i;n++)e+=t[n]+":"+a[t[n]]+";";return e}function yp(a){switch(a){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}var Oy=class{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new _2,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},typeof createImageBitmap!="undefined"&&/Firefox/.test(navigator.userAgent)===!1?this.textureLoader=new dl(this.options.manager):this.textureLoader=new ai(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Pt(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){let n=this,i=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll(function(s){return s._markDefs&&s._markDefs()}),Promise.all(this._invokeAll(function(s){return s.beforeRoot&&s.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(s){let o={scene:s[0][i.scene||0],scenes:s[0],animations:s[1],cameras:s[2],asset:i.asset,parser:n,userData:{}};Rl(r,o,i),Os(o,i),Promise.all(n._invokeAll(function(l){return l.afterRoot&&l.afterRoot(o)})).then(function(){e(o)})}).catch(t)}_markDefs(){let e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let i=0,r=t.length;i<r;i++){let s=t[i].joints;for(let o=0,l=s.length;o<l;o++)e[s[o]].isBone=!0}for(let i=0,r=e.length;i<r;i++){let s=e[i];s.mesh!==void 0&&(this._addNodeRef(this.meshCache,s.mesh),s.skin!==void 0&&(n[s.mesh].isSkinnedMesh=!0)),s.camera!==void 0&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;let i=n.clone();return i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){let t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){let i=e(t[n]);if(i)return i}return null}_invokeAll(e){let t=Object.values(this.plugins);t.unshift(this);let n=[];for(let i=0;i<t.length;i++){let r=e(t[i]);r&&n.push(r)}return n}getDependency(e,t){let n=e+":"+t,i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this.loadAnimation(t);break;case"camera":i=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){let n=this,i=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(i.map(function(r,s){return n.getDependency(e,s)})),this.cache.add(e,t)}return t}loadBuffer(e){let t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Qe.KHR_BINARY_GLTF].body);let i=this.options;return new Promise(function(r,s){n.load(By(t.uri,i.path),r,void 0,function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){let t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){let i=t.byteLength||0,r=t.byteOffset||0;return n.slice(r,r+i)})}loadAccessor(e){let t=this,n=this.json,i=this.json.accessors[e];if(i.bufferView===void 0&&i.sparse===void 0)return Promise.resolve(null);let r=[];return i.bufferView!==void 0?r.push(this.getDependency("bufferView",i.bufferView)):r.push(null),i.sparse!==void 0&&(r.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(r).then(function(s){let o=s[0],l=Fy[i.type],c=Ll[i.componentType],u=c.BYTES_PER_ELEMENT,f=u*l,h=i.byteOffset||0,d=i.bufferView!==void 0?n.bufferViews[i.bufferView].byteStride:void 0,p=i.normalized===!0,m,v;if(d&&d!==f){let x=Math.floor(h/d),g="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+x+":"+i.count,y=t.cache.get(g);y||(m=new c(o,x*d,i.count*d/u),y=new gi(m,d/u),t.cache.add(g,y)),v=new ri(y,l,h%d/u,p)}else o===null?m=new c(i.count*l):m=new c(o,h,i.count*l),v=new Se(m,l,p);if(i.sparse!==void 0){let x=Fy.SCALAR,g=Ll[i.sparse.indices.componentType],y=i.sparse.indices.byteOffset||0,_=i.sparse.values.byteOffset||0,w=new g(s[1],y,i.sparse.count*x),b=new c(s[2],_,i.sparse.count*l);o!==null&&(v=new Se(v.array.slice(),v.itemSize,v.normalized));for(let S=0,M=w.length;S<M;S++){let T=w[S];if(v.setX(T,b[S*l]),l>=2&&v.setY(T,b[S*l+1]),l>=3&&v.setZ(T,b[S*l+2]),l>=4&&v.setW(T,b[S*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return v})}loadTexture(e){let t=this.json,n=this.options,i=t.textures[e],r=t.images[i.source],s=this.textureLoader;if(r.uri){let o=n.manager.getHandler(r.uri);o!==null&&(s=o)}return this.loadTextureImage(e,r,s)}loadTextureImage(e,t,n){let i=this,r=this.json,s=this.options,o=r.textures[e],l=(t.uri||t.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];let c=self.URL||self.webkitURL,u=t.uri||"",f=!1,h=!0,d=u.search(/\.jpe?g($|\?)/i)>0||u.search(/^data\:image\/jpeg/)===0;if((t.mimeType==="image/jpeg"||d)&&(h=!1),t.bufferView!==void 0)u=i.getDependency("bufferView",t.bufferView).then(function(m){if(t.mimeType==="image/png"){let x=new DataView(m,25,1).getUint8(0,!1);h=x===6||x===4||x===3}f=!0;let v=new Blob([m],{type:t.mimeType});return u=c.createObjectURL(v),u});else if(t.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");let p=Promise.resolve(u).then(function(m){return new Promise(function(v,x){let g=v;n.isImageBitmapLoader===!0&&(g=function(y){let _=new lt(y);_.needsUpdate=!0,v(_)}),n.load(By(m,s.path),g,void 0,x)})}).then(function(m){f===!0&&c.revokeObjectURL(u),m.flipY=!1,o.name&&(m.name=o.name),h||(m.format=mn);let x=(r.samplers||{})[o.sampler]||{};return m.magFilter=Iy[x.magFilter]||Ke,m.minFilter=Iy[x.minFilter]||mi,m.wrapS=Dy[x.wrapS]||Nt,m.wrapT=Dy[x.wrapT]||Nt,i.associations.set(m,{type:"textures",index:e}),m}).catch(function(){return console.error("THREE.GLTFLoader: Couldn't load texture",u),null});return this.textureCache[l]=p,p}assignTexture(e,t,n){let i=this;return this.getDependency("texture",n.index).then(function(r){if(n.texCoord!==void 0&&n.texCoord!=0&&!(t==="aoMap"&&n.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),i.extensions[Qe.KHR_TEXTURE_TRANSFORM]){let s=n.extensions!==void 0?n.extensions[Qe.KHR_TEXTURE_TRANSFORM]:void 0;if(s){let o=i.associations.get(r);r=i.extensions[Qe.KHR_TEXTURE_TRANSFORM].extendTexture(r,s),i.associations.set(r,o)}}e[t]=r})}assignFinalMaterial(e){let t=e.geometry,n=e.material,i=t.attributes.tangent!==void 0,r=t.attributes.color!==void 0,s=t.attributes.normal===void 0,o=Object.keys(t.morphAttributes).length>0,l=o&&t.morphAttributes.normal!==void 0;if(e.isPoints){let c="PointsMaterial:"+n.uuid,u=this.cache.get(c);u||(u=new On,St.prototype.copy.call(u,n),u.color.copy(n.color),u.map=n.map,u.sizeAttenuation=!1,this.cache.add(c,u)),n=u}else if(e.isLine){let c="LineBasicMaterial:"+n.uuid,u=this.cache.get(c);u||(u=new rt,St.prototype.copy.call(u,n),u.color.copy(n.color),this.cache.add(c,u)),n=u}if(i||r||s||o){let c="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(c+="specular-glossiness:"),i&&(c+="vertex-tangents:"),r&&(c+="vertex-colors:"),s&&(c+="flat-shading:"),o&&(c+="morph-targets:"),l&&(c+="morph-normals:");let u=this.cache.get(c);u||(u=n.clone(),r&&(u.vertexColors=!0),s&&(u.flatShading=!0),o&&(u.morphTargets=!0),l&&(u.morphNormals=!0),i&&(u.vertexTangents=!0,u.normalScale&&(u.normalScale.y*=-1),u.clearcoatNormalScale&&(u.clearcoatNormalScale.y*=-1)),this.cache.add(c,u),this.associations.set(u,this.associations.get(n))),n=u}n.aoMap&&t.attributes.uv2===void 0&&t.attributes.uv!==void 0&&t.setAttribute("uv2",t.attributes.uv),e.material=n}getMaterialType(){return Rn}loadMaterial(e){let t=this,n=this.json,i=this.extensions,r=n.materials[e],s,o={},l=r.extensions||{},c=[];if(l[Qe.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){let f=i[Qe.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];s=f.getMaterialType(),c.push(f.extendParams(o,r,t))}else if(l[Qe.KHR_MATERIALS_UNLIT]){let f=i[Qe.KHR_MATERIALS_UNLIT];s=f.getMaterialType(),c.push(f.extendParams(o,r,t))}else{let f=r.pbrMetallicRoughness||{};if(o.color=new ue(1,1,1),o.opacity=1,Array.isArray(f.baseColorFactor)){let h=f.baseColorFactor;o.color.fromArray(h),o.opacity=h[3]}f.baseColorTexture!==void 0&&c.push(t.assignTexture(o,"map",f.baseColorTexture)),o.metalness=f.metallicFactor!==void 0?f.metallicFactor:1,o.roughness=f.roughnessFactor!==void 0?f.roughnessFactor:1,f.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(o,"metalnessMap",f.metallicRoughnessTexture)),c.push(t.assignTexture(o,"roughnessMap",f.metallicRoughnessTexture))),s=this._invokeOne(function(h){return h.getMaterialType&&h.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(h){return h.extendMaterialParams&&h.extendMaterialParams(e,o)})))}r.doubleSided===!0&&(o.side=Mn);let u=r.alphaMode||vp.OPAQUE;return u===vp.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,u===vp.MASK&&(o.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&s!==ct&&(c.push(t.assignTexture(o,"normalMap",r.normalTexture)),o.normalScale=new J(1,-1),r.normalTexture.scale!==void 0&&o.normalScale.set(r.normalTexture.scale,-r.normalTexture.scale)),r.occlusionTexture!==void 0&&s!==ct&&(c.push(t.assignTexture(o,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&s!==ct&&(o.emissive=new ue().fromArray(r.emissiveFactor)),r.emissiveTexture!==void 0&&s!==ct&&c.push(t.assignTexture(o,"emissiveMap",r.emissiveTexture)),Promise.all(c).then(function(){let f;return s===Wh?f=i[Qe.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):f=new s(o),r.name&&(f.name=r.name),f.map&&(f.map.encoding=xn),f.emissiveMap&&(f.emissiveMap.encoding=xn),Os(f,r),t.associations.set(f,{type:"materials",index:e}),r.extensions&&Rl(i,f,r),f})}createUniqueName(e){let t=Oe.sanitizeNodeName(e||""),n=t;for(let i=1;this.nodeNamesUsed[n];++i)n=t+"_"+i;return this.nodeNamesUsed[n]=!0,n}loadGeometries(e){let t=this,n=this.extensions,i=this.primitiveCache;function r(o){return n[Qe.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,t).then(function(l){return zy(l,o,t)})}let s=[];for(let o=0,l=e.length;o<l;o++){let c=e[o],u=E2(c),f=i[u];if(f)s.push(f.promise);else{let h;c.extensions&&c.extensions[Qe.KHR_DRACO_MESH_COMPRESSION]?h=r(c):h=zy(new ye,c,t),i[u]={primitive:c,promise:h},s.push(h)}}return Promise.all(s)}loadMesh(e){let t=this,n=this.json,i=this.extensions,r=n.meshes[e],s=r.primitives,o=[];for(let l=0,c=s.length;l<c;l++){let u=s[l].material===void 0?M2(this.cache):this.getDependency("material",s[l].material);o.push(u)}return o.push(t.loadGeometries(s)),Promise.all(o).then(function(l){let c=l.slice(0,l.length-1),u=l[l.length-1],f=[];for(let d=0,p=u.length;d<p;d++){let m=u[d],v=s[d],x,g=c[d];if(v.mode===or.TRIANGLES||v.mode===or.TRIANGLE_STRIP||v.mode===or.TRIANGLE_FAN||v.mode===void 0)x=r.isSkinnedMesh===!0?new Ji(m,g):new Ce(m,g),x.isSkinnedMesh===!0&&!x.geometry.attributes.skinWeight.normalized&&x.normalizeSkinWeights(),v.mode===or.TRIANGLE_STRIP?x.geometry=Uy(x.geometry,$u):v.mode===or.TRIANGLE_FAN&&(x.geometry=Uy(x.geometry,lc));else if(v.mode===or.LINES)x=new Ot(m,g);else if(v.mode===or.LINE_STRIP)x=new Gt(m,g);else if(v.mode===or.LINE_LOOP)x=new Io(m,g);else if(v.mode===or.POINTS)x=new vi(m,g);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+v.mode);Object.keys(x.geometry.morphAttributes).length>0&&T2(x,r),x.name=t.createUniqueName(r.name||"mesh_"+e),Os(x,r),v.extensions&&Rl(i,x,v),t.assignFinalMaterial(x),f.push(x)}if(f.length===1)return f[0];let h=new Jt;for(let d=0,p=f.length;d<p;d++)h.add(f[d]);return h})}loadCamera(e){let t,n=this.json.cameras[e],i=n[n.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new it(dt.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):n.type==="orthographic"&&(t=new sn(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),Os(t,n),Promise.resolve(t)}loadSkin(e){let t=this.json.skins[e],n={joints:t.joints};return t.inverseBindMatrices===void 0?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then(function(i){return n.inverseBindMatrices=i,n})}loadAnimation(e){let n=this.json.animations[e],i=[],r=[],s=[],o=[],l=[];for(let c=0,u=n.channels.length;c<u;c++){let f=n.channels[c],h=n.samplers[f.sampler],d=f.target,p=d.node!==void 0?d.node:d.id,m=n.parameters!==void 0?n.parameters[h.input]:h.input,v=n.parameters!==void 0?n.parameters[h.output]:h.output;i.push(this.getDependency("node",p)),r.push(this.getDependency("accessor",m)),s.push(this.getDependency("accessor",v)),o.push(h),l.push(d)}return Promise.all([Promise.all(i),Promise.all(r),Promise.all(s),Promise.all(o),Promise.all(l)]).then(function(c){let u=c[0],f=c[1],h=c[2],d=c[3],p=c[4],m=[];for(let x=0,g=u.length;x<g;x++){let y=u[x],_=f[x],w=h[x],b=d[x],S=p[x];if(y===void 0)continue;y.updateMatrix(),y.matrixAutoUpdate=!0;let M;switch(jr[S.path]){case jr.weights:M=bi;break;case jr.rotation:M=si;break;case jr.position:case jr.scale:default:M=Mi;break}let T=y.name?y.name:y.uuid,E=b.interpolation!==void 0?b2[b.interpolation]:yr,A=[];jr[S.path]===jr.weights?y.traverse(function(C){C.isMesh===!0&&C.morphTargetInfluences&&A.push(C.name?C.name:C.uuid)}):A.push(T);let I=w.array;if(w.normalized){let C=yp(I.constructor),R=new Float32Array(I.length);for(let D=0,F=I.length;D<F;D++)R[D]=I[D]*C;I=R}for(let C=0,R=A.length;C<R;C++){let D=new M(A[C]+"."+jr[S.path],_.array,I,E);b.interpolation==="CUBICSPLINE"&&(D.createInterpolant=function(O){return new Ns(this.times,this.values,this.getValueSize()/3,O)},D.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),m.push(D)}}let v=n.name?n.name:"animation_"+e;return new Si(v,void 0,m)})}createNodeMesh(e){let t=this.json,n=this,i=t.nodes[e];return i.mesh===void 0?null:n.getDependency("mesh",i.mesh).then(function(r){let s=n._getNodeRef(n.meshCache,i.mesh,r);return i.weights!==void 0&&s.traverse(function(o){if(!!o.isMesh)for(let l=0,c=i.weights.length;l<c;l++)o.morphTargetInfluences[l]=i.weights[l]}),s})}loadNode(e){let t=this.json,n=this.extensions,i=this,r=t.nodes[e],s=r.name?i.createUniqueName(r.name):"";return function(){let o=[],l=i._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&o.push(l),r.camera!==void 0&&o.push(i.getDependency("camera",r.camera).then(function(c){return i._getNodeRef(i.cameraCache,r.camera,c)})),i._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){o.push(c)}),Promise.all(o)}().then(function(o){let l;if(r.isBone===!0?l=new xi:o.length>1?l=new Jt:o.length===1?l=o[0]:l=new Re,l!==o[0])for(let c=0,u=o.length;c<u;c++)l.add(o[c]);if(r.name&&(l.userData.name=r.name,l.name=s),Os(l,r),r.extensions&&Rl(n,l,r),r.matrix!==void 0){let c=new fe;c.fromArray(r.matrix),l.applyMatrix4(c)}else r.translation!==void 0&&l.position.fromArray(r.translation),r.rotation!==void 0&&l.quaternion.fromArray(r.rotation),r.scale!==void 0&&l.scale.fromArray(r.scale);return i.associations.set(l,{type:"nodes",index:e}),l})}loadScene(e){let t=this.json,n=this.extensions,i=this.json.scenes[e],r=this,s=new Jt;i.name&&(s.name=r.createUniqueName(i.name)),Os(s,i),i.extensions&&Rl(n,s,i);let o=i.nodes||[],l=[];for(let c=0,u=o.length;c<u;c++)l.push(ky(o[c],s,t,r));return Promise.all(l).then(function(){return s})}};function ky(a,e,t,n){let i=t.nodes[a];return n.getDependency("node",a).then(function(r){if(i.skin===void 0)return r;let s;return n.getDependency("skin",i.skin).then(function(o){s=o;let l=[];for(let c=0,u=s.joints.length;c<u;c++)l.push(n.getDependency("node",s.joints[c]));return Promise.all(l)}).then(function(o){return r.traverse(function(l){if(!l.isMesh)return;let c=[],u=[];for(let f=0,h=o.length;f<h;f++){let d=o[f];if(d){c.push(d);let p=new fe;s.inverseBindMatrices!==void 0&&p.fromArray(s.inverseBindMatrices.array,f*16),u.push(p)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',s.joints[f])}l.bind(new $i(c,u),l.matrixWorld)}),r})}).then(function(r){e.add(r);let s=[];if(i.children){let o=i.children;for(let l=0,c=o.length;l<c;l++){let u=o[l];s.push(ky(u,r,t,n))}}return Promise.all(s)})}function A2(a,e,t){let n=e.attributes,i=new Dt;if(n.POSITION!==void 0){let o=t.json.accessors[n.POSITION],l=o.min,c=o.max;if(l!==void 0&&c!==void 0){if(i.set(new L(l[0],l[1],l[2]),new L(c[0],c[1],c[2])),o.normalized){let u=yp(Ll[o.componentType]);i.min.multiplyScalar(u),i.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;let r=e.targets;if(r!==void 0){let o=new L,l=new L;for(let c=0,u=r.length;c<u;c++){let f=r[c];if(f.POSITION!==void 0){let h=t.json.accessors[f.POSITION],d=h.min,p=h.max;if(d!==void 0&&p!==void 0){if(l.setX(Math.max(Math.abs(d[0]),Math.abs(p[0]))),l.setY(Math.max(Math.abs(d[1]),Math.abs(p[1]))),l.setZ(Math.max(Math.abs(d[2]),Math.abs(p[2]))),h.normalized){let m=yp(Ll[h.componentType]);l.multiplyScalar(m)}o.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(o)}a.boundingBox=i;let s=new En;i.getCenter(s.center),s.radius=i.min.distanceTo(i.max)/2,a.boundingSphere=s}function zy(a,e,t){let n=e.attributes,i=[];function r(s,o){return t.getDependency("accessor",s).then(function(l){a.setAttribute(o,l)})}for(let s in n){let o=xp[s]||s.toLowerCase();o in a.attributes||i.push(r(n[s],o))}if(e.indices!==void 0&&!a.index){let s=t.getDependency("accessor",e.indices).then(function(o){a.setIndex(o)});i.push(s)}return Os(a,e),A2(a,e,t),Promise.all(i).then(function(){return e.targets!==void 0?S2(a,e.targets,t):a})}function Uy(a,e){let t=a.getIndex();if(t===null){let s=[],o=a.getAttribute("position");if(o!==void 0){for(let l=0;l<o.count;l++)s.push(l);a.setIndex(s),t=a.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),a}let n=t.count-2,i=[];if(e===lc)for(let s=1;s<=n;s++)i.push(t.getX(0)),i.push(t.getX(s)),i.push(t.getX(s+1));else for(let s=0;s<n;s++)s%2==0?(i.push(t.getX(s)),i.push(t.getX(s+1)),i.push(t.getX(s+2))):(i.push(t.getX(s+2)),i.push(t.getX(s+1)),i.push(t.getX(s)));i.length/3!==n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let r=a.clone();return r.setIndex(i),r}var Vy=function(a,e,t,n){function i(r){return r instanceof t?r:new t(function(s){s(r)})}return new(t||(t=Promise))(function(r,s){function o(u){try{c(n.next(u))}catch(f){s(f)}}function l(u){try{c(n.throw(u))}catch(f){s(f)}}function c(u){u.done?r(u.value):i(u.value).then(o,l)}c((n=n.apply(a,e||[])).next())})},Il=class{constructor(e,t){this.cache=e,this.textureAnisotropy=t}get fileLoader(){return this._fileLoader||(this._fileLoader=new Pt),this._fileLoader}get imageLoader(){return this._imgLoader||(this._imgLoader=new Or),this._imgLoader}get svgLoader(){return this._svgLoader||(this._svgLoader=new Ds),this._svgLoader}get textureLoader(){return this._textureLoader||(this._textureLoader=new ai),this._textureLoader}get objectLoader(){return this._objectLoader||(this._objectLoader=new gh),this._objectLoader}get gltfLoader(){return this._gltfLoader||(this._gltfLoader=new Bs),this._gltfLoader}get fbxLoader(){return this._fbxLoader||(this._fbxLoader=new fp),this._fbxLoader}preload(e,t){return Vy(this,void 0,void 0,function*(){return this.cache.add(e,t),new Promise(n=>{let i=/\.fbx$|\.glb$|\.gltf$/.test(t);/\.jpe?g$|\.png$/.test(t)?this.textureLoader.load(t,s=>n(s)):(i&&this.fileLoader.setResponseType("arraybuffer"),this.fileLoader.load(t,s=>n(s)))})})}textureAtlas(e,t,n="JSONHash"){return Vy(this,void 0,void 0,function*(){let i=JSON.parse(yield this.file(t));if(i.textures){let o=i.textures[0].frames,l={frames:{}};o.forEach(c=>{l=Object.assign(Object.assign({},l),{frames:Object.assign(Object.assign({},l.frames),{[c.filename]:{frame:c.frame,rotated:c.rotated,sourceSize:c.sourceSize,spriteSourceSize:c.spriteSourceSize,trimmed:c.trimmed}})})}),i=l}return{texture:yield this.texture(e),json:i}})}file(e){let t=this.cache.get(e);return e=t||e,new Promise(n=>{this.fileLoader.load(e,i=>n(i))})}svg(e){let t=this.cache.get(e);return e=t||e,new Promise(n=>{this.svgLoader.load(e,i=>n(i))})}texture(e){if(!/^data:image\/[\S]+;base64,/gm.test(e)){let n=this.cache.get(e);e=n||e}return new Promise(n=>{this.textureLoader.load(e,i=>{i.anisotropy=this.textureAnisotropy,i.needsUpdate=!0,n(i)})})}object(e){let t=this.cache.get(e);return e=t||e,new Promise(n=>{this.objectLoader.load(e,i=>{n(i)})})}gltf(e){let t=this.cache.get(e);return e=t||e,new Promise(n=>{this.gltfLoader.load(e,i=>{n(i)})})}fbx(e){let t=this.cache.get(e);return e=t||e,new Promise(n=>{this.fbxLoader.load(e,i=>{n(i)})})}};var Hy=class extends Re{constructor(e,t,n,i){super();this.scene=e,this.light=t,this.size=n,this.color=i,this.geo=new hn(n||.2,16,8),this.mat=new ct({color:i||t.color}),this.mesh=new Ce(this.geo,this.mat),this.add(this.mesh),t.add(this)}dispose(){this.mesh.geometry.dispose(),Array.isArray(this.mesh.material)?this.mesh.material.forEach(e=>e.dispose()):this.mesh.material.dispose(),this.remove(this.mesh)}update(){}},Dl=class{constructor(e){this.scene=e}get helper(){return{directionalLightHelper:(e,t,n)=>{let i=new Sh(e,t,n);return this.scene.add(i),i},spotLightHelper:(e,t)=>{let n=new _h(e,t);return this.scene.add(n),n},pointLightHelper:(e,t,n)=>new Hy(this.scene,e,t,n)}}directionalLight(e={}){let{color:t=16777215,intensity:n=1}=e,i=new Ai(t,n);return i.castShadow=!0,this.scene.add(i),i}hemisphereLight(e={}){let{skyColor:t=16777215,groundColor:n=16777215,intensity:i=1}=e,r=new Xo(t,n,i);return this.scene.add(r),r}ambientLight(e={}){let{color:t=16777215,intensity:n=1}=e,i=new kr(t,n);return this.scene.add(i),i}pointLight(e={}){let{color:t=16777215,intensity:n=1,distance:i=0,decay:r=1}=e,s=new ci(t,n,i,r);return s.castShadow=!0,this.scene.add(s),s}spotLight(e={}){let{color:t=16777215,intensity:n=1,distance:i=0,angle:r=Math.PI/8,penumbra:s=0,decay:o=1}=e,l=new Ei(t,n,i,r,s,o);return l.castShadow=!0,this.scene.add(l),l}rectAreaLight(e={}){let{color:t=16777215,intensity:n=1,width:i=10,height:r=10}=e,s=new jo(t,n,i,r);return this.scene.add(s),s}};var ks=class extends Ce{constructor(e,t){super(e,t);this.isExtendedMesh=!0,this.isGroup=!1,this.vector3=new L,this.hasBody=!1,this.fragmentDepth=0,this.breakable=!1,this.fractureImpulse=1,this.name=`object-${this.id}`}get world(){return{theta:this.worldTheta,phi:this.worldPhi}}get worldTheta(){return this.getWorldDirection(this.vector3),Math.atan2(this.vector3.x,this.vector3.z)}get worldPhi(){return this.getWorldDirection(this.vector3),Math.acos(this.vector3.y)}};var Xh=new Map,P2=5,Ft=(a,e=!1)=>{if(!Xh.has(a))Xh.set(a,1);else{let t=Xh.get(a);if(typeof t=="undefined"||t>=P2)return;Xh.set(a,t+1)}e?console.error(`%c [enable3d] ${a} `,"background: #222; color: #bada55"):console.warn(`%c [enable3d] ${a} `,"background: #222; color: #bada55")};var Gy=class{constructor(){this._defaultMaterial=new _i({color:13421772})}get(){return this._defaultMaterial}},jh=Gy;var zs=function(a,e){var t={};for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&e.indexOf(n)<0&&(t[n]=a[n]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(a);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(a,n[i])&&(t[n[i]]=a[n[i]]);return t},Us=class{constructor(e){this.scene=e,this.isHeadless=e==="headless",this.defaultMaterial=new jh}get make(){return{plane:(e={},t={})=>this.makePlane(e,t),box:(e={},t={})=>this.makeBox(e,t),sphere:(e={},t={})=>this.makeSphere(e,t),cylinder:(e={},t={})=>this.makeCylinder(e,t),cone:(e={},t={})=>this.makeCone(e,t),torus:(e={},t={})=>this.makeTorus(e,t),extrude:(e,t={})=>this.makeExtrude(e,t)}}get add(){return{mesh:e=>this.addMesh(e),existing:e=>this.addExisting(e),plane:(e={},t={})=>this.addPlane(e,t),box:(e={},t={})=>this.addBox(e,t),ground:(e,t={})=>this.addGround(e,t),sphere:(e={},t={})=>this.addSphere(e,t),cylinder:(e={},t={})=>this.addCylinder(e,t),cone:(e={},t={})=>this.addCone(e,t),torus:(e={},t={})=>this.addTorus(e,t),extrude:(e,t={})=>this.addExtrude(e,t),material:(e={})=>this.addMaterial(e)}}addExisting(...e){this.scene!=="headless"&&this.scene.add(...e)}addMesh(e){if(Array.isArray(e))for(let t=0;t<e.length;t++)this.addExisting(e[t]);else this.addExisting(e);return this}createMesh(e,t,n){let{x:i=0,y:r=0,z:s=0}=n,o;switch(!Array.isArray(t)&&t.type){case"LineBasicMaterial":o=new Gt(e,t);break;case"PointsMaterial":o=new vi(e,t);break;default:o=new ks(e,t);break}return o.position.set(i,r,s),o.castShadow=o.receiveShadow=!0,o}makeExtrude(e,t){let{x:n,y:i,z:r,name:s,shape:o,autoCenter:l=!0,breakable:c=!1}=e,u=zs(e,["x","y","z","name","shape","autoCenter","breakable"]),{depth:f=1,bevelEnabled:h=!1}=u,d=new Ln(o,Object.assign({depth:f,bevelEnabled:h},u)),p=this.addMaterial(t),m=this.createMesh(d,p,{x:n,y:i,z:r});return l&&m.geometry.center(),m.name=s||`body_id_${m.id}`,m.shape="extrude",m}addExtrude(e,t={}){let n=this.makeExtrude(e,t);return this.addExisting(n),n}makePlane(e,t){let{x:n,y:i,z:r,name:s,breakable:o=!1}=e,l=zs(e,["x","y","z","name","breakable"]),c=new tn(l.width||1,l.height||1,l.widthSegments||1,l.heightSegments||1),u=this.addMaterial(t);u.side=Mn;let f=this.createMesh(c,u,{x:n,y:i,z:r});return f.name=s||`body_id_${f.id}`,f.shape="plane",f}addPlane(e,t){let n=this.makePlane(e,t);return this.addExisting(n),n}makeSphere(e,t){let{x:n,y:i,z:r,name:s,breakable:o=!1}=e,l=zs(e,["x","y","z","name","breakable"]),c=new hn(l.radius||1,l.widthSegments||16,l.heightSegments||12,l.phiStart||void 0,l.phiLength||void 0,l.thetaStart||void 0,l.thetaLength||void 0),u=this.addMaterial(t),f=this.createMesh(c,u,{x:n,y:i,z:r});return f.name=s||`body_id_${f.id}`,f.shape="sphere",f}addSphere(e={},t={}){let n=this.makeSphere(e,t);return this.addExisting(n),n}makeBox(e,t){let{x:n,y:i,z:r,name:s,breakable:o=!1}=e,l=zs(e,["x","y","z","name","breakable"]),c=new ni(l.width||1,l.height||1,l.depth||1,l.widthSegments||void 0,l.heightSegments||void 0,l.depthSegments||void 0),u=this.addMaterial(t),f=this.createMesh(c,u,{x:n,y:i,z:r});return f.name=s||`body_id_${f.id}`,f.shape="box",f}addBox(e={},t={}){let n=this.makeBox(e,t);return this.addExisting(n),n}addGround(e,t={}){let n=this.makeBox(e,t);return n.rotateX(dt.degToRad(90)),this.addExisting(n),n}makeCylinder(e={},t={}){let{x:n,y:i,z:r,name:s,breakable:o=!1}=e,l=zs(e,["x","y","z","name","breakable"]),c=new yi(l.radiusTop||1,l.radiusBottom||1,l.height||1,l.radiusSegments||void 0,l.heightSegments||void 0,l.openEnded||void 0,l.thetaStart||void 0,l.thetaLength||void 0),u=this.addMaterial(t),f=this.createMesh(c,u,{x:n,y:i,z:r});return f.name=s||`body_id_${f.id}`,f.shape="cylinder",f}addCylinder(e={},t={}){let n=this.makeCylinder(e,t);return this.addExisting(n),n}makeCone(e={},t={}){let{x:n,y:i,z:r,name:s,breakable:o=!1}=e,l=zs(e,["x","y","z","name","breakable"]),c=new Rr(l.radius||1,l.height||1,l.radiusSegments||8,l.heightSegments||1,l.openEnded||!1,l.thetaStart||0,l.thetaLength||2*Math.PI),u=this.addMaterial(t),f=this.createMesh(c,u,{x:n,y:i,z:r});return f.name=s||`body_id_${f.id}`,f.shape="cone",f}addCone(e={},t={}){let n=this.makeCone(e,t);return this.addExisting(n),n}makeTorus(e={},t={}){let{x:n,y:i,z:r,name:s,breakable:o=!1}=e,l=zs(e,["x","y","z","name","breakable"]),c=new Fr(l.radius||void 0,l.tube||void 0,l.radialSegments||void 0,l.tubularSegments||void 0,l.arc||void 0),u=this.addMaterial(t),f=this.createMesh(c,u,{x:n,y:i,z:r});return f.name=s||`body_id_${f.id}`,f.shape="torus",f}addTorus(e={},t={}){let n=this.makeTorus(e,t);return this.addExisting(n),n}addMaterial(e={}){let t=Object.keys(e)[0],n;if(this.scene==="headless")return this.defaultMaterial.get();switch(t){case"basic":n=new ct(e.basic);break;case"normal":n=new Wo(e.normal);break;case"standard":n=new Rn(e.standard);break;case"lambert":n=new _i(e.lambert);break;case"phong":n=new kn(e.phong);break;case"physical":typeof e.physical!="undefined"?n=new Qi(e.physical):(Ft("You need to pass parameters to the physical material. (Fallback to default material)"),n=this.defaultMaterial.get());break;case"toon":n=new Go(e.toon);break;case"line":n=new rt(e.line);break;case"points":n=new On(e.points);break;case"custom":n=e.custom||this.defaultMaterial.get();break;default:n=this.defaultMaterial.get();break}return n}};var Fl=class{constructor(e){this.scene=e}add(e,t={}){let n=this.make(e,t);return n?this.scene.add(n):console.warn("Could not make heightmap"),n}make(e,t={}){let{image:n}=e,{width:i,height:r}=n,{colorScale:s}=t,o=document.createElement("canvas");o.width=i,o.height=r;let l=o.getContext("2d");if(!l)return;l.drawImage(e.image,0,0);let c=l.getImageData(0,0,i,r),u=new Hn().fromBufferGeometry(new tn(10,10,i-1,r-1)),f={color:13421772,side:Mn};s&&(f=Object.assign(Object.assign({},f),{vertexColors:!0}));let h=new kn(f),d=new ks(u,h);d.receiveShadow=d.castShadow=!0,d.shape="concave";let p=d.geometry;for(let v=0;v<p.vertices.length;v++)p.vertices[v].z=c.data[v*4]/120;let m=(v,x)=>{var g=v.vertices[x.a].z,y=v.vertices[x.b].z,_=v.vertices[x.c].z;return Math.max(g,y,_)};return s&&p.faces.forEach(v=>v.color=new ue(s(m(p,v)).hex())),d.rotateX(-Math.PI/2),d.updateMatrix(),u.computeFaceNormals(),u.computeVertexNormals(),d.name="heightmap",d.geometry=Rh(new ye,d.geometry),d}};var Wy={type:"change"},wp={type:"start"},_p={type:"end"},bp=class extends Sn{constructor(e,t){super();t===void 0&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new L,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:gr.ROTATE,MIDDLE:gr.DOLLY,RIGHT:gr.PAN},this.touches={ONE:xr.ROTATE,TWO:xr.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return o.phi},this.getAzimuthalAngle=function(){return o.theta},this.listenToKeyEvents=function($){$.addEventListener("keydown",Ee),this._domElementKeyEvents=$},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(Wy),n.update(),r=i.NONE},this.update=function(){let $=new L,be=new Ve().setFromUnitVectors(e.up,new L(0,1,0)),Je=be.clone().invert(),Be=new L,ot=new Ve,mt=2*Math.PI;return function(){let di=n.object.position;$.copy(di).sub(n.target),$.applyQuaternion(be),o.setFromVector3($),n.autoRotate&&r===i.NONE&&T(S()),n.enableDamping?(o.theta+=l.theta*n.dampingFactor,o.phi+=l.phi*n.dampingFactor):(o.theta+=l.theta,o.phi+=l.phi);let zt=n.minAzimuthAngle,_t=n.maxAzimuthAngle;return isFinite(zt)&&isFinite(_t)&&(zt<-Math.PI?zt+=mt:zt>Math.PI&&(zt-=mt),_t<-Math.PI?_t+=mt:_t>Math.PI&&(_t-=mt),zt<=_t?o.theta=Math.max(zt,Math.min(_t,o.theta)):o.theta=o.theta>(zt+_t)/2?Math.max(zt,o.theta):Math.min(_t,o.theta)),o.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,o.phi)),o.makeSafe(),o.radius*=c,o.radius=Math.max(n.minDistance,Math.min(n.maxDistance,o.radius)),n.enableDamping===!0?n.target.addScaledVector(u,n.dampingFactor):n.target.add(u),$.setFromSpherical(o),$.applyQuaternion(Je),di.copy(n.target).add($),n.object.lookAt(n.target),n.enableDamping===!0?(l.theta*=1-n.dampingFactor,l.phi*=1-n.dampingFactor,u.multiplyScalar(1-n.dampingFactor)):(l.set(0,0,0),u.set(0,0,0)),c=1,f||Be.distanceToSquared(n.object.position)>s||8*(1-ot.dot(n.object.quaternion))>s?(n.dispatchEvent(Wy),Be.copy(n.object.position),ot.copy(n.object.quaternion),f=!1,!0):!1}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",ge),n.domElement.removeEventListener("pointerdown",V),n.domElement.removeEventListener("pointercancel",ee),n.domElement.removeEventListener("wheel",Te),n.domElement.ownerDocument.removeEventListener("pointermove",P),n.domElement.ownerDocument.removeEventListener("pointerup",N),n._domElementKeyEvents!==null&&n._domElementKeyEvents.removeEventListener("keydown",Ee)};let n=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},r=i.NONE,s=1e-6,o=new gl,l=new gl,c=1,u=new L,f=!1,h=new J,d=new J,p=new J,m=new J,v=new J,x=new J,g=new J,y=new J,_=new J,w=[],b={};function S(){return 2*Math.PI/60/60*n.autoRotateSpeed}function M(){return Math.pow(.95,n.zoomSpeed)}function T($){l.theta-=$}function E($){l.phi-=$}let A=function(){let $=new L;return function(Je,Be){$.setFromMatrixColumn(Be,0),$.multiplyScalar(-Je),u.add($)}}(),I=function(){let $=new L;return function(Je,Be){n.screenSpacePanning===!0?$.setFromMatrixColumn(Be,1):($.setFromMatrixColumn(Be,0),$.crossVectors(n.object.up,$)),$.multiplyScalar(Je),u.add($)}}(),C=function(){let $=new L;return function(Je,Be){let ot=n.domElement;if(n.object.isPerspectiveCamera){let mt=n.object.position;$.copy(mt).sub(n.target);let Bn=$.length();Bn*=Math.tan(n.object.fov/2*Math.PI/180),A(2*Je*Bn/ot.clientHeight,n.object.matrix),I(2*Be*Bn/ot.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(A(Je*(n.object.right-n.object.left)/n.object.zoom/ot.clientWidth,n.object.matrix),I(Be*(n.object.top-n.object.bottom)/n.object.zoom/ot.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function R($){n.object.isPerspectiveCamera?c/=$:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*$)),n.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function D($){n.object.isPerspectiveCamera?c*=$:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/$)),n.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function F($){h.set($.clientX,$.clientY)}function O($){g.set($.clientX,$.clientY)}function U($){m.set($.clientX,$.clientY)}function j($){d.set($.clientX,$.clientY),p.subVectors(d,h).multiplyScalar(n.rotateSpeed);let be=n.domElement;T(2*Math.PI*p.x/be.clientHeight),E(2*Math.PI*p.y/be.clientHeight),h.copy(d),n.update()}function Z($){y.set($.clientX,$.clientY),_.subVectors(y,g),_.y>0?R(M()):_.y<0&&D(M()),g.copy(y),n.update()}function K($){v.set($.clientX,$.clientY),x.subVectors(v,m).multiplyScalar(n.panSpeed),C(x.x,x.y),m.copy(v),n.update()}function G(){}function k($){$.deltaY<0?D(M()):$.deltaY>0&&R(M()),n.update()}function B($){let be=!1;switch($.code){case n.keys.UP:C(0,n.keyPanSpeed),be=!0;break;case n.keys.BOTTOM:C(0,-n.keyPanSpeed),be=!0;break;case n.keys.LEFT:C(n.keyPanSpeed,0),be=!0;break;case n.keys.RIGHT:C(-n.keyPanSpeed,0),be=!0;break}be&&($.preventDefault(),n.update())}function H(){if(w.length===1)h.set(w[0].pageX,w[0].pageY);else{let $=.5*(w[0].pageX+w[1].pageX),be=.5*(w[0].pageY+w[1].pageY);h.set($,be)}}function W(){if(w.length===1)m.set(w[0].pageX,w[0].pageY);else{let $=.5*(w[0].pageX+w[1].pageX),be=.5*(w[0].pageY+w[1].pageY);m.set($,be)}}function X(){let $=w[0].pageX-w[1].pageX,be=w[0].pageY-w[1].pageY,Je=Math.sqrt($*$+be*be);g.set(0,Je)}function te(){n.enableZoom&&X(),n.enablePan&&W()}function he(){n.enableZoom&&X(),n.enableRotate&&H()}function ae($){if(w.length==1)d.set($.pageX,$.pageY);else{let Je=qe($),Be=.5*($.pageX+Je.x),ot=.5*($.pageY+Je.y);d.set(Be,ot)}p.subVectors(d,h).multiplyScalar(n.rotateSpeed);let be=n.domElement;T(2*Math.PI*p.x/be.clientHeight),E(2*Math.PI*p.y/be.clientHeight),h.copy(d)}function ce($){if(w.length===1)v.set($.pageX,$.pageY);else{let be=qe($),Je=.5*($.pageX+be.x),Be=.5*($.pageY+be.y);v.set(Je,Be)}x.subVectors(v,m).multiplyScalar(n.panSpeed),C(x.x,x.y),m.copy(v)}function q($){let be=qe($),Je=$.pageX-be.x,Be=$.pageY-be.y,ot=Math.sqrt(Je*Je+Be*Be);y.set(0,ot),_.set(0,Math.pow(y.y/g.y,n.zoomSpeed)),R(_.y),g.copy(y)}function re($){n.enableZoom&&q($),n.enablePan&&ce($)}function Q($){n.enableZoom&&q($),n.enableRotate&&ae($)}function oe(){}function V($){n.enabled!==!1&&(w.length===0&&(n.domElement.ownerDocument.addEventListener("pointermove",P),n.domElement.ownerDocument.addEventListener("pointerup",N)),de($),$.pointerType==="touch"?Ie($):se($))}function P($){n.enabled!==!1&&($.pointerType==="touch"?Me($):me($))}function N($){n.enabled!==!1&&($.pointerType==="touch"?Y():ve($),Ae($),w.length===0&&(n.domElement.ownerDocument.removeEventListener("pointermove",P),n.domElement.ownerDocument.removeEventListener("pointerup",N)))}function ee($){Ae($)}function se($){let be;switch($.button){case 0:be=n.mouseButtons.LEFT;break;case 1:be=n.mouseButtons.MIDDLE;break;case 2:be=n.mouseButtons.RIGHT;break;default:be=-1}switch(be){case gr.DOLLY:if(n.enableZoom===!1)return;O($),r=i.DOLLY;break;case gr.ROTATE:if($.ctrlKey||$.metaKey||$.shiftKey){if(n.enablePan===!1)return;U($),r=i.PAN}else{if(n.enableRotate===!1)return;F($),r=i.ROTATE}break;case gr.PAN:if($.ctrlKey||$.metaKey||$.shiftKey){if(n.enableRotate===!1)return;F($),r=i.ROTATE}else{if(n.enablePan===!1)return;U($),r=i.PAN}break;default:r=i.NONE}r!==i.NONE&&n.dispatchEvent(wp)}function me($){if(n.enabled!==!1)switch(r){case i.ROTATE:if(n.enableRotate===!1)return;j($);break;case i.DOLLY:if(n.enableZoom===!1)return;Z($);break;case i.PAN:if(n.enablePan===!1)return;K($);break}}function ve($){G($),n.dispatchEvent(_p),r=i.NONE}function Te($){n.enabled===!1||n.enableZoom===!1||r!==i.NONE&&r!==i.ROTATE||($.preventDefault(),n.dispatchEvent(wp),k($),n.dispatchEvent(_p))}function Ee($){n.enabled===!1||n.enablePan===!1||B($)}function Ie($){switch(we($),w.length){case 1:switch(n.touches.ONE){case xr.ROTATE:if(n.enableRotate===!1)return;H(),r=i.TOUCH_ROTATE;break;case xr.PAN:if(n.enablePan===!1)return;W(),r=i.TOUCH_PAN;break;default:r=i.NONE}break;case 2:switch(n.touches.TWO){case xr.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;te(),r=i.TOUCH_DOLLY_PAN;break;case xr.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;he(),r=i.TOUCH_DOLLY_ROTATE;break;default:r=i.NONE}break;default:r=i.NONE}r!==i.NONE&&n.dispatchEvent(wp)}function Me($){switch(we($),r){case i.TOUCH_ROTATE:if(n.enableRotate===!1)return;ae($),n.update();break;case i.TOUCH_PAN:if(n.enablePan===!1)return;ce($),n.update();break;case i.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;re($),n.update();break;case i.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Q($),n.update();break;default:r=i.NONE}}function Y($){oe($),n.dispatchEvent(_p),r=i.NONE}function ge($){n.enabled!==!1&&$.preventDefault()}function de($){w.push($)}function Ae($){delete b[$.pointerId];for(let be=0;be<w.length;be++)if(w[be].pointerId==$.pointerId){w.splice(be,1);return}}function we($){let be=b[$.pointerId];be===void 0&&(be=new J,b[$.pointerId]=be),be.set($.pageX,$.pageY)}function qe($){let be=$.pointerId===w[0].pointerId?w[1]:w[0];return b[be.pointerId]}n.domElement.addEventListener("contextmenu",ge),n.domElement.addEventListener("pointerdown",V),n.domElement.addEventListener("pointercancel",ee),n.domElement.addEventListener("wheel",Te,{passive:!1}),this.update()}};var C2=function(a,e,t,n){function i(r){return r instanceof t?r:new t(function(s){s(r)})}return new(t||(t=Promise))(function(r,s){function o(u){try{c(n.next(u))}catch(f){s(f)}}function l(u){try{c(n.throw(u))}catch(f){s(f)}}function c(u){u.done?r(u.value):i(u.value).then(o,l)}c((n=n.apply(a,e||[])).next())})},Bl=class{constructor(e,t,n,i,r,s,o){this.scene=e,this.renderer=t,this.camera=n,this.lights=i,this.physics=r,this.load=s,this.factories=o}warpSpeed(...e){return C2(this,void 0,void 0,function*(){let t={},n=e.filter(l=>/^-\w+/.test(l)),i=n.length>0;if((e.length===0||i)&&(e=["light","camera","lookAtCenter","ground","grid","orbitControls","fog","sky"]),i&&n.map(c=>c.substr(1)).forEach(c=>{let u=e.indexOf(c);e.splice(u,1)}),e.includes("sky")){let l=["varying vec3 vWorldPosition;","","void main() {","","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","","}"].join(`
`),c=["uniform vec3 topColor;","uniform vec3 bottomColor;","uniform float offset;","uniform float exponent;","","varying vec3 vWorldPosition;","","void main() {","","float h = normalize( vWorldPosition + offset ).y;","gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h , 0.0), exponent ), 0.0 ) ), 0.9 );","","}"].join(`
`),u={topColor:{value:new ue(30719)},bottomColor:{value:new ue(15595007)},offset:{value:33},exponent:{value:.6}};var r=new hn(500,32,15),s=new Ht({uniforms:u,vertexShader:l,fragmentShader:c,side:gt}),o=new Ce(r,s);this.scene.add(o)}if(e.includes("camera")&&(this.camera.position.set(0,6,12),t=Object.assign({camera:this.camera},t)),e.includes("light")){let l=.4,c=this.lights.hemisphereLight({skyColor:16777215,groundColor:0,intensity:l}),u=this.lights.ambientLight({color:16777215,intensity:l}),f=this.lights.directionalLight({color:16777215,intensity:l});f.position.set(100,200,50);let h=20;f.shadow.camera.top=h,f.shadow.camera.bottom=-h,f.shadow.camera.left=-h,f.shadow.camera.right=h,f.shadow.mapSize.set(1024,1024),t=Object.assign({lights:{ambientLight:u,directionalLight:f,hemisphereLight:c}},t)}if(e.includes("lookAtCenter")&&this.camera.lookAt(this.scene.position),e.includes("ground")){let l=e.includes("grid"),c="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOnAAADusBZ+q87AAAAJtJREFUeJzt0EENwDAAxLDbNP6UOxh+NEYQ5dl2drFv286598GrA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAa4AO0BqgA7QG6ACtATpAu37AD8eaBH5JQdVbAAAAAElFTkSuQmCC",u=yield this.load.texture(c);u.wrapS=u.wrapT=Nt,u.repeat.set(21,21);let f={name:"ground",width:21,height:21,depth:1,y:-.5},h={phong:{map:l?u:null,color:16777215}},d;window.__loadPhysics?(d=this.physics.add.ground(f,h),d.body.setRestitution(1)):d=this.factories.add.ground(f,h),d.receiveShadow=!0,t=Object.assign({ground:d},t)}if(e.includes("orbitControls")){let l=new bp(this.camera,document.getElementById("enable3d-phaser-canvas")||this.renderer.domElement);t=Object.assign({orbitControls:l},t)}return t})}};var Xy=class{constructor(){this._mixers=[]}animationMixer(e){let t=new pl(e);return this.mixers.add(t),t}get mixers(){return{create:e=>this.animationMixer(e),add:e=>this._mixers.push(e),get:()=>this._mixers,update:e=>{var t;return(t=this._mixers)===null||t===void 0?void 0:t.forEach(n=>n.update(e/1e3))}}}},Mp=Xy;var qr=class extends Ce{constructor(e,t={}){super(e);this.type="Reflector";let n=this,i=t.color!==void 0?new ue(t.color):new ue(8355711),r=t.textureWidth||512,s=t.textureHeight||512,o=t.clipBias||0,l=t.shader||qr.ReflectorShader,c=new Tt,u=new L,f=new L,h=new L,d=new fe,p=new L(0,0,-1),m=new De,v=new L,x=new L,g=new De,y=new fe,_=new it,w={minFilter:Ke,magFilter:Ke,format:mn},b=new Zt(r,s,w);(!dt.isPowerOfTwo(r)||!dt.isPowerOfTwo(s))&&(b.texture.generateMipmaps=!1);let S=new Ht({uniforms:Pr.clone(l.uniforms),fragmentShader:l.fragmentShader,vertexShader:l.vertexShader});S.uniforms.tDiffuse.value=b.texture,S.uniforms.color.value=i,S.uniforms.textureMatrix.value=y,this.material=S,this.onBeforeRender=function(M,T,E){if(f.setFromMatrixPosition(n.matrixWorld),h.setFromMatrixPosition(E.matrixWorld),d.extractRotation(n.matrixWorld),u.set(0,0,1),u.applyMatrix4(d),v.subVectors(f,h),v.dot(u)>0)return;v.reflect(u).negate(),v.add(f),d.extractRotation(E.matrixWorld),p.set(0,0,-1),p.applyMatrix4(d),p.add(h),x.subVectors(f,p),x.reflect(u).negate(),x.add(f),_.position.copy(v),_.up.set(0,1,0),_.up.applyMatrix4(d),_.up.reflect(u),_.lookAt(x),_.far=E.far,_.updateMatrixWorld(),_.projectionMatrix.copy(E.projectionMatrix),y.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),y.multiply(_.projectionMatrix),y.multiply(_.matrixWorldInverse),y.multiply(n.matrixWorld),c.setFromNormalAndCoplanarPoint(u,f),c.applyMatrix4(_.matrixWorldInverse),m.set(c.normal.x,c.normal.y,c.normal.z,c.constant);let A=_.projectionMatrix;g.x=(Math.sign(m.x)+A.elements[8])/A.elements[0],g.y=(Math.sign(m.y)+A.elements[9])/A.elements[5],g.z=-1,g.w=(1+A.elements[10])/A.elements[14],m.multiplyScalar(2/m.dot(g)),A.elements[2]=m.x,A.elements[6]=m.y,A.elements[10]=m.z+1-o,A.elements[14]=m.w,b.texture.encoding=M.outputEncoding,n.visible=!1;let I=M.getRenderTarget(),C=M.xr.enabled,R=M.shadowMap.autoUpdate;M.xr.enabled=!1,M.shadowMap.autoUpdate=!1,M.setRenderTarget(b),M.state.buffers.depth.setMask(!0),M.autoClear===!1&&M.clear(),M.render(T,_),M.xr.enabled=C,M.shadowMap.autoUpdate=R,M.setRenderTarget(I);let D=E.viewport;D!==void 0&&M.state.viewport(D),n.visible=!0},this.getRenderTarget=function(){return b}}};qr.prototype.isReflector=!0;qr.ReflectorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`
		uniform mat4 textureMatrix;
		varying vec4 vUv;

		#include <common>
		#include <logdepthbuf_pars_vertex>

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

			#include <logdepthbuf_vertex>

		}`,fragmentShader:`
		uniform vec3 color;
		uniform sampler2D tDiffuse;
		varying vec4 vUv;

		#include <logdepthbuf_pars_fragment>

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			#include <logdepthbuf_fragment>

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

		}`};var Yr=class extends Ce{constructor(e,t={}){super(e);this.type="Refractor";let n=this,i=t.color!==void 0?new ue(t.color):new ue(8355711),r=t.textureWidth||512,s=t.textureHeight||512,o=t.clipBias||0,l=t.shader||Yr.RefractorShader,c=new it;c.matrixAutoUpdate=!1,c.userData.refractor=!0;let u=new Tt,f=new fe,h={minFilter:Ke,magFilter:Ke,format:mn},d=new Zt(r,s,h);(!dt.isPowerOfTwo(r)||!dt.isPowerOfTwo(s))&&(d.texture.generateMipmaps=!1),this.material=new Ht({uniforms:Pr.clone(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,transparent:!0}),this.material.uniforms.color.value=i,this.material.uniforms.tDiffuse.value=d.texture,this.material.uniforms.textureMatrix.value=f;let p=function(){let y=new L,_=new L,w=new fe,b=new L,S=new L;return function(T){return y.setFromMatrixPosition(n.matrixWorld),_.setFromMatrixPosition(T.matrixWorld),b.subVectors(y,_),w.extractRotation(n.matrixWorld),S.set(0,0,1),S.applyMatrix4(w),b.dot(S)<0}}(),m=function(){let y=new L,_=new L,w=new Ve,b=new L;return function(){n.matrixWorld.decompose(_,w,b),y.set(0,0,1).applyQuaternion(w).normalize(),y.negate(),u.setFromNormalAndCoplanarPoint(y,_)}}(),v=function(){let y=new Tt,_=new De,w=new De;return function(S){c.matrixWorld.copy(S.matrixWorld),c.matrixWorldInverse.copy(c.matrixWorld).invert(),c.projectionMatrix.copy(S.projectionMatrix),c.far=S.far,y.copy(u),y.applyMatrix4(c.matrixWorldInverse),_.set(y.normal.x,y.normal.y,y.normal.z,y.constant);let M=c.projectionMatrix;w.x=(Math.sign(_.x)+M.elements[8])/M.elements[0],w.y=(Math.sign(_.y)+M.elements[9])/M.elements[5],w.z=-1,w.w=(1+M.elements[10])/M.elements[14],_.multiplyScalar(2/_.dot(w)),M.elements[2]=_.x,M.elements[6]=_.y,M.elements[10]=_.z+1-o,M.elements[14]=_.w}}();function x(y){f.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),f.multiply(y.projectionMatrix),f.multiply(y.matrixWorldInverse),f.multiply(n.matrixWorld)}function g(y,_,w){n.visible=!1;let b=y.getRenderTarget(),S=y.xr.enabled,M=y.shadowMap.autoUpdate;y.xr.enabled=!1,y.shadowMap.autoUpdate=!1,y.setRenderTarget(d),y.autoClear===!1&&y.clear(),y.render(_,c),y.xr.enabled=S,y.shadowMap.autoUpdate=M,y.setRenderTarget(b);let T=w.viewport;T!==void 0&&y.state.viewport(T),n.visible=!0}this.onBeforeRender=function(y,_,w){d.texture.encoding=y.outputEncoding,w.userData.refractor!==!0&&(!p(w)||(m(),x(w),v(w),g(y,_,w)))},this.getRenderTarget=function(){return d}}};Yr.prototype.isRefractor=!0;Yr.RefractorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`

		uniform mat4 textureMatrix;

		varying vec4 vUv;

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform vec3 color;
		uniform sampler2D tDiffuse;

		varying vec4 vUv;

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

		}`};var Vs=class extends Ce{constructor(e,t={}){super(e);this.type="Water";let n=this,i=t.color!==void 0?new ue(t.color):new ue(16777215),r=t.textureWidth||512,s=t.textureHeight||512,o=t.clipBias||0,l=t.flowDirection||new J(1,0),c=t.flowSpeed||.03,u=t.reflectivity||.02,f=t.scale||1,h=t.shader||Vs.WaterShader,d=t.encoding!==void 0?t.encoding:jt,p=new ai,m=t.flowMap||void 0,v=t.normalMap0||p.load("textures/water/Water_1_M_Normal.jpg"),x=t.normalMap1||p.load("textures/water/Water_2_M_Normal.jpg"),g=.15,y=g*.5,_=new fe,w=new zr;if(qr===void 0){console.error("THREE.Water: Required component Reflector not found.");return}if(Yr===void 0){console.error("THREE.Water: Required component Refractor not found.");return}let b=new qr(e,{textureWidth:r,textureHeight:s,clipBias:o,encoding:d}),S=new Yr(e,{textureWidth:r,textureHeight:s,clipBias:o,encoding:d});b.matrixAutoUpdate=!1,S.matrixAutoUpdate=!1,this.material=new Ht({uniforms:Pr.merge([_e.fog,h.uniforms]),vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,transparent:!0,fog:!0}),m!==void 0?(this.material.defines.USE_FLOWMAP="",this.material.uniforms.tFlowMap={type:"t",value:m}):this.material.uniforms.flowDirection={type:"v2",value:l},v.wrapS=v.wrapT=Nt,x.wrapS=x.wrapT=Nt,this.material.uniforms.tReflectionMap.value=b.getRenderTarget().texture,this.material.uniforms.tRefractionMap.value=S.getRenderTarget().texture,this.material.uniforms.tNormalMap0.value=v,this.material.uniforms.tNormalMap1.value=x,this.material.uniforms.color.value=i,this.material.uniforms.reflectivity.value=u,this.material.uniforms.textureMatrix.value=_,this.material.uniforms.config.value.x=0,this.material.uniforms.config.value.y=y,this.material.uniforms.config.value.z=y,this.material.uniforms.config.value.w=f;function M(E){_.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),_.multiply(E.projectionMatrix),_.multiply(E.matrixWorldInverse),_.multiply(n.matrixWorld)}function T(){let E=w.getDelta(),A=n.material.uniforms.config;A.value.x+=c*E,A.value.y=A.value.x+y,A.value.x>=g?(A.value.x=0,A.value.y=y):A.value.y>=g&&(A.value.y=A.value.y-g)}this.onBeforeRender=function(E,A,I){M(I),T(),n.visible=!1,b.matrixWorld.copy(n.matrixWorld),S.matrixWorld.copy(n.matrixWorld),b.onBeforeRender(E,A,I),S.onBeforeRender(E,A,I),n.visible=!0}}};Vs.prototype.isWater=!0;Vs.WaterShader={uniforms:{color:{type:"c",value:null},reflectivity:{type:"f",value:0},tReflectionMap:{type:"t",value:null},tRefractionMap:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},textureMatrix:{type:"m4",value:null},config:{type:"v4",value:new De}},vertexShader:`

		#include <common>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>

		uniform mat4 textureMatrix;

		varying vec4 vCoord;
		varying vec2 vUv;
		varying vec3 vToEye;

		void main() {

			vUv = uv;
			vCoord = textureMatrix * vec4( position, 1.0 );

			vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
			vToEye = cameraPosition - worldPosition.xyz;

			vec4 mvPosition =  viewMatrix * worldPosition; // used in fog_vertex
			gl_Position = projectionMatrix * mvPosition;

			#include <logdepthbuf_vertex>
			#include <fog_vertex>

		}`,fragmentShader:`

		#include <common>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>

		uniform sampler2D tReflectionMap;
		uniform sampler2D tRefractionMap;
		uniform sampler2D tNormalMap0;
		uniform sampler2D tNormalMap1;

		#ifdef USE_FLOWMAP
			uniform sampler2D tFlowMap;
		#else
			uniform vec2 flowDirection;
		#endif

		uniform vec3 color;
		uniform float reflectivity;
		uniform vec4 config;

		varying vec4 vCoord;
		varying vec2 vUv;
		varying vec3 vToEye;

		void main() {

			#include <logdepthbuf_fragment>

			float flowMapOffset0 = config.x;
			float flowMapOffset1 = config.y;
			float halfCycle = config.z;
			float scale = config.w;

			vec3 toEye = normalize( vToEye );

			// determine flow direction
			vec2 flow;
			#ifdef USE_FLOWMAP
				flow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;
			#else
				flow = flowDirection;
			#endif
			flow.x *= - 1.0;

			// sample normal maps (distort uvs with flowdata)
			vec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );
			vec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );

			// linear interpolate to get the final normal color
			float flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;
			vec4 normalColor = mix( normalColor0, normalColor1, flowLerp );

			// calculate normal vector
			vec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );

			// calculate the fresnel term to blend reflection and refraction maps
			float theta = max( dot( toEye, normal ), 0.0 );
			float reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );

			// calculate final uv coords
			vec3 coord = vCoord.xyz / vCoord.w;
			vec2 uv = coord.xy + coord.z * normal.xz * 0.05;

			vec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );
			vec4 refractColor = texture2D( tRefractionMap, uv );

			// multiply water color with the mix of both textures
			gl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>

		}`};var jy=(a,e,t={})=>{let{width:n=20,height:i=20,x:r=0,y:s=0,z:o=0,color:l="#ffffff",scale:c=4,flowX:u=1,flowY:f=1,normalMap0:h=void 0,normalMap1:d=void 0}=t,p=new tn(n,i),m=new Rn({color:30654,transparent:!0,opacity:.8}),v=new Ce(p,m);v.position.set(r,s,o),v.rotation.x=Math.PI*-.5,a.add(v);let x=new tn(n,i),g=new Vs(x,{color:l,scale:c,flowDirection:new J(u,f),textureWidth:1024,textureHeight:1024,normalMap0:h,normalMap1:d,encoding:e.outputEncoding});return g.position.set(r,s+.1,o),g.rotation.x=Math.PI*-.5,a.add(g),{ground:v,water:g}};var Nl=class{constructor(e,t,n){this.scene=e,this.renderer=t,this.factories=n}water(e={}){jy(this.scene,this.renderer,e)}textureCube(e){e.length!==6&&Ft("You need to pass 6 urls to textureCube()");let t=new Sp;return e.forEach((n,i)=>{n.wrapS=n.wrapT=Nt;let r=this.factories.add.material({phong:{map:n}});t.materials[i]=r}),t}},Sp=class{constructor(){this.materials=new Array(6)}get texture(){return{left:this.getTexture(0),right:this.getTexture(1),up:this.getTexture(2),down:this.getTexture(3),front:this.getTexture(4),back:this.getTexture(5)}}getTexture(e){return this.materials[e].map}};var Tp=class{static createButton(e,t){t&&console.error('THREE.VRButton: The "options" parameter has been removed. Please set the reference space type via renderer.xr.setReferenceSpaceType() instead.');let n=document.createElement("button");function i(){let l=null;async function c(f){f.addEventListener("end",u),await e.xr.setSession(f),n.textContent="EXIT VR",l=f}function u(){l.removeEventListener("end",u),n.textContent="ENTER VR",l=null}n.style.display="",n.style.cursor="pointer",n.style.left="calc(50% - 50px)",n.style.width="100px",n.textContent="ENTER VR",n.onmouseenter=function(){n.style.opacity="1.0"},n.onmouseleave=function(){n.style.opacity="0.5"},n.onclick=function(){if(l===null){let f={optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]};navigator.xr.requestSession("immersive-vr",f).then(c)}else l.end()}}function r(){n.style.display="",n.style.cursor="auto",n.style.left="calc(50% - 75px)",n.style.width="150px",n.onmouseenter=null,n.onmouseleave=null,n.onclick=null}function s(){r(),n.textContent="VR NOT SUPPORTED"}function o(l){l.style.position="absolute",l.style.bottom="20px",l.style.padding="12px 6px",l.style.border="1px solid #fff",l.style.borderRadius="4px",l.style.background="rgba(0,0,0,0.1)",l.style.color="#fff",l.style.font="normal 13px sans-serif",l.style.textAlign="center",l.style.opacity="0.5",l.style.outline="none",l.style.zIndex="999"}if("xr"in navigator)return n.id="VRButton",n.style.display="none",o(n),navigator.xr.isSessionSupported("immersive-vr").then(function(l){l?i():s()}),n;{let l=document.createElement("a");return window.isSecureContext===!1?(l.href=document.location.href.replace(/^http:/,"https:"),l.innerHTML="WEBXR NEEDS HTTPS"):(l.href="https://immersiveweb.dev/",l.innerHTML="WEBXR NOT AVAILABLE"),l.style.left="calc(50% - 90px)",l.style.width="180px",l.style.textDecoration="none",o(l),l}}};var yt={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function qy(a){let e=await fetch(a);if(e.ok)return e.json();throw new Error(e.statusText)}async function L2(a){if(!a)throw new Error("No basePath supplied");return await qy(`${a}/profilesList.json`)}async function Yy(a,e,t=null,n=!0){if(!a)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");let i=await L2(e),r;if(a.profiles.some(l=>{let c=i[l];return c&&(r={profileId:l,profilePath:`${e}/${c.path}`,deprecated:!!c.deprecated}),!!r}),!r){if(!t)throw new Error("No matching profile name found");let l=i[t];if(!l)throw new Error(`No matching profile name found and default profile "${t}" missing.`);r={profileId:t,profilePath:`${e}/${l.path}`,deprecated:!!l.deprecated}}let s=await qy(r.profilePath),o;if(n){let l;if(a.handedness==="any"?l=s.layouts[Object.keys(s.layouts)[0]]:l=s.layouts[a.handedness],!l)throw new Error(`No matching handedness, ${a.handedness}, in profile ${r.profileId}`);l.assetPath&&(o=r.profilePath.replace("profile.json",l.assetPath))}return{profile:s,assetPath:o}}var R2={xAxis:0,yAxis:0,button:0,state:yt.ComponentState.DEFAULT};function I2(a=0,e=0){let t=a,n=e;if(Math.sqrt(a*a+e*e)>1){let s=Math.atan2(e,a);t=Math.cos(s),n=Math.sin(s)}return{normalizedXAxis:t*.5+.5,normalizedYAxis:n*.5+.5}}var Zy=class{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===yt.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(R2)}updateFromComponent({xAxis:e,yAxis:t,button:n,state:i}){let{normalizedXAxis:r,normalizedYAxis:s}=I2(e,t);switch(this.componentProperty){case yt.ComponentProperty.X_AXIS:this.value=this.states.includes(i)?r:.5;break;case yt.ComponentProperty.Y_AXIS:this.value=this.states.includes(i)?s:.5;break;case yt.ComponentProperty.BUTTON:this.value=this.states.includes(i)?n:0;break;case yt.ComponentProperty.STATE:this.valueNodeProperty===yt.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(i):this.value=this.states.includes(i)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}},Jy=class{constructor(e,t){if(!e||!t||!t.visualResponses||!t.gamepadIndices||Object.keys(t.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(n=>{let i=new Zy(t.visualResponses[n]);this.visualResponses[n]=i}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:yt.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=yt.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){let t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||this.values.button===1?this.values.state=yt.ComponentState.PRESSED:(t.touched||this.values.button>yt.ButtonTouchThreshold)&&(this.values.state=yt.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===yt.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>yt.AxisTouchThreshold&&(this.values.state=yt.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===yt.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>yt.AxisTouchThreshold&&(this.values.state=yt.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(t=>{t.updateFromComponent(this.values)})}},Ep=class{constructor(e,t,n){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=n,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(i=>{let r=this.layoutDescription.components[i];this.components[i]=new Jy(i,r)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){let e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}};var D2="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",F2="generic-trigger",$y=class extends Re{constructor(){super();this.motionController=null,this.envMap=null}setEnvironmentMap(e){return this.envMap==e?this:(this.envMap=e,this.traverse(t=>{t.isMesh&&(t.material.envMap=this.envMap,t.material.needsUpdate=!0)}),this)}updateMatrixWorld(e){super.updateMatrixWorld(e),!!this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(t=>{Object.values(t.visualResponses).forEach(n=>{let{valueNode:i,minNode:r,maxNode:s,value:o,valueNodeProperty:l}=n;!i||(l===yt.VisualResponseProperty.VISIBILITY?i.visible=o:l===yt.VisualResponseProperty.TRANSFORM&&(i.quaternion.slerpQuaternions(r.quaternion,s.quaternion,o),i.position.lerpVectors(r.position,s.position,o)))})}))}};function B2(a,e){Object.values(a.components).forEach(t=>{let{type:n,touchPointNodeName:i,visualResponses:r}=t;if(n===yt.ComponentType.TOUCHPAD)if(t.touchPointNode=e.getObjectByName(i),t.touchPointNode){let s=new hn(.001),o=new ct({color:255}),l=new Ce(s,o);t.touchPointNode.add(l)}else console.warn(`Could not find touch dot, ${t.touchPointNodeName}, in touchpad component ${t.id}`);Object.values(r).forEach(s=>{let{valueNodeName:o,minNodeName:l,maxNodeName:c,valueNodeProperty:u}=s;if(u===yt.VisualResponseProperty.TRANSFORM){if(s.minNode=e.getObjectByName(l),s.maxNode=e.getObjectByName(c),!s.minNode){console.warn(`Could not find ${l} in the model`);return}if(!s.maxNode){console.warn(`Could not find ${c} in the model`);return}}s.valueNode=e.getObjectByName(o),s.valueNode||console.warn(`Could not find ${o} in the model`)})})}function Qy(a,e){B2(a.motionController,e),a.envMap&&e.traverse(t=>{t.isMesh&&(t.material.envMap=a.envMap,t.material.needsUpdate=!0)}),a.add(e)}var Ap=class{constructor(e=null){this.gltfLoader=e,this.path=D2,this._assetCache={},this.gltfLoader||(this.gltfLoader=new Bs)}createControllerModel(e){let t=new $y,n=null;return e.addEventListener("connected",i=>{let r=i.data;r.targetRayMode!=="tracked-pointer"||!r.gamepad||Yy(r,this.path,F2).then(({profile:s,assetPath:o})=>{t.motionController=new Ep(r,s,o);let l=this._assetCache[t.motionController.assetUrl];if(l)n=l.scene.clone(),Qy(t,n);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(t.motionController.assetUrl,c=>{this._assetCache[t.motionController.assetUrl]=c,n=c.scene.clone(),Qy(t,n)},null,()=>{throw new Error(`Asset ${t.motionController.assetUrl} missing or malformed.`)})}}).catch(s=>{console.warn(s)})}),e.addEventListener("disconnected",()=>{t.motionController=null,t.remove(n),n=null}),t}};var Ol=class{constructor(e,t,n){this._renderer=e,this._scene=t,this._camera=n,this.controllerModelFactory=new Ap,this.cameraGroup=new Jt,this.cameraGroup.add(n),t.add(this.cameraGroup),e.xr.enabled=!0;let i=Tp.createButton(e);i.style.cssText+="background: rgba(0, 0, 0, 0.8); ",document.body.appendChild(i)}get isPresenting(){var e,t;return!!((t=(e=this._renderer)===null||e===void 0?void 0:e.xr)===null||t===void 0?void 0:t.isPresenting)}getController(e){let t=this._renderer.xr.getController(e);return this.cameraGroup.add(t),t}getControllerGrip(e){let t=this._renderer.xr.getControllerGrip(e),n=this.controllerModelFactory.createControllerModel(t);return t.add(n),this.cameraGroup.add(t),t}getControllerRay(e){let{targetRayMode:t}=e;if(t==="tracked-pointer"){let n=new ye;n.setAttribute("position",new pe([0,0,0,0,0,-1],3)),n.setAttribute("color",new pe([1,0,0,1,1,1],3));let i=new rt({vertexColors:!0});return new Gt(n,i)}if(t==="gaze"){let n=new Dr(.02,.04,32).translate(0,0,-1),i=new ct({color:"red",opacity:.5,transparent:!0});return new Ce(n,i)}}get camera(){return this.WebXRCamera}get WebXRCamera(){var e;return{group:this.cameraGroup,position:(e=this.cameraGroup)===null||e===void 0?void 0:e.position,rotation:this.isPresenting?this._renderer.xr.getCamera(this._camera).rotation:void 0,getWorldDirection:t=>this.isPresenting?this._renderer.xr.getCamera(this._camera).getWorldDirection(t):void 0}}};var N2=(a=20,e)=>{if(!window.__loadPhysics){console.log("There is not much fun without physics enabled!");return}for(let t=0;t<a;t++){let n=["standard","basic","normal","phong","line","points"],i=(s,o)=>Math.floor(Math.random()*(o-s+1)+s),r=s=>s[Math.floor(Math.random()*s.length)];Math.random()>.5?e.add.box({x:i(-10,10),y:i(10,20),z:i(-10,10),width:i(1,2)/10,height:i(1,2)/10,depth:i(1,2)/10,mass:1},{[r(n)]:{color:Math.floor(Math.random()*16777215)}}).body.setRestitution(Math.floor(Math.random()*10)/20):e.add.sphere({x:i(-10,10),y:i(10,20),z:i(-10,10),radius:i(1,2)/10,mass:1},{[r(n)]:{color:Math.floor(Math.random()*16777215)}}).body.setRestitution(Math.floor(Math.random()*10)/20)}},Pp=N2;var Di=class{perspectiveCamera(e={}){return Di.Perspective(e)}orthographicCamera(e={}){return Di.Orthographic(e)}static Perspective(e={}){let{fov:t=50,aspect:n=window.innerWidth/window.innerHeight,near:i=.1,far:r=2e3,x:s=0,y:o=5,z:l=25}=e,c=new it(t,n,i,r);return c.position.set(s,o,l),c}static Orthographic(e={}){let t=window.innerWidth,n=window.innerHeight,{left:i=t/-2,right:r=t/2,top:s=n/2,bottom:o=n/-2,near:l=1,far:c=1e3,x:u=0,y:f=0,z:h=10}=e,d=new sn(i,r,s,o,l,c);return d.position.set(u,f,h),d}};var Hs=function(a,e,t,n){function i(r){return r instanceof t?r:new t(function(s){s(r)})}return new(t||(t=Promise))(function(r,s){function o(u){try{c(n.next(u))}catch(f){s(f)}}function l(u){try{c(n.throw(u))}catch(f){s(f)}}function c(u){u.done?r(u.value):i(u.value).then(o,l)}c((n=n.apply(a,e||[])).next())})},qh=class{constructor(e={}){this.sceneConfig=e,this.scenes=new Map,this.__config={},this._isRunning=!1,this._deconstructor=[];let{key:t=Math.random().toString(),enableXR:n=!1}=e;this.__config.sceneKey=t,this.__config.enableXR=n}get deconstructor(){return{add:(...e)=>{e.forEach(t=>{this._deconstructor.push(t)})}}}initializeScene(e){let{renderer:t,parent:n,canvas:i,scene:r,scenes:s,camera:o,cache:l,physics:c,sceneConfig:u}=e;this.scene=r,this.scenes=s,this.camera=o,this.cache=l,this.physics=c,this.renderer=t,this.parent=n,this.canvas=i;let{autoStart:f,textureAnisotropy:h}=u;this.load=new Il(this.cache,h),this.lights=new Dl(this.scene),this.transform=new tr(this.camera,this.renderer),this.csg=Vd,this.heightMap=new Fl(this.scene),this.factories=new Us(this.scene),this.misc=new Nl(this.scene,this.renderer,this.factories),this.ws=new Bl(r,t,o,this.lights,this.physics,this.load,this.factories),this.mixers=new Mp,this.cameras=new Di,this.clock=new zr,this.__config.enableXR&&(this.webXR=new Ol(this.renderer,this.scene,this.camera)),f&&this.start(this.__config.sceneKey)}get sceneKey(){return this.__config.sceneKey}destroy(e){var t;(t=this.physics)===null||t===void 0||t.destroy(e.body),this.scene.remove(e),e=null}warpSpeed(...e){return Hs(this,void 0,void 0,function*(){return yield this.ws.warpSpeed(...e)})}get animationMixers(){return this.mixers.mixers}get make(){return this.factories.make}get add(){return this.factories.add}haveSomeFun(e=20){Pp(e,this.physics)}isRunning(){return this._isRunning}start(e,t){var n;return Hs(this,void 0,void 0,function*(){e&&e!==this.__config.sceneKey?(this.stop(),(n=this.scenes.get(e))===null||n===void 0||n._start(t)):this._start(t)})}_start(e){var t;return Hs(this,void 0,void 0,function*(){yield(t=this.init)===null||t===void 0?void 0:t.call(this,e),yield this._preload(),yield this._create(),this.renderer.setAnimationLoop(()=>{this._update()}),this._isRunning=!0})}restart(e){return Hs(this,void 0,void 0,function*(){yield this.stop(),yield this.start(this.__config.sceneKey,e)})}stop(){var e,t,n;return Hs(this,void 0,void 0,function*(){this._isRunning=!1,this.renderer.setAnimationLoop(null),this.clock.start();for(let i of this._deconstructor)yield(e=i.dispose)===null||e===void 0?void 0:e.call(i),yield(t=i.destroy)===null||t===void 0?void 0:t.call(i),typeof i=="function"&&(yield i==null?void 0:i()),i=null;if(this._deconstructor=[],(n=this.physics)===null||n===void 0?void 0:n.rigidBodies)for(let i=this.physics.rigidBodies.length-1;i>=0;i--)this.physics.destroy(this.physics.rigidBodies[i]);for(let i=this.scene.children.length-1;i>=0;i--)this.scene.remove(this.scene.children[i])})}setSize(e,t){this.renderer.setSize(e,t),typeof this.camera.aspect!="undefined"&&(this.camera.aspect=e/t),this.camera.updateProjectionMatrix()}setPixelRatio(e){this.renderer.setPixelRatio(e)}init(e={}){}preload(){}create(){}update(e,t){}preRender(){}postRender(){}_preload(){var e;return Hs(this,void 0,void 0,function*(){yield(e=this.preload)===null||e===void 0?void 0:e.call(this)})}_create(){var e;return Hs(this,void 0,void 0,function*(){yield(e=this.create)===null||e===void 0?void 0:e.call(this)})}_update(){var e,t,n;let i=this.clock.getDelta()*1e3,r=this.clock.getElapsedTime();(e=this.update)===null||e===void 0||e.call(this,parseFloat(r.toFixed(3)),parseInt(i.toString())),(t=this.physics)===null||t===void 0||t.update(i),(n=this.physics)===null||n===void 0||n.updateDebugger(),this.animationMixers.update(i),this.preRender(),this.composer?this.composer.render():this.renderer.render(this.scene,this.camera),this.postRender()}};"use strict";"use strict";var Cp=mr(Gs());var n1=class{constructor(e,t){this.physics=e,this.ammo=t,this.ignoreScale=!1,this.isSoftBody=!1,this.offset={x:0,y:0,z:0},this.errors=[],this.checkCollisions=!1,this.breakable=!1,this.fractureImpulse=1,this.didUpdate=!1,this.skipUpdate=!1,this._emitUpdateEvents=!1,this._needUpdate=!1,this.tmpEuler=new Ut,this.tmpQuaternion=new Ve,this.tmpBtVector3=new Ammo.btVector3,this.tmpBtVector3_1=new Ammo.btVector3,this.tmpBtQuaternion=new Ammo.btQuaternion(0,0,0,1),this.eventEmitter=new Cp.Events,this.name=t.name}destructor(){this.eventEmitter&&this.eventEmitter.removeAllListeners(),Ammo.destroy(this.tmpBtVector3),Ammo.destroy(this.tmpBtVector3_1),Ammo.destroy(this.tmpBtQuaternion),Ammo.destroy(this.ammo.getCollisionShape()),Ammo.destroy(this.ammo)}setupEventEmitter(){typeof this.eventEmitter=="undefined"&&(this.eventEmitter=new Cp.Events)}get needUpdate(){return this._needUpdate}set needUpdate(e){!e&&this._needUpdate&&(this.didUpdate=!0),this._needUpdate=e}onUpdateEvent(e,t=!1){this.setupEventEmitter(),this._emitUpdateEvents=!0,t?this.eventEmitter.once("update",()=>{e()}):this.eventEmitter.on("update",()=>{e()})}get on(){return{update:e=>this.onUpdateEvent(e),collision:e=>this.onCollision(e)}}get once(){return{update:e=>this.onUpdateEvent(e,!0)}}onCollision(e){this.checkCollisions=!0,this.physics.collisionEvents.on("collision",t=>{let{bodies:n,event:i}=t;n[0].name===this.name?e(n[1],i):n[1].name===this.name&&e(n[0],i)})}transform(){let e=this.physics.worldTransform;this.ammo.getMotionState().getWorldTransform(e)}refresh(){let e=this.physics.worldTransform;this.ammo.getMotionState().setWorldTransform(e)}setRotation(e,t,n){let i=this.tmpEuler.set(e,t,n),r=this.tmpQuaternion.set(0,0,0,1);r.setFromEuler(i),this.tmpBtQuaternion.setValue(0,0,0,1);let s=this.tmpBtQuaternion;s.setValue(r.x,r.y,r.z,r.w),this.physics.worldTransform.setRotation(s)}get rotation(){let e,t,n,r=this.physics.worldTransform.getRotation(),s=this.tmpQuaternion.set(r.x(),r.y(),r.z(),r.w());s.w>1&&(s=s.normalize());let o=2*Math.acos(s.w),l=Math.sqrt(1-s.w*s.w);return l<.001?(e=s.x,t=s.y,n=s.z):(e=s.x/l,t=s.y/l,n=s.z/l),{x:e*o,y:t*o,z:n*o}}get quaternion(){let t=this.physics.worldTransform.getRotation();return{x:t.x(),y:t.y(),z:t.z(),w:t.w()}}setPosition(e,t,n){this.physics.worldTransform.getOrigin().setValue(e,t,n)}get position(){let e=this.physics.worldTransform;return{x:e.getOrigin().x(),y:e.getOrigin().y(),z:e.getOrigin().z()}}get velocity(){return{x:this.ammo.getLinearVelocity().x(),y:this.ammo.getLinearVelocity().y(),z:this.ammo.getLinearVelocity().z()}}get angularVelocity(){return{x:this.ammo.getAngularVelocity().x(),y:this.ammo.getAngularVelocity().y(),z:this.ammo.getAngularVelocity().z()}}setVelocity(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.setLinearVelocity(this.tmpBtVector3)}setVelocityX(e){this.tmpBtVector3.setValue(e,this.velocity.y,this.velocity.z),this.ammo.setLinearVelocity(this.tmpBtVector3)}setVelocityY(e){this.tmpBtVector3.setValue(this.velocity.x,e,this.velocity.z),this.ammo.setLinearVelocity(this.tmpBtVector3)}setVelocityZ(e){this.tmpBtVector3.setValue(this.velocity.x,this.velocity.y,e),this.ammo.setLinearVelocity(this.tmpBtVector3)}setAngularVelocity(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.setAngularVelocity(this.tmpBtVector3)}setAngularVelocityX(e){this.tmpBtVector3.setValue(e,this.angularVelocity.y,this.angularVelocity.z),this.ammo.setAngularVelocity(this.tmpBtVector3)}setAngularVelocityY(e){this.tmpBtVector3.setValue(this.angularVelocity.x,e,this.angularVelocity.z),this.ammo.setAngularVelocity(this.tmpBtVector3)}setAngularVelocityZ(e){this.tmpBtVector3.setValue(this.angularVelocity.x,this.angularVelocity.y,e),this.ammo.setAngularVelocity(this.tmpBtVector3)}applyForce(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyForceX(e){this.tmpBtVector3.setValue(e,0,0),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyForceY(e){this.tmpBtVector3.setValue(0,e,0),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyForceZ(e){this.tmpBtVector3.setValue(0,0,e),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyCentralForce(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.applyCentralForce(this.tmpBtVector3)}applyCentralImpulse(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.applyCentralImpulse(this.tmpBtVector3)}applyCentralLocalForce(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.applyCentralLocalForce(this.tmpBtVector3)}applyImpulse(e,t){this.tmpBtVector3.setValue(e.x||0,e.y||0,e.z||0),this.tmpBtVector3_1.setValue(t.x||0,t.y||0,t.z||0),this.ammo.applyImpulse(this.tmpBtVector3,this.tmpBtVector3_1)}applyLocalTorque(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.applyLocalTorque(this.tmpBtVector3)}applyTorque(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.applyTorque(this.tmpBtVector3)}applyTorqueImpulse(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.applyTorqueImpulse(this.tmpBtVector3)}setCollisionFlags(e){this.ammo.setCollisionFlags(e)}getCollisionFlags(){return this.ammo.getCollisionFlags()}setRestitution(e){this.ammo.setRestitution(e)}setBounciness(e){this.setRestitution(e)}setFriction(e){this.ammo.setFriction(e)}setDamping(e,t){this.ammo.setDamping(e,t)}setGravity(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.setGravity(this.tmpBtVector3)}setLinearFactor(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.setLinearFactor(this.tmpBtVector3)}setAngularFactor(e,t,n){this.tmpBtVector3.setValue(e,t,n),this.ammo.setAngularFactor(this.tmpBtVector3)}setCcdMotionThreshold(e){this.ammo.setCcdMotionThreshold(e)}setCcdSweptSphereRadius(e){this.ammo.setCcdSweptSphereRadius(e)}},i1=n1;var r1=class{constructor(e,t){this.factory=e,this.addExisting=t}addPlane(e={},t={}){let n=this.factory.add.plane(e,t);return this.addExisting(n,e),n}addSphere(e={},t={}){let n=this.factory.add.sphere(e,t);return this.addExisting(n,e),n}addBox(e={},t={}){let n=this.factory.add.box(e,t);return this.addExisting(n,e),n}addGround(e,t={}){let n=this.factory.add.ground(e,t),i=Object.assign(Object.assign({},e),{mass:0,collisionFlags:1});return this.addExisting(n,i),n}addCylinder(e={},t={}){let n=this.factory.add.cylinder(e,t);return this.addExisting(n,e),n}addCone(e={},t={}){let n=this.factory.add.cone(e,t);return this.addExisting(n,e),n}addTorus(e={},t={}){let n=this.factory.add.torus(e,t);return this.addExisting(n,e),n}addExtrude(e,t={}){let n=this.factory.add.extrude(e,t);return n.translateX(1),this.addExisting(n),n}},s1=r1;var Jh=class{constructor(e,t){this.worldTransform=e,this.physicsWorld=t,this.tmpBtVector3=new Ammo.btVector3}toAmmoV3(e,t=0){return new Ammo.btVector3(typeof(e==null?void 0:e.x)!="undefined"?e.x:t,typeof(e==null?void 0:e.y)!="undefined"?e.y:t,typeof(e==null?void 0:e.z)!="undefined"?e.z:t)}get addConstraints(){return{lock:(e,t,n)=>this.lock(e,t,n),fixed:(e,t,n)=>this.fixed(e,t,n),pointToPoint:(e,t,n,i)=>this.pointToPoint(e,t,n,i),hinge:(e,t,n,i)=>this.hinge(e,t,n,i),slider:(e,t,n={},i)=>this.slider(e,t,n,i),spring:(e,t,n={},i)=>this.spring(e,t,n,i),coneTwist:(e,t,n={frameA:{},frameB:{}},i)=>this.coneTwist(e,t,n,i),dof:(e,t,n,i)=>this.dof(e,t,n,i)}}getTransform(e,t,n={x:0,y:0,z:0},i=!1){n=Object.assign({x:0,y:0,z:0},n);let r=(o,l)=>{var c=(o.x()-l.x())/2+n.x,u=(o.y()-l.y())/2+n.y,f=(o.z()-l.z())/2+n.z;return new Ammo.btVector3(c,u,f)},s=new Ammo.btTransform;if(s.setIdentity(),i){let o=r(e.getWorldTransform().getOrigin(),t.getWorldTransform().getOrigin()),l=new Ammo.btTransform;l.setIdentity(),l.setOrigin(o);let c=e.getCenterOfMassTransform().inverse().op_mul(t.getWorldTransform());return c.op_mul(l),{transformA:c,transformB:l}}else return s.setOrigin(new Ammo.btVector3(n.x,n.y,n.z)),{transformA:e.getCenterOfMassTransform().inverse().op_mul(t.getWorldTransform()).op_mul(s),transformB:s}}lock(e,t,n=!0){let i={x:0,y:0,z:0};return this.dof(e,t,{angularLowerLimit:i,angularUpperLimit:i},n)}fixed(e,t,n=!0){let i=this.getTransform(e.ammo,t.ammo);i.transformA.setRotation(e.ammo.getWorldTransform().getRotation()),i.transformB.setRotation(t.ammo.getWorldTransform().getRotation());let r=new Ammo.btFixedConstraint(e.ammo,t.ammo,i.transformA,i.transformB);return this.physicsWorld.addConstraint(r,n),r}pointToPoint(e,t,n={},i=!0){let{pivotA:r,pivotB:s}=n,o=new Ammo.btVector3((r==null?void 0:r.x)||0,(r==null?void 0:r.y)||0,(r==null?void 0:r.z)||0),l=new Ammo.btVector3((s==null?void 0:s.x)||0,(s==null?void 0:s.y)||0,(s==null?void 0:s.z)||0),c=new Ammo.btPoint2PointConstraint(e.ammo,t.ammo,o,l);return this.physicsWorld.addConstraint(c,i),c}hinge(e,t,n={},i=!0){let{pivotA:r,pivotB:s,axisA:o,axisB:l}=n,c=new Ammo.btVector3((r==null?void 0:r.x)||0,(r==null?void 0:r.y)||0,(r==null?void 0:r.z)||0),u=new Ammo.btVector3((s==null?void 0:s.x)||0,(s==null?void 0:s.y)||0,(s==null?void 0:s.z)||0),f=new Ammo.btVector3((o==null?void 0:o.x)||0,(o==null?void 0:o.y)||0,(o==null?void 0:o.z)||0),h=new Ammo.btVector3((l==null?void 0:l.x)||0,(l==null?void 0:l.y)||0,(l==null?void 0:l.z)||0),d=new Ammo.btHingeConstraint(e.ammo,t.ammo,c,u,f,h,!0);return this.physicsWorld.addConstraint(d,i),d}slider(e,t,n={},i=!0){let r=this.getTransform(e.ammo,t.ammo),{frameA:s={},frameB:o={},linearLowerLimit:l=0,linearUpperLimit:c=0,angularLowerLimit:u=0,angularUpperLimit:f=0}=n,h=r.transformA.getRotation();h.setEulerZYX(s.x||0,s.y||0,s.z||0),r.transformA.setRotation(h);let d=r.transformB.getRotation();d.setEulerZYX(o.x||0,o.y||0,o.z||0),r.transformB.setRotation(d);let p=new Ammo.btSliderConstraint(e.ammo,t.ammo,r.transformA,r.transformB,!0);return p.setLowerLinLimit(l),p.setUpperLinLimit(c),p.setLowerAngLimit(u),p.setUpperAngLimit(f),this.physicsWorld.addConstraint(p,i),p}spring(e,t,n={},i=!0){let{stiffness:r=50,damping:s=.01,angularLock:o=!1,linearLowerLimit:l={},linearUpperLimit:c={},angularLowerLimit:u={},angularUpperLimit:f={},offset:h={},center:d=!1,enableSpring:p=!0}=n,m=Object.assign({x:0,y:0,z:0},h),v=this.getTransform(e.ammo,t.ammo,m,d),x=new Ammo.btGeneric6DofSpringConstraint(e.ammo,t.ammo,v.transformA,v.transformB,!0);this.tmpBtVector3.setValue(l.x||0,l.y||0,l.z||0),x.setLinearLowerLimit(this.tmpBtVector3),this.tmpBtVector3.setValue(c.x||0,c.y||0,c.z||0),x.setLinearUpperLimit(this.tmpBtVector3),o?(this.tmpBtVector3.setValue(0,0,0),x.setAngularLowerLimit(this.tmpBtVector3),x.setAngularUpperLimit(this.tmpBtVector3)):(console.log(u,f),x.setAngularLowerLimit(this.toAmmoV3(u,-Math.PI)),x.setAngularUpperLimit(this.toAmmoV3(f,Math.PI)));for(let g=0;g<3;g++)x.enableSpring(g,p),x.setStiffness(g,r),x.setDamping(g,s);return this.physicsWorld.addConstraint(x,i),x}coneTwist(e,t,n,i=!0){let{frameA:r,frameB:s}=n,o=new Ammo.btTransform;o.setIdentity(),o.getOrigin().setValue((r==null?void 0:r.x)||0,(r==null?void 0:r.y)||0,(r==null?void 0:r.z)||0);let l=new Ammo.btTransform;l.setIdentity(),l.getOrigin().setValue((s==null?void 0:s.x)||0,(s==null?void 0:s.y)||0,(s==null?void 0:s.z)||0);let c=this.getTransform(e.ammo,t.ammo),u=new Ammo.btConeTwistConstraint(t.ammo,e.ammo,o,l);return u.setAngularOnly(!0),this.physicsWorld.addConstraint(u,i),u}dof(e,t,n={},i=!0){let{offset:r,center:s=!1}=n,o=Object.assign({x:0,y:0,z:0},r),l=this.getTransform(e.ammo,t.ammo,o,s),c=new Ammo.btGeneric6DofConstraint(e.ammo,t.ammo,l.transformA,l.transformB,!0),{linearLowerLimit:u,linearUpperLimit:f,angularLowerLimit:h,angularUpperLimit:d}=n,p=this.toAmmoV3(u),m=this.toAmmoV3(f),v=this.toAmmoV3(h,-Math.PI),x=this.toAmmoV3(d,Math.PI);return c.setLinearLowerLimit(p),c.setLinearUpperLimit(m),c.setAngularLowerLimit(v),c.setAngularUpperLimit(x),Ammo.destroy(p),Ammo.destroy(m),Ammo.destroy(v),Ammo.destroy(x),this.physicsWorld.addConstraint(c,i),c}};var b1=mr(Gs());var pa={BOX:"box",CYLINDER:"cylinder",SPHERE:"sphere",CAPSULE:"capsule",CONE:"cone",HULL:"hull",HACD:"hacd",VHACD:"vhacd",MESH:"mesh",HEIGHTFIELD:"heightfield"},ma={ALL:"all",MANUAL:"manual"};var o1=function(){let a=new L,e=new L,t=new fe;return function(n,i,r,s={}){if(s.type=pa.HULL,Qh(s),s.fit===ma.MANUAL)return console.warn("cannot use fit: manual with type: hull"),null;let o=Lp(n,i),l=new Ammo.btVector3,c=new Ammo.btConvexHullShape;c.setMargin(s.margin),e.addVectors(o.max,o.min).multiplyScalar(.5);let u=0;for(let p=0;p<n.length;p++)u+=n[p].length/3;let f=s.hullMaxVertices||1e5;u>f&&console.warn(`too many vertices for hull shape; sampling ~${f} from ~${u} vertices`);let h=Math.min(1,f/u);for(let p=0;p<n.length;p++){let m=n[p];t.fromArray(i[p]);for(let v=0;v<m.length;v+=3){let x=p===n.length-1&&v===m.length-3;(Math.random()<=h||x)&&(a.set(m[v],m[v+1],m[v+2]).applyMatrix4(t).sub(e),l.setValue(a.x,a.y,a.z),c.addPoint(l,x))}}let d=c;if(c.getNumVertices()>=100){let p=new Ammo.btShapeHull(c);p.buildHull(s.margin),Ammo.destroy(c),d=new Ammo.btConvexHullShape(Ammo.getPointer(p.getVertexPointer()),p.numVertices()),Ammo.destroy(p)}return Ammo.destroy(l),Kh(d,s,eu(r,s)),d}}(),a1=function(){let a=new L,e=new L,t=new fe;return function(n,i,r,s,o={}){if(o.type=pa.HACD,Qh(o),o.fit===ma.MANUAL)return console.warn("cannot use fit: manual with type: hacd"),[];if(!Ammo.hasOwnProperty("HACD"))return console.warn("HACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version."),[];let l=Lp(n,i),c=eu(s,o),u=0,f=0;e.addVectors(l.max,l.min).multiplyScalar(.5);for(let y=0;y<n.length;y++)u+=n[y].length/3,r&&r[y]?f+=r[y].length/3:f+=n[y].length/9;let h=new Ammo.HACD;o.hasOwnProperty("compacityWeight")&&h.SetCompacityWeight(o.compacityWeight),o.hasOwnProperty("volumeWeight")&&h.SetVolumeWeight(o.volumeWeight),o.hasOwnProperty("nClusters")&&h.SetNClusters(o.nClusters),o.hasOwnProperty("nVerticesPerCH")&&h.SetNVerticesPerCH(o.nVerticesPerCH),o.hasOwnProperty("concavity")&&h.SetConcavity(o.concavity);let d=Ammo._malloc(u*3*8),p=Ammo._malloc(f*3*4);h.SetPoints(d),h.SetTriangles(p),h.SetNPoints(u),h.SetNTriangles(f);let m=d/8,v=p/4;for(let y=0;y<n.length;y++){let _=n[y];t.fromArray(i[y]);for(let w=0;w<_.length;w+=3)a.set(_[w+0],_[w+1],_[w+2]).applyMatrix4(t).sub(e),Ammo.HEAPF64[m+0]=a.x,Ammo.HEAPF64[m+1]=a.y,Ammo.HEAPF64[m+2]=a.z,m+=3;if(r[y]){let w=r[y];for(let b=0;b<w.length;b++)Ammo.HEAP32[v]=w[b],v++}else for(let w=0;w<_.length/3;w++)Ammo.HEAP32[v]=w,v++}h.Compute(),Ammo._free(d),Ammo._free(p);let x=h.GetNClusters(),g=[];for(let y=0;y<x;y++){let _=new Ammo.btConvexHullShape;_.setMargin(o.margin);let w=h.GetNPointsCH(y),b=h.GetNTrianglesCH(y),S=Ammo._malloc(w*3*8),M=Ammo._malloc(b*3*4);h.GetCH(y,S,M);let T=S/8;for(let E=0;E<w;E++){let A=new Ammo.btVector3,I=Ammo.HEAPF64[T+E*3+0],C=Ammo.HEAPF64[T+E*3+1],R=Ammo.HEAPF64[T+E*3+2];A.setValue(I,C,R),_.addPoint(A,E===w-1),Ammo.destroy(A)}Kh(_,o,c),g.push(_)}return g}}(),l1=function(){let a=new L,e=new L,t=new fe;return function(n,i,r,s,o={}){if(o.type=pa.VHACD,Qh(o),o.fit===ma.MANUAL)return console.warn("cannot use fit: manual with type: vhacd"),[];if(!Ammo.hasOwnProperty("VHACD"))return console.warn("VHACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version."),[];let l=Lp(n,i),c=eu(s,o),u=0,f=0;e.addVectors(l.max,l.min).multiplyScalar(.5);for(let w=0;w<n.length;w++)u+=n[w].length/3,r&&r[w]?f+=r[w].length/3:f+=n[w].length/9;let h=new Ammo.VHACD,d=new Ammo.Parameters;o.hasOwnProperty("resolution")&&d.set_m_resolution(o.resolution),o.hasOwnProperty("depth")&&d.set_m_depth(o.depth),o.hasOwnProperty("concavity")&&d.set_m_concavity(o.concavity),o.hasOwnProperty("planeDownsampling")&&d.set_m_planeDownsampling(o.planeDownsampling),o.hasOwnProperty("convexhullDownsampling")&&d.set_m_convexhullDownsampling(o.convexhullDownsampling),o.hasOwnProperty("alpha")&&d.set_m_alpha(o.alpha),o.hasOwnProperty("beta")&&d.set_m_beta(o.beta),o.hasOwnProperty("gamma")&&d.set_m_gamma(o.gamma),o.hasOwnProperty("pca")&&d.set_m_pca(o.pca),o.hasOwnProperty("mode")&&d.set_m_mode(o.mode),o.hasOwnProperty("maxNumVerticesPerCH")&&d.set_m_maxNumVerticesPerCH(o.maxNumVerticesPerCH),o.hasOwnProperty("minVolumePerCH")&&d.set_m_minVolumePerCH(o.minVolumePerCH),o.hasOwnProperty("convexhullApproximation")&&d.set_m_convexhullApproximation(o.convexhullApproximation),o.hasOwnProperty("oclAcceleration")&&d.set_m_oclAcceleration(o.oclAcceleration);let p=Ammo._malloc(u*3*8+3),m=Ammo._malloc(f*3*4),v=p/8,x=m/4;for(let w=0;w<n.length;w++){let b=n[w];t.fromArray(i[w]);for(let S=0;S<b.length;S+=3)a.set(b[S+0],b[S+1],b[S+2]).applyMatrix4(t).sub(e),Ammo.HEAPF64[v+0]=a.x,Ammo.HEAPF64[v+1]=a.y,Ammo.HEAPF64[v+2]=a.z,v+=3;if(r[w]){let S=r[w];for(let M=0;M<S.length;M++)Ammo.HEAP32[x]=S[M],x++}else for(let S=0;S<b.length/3;S++)Ammo.HEAP32[x]=S,x++}h.Compute(p,3,u,m,3,f,d),Ammo._free(p),Ammo._free(m);let g=h.GetNConvexHulls(),y=[],_=new Ammo.ConvexHull;for(let w=0;w<g;w++){h.GetConvexHull(w,_);let b=_.get_m_nPoints(),S=_.get_m_points(),M=new Ammo.btConvexHullShape;M.setMargin(o.margin);for(let T=0;T<b;T++){let E=new Ammo.btVector3,A=_.get_m_points(T*3+0),I=_.get_m_points(T*3+1),C=_.get_m_points(T*3+2);E.setValue(A,I,C),M.addPoint(E,T===b-1),Ammo.destroy(E)}Kh(M,o,c),y.push(M)}return Ammo.destroy(_),Ammo.destroy(h),y}}(),$h=function(){let a=new L,e=new L,t=new L,n=new fe;return function(i,r,s,o,l={}){if(l.type=pa.MESH,Qh(l),l.fit===ma.MANUAL)return console.warn("cannot use fit: manual with type: mesh"),null;let c=eu(o,l),u=new Ammo.btVector3,f=new Ammo.btVector3,h=new Ammo.btVector3,d=new Ammo.btTriangleMesh(!0,!1);for(let v=0;v<i.length;v++){let x=i[v],g=s[v]?s[v]:null;if(n.fromArray(r[v]),g)for(let y=0;y<g.length;y+=3){let _=g[y]*3,w=g[y+1]*3,b=g[y+2]*3;a.set(x[_],x[_+1],x[_+2]).applyMatrix4(n),e.set(x[w],x[w+1],x[w+2]).applyMatrix4(n),t.set(x[b],x[b+1],x[b+2]).applyMatrix4(n),u.setValue(a.x,a.y,a.z),f.setValue(e.x,e.y,e.z),h.setValue(t.x,t.y,t.z),d.addTriangle(u,f,h,!1)}else for(let y=0;y<x.length;y+=9)a.set(x[y+0],x[y+1],x[y+2]).applyMatrix4(n),e.set(x[y+3],x[y+4],x[y+5]).applyMatrix4(n),t.set(x[y+6],x[y+7],x[y+8]).applyMatrix4(n),u.setValue(a.x,a.y,a.z),f.setValue(e.x,e.y,e.z),h.setValue(t.x,t.y,t.z),d.addTriangle(u,f,h,!1)}let p=new Ammo.btVector3(c.x,c.y,c.z);d.setScaling(p),Ammo.destroy(p);let m;return l.concave?m=new Ammo.btBvhTriangleMeshShape(d,!0,!0):m=new Ammo.btConvexTriangleMeshShape(d,!0),m.resources=[d],Ammo.destroy(u),Ammo.destroy(f),Ammo.destroy(h),Kh(m,l),m}}();function Qh(a){a.type=a.type||pa.HULL,a.margin=a.hasOwnProperty("margin")?a.margin:.01}var Kh=function(a,e,t){},c1=function(){let a=new fe;return function(e,t,n){parseInt(ki)>=123?a.copy(e.matrixWorld).invert():a.getInverse(e.matrixWorld),new L().setFromMatrixScale(e.matrixWorld),e.traverse(r=>{let s=new fe;r.isMesh&&(t.includeInvisible||r.el&&r.el.object3D.visible||r.visible)&&(r===e?s.identity():(r.updateWorldMatrix(!0),s.multiplyMatrices(a,r.matrixWorld)),n(r.geometry.isBufferGeometry?r.geometry.attributes.position.array:r.geometry.vertices,s.elements,r.geometry.index?r.geometry.index.array:null))})}}(),eu=function(){let a=new fe;return function(e,t={}){let n=new L(1,1,1);return t.fit===ma.ALL&&(a.fromArray(e),n.setFromMatrixScale(a)),n}}(),sR=function(){let a=new L;return function(e,t,n){let i=0,{x:r,y:s,z:o}=n.getCenter(a);return h1(e,t,l=>{let c=r-l.x,u=s-l.y,f=o-l.z;i=Math.max(i,c*c+u*u+f*f)}),Math.sqrt(i)}}();var Lp=function(a,e){let t=new Dt,n=1/0,i=1/0,r=1/0,s=-1/0,o=-1/0,l=-1/0;return t.min.set(0,0,0),t.max.set(0,0,0),h1(a,e,c=>{c.x<n&&(n=c.x),c.y<i&&(i=c.y),c.z<r&&(r=c.z),c.x>s&&(s=c.x),c.y>o&&(o=c.y),c.z>l&&(l=c.z)}),t.min.set(n,i,r),t.max.set(s,o,l),t},h1=function(){let a=new L,e=new fe;return function(t,n,i){for(let r=0;r<t.length;r++){e.fromArray(n[r]);for(let s=0;s<t[r].length;s+=3)a.set(t[r][s],t[r][s+1],t[r][s+2]).applyMatrix4(e),i(a)}}}();var u1=(a,e)=>{let{radius:t=1,tube:n=.4,tubularSegments:i=8}=a,r=Math.PI,s=i,o=Math.sqrt(2*n*n-2*n*n*Math.cos(2*r/s)),l=new Ammo.btVector3(n,r/s+.5*o,n),c=new Ammo.btCylinderShape(l);c.setMargin(.05);let u=new Ammo.btCompoundShape,f=new Ammo.btVector3(0,0,1),h=new Ammo.btVector3(0,t,0),d=new Ammo.btQuaternion(e.x,e.y,e.z,e.w);for(let p=0;p<s;p++){let m=p*2*r/s,v=h.rotate(f,m),x=new Ammo.btTransform;d.setRotation(f,m+Math.PI/2),x.setIdentity(),x.setOrigin(v),x.setRotation(d),u.addChildShape(x,c)}return u};var f1=mr(Gs());var Rp=class extends f1.Events{addCollider(e,t,n){!e.body||!t.body||(e.body.checkCollisions=!0,t.body.checkCollisions=!0,this.on("collision",i=>{var r,s;let{bodies:o,event:l}=i;((r=o[0])===null||r===void 0?void 0:r.name)&&((s=o[1])===null||s===void 0?void 0:s.name)&&(e==null?void 0:e.name)&&(t==null?void 0:t.name)&&(o[0].name===e.name&&o[1].name===t.name||o[1].name===e.name&&o[0].name===t.name)&&n(l)}))}};var d1={NoDebug:0,DrawWireframe:1,DrawAabb:2,DrawFeaturesText:4,DrawContactPoints:8,NoDeactivation:16,NoHelpText:32,DrawText:64,ProfileTimings:128,EnableSatComparison:256,DisableBulletLCP:512,EnableCCD:1024,DrawConstraints:1<<11,DrawConstraintLimits:1<<12,FastWireframe:1<<13,DrawNormals:1<<14,DrawOnTop:1<<15,MAX_DEBUG_DRAW_MODE:4294967295},p1=class{constructor(e,t,n={}){this.scene=e,this.world=t,this.options=n,this.debugDrawMode=n.debugDrawMode||d1.DrawWireframe;let i=this.debugDrawMode&d1.DrawOnTop||!1,r=n.maxBufferSize||1e6;this.geometry=new ye;let s=new Float32Array(r*3),o=new Float32Array(r*3);this.geometry.setAttribute("position",new Se(s,3).setUsage(Gi)),this.geometry.setAttribute("color",new Se(o,3).setUsage(Gi)),this.index=0;let l=new rt({vertexColors:!0,depthTest:!i});this.mesh=new Ot(this.geometry,l),i&&(this.mesh.renderOrder=999),this.mesh.frustumCulled=!1,this.enabled=!1,this.debugDrawer=new Ammo.DebugDrawer,this.debugDrawer.drawLine=this.drawLine.bind(this),this.debugDrawer.drawContactPoint=this.drawContactPoint.bind(this),this.debugDrawer.reportErrorWarning=this.reportErrorWarning.bind(this),this.debugDrawer.draw3dText=this.draw3dText.bind(this),this.debugDrawer.setDebugMode=this.setDebugMode.bind(this),this.debugDrawer.getDebugMode=this.getDebugMode.bind(this),this.world.setDebugDrawer(this.debugDrawer)}enable(){this.enabled=!0,this.scene.add(this.mesh)}disable(){this.enabled=!1,this.scene.remove(this.mesh)}update(){!this.enabled||(this.index!=0&&(this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0),this.index=0,this.world.debugDrawWorld(),this.geometry.setDrawRange(0,this.index))}drawLine(e,t,n){let i=Ammo.HEAPF32,r=i[(n+0)/4],s=i[(n+4)/4],o=i[(n+8)/4],l=i[(e+0)/4],c=i[(e+4)/4],u=i[(e+8)/4];this.geometry.attributes.position.setXYZ(this.index,l,c,u),this.geometry.attributes.color.setXYZ(this.index++,r,s,o);let f=i[(t+0)/4],h=i[(t+4)/4],d=i[(t+8)/4];this.geometry.attributes.position.setXYZ(this.index,f,h,d),this.geometry.attributes.color.setXYZ(this.index++,r,s,o)}drawContactPoint(e,t,n,i,r){let s=Ammo.HEAPF32,o=s[(r+0)/4],l=s[(r+4)/4],c=s[(r+8)/4],u=s[(e+0)/4],f=s[(e+4)/4],h=s[(e+8)/4];this.geometry.attributes.position.setXYZ(this.index,u,f,h),this.geometry.attributes.color.setXYZ(this.index++,o,l,c);let d=s[(t+0)/4]*n,p=s[(t+4)/4]*n,m=s[(t+8)/4]*n;this.geometry.attributes.position.setXYZ(this.index,u+d,f+p,h+m),this.geometry.attributes.color.setXYZ(this.index++,o,l,c)}reportErrorWarning(e){Ammo.hasOwnProperty("Pointer_stringify")?console.warn(Ammo.Pointer_stringify(e)):this.warnedOnce||(this.warnedOnce=!0,console.warn("Cannot print warningString, please rebuild Ammo.js using 'debug' flag"))}draw3dText(e,t){console.warn("TODO: draw3dText")}setDebugMode(e){this.debugDrawMode=e}getDebugMode(){return this.debugDrawMode}},m1=p1;var tu=0,U2=1,V2=new L,g1=new Ls,Ip=new Tt,x1=new L,nu=new pt,iu=class{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new Dp,this.unassigned=new Dp,this.vertices=[]}setFromPoints(e){Array.isArray(e)!==!0&&console.error("THREE.ConvexHull: Points parameter is not an array."),e.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.vertices.push(new v1(e[t]));return this.compute(),this}setFromObject(e){let t=[];return e.updateMatrixWorld(!0),e.traverse(function(n){let i=n.geometry;if(i!==void 0){if(i.isGeometry){console.error("THREE.ConvexHull no longer supports Geometry. Use THREE.BufferGeometry instead.");return}else if(i.isBufferGeometry){let r=i.attributes.position;if(r!==void 0)for(let s=0,o=r.count;s<o;s++){let l=new L;l.fromBufferAttribute(r,s).applyMatrix4(n.matrixWorld),t.push(l)}}}}),this.setFromPoints(t)}containsPoint(e){let t=this.faces;for(let n=0,i=t.length;n<i;n++)if(t[n].distanceToPoint(e)>this.tolerance)return!1;return!0}intersectRay(e,t){let n=this.faces,i=-1/0,r=1/0;for(let s=0,o=n.length;s<o;s++){let l=n[s],c=l.distanceToPoint(e.origin),u=l.normal.dot(e.direction);if(c>0&&u>=0)return null;let f=u!==0?-c/u:0;if(!(f<=0)&&(u>0?r=Math.min(f,r):i=Math.max(f,i),i>r))return null}return i!==-1/0?e.at(i,t):e.at(r,t),t}intersectsRay(e){return this.intersectRay(e,V2)!==null}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(e,t){return e.face=t,t.outside===null?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this}removeVertexFromFace(e,t){return e===t.outside&&(e.next!==null&&e.next.face===t?t.outside=e.next:t.outside=null),this.assigned.remove(e),this}removeAllVerticesFromFace(e){if(e.outside!==null){let t=e.outside,n=e.outside;for(;n.next!==null&&n.next.face===e;)n=n.next;return this.assigned.removeSubList(t,n),t.prev=n.next=null,e.outside=null,t}}deleteFaceVertices(e,t){let n=this.removeAllVerticesFromFace(e);if(n!==void 0)if(t===void 0)this.unassigned.appendChain(n);else{let i=n;do{let r=i.next;t.distanceToPoint(i.point)>this.tolerance?this.addVertexToFace(i,t):this.unassigned.append(i),i=r}while(i!==null)}return this}resolveUnassignedPoints(e){if(this.unassigned.isEmpty()===!1){let t=this.unassigned.first();do{let n=t.next,i=this.tolerance,r=null;for(let s=0;s<e.length;s++){let o=e[s];if(o.mark===tu){let l=o.distanceToPoint(t.point);if(l>i&&(i=l,r=o),i>1e3*this.tolerance)break}}r!==null&&this.addVertexToFace(t,r),t=n}while(t!==null)}return this}computeExtremes(){let e=new L,t=new L,n=[],i=[];for(let r=0;r<3;r++)n[r]=i[r]=this.vertices[0];e.copy(this.vertices[0].point),t.copy(this.vertices[0].point);for(let r=0,s=this.vertices.length;r<s;r++){let o=this.vertices[r],l=o.point;for(let c=0;c<3;c++)l.getComponent(c)<e.getComponent(c)&&(e.setComponent(c,l.getComponent(c)),n[c]=o);for(let c=0;c<3;c++)l.getComponent(c)>t.getComponent(c)&&(t.setComponent(c,l.getComponent(c)),i[c]=o)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(e.x),Math.abs(t.x))+Math.max(Math.abs(e.y),Math.abs(t.y))+Math.max(Math.abs(e.z),Math.abs(t.z))),{min:n,max:i}}computeInitialHull(){let e=this.vertices,t=this.computeExtremes(),n=t.min,i=t.max,r=0,s=0;for(let h=0;h<3;h++){let d=i[h].point.getComponent(h)-n[h].point.getComponent(h);d>r&&(r=d,s=h)}let o=n[s],l=i[s],c,u;r=0,g1.set(o.point,l.point);for(let h=0,d=this.vertices.length;h<d;h++){let p=e[h];if(p!==o&&p!==l){g1.closestPointToPoint(p.point,!0,x1);let m=x1.distanceToSquared(p.point);m>r&&(r=m,c=p)}}r=-1,Ip.setFromCoplanarPoints(o.point,l.point,c.point);for(let h=0,d=this.vertices.length;h<d;h++){let p=e[h];if(p!==o&&p!==l&&p!==c){let m=Math.abs(Ip.distanceToPoint(p.point));m>r&&(r=m,u=p)}}let f=[];if(Ip.distanceToPoint(u.point)<0){f.push(qn.create(o,l,c),qn.create(u,l,o),qn.create(u,c,l),qn.create(u,o,c));for(let h=0;h<3;h++){let d=(h+1)%3;f[h+1].getEdge(2).setTwin(f[0].getEdge(d)),f[h+1].getEdge(1).setTwin(f[d+1].getEdge(0))}}else{f.push(qn.create(o,c,l),qn.create(u,o,l),qn.create(u,l,c),qn.create(u,c,o));for(let h=0;h<3;h++){let d=(h+1)%3;f[h+1].getEdge(2).setTwin(f[0].getEdge((3-h)%3)),f[h+1].getEdge(0).setTwin(f[d+1].getEdge(1))}}for(let h=0;h<4;h++)this.faces.push(f[h]);for(let h=0,d=e.length;h<d;h++){let p=e[h];if(p!==o&&p!==l&&p!==c&&p!==u){r=this.tolerance;let m=null;for(let v=0;v<4;v++){let x=this.faces[v].distanceToPoint(p.point);x>r&&(r=x,m=this.faces[v])}m!==null&&this.addVertexToFace(p,m)}}return this}reindexFaces(){let e=[];for(let t=0;t<this.faces.length;t++){let n=this.faces[t];n.mark===tu&&e.push(n)}return this.faces=e,this}nextVertexToAdd(){if(this.assigned.isEmpty()===!1){let e,t=0,n=this.assigned.first().face,i=n.outside;do{let r=n.distanceToPoint(i.point);r>t&&(t=r,e=i),i=i.next}while(i!==null&&i.face===n);return e}}computeHorizon(e,t,n,i){this.deleteFaceVertices(n),n.mark=U2;let r;t===null?r=t=n.getEdge(0):r=t.next;do{let s=r.twin,o=s.face;o.mark===tu&&(o.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,s,o,i):i.push(r)),r=r.next}while(r!==t);return this}addAdjoiningFace(e,t){let n=qn.create(e,t.tail(),t.head());return this.faces.push(n),n.getEdge(-1).setTwin(t.twin),n.getEdge(0)}addNewFaces(e,t){this.newFaces=[];let n=null,i=null;for(let r=0;r<t.length;r++){let s=t[r],o=this.addAdjoiningFace(e,s);n===null?n=o:o.next.setTwin(i),this.newFaces.push(o.face),i=o}return n.next.setTwin(i),this}addVertexToHull(e){let t=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let e;for(this.computeInitialHull();(e=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}},qn=class{constructor(){this.normal=new L,this.midpoint=new L,this.area=0,this.constant=0,this.outside=null,this.mark=tu,this.edge=null}static create(e,t,n){let i=new qn,r=new ru(e,i),s=new ru(t,i),o=new ru(n,i);return r.next=o.prev=s,s.next=r.prev=o,o.next=s.prev=r,i.edge=r,i.compute()}getEdge(e){let t=this.edge;for(;e>0;)t=t.next,e--;for(;e<0;)t=t.prev,e++;return t}compute(){let e=this.edge.tail(),t=this.edge.head(),n=this.edge.next.head();return nu.set(e.point,t.point,n.point),nu.getNormal(this.normal),nu.getMidpoint(this.midpoint),this.area=nu.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(e){return this.normal.dot(e)-this.constant}},ru=class{constructor(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){let e=this.head(),t=this.tail();return t!==null?t.point.distanceTo(e.point):-1}lengthSquared(){let e=this.head(),t=this.tail();return t!==null?t.point.distanceToSquared(e.point):-1}setTwin(e){return this.twin=e,e.twin=this,this}},v1=class{constructor(e){this.point=e,this.prev=null,this.next=null,this.face=null}},Dp=class{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(e,t){return t.prev=e.prev,t.next=e,t.prev===null?this.head=t:t.prev.next=t,e.prev=t,this}insertAfter(e,t){return t.prev=e,t.next=e.next,t.next===null?this.tail=t:t.next.prev=t,e.next=t,this}append(e){return this.head===null?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this}appendChain(e){for(this.head===null?this.head=e:this.tail.next=e,e.prev=this.tail;e.next!==null;)e=e.next;return this.tail=e,this}remove(e){return e.prev===null?this.head=e.next:e.prev.next=e.next,e.next===null?this.tail=e.prev:e.next.prev=e.prev,this}removeSubList(e,t){return e.prev===null?this.head=t.next:e.prev.next=t.next,t.next===null?this.tail=e.prev:t.next.prev=e.prev,this}isEmpty(){return this.head===null}};var su=class extends ye{constructor(e){super();let t=[],n=[];iu===void 0&&console.error("THREE.ConvexBufferGeometry: ConvexBufferGeometry relies on ConvexHull");let r=new iu().setFromPoints(e).faces;for(let s=0;s<r.length;s++){let o=r[s],l=o.edge;do{let c=l.head().point;t.push(c.x,c.y,c.z),n.push(o.normal.x,o.normal.y,o.normal.z),l=l.next}while(l!==o.edge)}this.setAttribute("position",new pe(t,3)),this.setAttribute("normal",new pe(n,3))}};var y1=a=>{let e=window.THREE&&window.THREE.ConvexGeometry?window.THREE.ConvexGeometry:su;return new e(a)},fi=function(a,e){this.minSizeForBreak=a||1.4,this.smallDelta=e||1e-4,this.tempLine1=new Ls,this.tempPlane1=new Tt,this.tempPlane2=new Tt,this.tempPlane_Cut=new Tt,this.tempCM1=new L,this.tempCM2=new L,this.tempVector3=new L,this.tempVector3_2=new L,this.tempVector3_3=new L,this.tempVector3_P0=new L,this.tempVector3_P1=new L,this.tempVector3_P2=new L,this.tempVector3_N0=new L,this.tempVector3_N1=new L,this.tempVector3_AB=new L,this.tempVector3_CB=new L,this.tempResultObjects={object1:null,object2:null},this.segments=[];for(var t=30*30,n=0;n<t;n++)this.segments[n]=!1};fi.prototype={constructor:fi,prepareBreakableObject:function(a,e,t,n,i){a.geometry.isBufferGeometry||console.error("THREE.ConvexObjectBreaker.prepareBreakableObject(): Parameter object must have a BufferGeometry."),a.userData.ammoPhysicsData={};var r=a.userData.ammoPhysicsData;r.mass=e,r.velocity=t.clone(),r.angularVelocity=n.clone(),r.breakable=i},subdivideByImpact:function(a,e,t,n,i){var r=[],s=this.tempPlane1,o=this.tempPlane2;this.tempVector3.addVectors(e,t),s.setFromCoplanarPoints(e,a.position,this.tempVector3);var l=i+n,c=this;function u(f,h,d,p){if(Math.random()<p*.05||p>l){r.push(f);return}var m=Math.PI;p===0?(o.normal.copy(s.normal),o.constant=s.constant):p<=n?(m=(d-h)*(.2+.6*Math.random())+h,c.tempVector3_2.copy(a.position).sub(e).applyAxisAngle(t,m).add(e),o.setFromCoplanarPoints(e,c.tempVector3,c.tempVector3_2)):(m=(.5*(p&1)+.2*(2-Math.random()))*Math.PI,c.tempVector3_2.copy(e).sub(f.position).applyAxisAngle(t,m).add(f.position),c.tempVector3_3.copy(t).add(f.position),o.setFromCoplanarPoints(f.position,c.tempVector3_3,c.tempVector3_2)),c.cutByPlane(f,o,c.tempResultObjects);var v=c.tempResultObjects.object1,x=c.tempResultObjects.object2;v&&u(v,h,m,p+1),x&&u(x,m,d,p+1)}return u(a,0,2*Math.PI,0),r},cutByPlane:function(a,e,t){var n=a.geometry,i=n.attributes.position.array,r=n.attributes.normal.array,s=i.length/3,o=s/3,l=n.getIndex();l&&(l=l.array,o=l.length/3);function c(q,re){var Q=q*3+re;return l?l[Q]:Q}for(var u=[],f=[],h=this.smallDelta,d=s*s,p=0;p<d;p++)this.segments[p]=!1;for(var m=this.tempVector3_P0,v=this.tempVector3_P1,x=this.tempVector3_N0,g=this.tempVector3_N1,p=0;p<o-1;p++){var y=c(p,0),_=c(p,1),w=c(p,2);x.set(r[y],r[y]+1,r[y]+2);for(var b=p+1;b<o;b++){var S=c(b,0),M=c(b,1),T=c(b,2);g.set(r[S],r[S]+1,r[S]+2);var E=1-x.dot(g)<h;E&&(y===S||y===M||y===T?_===S||_===M||_===T?(this.segments[y*s+_]=!0,this.segments[_*s+y]=!0):(this.segments[w*s+y]=!0,this.segments[y*s+w]=!0):(_===S||_===M||_===T)&&(this.segments[w*s+_]=!0,this.segments[_*s+w]=!0))}}var A=this.tempPlane_Cut;a.updateMatrix(),fi.transformPlaneToLocalSpace(e,a.matrix,A);for(var p=0;p<o;p++)for(var I=c(p,0),C=c(p,1),R=c(p,2),D=0;D<3;D++){var F=D===0?I:D===1?C:R,O=D===0?C:D===1?R:I,U=this.segments[F*s+O];if(!U){this.segments[F*s+O]=!0,this.segments[O*s+F]=!0,m.set(i[3*F],i[3*F+1],i[3*F+2]),v.set(i[3*O],i[3*O+1],i[3*O+2]);var j=0,Z=A.distanceToPoint(m);Z>h?(j=2,f.push(m.clone())):Z<-h?(j=1,u.push(m.clone())):(j=3,u.push(m.clone()),f.push(m.clone()));var K=0,Z=A.distanceToPoint(v);if(Z>h?(K=2,f.push(v.clone())):Z<-h?(K=1,u.push(v.clone())):(K=3,u.push(v.clone()),f.push(v.clone())),j===1&&K===2||j===2&&K===1){this.tempLine1.start.copy(m),this.tempLine1.end.copy(v);var G=new L;if(G=A.intersectLine(this.tempLine1,G),G===void 0)return console.error("Internal error: segment does not intersect plane."),t.segmentedObject1=null,t.segmentedObject2=null,0;u.push(G),f.push(G.clone())}}}var k=a.userData.ammoPhysicsData.mass*.5;this.tempCM1.set(0,0,0);var B=0,H=u.length;if(H>0){for(var p=0;p<H;p++)this.tempCM1.add(u[p]);this.tempCM1.divideScalar(H);for(var p=0;p<H;p++){var W=u[p];W.sub(this.tempCM1),B=Math.max(B,W.x,W.y,W.z)}this.tempCM1.add(a.position)}this.tempCM2.set(0,0,0);var X=0,te=f.length;if(te>0){for(var p=0;p<te;p++)this.tempCM2.add(f[p]);this.tempCM2.divideScalar(te);for(var p=0;p<te;p++){var W=f[p];W.sub(this.tempCM2),X=Math.max(X,W.x,W.y,W.z)}this.tempCM2.add(a.position)}var he=null,ae=null,ce=0;if(H>4)try{he=new Ce(y1(u),a.material),he.position.copy(this.tempCM1),he.quaternion.copy(a.quaternion),he.userData=a.userData,this.prepareBreakableObject(he,k,a.userData.ammoPhysicsData.velocity,a.userData.ammoPhysicsData.angularVelocity,2*B>this.minSizeForBreak),ce++}catch(q){Ft("Error in ConvexObjectBreaker.ts",!0),Ft(q,!0)}if(te>4)try{ae=new Ce(y1(f),a.material),ae.position.copy(this.tempCM2),ae.quaternion.copy(a.quaternion),ae.userData=a.userData,this.prepareBreakableObject(ae,k,a.userData.ammoPhysicsData.velocity,a.userData.ammoPhysicsData.angularVelocity,2*X>this.minSizeForBreak),ce++}catch(q){Ft("Error in ConvexObjectBreaker.ts",!0),Ft(q,!0)}return t.object1=he,t.object2=ae,ce}};fi.transformFreeVector=function(a,e){var t=a.x,n=a.y,i=a.z,r=e.elements;return a.x=r[0]*t+r[4]*n+r[8]*i,a.y=r[1]*t+r[5]*n+r[9]*i,a.z=r[2]*t+r[6]*n+r[10]*i,a};fi.transformFreeVectorInverse=function(a,e){var t=a.x,n=a.y,i=a.z,r=e.elements;return a.x=r[0]*t+r[1]*n+r[2]*i,a.y=r[4]*t+r[5]*n+r[6]*i,a.z=r[8]*t+r[9]*n+r[10]*i,a};fi.transformTiedVectorInverse=function(a,e){var t=a.x,n=a.y,i=a.z,r=e.elements;return a.x=r[0]*t+r[1]*n+r[2]*i-r[12],a.y=r[4]*t+r[5]*n+r[6]*i-r[13],a.z=r[8]*t+r[9]*n+r[10]*i-r[14],a};fi.transformPlaneToLocalSpace=function(){var a=new L;return function(t,n,i){i.normal.copy(t.normal),i.constant=t.constant;var r=fi.transformTiedVectorInverse(t.coplanarPoint(a),n);fi.transformFreeVectorInverse(i.normal,n),i.constant=-r.dot(i.normal)}}();var H2=(()=>{try{if(typeof WebAssembly=="object"&&typeof WebAssembly.instantiate=="function"){let a=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(a instanceof WebAssembly.Module)return new WebAssembly.Instance(a)instanceof WebAssembly.Instance}}catch(a){console.error(a.message)}return!1})(),w1=(a,e)=>{var t=document.createElement("script");t.onload=()=>{e()},t.onerror=()=>{throw new Error(`failed to load ${a}`)},t.async=!0,t.src=a,document.head.appendChild(t)},G2=(a,e)=>{H2?w1(`${a}/ammo.wasm.js`,()=>e()):w1(`${a}/ammo.js`,()=>e())},_1=G2;var kl=(a,e)=>{typeof window!="undefined"&&(window.__loadPhysics=!0),_1(a,()=>{Ammo().then(()=>{e()})})};var W2=(a,e)=>{e.forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(n=>{Object.defineProperty(a.prototype,n,Object.getOwnPropertyDescriptor(t.prototype,n))})})},Bp=W2;var ou=class{constructor(e){this.physics=e}getHitPointWorld(){let e=this._btRayCallback.get_m_hitPointWorld();return{x:e.x(),y:e.y(),z:e.z()}}getHitNormalWorld(){let e=this._btRayCallback.get_m_hitNormalWorld();return{x:e.x(),y:e.y(),z:e.z()}}getCollisionObject(){return Ammo.castObject(this._btRayCallback.get_m_collisionObject(),Ammo.btRigidBody).threeObject}};var au=class{constructor(e){this.physics=e}getHitPointsWorld(){let e=this._btRayCallback.get_m_hitPointWorld(),t=[];for(let n=e.size()-1;n>=0;n--){let i=e.at(n);t.push({x:i.x(),y:i.y(),z:i.z()})}return t}getHitPointWorld(){return Ft("Use getHitPointsWorld() instead of getHitPointWorld() for the AllHitsRayCaster!"),this.getHitPointsWorld()}getHitNormalsWorld(){let e=this._btRayCallback.get_m_hitNormalWorld(),t=[];for(let n=e.size()-1;n>=0;n--){let i=e.at(n);t.push({x:i.x(),y:i.y(),z:i.z()})}return t}getCollisionObjects(){let e=[],t=this._btRayCallback.get_m_collisionObjects();for(let n=t.size()-1;n>=0;n--){let i=Ammo.castObject(t.at(n),Ammo.btRigidBody);e.push(i.threeObject)}return e}};var Np=class{constructor(e){this.physics=e}setRayFromWorld(e=0,t=0,n=0){this._btRayFrom.setValue(e,t,n)}setRayToWorld(e=0,t=0,n=0){this._btRayTo.setValue(e,t,n)}hasHit(){return this._btRayCallback.hasHit()}rayTest(){typeof this._btRayCallback!="undefined"&&Ammo.destroy(this._btRayCallback),this._btRayCallback=this.type==="closest"?new Ammo.ClosestRayResultCallback(this._btRayFrom,this._btRayTo):new Ammo.AllHitsRayResultCallback(this._btRayFrom,this._btRayTo),this.physics.physicsWorld.rayTest(this._btRayFrom,this._btRayTo,this._btRayCallback)}destroy(){typeof this._btRayFrom!="undefined"&&Ammo.destroy(this._btRayFrom),typeof this._btRayTo!="undefined"&&Ammo.destroy(this._btRayTo),typeof this._btRayCallback!="undefined"&&Ammo.destroy(this._btRayCallback)}},lu=class{constructor(e){this.physics=e,this.type="closest",this._btRayFrom=new Ammo.btVector3(0,0,0),this._btRayTo=new Ammo.btVector3(0,0,0)}},cu=class{constructor(e){this.physics=e,this.type="allHits",this._btRayFrom=new Ammo.btVector3(0,0,0),this._btRayTo=new Ammo.btVector3(0,0,0)}};Bp(lu,[Np,ou]);Bp(cu,[Np,au]);var Op=class extends b1.Events{constructor(e,t={}){super();this.scene=e,this.config=t,this.rigidBodies=[],this.earlierDetectedCollisions=[],this.complexShapes=["plane","hull","hacd","vhacd","convexMesh","concaveMesh"],this.gravity=t.gravity||{x:0,y:-9.81,z:0},this.isHeadless=e==="headless",this.tmpEuler=new Ut,this.tmpQuaternion=new Ve,this.tmpVector3=new L,this.tmpVector3a=new L,this.tmpMatrix4=new fe,this.tmpMatrix4a=new fe,this.tmpBtVector3=new Ammo.btVector3,this.tmpBtQuaternion=new Ammo.btQuaternion(0,0,0,1),this.emptyV3=new L,this.impactPoint=new L,this.impactNormal=new L,e!=="headless"&&(this.defaultMaterial=new jh),this.start()}get tmpTrans(){return console.warn("Use worldTransform instead of tmpTrans."),this.worldTransform}set tmpTrans(e){console.warn("Use worldTransform instead of tmpTrans."),this.worldTransform=e}destroy(e){var t;let n=Object.keys(e).includes("body")?e.body:e;if(typeof(n==null?void 0:n.ammo)=="undefined")return;let i=n.ammo.threeObject,r=i.name;if(r&&i&&((t=i==null?void 0:i.body)===null||t===void 0?void 0:t.ammo)){i.body.isSoftBody?this.physicsWorld.removeSoftBody(i.body.ammo):this.physicsWorld.removeRigidBody(i.body.ammo),i.body.destructor(),i.body=void 0,i.hasBody=!1,delete n.ammo.threeObject;for(let s=0;s<this.rigidBodies.length;s++)this.rigidBodies[s].name===r&&(this.rigidBodies.splice(s,1),s--)}this.scene==="headless"&&i&&(i=null)}setup(){if(this.worldTransform=new Ammo.btTransform,typeof this.config.setupPhysicsWorld=="function"?this.physicsWorld=this.config.setupPhysicsWorld():this.physicsWorld=this.setupPhysicsWorld(),this.scene!=="headless"){this.convexBreaker=new fi,this.objectsToRemove=[],this.numObjectsToRemove=0;for(let e=0;e<500;e++)this.objectsToRemove[e]=null}this.collisionEvents=new Rp,this.factory=new Us(this.scene),this.shapes=new s1(this.factory,(e,t)=>this.addExisting(e,t)),this.constraints=new Jh(this.worldTransform,this.physicsWorld),this.scene!=="headless"&&(this.debugDrawer=new m1(this.scene,this.physicsWorld,{}))}updateDebugger(){this.scene!=="headless"&&this.debugDrawer&&this.debugDrawer.enabled&&this.debugDrawer.update()}setupPhysicsWorld(){let e=this.gravity,{softBodies:t=!1}=this.config,n;if(!t){let i=new Ammo.btDefaultCollisionConfiguration,r=new Ammo.btCollisionDispatcher(i),s=new Ammo.btDbvtBroadphase,o=new Ammo.btSequentialImpulseConstraintSolver;n=new Ammo.btDiscreteDynamicsWorld(r,s,o,i)}if(t){let i=new Ammo.btSoftBodyRigidBodyCollisionConfiguration,r=new Ammo.btCollisionDispatcher(i),s=new Ammo.btDbvtBroadphase,o=new Ammo.btSequentialImpulseConstraintSolver,l=new Ammo.btDefaultSoftBodySolver;n=new Ammo.btSoftRigidDynamicsWorld(r,s,o,i,l)}return n.setGravity(new Ammo.btVector3(e.x,e.y,e.z)),n}createDebrisFromBreakableObject(e,t){this.scene!=="headless"&&(e.material=t.material,e.shape="hull",e.fragmentDepth=t.fragmentDepth+1,e.name=`${t.name}__DEBRIS_${e.id}`,this.scene.add(e),this.addExisting(e,{autoCenter:!0}),e.body.fractureImpulse=t.body.fractureImpulse,e.body.breakable=!1,setTimeout(()=>{e.body.breakable=!0},2500))}removeDebris(e){this.scene!=="headless"&&(this.scene.remove(e),this.destroy(e))}update(e){this.updatePhysics(e),this.detectCollisions()}updatePhysics(e){let t=e/1e3;this.physicsWorld.stepSimulation(t,this.config.maxSubSteps||4,this.config.fixedTimeStep||1/60);for(let n=0;n<this.rigidBodies.length;n++){let i=this.rigidBodies[n],s=i.body.ammo.getMotionState();if(s){if(s.getWorldTransform(this.worldTransform),i.body.didUpdate&&(i.body._emitUpdateEvents&&i.body.eventEmitter.emit("update"),i.body.didUpdate=!1),i.body.ammo.isKinematicObject()&&i.body.needUpdate)i.getWorldQuaternion(this.tmpQuaternion),i.getWorldPosition(this.tmpVector3),this.tmpBtVector3.setValue(this.tmpVector3.x,this.tmpVector3.y,this.tmpVector3.z),this.tmpBtQuaternion.setValue(this.tmpQuaternion.x,this.tmpQuaternion.y,this.tmpQuaternion.z,this.tmpQuaternion.w),this.worldTransform.setOrigin(this.tmpBtVector3),this.worldTransform.setRotation(this.tmpBtQuaternion),s.setWorldTransform(this.worldTransform),i.body.needUpdate=!1;else if(!i.body.skipUpdate){if(!i.body.ammo.isStaticObject()){let o=this.worldTransform.getOrigin(),l=this.worldTransform.getRotation(),c=i.body.offset;if(i.body.ignoreScale)this.tmpVector3a.set(i.scale.x,i.scale.y,i.scale.z);else{let u=i.body.ammo.getCollisionShape().getLocalScaling();this.tmpVector3a.set(u.x(),u.y(),u.z())}this.tmpVector3.set(o.x()+c.x,o.y()+c.y,o.z()+c.z),this.tmpQuaternion.set(l.x(),l.y(),l.z(),l.w()),this.tmpMatrix4.compose(this.tmpVector3,this.tmpQuaternion,this.tmpVector3a),i.parent?parseInt(ki)>=123?this.tmpMatrix4a.copy(i.parent.matrixWorld).invert():this.tmpMatrix4a.getInverse(i.parent.matrixWorld):this.tmpMatrix4a.identity(),this.tmpMatrix4a.multiply(this.tmpMatrix4),this.tmpMatrix4a.decompose(i.position,i.quaternion,i.scale)}}}}}detectCollisions(){var e,t;let n=[];this.impactPoint.set(0,0,0),this.impactNormal.set(0,0,0);let i=this.physicsWorld.getDispatcher(),r=i.getNumManifolds();for(let s=0;s<r;s++){let o=i.getManifoldByIndexInternal(s),l=o.getNumContacts(),c=Ammo.castObject(o.getBody0(),Ammo.btRigidBody),u=Ammo.castObject(o.getBody1(),Ammo.btRigidBody),f=c.threeObject,h=u.threeObject;if(!f||!h||c.name===""&&u.name==="")continue;let d=(e=f.body)===null||e===void 0?void 0:e.checkCollisions,p=(t=h.body)===null||t===void 0?void 0:t.checkCollisions,m=f.body.breakable,v=h.body.breakable,x=f.body.fractureImpulse,g=h.body.fractureImpulse,y=d||p,_=m||v;if(typeof f.fragmentDepth=="undefined"&&(f.fragmentDepth=0),typeof h.fragmentDepth=="undefined"&&(h.fragmentDepth=0),!y&&!_)continue;let w=!1,b=0,S="start";for(let T=0;T<l;T++){let E=o.getContactPoint(T);if(E.getDistance()<=0){w=!0;let I=E.getAppliedImpulse(),C=E.get_m_positionWorldOnB(),R=E.get_m_normalWorldOnB();if(d||p){let D=[f.name,h.name].sort(),F=`${D[0]}__${D[1]}`;this.earlierDetectedCollisions.find(O=>O.combinedName===F)&&(S="collision"),n.find(O=>O.combinedName===F)||(n.push({combinedName:F,collision:!0}),this.collisionEvents.emit("collision",{bodies:[f,h],event:S}))}I>=b&&(b=I,(m||v)&&(this.impactPoint.set(C.x(),C.y(),C.z()),this.impactNormal.set(R.x(),R.y(),R.z())));break}}if(!w||!_)continue;let M=2;if(this.emptyV3.set(0,0,0),f.userData.ammoPhysicsData={mass:1,velocity:this.emptyV3,angularVelocity:this.emptyV3,breakable:m,physicsBody:c},h.userData.ammoPhysicsData={mass:1,velocity:this.emptyV3,angularVelocity:this.emptyV3,breakable:v,physicsBody:u},m&&b>x&&f.fragmentDepth<M){let T=this.convexBreaker.subdivideByImpact(f,this.impactPoint,this.impactNormal,1,2),E=T.length;for(let A=0;A<E;A++){let I=c.getLinearVelocity(),C=c.getAngularVelocity(),R=T[A];R.userData.ammoPhysicsData.velocity.set(I.x(),I.y(),I.z()),R.userData.ammoPhysicsData.angularVelocity.set(C.x(),C.y(),C.z()),this.createDebrisFromBreakableObject(R,f)}this.objectsToRemove[this.numObjectsToRemove++]=f}if(v&&b>g&&h.fragmentDepth<M){let T=this.convexBreaker.subdivideByImpact(h,this.impactPoint,this.impactNormal,1,2),E=T.length;for(let A=0;A<E;A++){let I=u.getLinearVelocity(),C=u.getAngularVelocity(),R=T[A];R.userData.ammoPhysicsData.velocity.set(I.x(),I.y(),I.z()),R.userData.ammoPhysicsData.angularVelocity.set(C.x(),C.y(),C.z()),this.createDebrisFromBreakableObject(R,h)}this.objectsToRemove[this.numObjectsToRemove++]=h}}for(let s=0;s<this.numObjectsToRemove;s++)this.removeDebris(this.objectsToRemove[s]);this.numObjectsToRemove=0,this.earlierDetectedCollisions.forEach(s=>{let{combinedName:o}=s;if(!n.find(l=>l.combinedName===o)){let l=o.split("__"),c=this.rigidBodies.find(h=>h.name===l[0]),u=this.rigidBodies.find(h=>h.name===l[1]),f="end";c&&u&&this.collisionEvents.emit("collision",{bodies:[c,u],event:f})}}),this.earlierDetectedCollisions=[...n]}setGravity(e=0,t=-9.8,n=0){this.tmpBtVector3.setValue(e,t,n),this.physicsWorld.setGravity(this.tmpBtVector3)}get debug(){return this.isHeadless?null:{enable:()=>{this.debugDrawer.enable()},mode:(e=1)=>{this.debugDrawer.setDebugMode(e)},disable:()=>{this.debugDrawer.disable()}}}start(){if(typeof Ammo=="undefined"){Ft("Are you sure you included ammo.js?");return}typeof Ammo=="function"?Ammo().then(()=>{this.setup()}):this.setup()}get add(){return{collider:(e,t,n)=>this.collisionEvents.addCollider(e,t,n),constraints:this.constraints.addConstraints,existing:(e,t)=>this.addExisting(e,t),plane:(e={},t={})=>this.shapes.addPlane(e,t),sphere:(e={},t={})=>this.shapes.addSphere(e,t),ground:(e={},t={})=>this.shapes.addGround(e,t),box:(e={},t={})=>this.shapes.addBox(e,t),cylinder:(e={},t={})=>this.shapes.addCylinder(e,t),cone:(e={},t={})=>this.shapes.addCone(e,t),torus:(e={},t={})=>this.shapes.addTorus(e,t),extrude:(e,t={})=>this.shapes.addExtrude(e,t),raycaster:(e="closest")=>e==="closest"?new lu(this):new cu(this)}}prepareThreeObjectForCollisionShape(e,t={}){var n,i;let{autoCenter:r=!1}=t,s={width:1,height:1,depth:1,radius:1,radiusTop:1,radiusBottom:1,tube:.4,tubularSegments:6},o="unknown",l=((n=e.geometry)===null||n===void 0?void 0:n.type)||"unknown";/box/i.test(l)?o="box":/cone/i.test(l)?o="cone":/cylinder/i.test(l)?o="cylinder":/extrude/i.test(l)?o="extrude":/plane/i.test(l)?o="plane":/sphere/i.test(l)?o="sphere":/torus/i.test(l)&&(o="torus");let c=Object.assign(Object.assign({},s),(i=e==null?void 0:e.geometry)===null||i===void 0?void 0:i.parameters);return t.shape?(c=Object.assign(Object.assign({},s),t),o=t.shape):e.shape&&(o=e.shape),Object.keys(c).forEach(u=>{typeof c[u]=="undefined"&&s[u]&&(c[u]=s[u])}),r&&e.geometry.center(),o==="cylinder"&&(c.radius=t.radius||c.radiusTop),o==="extrude"&&(o="hacd"),(o==="mesh"||o==="convex")&&(o="convexMesh"),o==="concave"&&(o="concaveMesh"),o==="unknown"&&(Ft(`Shape for ${e==null?void 0:e.name} not recognized! Will fallback to box.`),o="box"),{shape:o,params:c,object:e}}createCollisionShape(e,t,n){let i=(n==null?void 0:n.quaternion)?n==null?void 0:n.quaternion:new Ve(0,0,0,1),{axis:r="y"}=t,s=new Ammo.btVector3,o=n==null?void 0:n.geometry;n&&(o==null?void 0:o.isGeometry)&&(n.geometry=new ye().fromGeometry(o));let l=p=>{let m=new fe().elements,v=[],x=[],g=[];return c1(p,{},(y,_,w)=>{v.push(y),x.push(_),g.push(w)}),{vertices:v,matrices:x,indexes:g,matrixWorld:m}},c={};this.complexShapes.indexOf(e)!==-1&&(c=l(n));let u;switch(e){case"box":s.setValue(t.width/2,t.height/2,t.depth/2),u=new Ammo.btBoxShape(s);break;case"sphere":u=new Ammo.btSphereShape(t.radius);break;case"cylinder":switch(r){case"y":s.setValue(t.radius,t.height/2,t.radius),u=new Ammo.btCylinderShape(s);break;case"x":s.setValue(t.height/2,t.radius,t.radius),u=new Ammo.btCylinderShapeX(s);break;case"z":s.setValue(t.radius,t.radius,t.height/2),u=new Ammo.btCylinderShapeZ(s);break}break;case"cone":switch(r){case"y":u=new Ammo.btConeShape(t.radius,t.height);break;case"x":u=new Ammo.btConeShapeX(t.radius,t.height);break;case"z":u=new Ammo.btConeShapeZ(t.radius,t.height);break}break;case"capsule":switch(r){case"y":u=new Ammo.btCapsuleShape(t.radius,t.height);break;case"x":u=new Ammo.btCapsuleShapeX(t.radius,t.height);break;case"z":u=new Ammo.btCapsuleShapeZ(t.radius,t.height);break}break;case"torus":u=u1(t,i);break;case"plane":u=$h(c.vertices,c.matrices,c.indexes,c.matrixWorld,Object.assign(Object.assign({},t),{concave:!1}));break;case"hull":u=o1(c.vertices,c.matrices,c.matrixWorld,t);break;case"hacd":u=a1(c.vertices,c.matrices,c.indexes,c.matrixWorld,t);break;case"vhacd":u=l1(c.vertices,c.matrices,c.indexes,c.matrixWorld,t);break;case"convexMesh":u=$h(c.vertices,c.matrices,c.indexes,c.matrixWorld,Object.assign(Object.assign({},t),{concave:!1}));break;case"concaveMesh":u=$h(c.vertices,c.matrices,c.indexes,c.matrixWorld,Object.assign(Object.assign({},t),{concave:!0}));break}Ammo.destroy(s);let{x:f,y:h,z:d}=t;return(f||h||d)&&(u.offset={x:f||0,y:h||0,z:d||0}),Array.isArray(u)&&(u=this.mergeCollisionShapesToCompoundShape(u)),u}mergeCollisionShapesToCompoundShape(e){let t=new Ammo.btCompoundShape;return e.forEach(n=>{let i=n._tmp;if(i){let{pos:r,quat:s,scale:o,margin:l}=i,c=this.applyPosQuatScaleMargin(n,r,s,o,l);t.addChildShape(c,n)}else{let r=new Ammo.btTransform;r.setIdentity(),t.addChildShape(r,n)}}),t}addExisting(e,t={}){let{hasBody:n}=e;if(n){Ft(`Object "${e.name}" already has a physical body!`);return}let i=new L,r=new Ve,s=new L;e.getWorldPosition(i),e.getWorldQuaternion(r),e.getWorldScale(s);let o=(t.collisionFlags||0).toString(2).slice(-1)==="1",l=(t.collisionFlags||0).toString(2).slice(-2,-1)==="1",{shape:c="unknown",compound:u=[],mass:f=o||l?0:1,collisionFlags:h=0,collisionGroup:d=1,collisionMask:p=-1,offset:m=void 0,breakable:v=!1,addChildren:x=!0,margin:g=.01,ignoreScale:y=!1,fractureImpulse:_=1}=t;if(y&&s.set(1,1,1),u.length>=1){let T=u.map(C=>this.createCollisionShape(C.shape,C)),E=this.mergeCollisionShapesToCompoundShape(T),A=this.applyPosQuatScaleMargin(E,i,r,s,g),I=this.collisionShapeToRigidBody(E,A,f,l);this.addRigidBodyToWorld(e,I,h,d,p,m),e.body.breakable=v,e.body.fractureImpulse=_,e.body.ignoreScale=y;return}let w=[];if(c!=="unknown"||e.isMesh){let T=this.prepareThreeObjectForCollisionShape(e,t),E=this.createCollisionShape(T.shape,T.params,T.object);w.push(E)}if(c==="unknown"&&x&&e.children.length>=1&&e.children.forEach(T=>{if(T.isMesh){let E=this.prepareThreeObjectForCollisionShape(T),A=this.createCollisionShape(E.shape,E.params,E.object);A._tmp={pos:T.position.clone(),quat:T.quaternion.clone(),scale:T.scale.clone(),margin:g},w.push(A)}}),w.length===0){let T=this.prepareThreeObjectForCollisionShape(e,t),E=this.createCollisionShape(T.shape,T.params,T.object);w.push(E)}let b=w.length===1?w[0]:this.mergeCollisionShapesToCompoundShape(w),S=this.applyPosQuatScaleMargin(b,i,r,s,g),M=this.collisionShapeToRigidBody(b,S,f,l);this.addRigidBodyToWorld(e,M,h,d,p,m),e.body.breakable=v,e.body.fractureImpulse=_,e.body.ignoreScale=y}addRigidBodyToWorld(e,t,n,i,r,s){this.rigidBodies.push(e),this.physicsWorld.addRigidBody(t,i,r);let o=Object.values(t)[0];e.name||(e.name=`object-${e.id}`),t.name=e.name,e.body=new i1(this,t),e.hasBody=!0,e.ptr=o,t.threeObject=e,s&&(e.body.offset=Object.assign({x:0,y:0,z:0},s)),e.body.setCollisionFlags(n)}applyPosQuatScaleMargin(e,t=new L,n=new Ve,i=new L,r=.01){e.setMargin(r);let s=new Ammo.btQuaternion(0,0,0,1);s.setValue(n.x,n.y,n.z,n.w);let o=new Ammo.btTransform;o.setIdentity(),o.getOrigin().setValue(t.x,t.y,t.z),o.setRotation(s),Ammo.destroy(s);let l=new Ammo.btVector3(i.x,i.y,i.z);return e.setLocalScaling(l),Ammo.destroy(l),o}collisionShapeToRigidBody(e,t,n,i){let r=new Ammo.btDefaultMotionState(t),s=new Ammo.btVector3(0,0,0);n>0&&e.calculateLocalInertia(n,s);let o=new Ammo.btRigidBodyConstructionInfo(n,r,e,s),l=new Ammo.btRigidBody(o);return(n>0||i)&&l.setActivationState(4),l}};var hu=class{constructor(e={}){this.threeGraphicsConfig=e;let{alpha:t=!1,anisotropy:n=1,camera:i=Di.Perspective({z:25,y:5}),antialias:r=!1,usePhysics:s=!0,renderer:o}=e;this.textureAnisotropy=n,this.camera=i,this.scene=new bs,this.renderer=o||new et({antialias:r,alpha:t}),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=nc,this.cache=Ki,this.cache.enabled=!0,s&&(typeof Ammo!="undefined"?this.physics=new Op(this.scene,e):Ft("Are you sure you included ammo.js?"))}};var M1="0.23.0";var q2=`Powered by enable3d v${M1}`;console.log(`%c %c %c %c %c ${q2} %c https://enable3d.io/`,"background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none");var uu=class extends hu{constructor(e){var t;super(e);this.projectConfig=e,this.scenes=new Map,this.renderer.setSize(window.innerWidth,window.innerHeight),this.projectConfig.parent?this.parent=document.getElementById(this.projectConfig.parent):this.parent=document.body,this.parent||(Ft(`Parent "${this.projectConfig.parent}" not found! Will add it to the body.`),this.parent=document.body),this.parent.appendChild(this.renderer.domElement),this.canvas=this.renderer.domElement;let n="";this.projectConfig.scenes.forEach((i,r)=>{let s=new i;r===0&&(n=s.sceneKey);let o={sceneConfig:{textureAnisotropy:this.textureAnisotropy,autoStart:!1},renderer:this.renderer,parent:this.parent,canvas:this.canvas,scene:this.scene,scenes:this.scenes,camera:this.camera,cache:this.cache,physics:this.physics};s.initializeScene(o),r===0&&(s.setSize(this.parent.clientWidth,this.parent.clientHeight),s.setPixelRatio(Math.max(1,window.devicePixelRatio/2))),this.scenes.set(s.sceneKey,s)}),(t=this.scenes.get(n))===null||t===void 0||t.start(n)}};var Z2=mr(Gs());var Y2=[{name:"pointer",enabled:!0,test:"onpointerdown"in window,events:{down:"pointerdown",move:"pointermove",up:"pointerup"}},{name:"touch",enabled:!0,test:"ontouchstart"in window&&window.navigator.maxTouchPoints>=1,events:{down:"touchstart",move:"touchmove",up:"touchend"}},{name:"mouse",enabled:!0,test:"onmousedown"in window,events:{down:"mousedown",move:"mousemove",up:"mouseup"}}];var EI=new Map;var S1=document.createElement("canvas");var AI=new Yo,PI=new J,CI=new J,LI=new J;var J2=mr(Gs());var ar=mr(E1());var e3=mr(Gs());var CD=new sn(-1,1,1,-1,0,1),A1=new ye;A1.setAttribute("position",new pe([-1,3,0,-1,-1,0,3,-1,0],3));A1.setAttribute("uv",new pe([0,2,0,0,2,0],2));var GD=new sn(-1,1,1,-1,0,1),P1=new ye;P1.setAttribute("position",new pe([-1,3,0,-1,-1,0,3,-1,0],3));P1.setAttribute("uv",new pe([0,2,0,0,2,0],2));var i3={uniforms:{tDiffuse:{value:null},tSize:{value:new J(256,256)},center:{value:new J(.5,.5)},angle:{value:1.57},scale:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform vec2 center;
		uniform float angle;
		uniform float scale;
		uniform vec2 tSize;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		float pattern() {

			float s = sin( angle ), c = cos( angle );

			vec2 tex = vUv * tSize - center;
			vec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;

			return ( sin( point.x ) * sin( point.y ) ) * 4.0;

		}

		void main() {

			vec4 color = texture2D( tDiffuse, vUv );

			float average = ( color.r + color.g + color.b ) / 3.0;

			gl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );

		}`};window.THREE=Lt;window.alert=()=>{};var fu=class extends xl{constructor(e,t,n,i){super(t);let r=this,s=new Float32Array(12*3),o=new Float32Array(12*3),l=new Float32Array(12*3);this.enableUvs=n!==void 0?n:!1,this.enableColors=i!==void 0?i:!1,this.init=function(x){this.resolution=x,this.isolation=80,this.size=x,this.size2=this.size*this.size,this.size3=this.size2*this.size,this.halfsize=this.size/2,this.delta=2/this.size,this.yd=this.size,this.zd=this.size2,this.field=new Float32Array(this.size3),this.normal_cache=new Float32Array(this.size3*3),this.palette=new Float32Array(this.size3*3),this.maxCount=4096,this.count=0,this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=new Float32Array(this.maxCount*3),this.normalArray=new Float32Array(this.maxCount*3),this.enableUvs&&(this.uvArray=new Float32Array(this.maxCount*2)),this.enableColors&&(this.colorArray=new Float32Array(this.maxCount*3))};function c(x,g,y){return x+(g-x)*y}function u(x,g,y,_,w,b,S,M,T,E){let A=(y-S)/(M-S),I=r.normal_cache;s[g+0]=_+A*r.delta,s[g+1]=w,s[g+2]=b,o[g+0]=c(I[x+0],I[x+3],A),o[g+1]=c(I[x+1],I[x+4],A),o[g+2]=c(I[x+2],I[x+5],A),l[g+0]=c(r.palette[T*3+0],r.palette[E*3+0],A),l[g+1]=c(r.palette[T*3+1],r.palette[E*3+1],A),l[g+2]=c(r.palette[T*3+2],r.palette[E*3+2],A)}function f(x,g,y,_,w,b,S,M,T,E){let A=(y-S)/(M-S),I=r.normal_cache;s[g+0]=_,s[g+1]=w+A*r.delta,s[g+2]=b;let C=x+r.yd*3;o[g+0]=c(I[x+0],I[C+0],A),o[g+1]=c(I[x+1],I[C+1],A),o[g+2]=c(I[x+2],I[C+2],A),l[g+0]=c(r.palette[T*3+0],r.palette[E*3+0],A),l[g+1]=c(r.palette[T*3+1],r.palette[E*3+1],A),l[g+2]=c(r.palette[T*3+2],r.palette[E*3+2],A)}function h(x,g,y,_,w,b,S,M,T,E){let A=(y-S)/(M-S),I=r.normal_cache;s[g+0]=_,s[g+1]=w,s[g+2]=b+A*r.delta;let C=x+r.zd*3;o[g+0]=c(I[x+0],I[C+0],A),o[g+1]=c(I[x+1],I[C+1],A),o[g+2]=c(I[x+2],I[C+2],A),l[g+0]=c(r.palette[T*3+0],r.palette[E*3+0],A),l[g+1]=c(r.palette[T*3+1],r.palette[E*3+1],A),l[g+2]=c(r.palette[T*3+2],r.palette[E*3+2],A)}function d(x){let g=x*3;r.normal_cache[g]===0&&(r.normal_cache[g+0]=r.field[x-1]-r.field[x+1],r.normal_cache[g+1]=r.field[x-r.yd]-r.field[x+r.yd],r.normal_cache[g+2]=r.field[x-r.zd]-r.field[x+r.zd])}function p(x,g,y,_,w,b){let S=_+1,M=_+r.yd,T=_+r.zd,E=S+r.yd,A=S+r.zd,I=_+r.yd+r.zd,C=S+r.yd+r.zd,R=0,D=r.field[_],F=r.field[S],O=r.field[M],U=r.field[E],j=r.field[T],Z=r.field[A],K=r.field[I],G=r.field[C];D<w&&(R|=1),F<w&&(R|=2),O<w&&(R|=8),U<w&&(R|=4),j<w&&(R|=16),Z<w&&(R|=32),K<w&&(R|=128),G<w&&(R|=64);let k=r3[R];if(k===0)return 0;let B=r.delta,H=x+B,W=g+B,X=y+B;k&1&&(d(_),d(S),u(_*3,0,w,x,g,y,D,F,_,S)),k&2&&(d(S),d(E),f(S*3,3,w,H,g,y,F,U,S,E)),k&4&&(d(M),d(E),u(M*3,6,w,x,W,y,O,U,M,E)),k&8&&(d(_),d(M),f(_*3,9,w,x,g,y,D,O,_,M)),k&16&&(d(T),d(A),u(T*3,12,w,x,g,X,j,Z,T,A)),k&32&&(d(A),d(C),f(A*3,15,w,H,g,X,Z,G,A,C)),k&64&&(d(I),d(C),u(I*3,18,w,x,W,X,K,G,I,C)),k&128&&(d(T),d(I),f(T*3,21,w,x,g,X,j,K,T,I)),k&256&&(d(_),d(T),h(_*3,24,w,x,g,y,D,j,_,T)),k&512&&(d(S),d(A),h(S*3,27,w,H,g,y,F,Z,S,A)),k&1024&&(d(E),d(C),h(E*3,30,w,H,W,y,U,G,E,C)),k&2048&&(d(M),d(I),h(M*3,33,w,x,W,y,O,K,M,I)),R<<=4;let te,he,ae,ce=0,q=0;for(;du[R+q]!=-1;)te=R+q,he=te+1,ae=te+2,m(s,o,l,3*du[te],3*du[he],3*du[ae],b),q+=3,ce++;return ce}function m(x,g,y,_,w,b,S){let M=r.count*3;if(r.positionArray[M+0]=x[_],r.positionArray[M+1]=x[_+1],r.positionArray[M+2]=x[_+2],r.positionArray[M+3]=x[w],r.positionArray[M+4]=x[w+1],r.positionArray[M+5]=x[w+2],r.positionArray[M+6]=x[b],r.positionArray[M+7]=x[b+1],r.positionArray[M+8]=x[b+2],r.material.flatShading===!0){let T=(g[_+0]+g[w+0]+g[b+0])/3,E=(g[_+1]+g[w+1]+g[b+1])/3,A=(g[_+2]+g[w+2]+g[b+2])/3;r.normalArray[M+0]=T,r.normalArray[M+1]=E,r.normalArray[M+2]=A,r.normalArray[M+3]=T,r.normalArray[M+4]=E,r.normalArray[M+5]=A,r.normalArray[M+6]=T,r.normalArray[M+7]=E,r.normalArray[M+8]=A}else r.normalArray[M+0]=g[_+0],r.normalArray[M+1]=g[_+1],r.normalArray[M+2]=g[_+2],r.normalArray[M+3]=g[w+0],r.normalArray[M+4]=g[w+1],r.normalArray[M+5]=g[w+2],r.normalArray[M+6]=g[b+0],r.normalArray[M+7]=g[b+1],r.normalArray[M+8]=g[b+2];if(r.enableUvs){let T=r.count*2;r.uvArray[T+0]=x[_+0],r.uvArray[T+1]=x[_+2],r.uvArray[T+2]=x[w+0],r.uvArray[T+3]=x[w+2],r.uvArray[T+4]=x[b+0],r.uvArray[T+5]=x[b+2]}r.enableColors&&(r.colorArray[M+0]=y[_+0],r.colorArray[M+1]=y[_+1],r.colorArray[M+2]=y[_+2],r.colorArray[M+3]=y[w+0],r.colorArray[M+4]=y[w+1],r.colorArray[M+5]=y[w+2],r.colorArray[M+6]=y[b+0],r.colorArray[M+7]=y[b+1],r.colorArray[M+8]=y[b+2]),r.count+=3,r.count>=r.maxCount-3&&(r.hasPositions=!0,r.hasNormals=!0,r.enableUvs&&(r.hasUvs=!0),r.enableColors&&(r.hasColors=!0),S(r))}this.begin=function(){this.count=0,this.hasPositions=!1,this.hasNormals=!1,this.hasUvs=!1,this.hasColors=!1},this.end=function(x){if(this.count!==0){for(let g=this.count*3;g<this.positionArray.length;g++)this.positionArray[g]=0;this.hasPositions=!0,this.hasNormals=!0,this.enableUvs&&this.material.map&&(this.hasUvs=!0),this.enableColors&&this.material.vertexColors!==Nd&&(this.hasColors=!0),x(this)}},this.addBall=function(x,g,y,_,w,b){let S=Math.sign(_);_=Math.abs(_);let M=b!=null,T=new ue(x,g,y);if(M)try{T=b instanceof ue?b:Array.isArray(b)?new ue(Math.min(Math.abs(b[0]),1),Math.min(Math.abs(b[1]),1),Math.min(Math.abs(b[2]),1)):new ue(b)}catch(ce){T=new ue(x,g,y)}let E=this.size*Math.sqrt(_/w),A=y*this.size,I=g*this.size,C=x*this.size,R=Math.floor(A-E);R<1&&(R=1);let D=Math.floor(A+E);D>this.size-1&&(D=this.size-1);let F=Math.floor(I-E);F<1&&(F=1);let O=Math.floor(I+E);O>this.size-1&&(O=this.size-1);let U=Math.floor(C-E);U<1&&(U=1);let j=Math.floor(C+E);j>this.size-1&&(j=this.size-1);let Z,K,G,k,B,H,W,X,te,he,ae;for(G=R;G<D;G++)for(B=this.size2*G,X=G/this.size-y,te=X*X,K=F;K<O;K++)for(k=B+this.size*K,W=K/this.size-g,he=W*W,Z=U;Z<j;Z++)if(H=Z/this.size-x,ae=_/(1e-6+H*H+he+te)-w,ae>0){this.field[k+Z]+=ae*S;let ce=Math.sqrt((Z-C)*(Z-C)+(K-I)*(K-I)+(G-A)*(G-A))/E,q=1-ce*ce*ce*(ce*(ce*6-15)+10);this.palette[(k+Z)*3+0]+=T.r*q,this.palette[(k+Z)*3+1]+=T.g*q,this.palette[(k+Z)*3+2]+=T.b*q}},this.addPlaneX=function(x,g){let y=this.size,_=this.yd,w=this.zd,b=this.field,S,M,T,E,A,I,C,R=y*Math.sqrt(x/g);for(R>y&&(R=y),S=0;S<R;S++)if(I=S/y,E=I*I,A=x/(1e-4+E)-g,A>0)for(M=0;M<y;M++)for(C=S+M*_,T=0;T<y;T++)b[w*T+C]+=A},this.addPlaneY=function(x,g){let y=this.size,_=this.yd,w=this.zd,b=this.field,S,M,T,E,A,I,C,R,D=y*Math.sqrt(x/g);for(D>y&&(D=y),M=0;M<D;M++)if(I=M/y,E=I*I,A=x/(1e-4+E)-g,A>0)for(C=M*_,S=0;S<y;S++)for(R=C+S,T=0;T<y;T++)b[w*T+R]+=A},this.addPlaneZ=function(x,g){let y=this.size,_=this.yd,w=this.zd,b=this.field,S,M,T,E,A,I,C,R,D=y*Math.sqrt(x/g);for(D>y&&(D=y),T=0;T<D;T++)if(I=T/y,E=I*I,A=x/(1e-4+E)-g,A>0)for(C=w*T,M=0;M<y;M++)for(R=C+M*_,S=0;S<y;S++)b[R+S]+=A},this.setCell=function(x,g,y,_){let w=this.size2*y+this.size*g+x;this.field[w]=_},this.getCell=function(x,g,y){let _=this.size2*y+this.size*g+x;return this.field[_]},this.blur=function(x=1){let g=this.field,y=g.slice(),_=this.size,w=this.size2;for(let b=0;b<_;b++)for(let S=0;S<_;S++)for(let M=0;M<_;M++){let T=w*M+_*S+b,E=y[T],A=1;for(let I=-1;I<=1;I+=2){let C=I+b;if(!(C<0||C>=_))for(let R=-1;R<=1;R+=2){let D=R+S;if(!(D<0||D>=_))for(let F=-1;F<=1;F+=2){let O=F+M;if(O<0||O>=_)continue;let U=w*O+_*D+C,j=y[U];A++,E+=x*(j-E)/A}}}g[T]=E}},this.reset=function(){for(let x=0;x<this.size3;x++)this.normal_cache[x*3]=0,this.field[x]=0,this.palette[x*3]=this.palette[x*3+1]=this.palette[x*3+2]=0},this.render=function(x){this.begin();let g=this.size-2;for(let y=1;y<g;y++){let _=this.size2*y,w=(y-this.halfsize)/this.halfsize;for(let b=1;b<g;b++){let S=_+this.size*b,M=(b-this.halfsize)/this.halfsize;for(let T=1;T<g;T++){let E=(T-this.halfsize)/this.halfsize,A=S+T;p(E,M,w,A,this.isolation,x)}}}this.end(x)},this.generateGeometry=function(){return console.warn("THREE.MarchingCubes: generateGeometry() now returns BufferGeometry"),this.generateBufferGeometry()};function v(x,g,y){let _=new Float32Array(x.length+y);return _.set(x,0),_.set(g.slice(0,y),x.length),_}this.generateBufferGeometry=function(){let x=new ye,g=new Float32Array,y=new Float32Array,_=new Float32Array,w=new Float32Array,b=this,S=function(M){b.hasPositions&&(g=v(g,M.positionArray,M.count*3)),b.hasNormals&&(y=v(y,M.normalArray,M.count*3)),b.hasColors&&(_=v(_,M.colorArray,M.count*3)),b.hasUvs&&(w=v(w,M.uvArray,M.count*2)),M.count=0};return this.render(S),this.hasPositions&&x.setAttribute("position",new Se(g,3)),this.hasNormals&&x.setAttribute("normal",new Se(y,3)),this.hasColors&&x.setAttribute("color",new Se(_,3)),this.hasUvs&&x.setAttribute("uv",new Se(w,2)),x},this.init(e)}};fu.prototype.isMarchingCubes=!0;var r3=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),du=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);var Ul=function(){var a=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(u){u.preventDefault(),n(++a%e.children.length)},!1);function t(u){return e.appendChild(u.dom),u}function n(u){for(var f=0;f<e.children.length;f++)e.children[f].style.display=f===u?"block":"none";a=u}var i=(performance||Date).now(),r=i,s=0,o=t(new Ul.Panel("FPS","#0ff","#002")),l=t(new Ul.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new Ul.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:e,addPanel:t,showPanel:n,begin:function(){i=(performance||Date).now()},end:function(){s++;var u=(performance||Date).now();if(l.update(u-i,200),u>=r+1e3&&(o.update(s*1e3/(u-r),100),r=u,s=0,c)){var f=performance.memory;c.update(f.usedJSHeapSize/1048576,f.jsHeapSizeLimit/1048576)}return u},update:function(){i=this.end()},domElement:e,setMode:n}};Ul.Panel=function(a,e,t){var n=1/0,i=0,r=Math.round,s=r(window.devicePixelRatio||1),o=80*s,l=48*s,c=3*s,u=2*s,f=3*s,h=15*s,d=74*s,p=30*s,m=document.createElement("canvas");m.width=o,m.height=l,m.style.cssText="width:80px;height:48px";var v=m.getContext("2d");return v.font="bold "+9*s+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=t,v.fillRect(0,0,o,l),v.fillStyle=e,v.fillText(a,c,u),v.fillRect(f,h,d,p),v.fillStyle=t,v.globalAlpha=.9,v.fillRect(f,h,d,p),{dom:m,update:function(x,g){n=Math.min(n,x),i=Math.max(i,x),v.fillStyle=t,v.globalAlpha=1,v.fillRect(0,0,o,h),v.fillStyle=e,v.fillText(r(x)+" "+a+" ("+r(n)+"-"+r(i)+")",c,u),v.drawImage(m,f+s,h,d-s,p,f,h,d-s,p),v.fillRect(f+d-s,h,s,p),v.fillStyle=t,v.globalAlpha=.9,v.fillRect(f+d-s,h,s,r((1-x/g)*p))}}};var C1=Ul;var Xw=mr(L1());function lr(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function R1(a,e){a.prototype=Object.create(e.prototype),a.prototype.constructor=a,a.__proto__=e}var dn={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},ga={duration:.5,overwrite:!1,delay:0},Hp,Fi=1e8,st=1/Fi,Gp=Math.PI*2,s3=Gp/4,o3=0,I1=Math.sqrt,a3=Math.cos,l3=Math.sin,$t=function(e){return typeof e=="string"},Xt=function(e){return typeof e=="function"},cr=function(e){return typeof e=="number"},pu=function(e){return typeof e=="undefined"},hr=function(e){return typeof e=="object"},yn=function(e){return e!==!1},D1=function(){return typeof window!="undefined"},F1=function(e){return Xt(e)||$t(e)},B1=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},In=Array.isArray,Wp=/(?:-?\.?\d|\.)+/gi,Xp=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Ws=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,jp=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,qp=/[+-]=-?[.\d]+/,N1=/[^,'"\[\]\s]+/gi,c3=/[\d.+\-=]+(?:e[-+]\d*)*/i,wt,Bi,Yp,Zp,Dn={},mu={},O1,k1=function(e){return(mu=va(e,Dn))&&Qn},gu=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},xu=function(e,t){return!t&&console.warn(e)},z1=function(e,t){return e&&(Dn[e]=t)&&mu&&(mu[e]=t)||Dn},xa=function(){return 0},Jp={},Zr=[],$p={},U1,wn={},Qp={},V1=30,vu=[],Kp="",em=function(e){var t=e[0],n,i;if(hr(t)||Xt(t)||(e=[e]),!(n=(t._gsap||{}).harness)){for(i=vu.length;i--&&!vu[i].targetTest(t););n=vu[i]}for(i=e.length;i--;)e[i]&&(e[i]._gsap||(e[i]._gsap=new um(e[i],n)))||e.splice(i,1);return e},Jr=function(e){return e._gsap||em(Jn(e))[0]._gsap},tm=function(e,t,n){return(n=e[t])&&Xt(n)?e[t]():pu(n)&&e.getAttribute&&e.getAttribute(t)||n},_n=function(e,t){return(e=e.split(",")).forEach(t)||e},je=function(e){return Math.round(e*1e5)/1e5||0},h3=function(e,t){for(var n=t.length,i=0;e.indexOf(t[i])<0&&++i<n;);return i<n},yu=function(){var e=Zr.length,t=Zr.slice(0),n,i;for($p={},Zr.length=0,n=0;n<e;n++)i=t[n],i&&i._lazy&&(i.render(i._lazy[0],i._lazy[1],!0)._lazy=0)},H1=function(e,t,n,i){Zr.length&&yu(),e.render(t,n,i),Zr.length&&yu()},G1=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(N1).length<2?t:$t(e)?e.trim():e},W1=function(e){return e},Yn=function(e,t){for(var n in t)n in e||(e[n]=t[n]);return e},u3=function(e,t){for(var n in t)n in e||n==="duration"||n==="ease"||(e[n]=t[n])},va=function(e,t){for(var n in t)e[n]=t[n];return e},X1=function a(e,t){for(var n in t)n!=="__proto__"&&n!=="constructor"&&n!=="prototype"&&(e[n]=hr(t[n])?a(e[n]||(e[n]={}),t[n]):t[n]);return e},nm=function(e,t){var n={},i;for(i in e)i in t||(n[i]=e[i]);return n},wu=function(e){var t=e.parent||wt,n=e.keyframes?u3:Yn;if(yn(e.inherit))for(;t;)n(e,t.vars.defaults),t=t.parent||t._dp;return e},f3=function(e,t){for(var n=e.length,i=n===t.length;i&&n--&&e[n]===t[n];);return n<0},d3=function(e,t,n,i,r){n===void 0&&(n="_first"),i===void 0&&(i="_last");var s=e[i],o;if(r)for(o=t[r];s&&s[r]>o;)s=s._prev;return s?(t._next=s._next,s._next=t):(t._next=e[n],e[n]=t),t._next?t._next._prev=t:e[i]=t,t._prev=s,t.parent=t._dp=e,t},_u=function(e,t,n,i){n===void 0&&(n="_first"),i===void 0&&(i="_last");var r=t._prev,s=t._next;r?r._next=s:e[n]===t&&(e[n]=s),s?s._prev=r:e[i]===t&&(e[i]=r),t._next=t._prev=t.parent=null},$r=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove(e),e._act=0},Xs=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var n=e;n;)n._dirty=1,n=n.parent;return e},p3=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},m3=function a(e){return!e||e._ts&&a(e.parent)},j1=function(e){return e._repeat?ya(e._tTime,e=e.duration()+e._rDelay)*e:0},ya=function(e,t){var n=Math.floor(e/=t);return e&&n===e?n-1:n},bu=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},im=function(e){return e._end=je(e._start+(e._tDur/Math.abs(e._ts||e._rts||st)||0))},q1=function(e,t){var n=e._dp;return n&&n.smoothChildTiming&&e._ts&&(e._start=je(n._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),im(e),n._dirty||Xs(n,e)),e},Y1=function(e,t){var n;if((t._time||t._initted&&!t._dur)&&(n=bu(e.rawTime(),t),(!t._dur||Hl(0,t.totalDuration(),n)-t._tTime>st)&&t.render(n,!0)),Xs(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(n=e;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;e._zTime=-st}},Ni=function(e,t,n,i){return t.parent&&$r(t),t._start=je((cr(n)?n:n||e!==wt?Zn(e,n,t):e._time)+t._delay),t._end=je(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),d3(e,t,"_first","_last",e._sort?"_start":0),rm(t)||(e._recent=t),i||Y1(e,t),e},Z1=function(e,t){return(Dn.ScrollTrigger||gu("scrollTrigger",t))&&Dn.ScrollTrigger.create(t,e)},J1=function(e,t,n,i){if(k3(e,t),!e._initted)return 1;if(!n&&e._pt&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&U1!==Fn.frame)return Zr.push(e),e._lazy=[t,i],1},g3=function a(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||a(t))},rm=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},x3=function(e,t,n,i){var r=e.ratio,s=t<0||!t&&(!e._start&&g3(e)&&!(!e._initted&&rm(e))||(e._ts<0||e._dp._ts<0)&&!rm(e))?0:1,o=e._rDelay,l=0,c,u,f;if(o&&e._repeat&&(l=Hl(0,e._tDur,t),u=ya(l,o),f=ya(e._tTime,o),e._yoyo&&u&1&&(s=1-s),u!==f&&(r=1-s,e.vars.repeatRefresh&&e._initted&&e.invalidate())),s!==r||i||e._zTime===st||!t&&e._zTime){if(!e._initted&&J1(e,t,i,n))return;for(f=e._zTime,e._zTime=t||(n?st:0),n||(n=t&&!f),e.ratio=s,e._from&&(s=1-s),e._time=0,e._tTime=l,c=e._pt;c;)c.r(s,c.d),c=c._next;e._startAt&&t<0&&e._startAt.render(t,!0,!0),e._onUpdate&&!n&&$n(e,"onUpdate"),l&&e._repeat&&!n&&e.parent&&$n(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===s&&(s&&$r(e,1),n||($n(e,s?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},v3=function(e,t,n){var i;if(n>t)for(i=e._first;i&&i._start<=n;){if(!i._dur&&i.data==="isPause"&&i._start>t)return i;i=i._next}else for(i=e._last;i&&i._start>=n;){if(!i._dur&&i.data==="isPause"&&i._start<t)return i;i=i._prev}},wa=function(e,t,n,i){var r=e._repeat,s=je(t)||0,o=e._tTime/e._tDur;return o&&!i&&(e._time*=s/e._dur),e._dur=s,e._tDur=r?r<0?1e10:je(s*(r+1)+e._rDelay*r):s,o&&!i?q1(e,e._tTime=e._tDur*o):e.parent&&im(e),n||Xs(e.parent,e),e},$1=function(e){return e instanceof an?Xs(e):wa(e,e._dur)},y3={_start:0,endTime:xa,totalDuration:xa},Zn=function a(e,t,n){var i=e.labels,r=e._recent||y3,s=e.duration()>=Fi?r.endTime(!1):e._dur,o,l,c;return $t(t)&&(isNaN(t)||t in i)?(l=t.charAt(0),c=t.substr(-1)==="%",o=t.indexOf("="),l==="<"||l===">"?(o>=0&&(t=t.replace(/=/,"")),(l==="<"?r._start:r.endTime(r._repeat>=0))+(parseFloat(t.substr(1))||0)*(c?(o<0?r:n).totalDuration()/100:1)):o<0?(t in i||(i[t]=s),i[t]):(l=parseFloat(t.charAt(o-1)+t.substr(o+1)),c&&n&&(l=l/100*(In(n)?n[0]:n).totalDuration()),o>1?a(e,t.substr(0,o-1),n)+l:s+l)):t==null?s:+t},Vl=function(e,t,n){var i=cr(t[1]),r=(i?2:1)+(e<2?0:1),s=t[r],o,l;if(i&&(s.duration=t[1]),s.parent=n,e){for(o=s,l=n;l&&!("immediateRender"in o);)o=l.vars.defaults||{},l=yn(l.vars.inherit)&&l.parent;s.immediateRender=yn(o.immediateRender),e<2?s.runBackwards=1:s.startAt=t[r-1]}return new kt(t[0],s,t[r+1])},Qr=function(e,t){return e||e===0?t(e):t},Hl=function(e,t,n){return n<e?e:n>t?t:n},bn=function(e){if(typeof e!="string")return"";var t=c3.exec(e);return t?e.substr(t.index+t[0].length):""},w3=function(e,t,n){return Qr(n,function(i){return Hl(e,t,i)})},sm=[].slice,Q1=function(e,t){return e&&hr(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&hr(e[0]))&&!e.nodeType&&e!==Bi},_3=function(e,t,n){return n===void 0&&(n=[]),e.forEach(function(i){var r;return $t(i)&&!t||Q1(i,1)?(r=n).push.apply(r,Jn(i)):n.push(i)})||n},Jn=function(e,t,n){return $t(e)&&!n&&(Yp||!ba())?sm.call((t||Zp).querySelectorAll(e),0):In(e)?_3(e,n):Q1(e)?sm.call(e,0):e?[e]:[]},b3=function(e){return e=Jn(e)[0]||xu("Invalid scope")||{},function(t){var n=e.current||e.nativeElement||e;return Jn(t,n.querySelectorAll?n:n===e?xu("Invalid scope")||Zp.createElement("div"):e)}},K1=function(e){return e.sort(function(){return .5-Math.random()})},ew=function(e){if(Xt(e))return e;var t=hr(e)?e:{each:e},n=Ma(t.ease),i=t.from||0,r=parseFloat(t.base)||0,s={},o=i>0&&i<1,l=isNaN(i)||o,c=t.axis,u=i,f=i;return $t(i)?u=f={center:.5,edges:.5,end:1}[i]||0:!o&&l&&(u=i[0],f=i[1]),function(h,d,p){var m=(p||t).length,v=s[m],x,g,y,_,w,b,S,M,T;if(!v){if(T=t.grid==="auto"?0:(t.grid||[1,Fi])[1],!T){for(S=-Fi;S<(S=p[T++].getBoundingClientRect().left)&&T<m;);T--}for(v=s[m]=[],x=l?Math.min(T,m)*u-.5:i%T,g=l?m*f/T-.5:i/T|0,S=0,M=Fi,b=0;b<m;b++)y=b%T-x,_=g-(b/T|0),v[b]=w=c?Math.abs(c==="y"?_:y):I1(y*y+_*_),w>S&&(S=w),w<M&&(M=w);i==="random"&&K1(v),v.max=S-M,v.min=M,v.v=m=(parseFloat(t.amount)||parseFloat(t.each)*(T>m?m-1:c?c==="y"?m/T:T:Math.max(T,m/T))||0)*(i==="edges"?-1:1),v.b=m<0?r-m:r,v.u=bn(t.amount||t.each)||0,n=n&&m<0?cw(n):n}return m=(v[h]-v.min)/v.max||0,je(v.b+(n?n(m):m)*v.v)+v.u}},om=function(e){var t=e<1?Math.pow(10,(e+"").length-2):1;return function(n){var i=Math.round(parseFloat(n)/e)*e*t;return(i-i%1)/t+(cr(n)?0:bn(n))}},tw=function(e,t){var n=In(e),i,r;return!n&&hr(e)&&(i=n=e.radius||Fi,e.values?(e=Jn(e.values),(r=!cr(e[0]))&&(i*=i)):e=om(e.increment)),Qr(t,n?Xt(e)?function(s){return r=e(s),Math.abs(r-s)<=i?r:s}:function(s){for(var o=parseFloat(r?s.x:s),l=parseFloat(r?s.y:0),c=Fi,u=0,f=e.length,h,d;f--;)r?(h=e[f].x-o,d=e[f].y-l,h=h*h+d*d):h=Math.abs(e[f]-o),h<c&&(c=h,u=f);return u=!i||c<=i?e[u]:s,r||u===s||cr(s)?u:u+bn(s)}:om(e))},nw=function(e,t,n,i){return Qr(In(e)?!t:n===!0?!!(n=0):!i,function(){return In(e)?e[~~(Math.random()*e.length)]:(n=n||1e-5)&&(i=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((e-n/2+Math.random()*(t-e+n*.99))/n)*n*i)/i})},M3=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(i){return t.reduce(function(r,s){return s(r)},i)}},S3=function(e,t){return function(n){return e(parseFloat(n))+(t||bn(n))}},T3=function(e,t,n){return rw(e,t,0,1,n)},iw=function(e,t,n){return Qr(n,function(i){return e[~~t(i)]})},E3=function a(e,t,n){var i=t-e;return In(e)?iw(e,a(0,e.length),t):Qr(n,function(r){return(i+(r-e)%i)%i+e})},A3=function a(e,t,n){var i=t-e,r=i*2;return In(e)?iw(e,a(0,e.length-1),t):Qr(n,function(s){return s=(r+(s-e)%r)%r||0,e+(s>i?r-s:s)})},Gl=function(e){for(var t=0,n="",i,r,s,o;~(i=e.indexOf("random(",t));)s=e.indexOf(")",i),o=e.charAt(i+7)==="[",r=e.substr(i+7,s-i-7).match(o?N1:Wp),n+=e.substr(t,i-t)+nw(o?r:+r[0],o?0:+r[1],+r[2]||1e-5),t=s+1;return n+e.substr(t,e.length-t)},rw=function(e,t,n,i,r){var s=t-e,o=i-n;return Qr(r,function(l){return n+((l-e)/s*o||0)})},P3=function a(e,t,n,i){var r=isNaN(e+t)?0:function(d){return(1-d)*e+d*t};if(!r){var s=$t(e),o={},l,c,u,f,h;if(n===!0&&(i=1)&&(n=null),s)e={p:e},t={p:t};else if(In(e)&&!In(t)){for(u=[],f=e.length,h=f-2,c=1;c<f;c++)u.push(a(e[c-1],e[c]));f--,r=function(p){p*=f;var m=Math.min(h,~~p);return u[m](p-m)},n=t}else i||(e=va(In(e)?[]:{},e));if(!u){for(l in t)fm.call(o,e,l,"get",t[l]);r=function(p){return gm(p,o)||(s?e.p:e)}}}return Qr(n,r)},sw=function(e,t,n){var i=e.labels,r=Fi,s,o,l;for(s in i)o=i[s]-t,o<0==!!n&&o&&r>(o=Math.abs(o))&&(l=s,r=o);return l},$n=function(e,t,n){var i=e.vars,r=i[t],s,o;if(!!r)return s=i[t+"Params"],o=i.callbackScope||e,n&&Zr.length&&yu(),s?r.apply(o,s):r.call(o)},Wl=function(e){return $r(e),e.scrollTrigger&&e.scrollTrigger.kill(!1),e.progress()<1&&$n(e,"onInterrupt"),e},_a,C3=function(e){e=!e.name&&e.default||e;var t=e.name,n=Xt(e),i=t&&!n&&e.init?function(){this._props=[]}:e,r={init:xa,render:gm,add:fm,kill:X3,modifier:W3,rawVars:0},s={targetTest:0,get:0,getSetter:Su,aliases:{},register:0};if(ba(),e!==i){if(wn[t])return;Yn(i,Yn(nm(e,r),s)),va(i.prototype,va(r,nm(e,s))),wn[i.prop=t]=i,e.targetTest&&(vu.push(i),Jp[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}z1(t,i),e.register&&e.register(Qn,i,pn)},at=255,Xl={aqua:[0,at,at],lime:[0,at,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,at],navy:[0,0,128],white:[at,at,at],olive:[128,128,0],yellow:[at,at,0],orange:[at,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[at,0,0],pink:[at,192,203],cyan:[0,at,at],transparent:[at,at,at,0]},am=function(e,t,n){return e=e<0?e+1:e>1?e-1:e,(e*6<1?t+(n-t)*e*6:e<.5?n:e*3<2?t+(n-t)*(2/3-e)*6:t)*at+.5|0},ow=function(e,t,n){var i=e?cr(e)?[e>>16,e>>8&at,e&at]:0:Xl.black,r,s,o,l,c,u,f,h,d,p;if(!i){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),Xl[e])i=Xl[e];else if(e.charAt(0)==="#"){if(e.length<6&&(r=e.charAt(1),s=e.charAt(2),o=e.charAt(3),e="#"+r+r+s+s+o+o+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return i=parseInt(e.substr(1,6),16),[i>>16,i>>8&at,i&at,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),i=[e>>16,e>>8&at,e&at]}else if(e.substr(0,3)==="hsl"){if(i=p=e.match(Wp),!t)l=+i[0]%360/360,c=+i[1]/100,u=+i[2]/100,s=u<=.5?u*(c+1):u+c-u*c,r=u*2-s,i.length>3&&(i[3]*=1),i[0]=am(l+1/3,r,s),i[1]=am(l,r,s),i[2]=am(l-1/3,r,s);else if(~e.indexOf("="))return i=e.match(Xp),n&&i.length<4&&(i[3]=1),i}else i=e.match(Wp)||Xl.transparent;i=i.map(Number)}return t&&!p&&(r=i[0]/at,s=i[1]/at,o=i[2]/at,f=Math.max(r,s,o),h=Math.min(r,s,o),u=(f+h)/2,f===h?l=c=0:(d=f-h,c=u>.5?d/(2-f-h):d/(f+h),l=f===r?(s-o)/d+(s<o?6:0):f===s?(o-r)/d+2:(r-s)/d+4,l*=60),i[0]=~~(l+.5),i[1]=~~(c*100+.5),i[2]=~~(u*100+.5)),n&&i.length<4&&(i[3]=1),i},aw=function(e){var t=[],n=[],i=-1;return e.split(ur).forEach(function(r){var s=r.match(Ws)||[];t.push.apply(t,s),n.push(i+=s.length+1)}),t.c=n,t},lw=function(e,t,n){var i="",r=(e+i).match(ur),s=t?"hsla(":"rgba(",o=0,l,c,u,f;if(!r)return e;if(r=r.map(function(h){return(h=ow(h,t,1))&&s+(t?h[0]+","+h[1]+"%,"+h[2]+"%,"+h[3]:h.join(","))+")"}),n&&(u=aw(e),l=n.c,l.join(i)!==u.c.join(i)))for(c=e.replace(ur,"1").split(Ws),f=c.length-1;o<f;o++)i+=c[o]+(~l.indexOf(o)?r.shift()||s+"0,0,0,0)":(u.length?u:r.length?r:n).shift());if(!c)for(c=e.split(ur),f=c.length-1;o<f;o++)i+=c[o]+r[o];return i+c[f]},ur=function(){var a="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in Xl)a+="|"+e+"\\b";return new RegExp(a+")","gi")}(),L3=/hsl[a]?\(/,lm=function(e){var t=e.join(" "),n;if(ur.lastIndex=0,ur.test(t))return n=L3.test(t),e[1]=lw(e[1],n),e[0]=lw(e[0],n,aw(e[1])),!0},Mu,Fn=function(){var a=Date.now,e=500,t=33,n=a(),i=n,r=1e3/240,s=r,o=[],l,c,u,f,h,d,p=function m(v){var x=a()-i,g=v===!0,y,_,w,b;if(x>e&&(n+=x-t),i+=x,w=i-n,y=w-s,(y>0||g)&&(b=++f.frame,h=w-f.time*1e3,f.time=w=w/1e3,s+=y+(y>=r?4:r-y),_=1),g||(l=c(m)),_)for(d=0;d<o.length;d++)o[d](w,h,b,v)};return f={time:0,frame:0,tick:function(){p(!0)},deltaRatio:function(v){return h/(1e3/(v||60))},wake:function(){O1&&(!Yp&&D1()&&(Bi=Yp=window,Zp=Bi.document||{},Dn.gsap=Qn,(Bi.gsapVersions||(Bi.gsapVersions=[])).push(Qn.version),k1(mu||Bi.GreenSockGlobals||!Bi.gsap&&Bi||{}),u=Bi.requestAnimationFrame),l&&f.sleep(),c=u||function(v){return setTimeout(v,s-f.time*1e3+1|0)},Mu=1,p(2))},sleep:function(){(u?Bi.cancelAnimationFrame:clearTimeout)(l),Mu=0,c=xa},lagSmoothing:function(v,x){e=v||1/st,t=Math.min(x,e,0)},fps:function(v){r=1e3/(v||240),s=f.time*1e3+r},add:function(v){o.indexOf(v)<0&&o.push(v),ba()},remove:function(v){var x;~(x=o.indexOf(v))&&o.splice(x,1)&&d>=x&&d--},_listeners:o},f}(),ba=function(){return!Mu&&Fn.wake()},Ze={},R3=/^[\d.\-M][\d.\-,\s]/,I3=/["']/g,D3=function(e){for(var t={},n=e.substr(1,e.length-3).split(":"),i=n[0],r=1,s=n.length,o,l,c;r<s;r++)l=n[r],o=r!==s-1?l.lastIndexOf(","):l.length,c=l.substr(0,o),t[i]=isNaN(c)?c.replace(I3,"").trim():+c,i=l.substr(o+1).trim();return t},F3=function(e){var t=e.indexOf("(")+1,n=e.indexOf(")"),i=e.indexOf("(",t);return e.substring(t,~i&&i<n?e.indexOf(")",n+1):n)},B3=function(e){var t=(e+"").split("("),n=Ze[t[0]];return n&&t.length>1&&n.config?n.config.apply(null,~e.indexOf("{")?[D3(t[1])]:F3(e).split(",").map(G1)):Ze._CE&&R3.test(e)?Ze._CE("",e):n},cw=function(e){return function(t){return 1-e(1-t)}},hw=function a(e,t){for(var n=e._first,i;n;)n instanceof an?a(n,t):n.vars.yoyoEase&&(!n._yoyo||!n._repeat)&&n._yoyo!==t&&(n.timeline?a(n.timeline,t):(i=n._ease,n._ease=n._yEase,n._yEase=i,n._yoyo=t)),n=n._next},Ma=function(e,t){return e&&(Xt(e)?e:Ze[e]||B3(e))||t},js=function(e,t,n,i){n===void 0&&(n=function(l){return 1-t(1-l)}),i===void 0&&(i=function(l){return l<.5?t(l*2)/2:1-t((1-l)*2)/2});var r={easeIn:t,easeOut:n,easeInOut:i},s;return _n(e,function(o){Ze[o]=Dn[o]=r,Ze[s=o.toLowerCase()]=n;for(var l in r)Ze[s+(l==="easeIn"?".in":l==="easeOut"?".out":".inOut")]=Ze[o+"."+l]=r[l]}),r},uw=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},cm=function a(e,t,n){var i=t>=1?t:1,r=(n||(e?.3:.45))/(t<1?t:1),s=r/Gp*(Math.asin(1/i)||0),o=function(u){return u===1?1:i*Math.pow(2,-10*u)*l3((u-s)*r)+1},l=e==="out"?o:e==="in"?function(c){return 1-o(1-c)}:uw(o);return r=Gp/r,l.config=function(c,u){return a(e,c,u)},l},hm=function a(e,t){t===void 0&&(t=1.70158);var n=function(s){return s?--s*s*((t+1)*s+t)+1:0},i=e==="out"?n:e==="in"?function(r){return 1-n(1-r)}:uw(n);return i.config=function(r){return a(e,r)},i};_n("Linear,Quad,Cubic,Quart,Quint,Strong",function(a,e){var t=e<5?e+1:e;js(a+",Power"+(t-1),e?function(n){return Math.pow(n,t)}:function(n){return n},function(n){return 1-Math.pow(1-n,t)},function(n){return n<.5?Math.pow(n*2,t)/2:1-Math.pow((1-n)*2,t)/2})});Ze.Linear.easeNone=Ze.none=Ze.Linear.easeIn;js("Elastic",cm("in"),cm("out"),cm());(function(a,e){var t=1/e,n=2*t,i=2.5*t,r=function(o){return o<t?a*o*o:o<n?a*Math.pow(o-1.5/e,2)+.75:o<i?a*(o-=2.25/e)*o+.9375:a*Math.pow(o-2.625/e,2)+.984375};js("Bounce",function(s){return 1-r(1-s)},r)})(7.5625,2.75);js("Expo",function(a){return a?Math.pow(2,10*(a-1)):0});js("Circ",function(a){return-(I1(1-a*a)-1)});js("Sine",function(a){return a===1?1:-a3(a*s3)+1});js("Back",hm("in"),hm("out"),hm());Ze.SteppedEase=Ze.steps=Dn.SteppedEase={config:function(e,t){e===void 0&&(e=1);var n=1/e,i=e+(t?0:1),r=t?1:0,s=1-st;return function(o){return((i*Hl(0,s,o)|0)+r)*n}}};ga.ease=Ze["quad.out"];_n("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(a){return Kp+=a+","+a+"Params,"});var um=function(e,t){this.id=o3++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:tm,this.set=t?t.getSetter:Su},jl=function(){function a(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,wa(this,+t.duration,1,1),this.data=t.data,Mu||Fn.wake()}var e=a.prototype;return e.delay=function(n){return n||n===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+n-this._delay),this._delay=n,this):this._delay},e.duration=function(n){return arguments.length?this.totalDuration(this._repeat>0?n+(n+this._rDelay)*this._repeat:n):this.totalDuration()&&this._dur},e.totalDuration=function(n){return arguments.length?(this._dirty=0,wa(this,this._repeat<0?n:(n-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(n,i){if(ba(),!arguments.length)return this._tTime;var r=this._dp;if(r&&r.smoothChildTiming&&this._ts){for(q1(this,n),!r._dp||r.parent||Y1(r,this);r.parent;)r.parent._time!==r._start+(r._ts>=0?r._tTime/r._ts:(r.totalDuration()-r._tTime)/-r._ts)&&r.totalTime(r._tTime,!0),r=r.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&n<this._tDur||this._ts<0&&n>0||!this._tDur&&!n)&&Ni(this._dp,this,this._start-this._delay)}return(this._tTime!==n||!this._dur&&!i||this._initted&&Math.abs(this._zTime)===st||!n&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=n),H1(this,n,i)),this},e.time=function(n,i){return arguments.length?this.totalTime(Math.min(this.totalDuration(),n+j1(this))%(this._dur+this._rDelay)||(n?this._dur:0),i):this._time},e.totalProgress=function(n,i){return arguments.length?this.totalTime(this.totalDuration()*n,i):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},e.progress=function(n,i){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-n:n)+j1(this),i):this.duration()?Math.min(1,this._time/this._dur):this.ratio},e.iteration=function(n,i){var r=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(n-1)*r,i):this._repeat?ya(this._tTime,r)+1:1},e.timeScale=function(n){if(!arguments.length)return this._rts===-st?0:this._rts;if(this._rts===n)return this;var i=this.parent&&this._ts?bu(this.parent._time,this):this._tTime;return this._rts=+n||0,this._ts=this._ps||n===-st?0:this._rts,p3(this.totalTime(Hl(-this._delay,this._tDur,i),!0))},e.paused=function(n){return arguments.length?(this._ps!==n&&(this._ps=n,n?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(ba(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==st&&(this._tTime-=st)))),this):this._ps},e.startTime=function(n){if(arguments.length){this._start=n;var i=this.parent||this._dp;return i&&(i._sort||!this.parent)&&Ni(i,this,n-this._delay),this}return this._start},e.endTime=function(n){return this._start+(yn(n)?this.totalDuration():this.duration())/Math.abs(this._ts)},e.rawTime=function(n){var i=this.parent||this._dp;return i?n&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?bu(i.rawTime(n),this):this._tTime:this._tTime},e.globalTime=function(n){for(var i=this,r=arguments.length?n:i.rawTime();i;)r=i._start+r/(i._ts||1),i=i._dp;return r},e.repeat=function(n){return arguments.length?(this._repeat=n===1/0?-2:n,$1(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(n){if(arguments.length){var i=this._time;return this._rDelay=n,$1(this),i?this.time(i):this}return this._rDelay},e.yoyo=function(n){return arguments.length?(this._yoyo=n,this):this._yoyo},e.seek=function(n,i){return this.totalTime(Zn(this,n),yn(i))},e.restart=function(n,i){return this.play().totalTime(n?-this._delay:0,yn(i))},e.play=function(n,i){return n!=null&&this.seek(n,i),this.reversed(!1).paused(!1)},e.reverse=function(n,i){return n!=null&&this.seek(n||this.totalDuration(),i),this.reversed(!0).paused(!1)},e.pause=function(n,i){return n!=null&&this.seek(n,i),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(n){return arguments.length?(!!n!==this.reversed()&&this.timeScale(-this._rts||(n?-st:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-st,this},e.isActive=function(){var n=this.parent||this._dp,i=this._start,r;return!!(!n||this._ts&&this._initted&&n.isActive()&&(r=n.rawTime(!0))>=i&&r<this.endTime(!0)-st)},e.eventCallback=function(n,i,r){var s=this.vars;return arguments.length>1?(i?(s[n]=i,r&&(s[n+"Params"]=r),n==="onUpdate"&&(this._onUpdate=i)):delete s[n],this):s[n]},e.then=function(n){var i=this;return new Promise(function(r){var s=Xt(n)?n:W1,o=function(){var c=i.then;i.then=null,Xt(s)&&(s=s(i))&&(s.then||s===i)&&(i.then=c),r(s),i.then=c};i._initted&&i.totalProgress()===1&&i._ts>=0||!i._tTime&&i._ts<0?o():i._prom=o})},e.kill=function(){Wl(this)},a}();Yn(jl.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-st,_prom:0,_ps:!1,_rts:1});var an=function(a){R1(e,a);function e(n,i){var r;return n===void 0&&(n={}),r=a.call(this,n)||this,r.labels={},r.smoothChildTiming=!!n.smoothChildTiming,r.autoRemoveChildren=!!n.autoRemoveChildren,r._sort=yn(n.sortChildren),wt&&Ni(n.parent||wt,lr(r),i),n.reversed&&r.reverse(),n.paused&&r.paused(!0),n.scrollTrigger&&Z1(lr(r),n.scrollTrigger),r}var t=e.prototype;return t.to=function(i,r,s){return Vl(0,arguments,this),this},t.from=function(i,r,s){return Vl(1,arguments,this),this},t.fromTo=function(i,r,s,o){return Vl(2,arguments,this),this},t.set=function(i,r,s){return r.duration=0,r.parent=this,wu(r).repeatDelay||(r.repeat=0),r.immediateRender=!!r.immediateRender,new kt(i,r,Zn(this,s),1),this},t.call=function(i,r,s){return Ni(this,kt.delayedCall(0,i,r),s)},t.staggerTo=function(i,r,s,o,l,c,u){return s.duration=r,s.stagger=s.stagger||o,s.onComplete=c,s.onCompleteParams=u,s.parent=this,new kt(i,s,Zn(this,l)),this},t.staggerFrom=function(i,r,s,o,l,c,u){return s.runBackwards=1,wu(s).immediateRender=yn(s.immediateRender),this.staggerTo(i,r,s,o,l,c,u)},t.staggerFromTo=function(i,r,s,o,l,c,u,f){return o.startAt=s,wu(o).immediateRender=yn(o.immediateRender),this.staggerTo(i,r,o,l,c,u,f)},t.render=function(i,r,s){var o=this._time,l=this._dirty?this.totalDuration():this._tDur,c=this._dur,u=this!==wt&&i>l-st&&i>=0?l:i<st?0:i,f=this._zTime<0!=i<0&&(this._initted||!c),h,d,p,m,v,x,g,y,_,w,b,S;if(u!==this._tTime||s||f){if(o!==this._time&&c&&(u+=this._time-o,i+=this._time-o),h=u,_=this._start,y=this._ts,x=!y,f&&(c||(o=this._zTime),(i||!r)&&(this._zTime=i)),this._repeat){if(b=this._yoyo,v=c+this._rDelay,this._repeat<-1&&i<0)return this.totalTime(v*100+i,r,s);if(h=je(u%v),u===l?(m=this._repeat,h=c):(m=~~(u/v),m&&m===u/v&&(h=c,m--),h>c&&(h=c)),w=ya(this._tTime,v),!o&&this._tTime&&w!==m&&(w=m),b&&m&1&&(h=c-h,S=1),m!==w&&!this._lock){var M=b&&w&1,T=M===(b&&m&1);if(m<w&&(M=!M),o=M?0:c,this._lock=1,this.render(o||(S?0:je(m*v)),r,!c)._lock=0,this._tTime=u,!r&&this.parent&&$n(this,"onRepeat"),this.vars.repeatRefresh&&!S&&(this.invalidate()._lock=1),o&&o!==this._time||x!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(c=this._dur,l=this._tDur,T&&(this._lock=2,o=M?c:-1e-4,this.render(o,!0),this.vars.repeatRefresh&&!S&&this.invalidate()),this._lock=0,!this._ts&&!x)return this;hw(this,S)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(g=v3(this,je(o),je(h)),g&&(u-=h-(h=g._start))),this._tTime=u,this._time=h,this._act=!y,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=i,o=0),!o&&h&&!r&&($n(this,"onStart"),this._tTime!==u))return this;if(h>=o&&i>=0)for(d=this._first;d;){if(p=d._next,(d._act||h>=d._start)&&d._ts&&g!==d){if(d.parent!==this)return this.render(i,r,s);if(d.render(d._ts>0?(h-d._start)*d._ts:(d._dirty?d.totalDuration():d._tDur)+(h-d._start)*d._ts,r,s),h!==this._time||!this._ts&&!x){g=0,p&&(u+=this._zTime=-st);break}}d=p}else{d=this._last;for(var E=i<0?i:h;d;){if(p=d._prev,(d._act||E<=d._end)&&d._ts&&g!==d){if(d.parent!==this)return this.render(i,r,s);if(d.render(d._ts>0?(E-d._start)*d._ts:(d._dirty?d.totalDuration():d._tDur)+(E-d._start)*d._ts,r,s),h!==this._time||!this._ts&&!x){g=0,p&&(u+=this._zTime=E?-st:st);break}}d=p}}if(g&&!r&&(this.pause(),g.render(h>=o?0:-st)._zTime=h>=o?1:-1,this._ts))return this._start=_,im(this),this.render(i,r,s);this._onUpdate&&!r&&$n(this,"onUpdate",!0),(u===l&&l>=this.totalDuration()||!u&&o)&&(_===this._start||Math.abs(y)!==Math.abs(this._ts))&&(this._lock||((i||!c)&&(u===l&&this._ts>0||!u&&this._ts<0)&&$r(this,1),!r&&!(i<0&&!o)&&(u||o||!l)&&($n(this,u===l&&i>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(u<l&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(i,r){var s=this;if(cr(r)||(r=Zn(this,r,i)),!(i instanceof jl)){if(In(i))return i.forEach(function(o){return s.add(o,r)}),this;if($t(i))return this.addLabel(i,r);if(Xt(i))i=kt.delayedCall(0,i);else return this}return this!==i?Ni(this,i,r):this},t.getChildren=function(i,r,s,o){i===void 0&&(i=!0),r===void 0&&(r=!0),s===void 0&&(s=!0),o===void 0&&(o=-Fi);for(var l=[],c=this._first;c;)c._start>=o&&(c instanceof kt?r&&l.push(c):(s&&l.push(c),i&&l.push.apply(l,c.getChildren(!0,r,s)))),c=c._next;return l},t.getById=function(i){for(var r=this.getChildren(1,1,1),s=r.length;s--;)if(r[s].vars.id===i)return r[s]},t.remove=function(i){return $t(i)?this.removeLabel(i):Xt(i)?this.killTweensOf(i):(_u(this,i),i===this._recent&&(this._recent=this._last),Xs(this))},t.totalTime=function(i,r){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=je(Fn.time-(this._ts>0?i/this._ts:(this.totalDuration()-i)/-this._ts))),a.prototype.totalTime.call(this,i,r),this._forcing=0,this):this._tTime},t.addLabel=function(i,r){return this.labels[i]=Zn(this,r),this},t.removeLabel=function(i){return delete this.labels[i],this},t.addPause=function(i,r,s){var o=kt.delayedCall(0,r||xa,s);return o.data="isPause",this._hasPause=1,Ni(this,o,Zn(this,i))},t.removePause=function(i){var r=this._first;for(i=Zn(this,i);r;)r._start===i&&r.data==="isPause"&&$r(r),r=r._next},t.killTweensOf=function(i,r,s){for(var o=this.getTweensOf(i,s),l=o.length;l--;)Kr!==o[l]&&o[l].kill(i,r);return this},t.getTweensOf=function(i,r){for(var s=[],o=Jn(i),l=this._first,c=cr(r),u;l;)l instanceof kt?h3(l._targets,o)&&(c?(!Kr||l._initted&&l._ts)&&l.globalTime(0)<=r&&l.globalTime(l.totalDuration())>r:!r||l.isActive())&&s.push(l):(u=l.getTweensOf(o,r)).length&&s.push.apply(s,u),l=l._next;return s},t.tweenTo=function(i,r){r=r||{};var s=this,o=Zn(s,i),l=r,c=l.startAt,u=l.onStart,f=l.onStartParams,h=l.immediateRender,d,p=kt.to(s,Yn({ease:r.ease||"none",lazy:!1,immediateRender:!1,time:o,overwrite:"auto",duration:r.duration||Math.abs((o-(c&&"time"in c?c.time:s._time))/s.timeScale())||st,onStart:function(){if(s.pause(),!d){var v=r.duration||Math.abs((o-(c&&"time"in c?c.time:s._time))/s.timeScale());p._dur!==v&&wa(p,v,0,1).render(p._time,!0,!0),d=1}u&&u.apply(p,f||[])}},r));return h?p.render(0):p},t.tweenFromTo=function(i,r,s){return this.tweenTo(r,Yn({startAt:{time:Zn(this,i)}},s))},t.recent=function(){return this._recent},t.nextLabel=function(i){return i===void 0&&(i=this._time),sw(this,Zn(this,i))},t.previousLabel=function(i){return i===void 0&&(i=this._time),sw(this,Zn(this,i),1)},t.currentLabel=function(i){return arguments.length?this.seek(i,!0):this.previousLabel(this._time+st)},t.shiftChildren=function(i,r,s){s===void 0&&(s=0);for(var o=this._first,l=this.labels,c;o;)o._start>=s&&(o._start+=i,o._end+=i),o=o._next;if(r)for(c in l)l[c]>=s&&(l[c]+=i);return Xs(this)},t.invalidate=function(){var i=this._first;for(this._lock=0;i;)i.invalidate(),i=i._next;return a.prototype.invalidate.call(this)},t.clear=function(i){i===void 0&&(i=!0);for(var r=this._first,s;r;)s=r._next,this.remove(r),r=s;return this._dp&&(this._time=this._tTime=this._pTime=0),i&&(this.labels={}),Xs(this)},t.totalDuration=function(i){var r=0,s=this,o=s._last,l=Fi,c,u,f;if(arguments.length)return s.timeScale((s._repeat<0?s.duration():s.totalDuration())/(s.reversed()?-i:i));if(s._dirty){for(f=s.parent;o;)c=o._prev,o._dirty&&o.totalDuration(),u=o._start,u>l&&s._sort&&o._ts&&!s._lock?(s._lock=1,Ni(s,o,u-o._delay,1)._lock=0):l=u,u<0&&o._ts&&(r-=u,(!f&&!s._dp||f&&f.smoothChildTiming)&&(s._start+=u/s._ts,s._time-=u,s._tTime-=u),s.shiftChildren(-u,!1,-1/0),l=0),o._end>r&&o._ts&&(r=o._end),o=c;wa(s,s===wt&&s._time>r?s._time:r,1,1),s._dirty=0}return s._tDur},e.updateRoot=function(i){if(wt._ts&&(H1(wt,bu(i,wt)),U1=Fn.frame),Fn.frame>=V1){V1+=dn.autoSleep||120;var r=wt._first;if((!r||!r._ts)&&dn.autoSleep&&Fn._listeners.length<2){for(;r&&!r._ts;)r=r._next;r||Fn.sleep()}}},e}(jl);Yn(an.prototype,{_lock:0,_hasPause:0,_forcing:0});var N3=function(e,t,n,i,r,s,o){var l=new pn(this._pt,e,t,0,1,mm,null,r),c=0,u=0,f,h,d,p,m,v,x,g;for(l.b=n,l.e=i,n+="",i+="",(x=~i.indexOf("random("))&&(i=Gl(i)),s&&(g=[n,i],s(g,e,t),n=g[0],i=g[1]),h=n.match(jp)||[];f=jp.exec(i);)p=f[0],m=i.substring(c,f.index),d?d=(d+1)%5:m.substr(-5)==="rgba("&&(d=1),p!==h[u++]&&(v=parseFloat(h[u-1])||0,l._pt={_next:l._pt,p:m||u===1?m:",",s:v,c:p.charAt(1)==="="?parseFloat(p.substr(2))*(p.charAt(0)==="-"?-1:1):parseFloat(p)-v,m:d&&d<4?Math.round:0},c=jp.lastIndex);return l.c=c<i.length?i.substring(c,i.length):"",l.fp=o,(qp.test(i)||x)&&(l.e=0),this._pt=l,l},fm=function(e,t,n,i,r,s,o,l,c){Xt(i)&&(i=i(r||0,e,s));var u=e[t],f=n!=="get"?n:Xt(u)?c?e[t.indexOf("set")||!Xt(e["get"+t.substr(3)])?t:"get"+t.substr(3)](c):e[t]():u,h=Xt(u)?c?V3:dw:pm,d;if($t(i)&&(~i.indexOf("random(")&&(i=Gl(i)),i.charAt(1)==="="&&(d=parseFloat(f)+parseFloat(i.substr(2))*(i.charAt(0)==="-"?-1:1)+(bn(f)||0),(d||d===0)&&(i=d))),f!==i)return!isNaN(f*i)&&i!==""?(d=new pn(this._pt,e,t,+f||0,i-(f||0),typeof u=="boolean"?G3:pw,0,h),c&&(d.fp=c),o&&d.modifier(o,this,e),this._pt=d):(!u&&!(t in e)&&gu(t,i),N3.call(this,e,t,f,i,h,l||dn.stringFilter,c))},O3=function(e,t,n,i,r){if(Xt(e)&&(e=ql(e,r,t,n,i)),!hr(e)||e.style&&e.nodeType||In(e)||B1(e))return $t(e)?ql(e,r,t,n,i):e;var s={},o;for(o in e)s[o]=ql(e[o],r,t,n,i);return s},dm=function(e,t,n,i,r,s){var o,l,c,u;if(wn[e]&&(o=new wn[e]).init(r,o.rawVars?t[e]:O3(t[e],i,r,s,n),n,i,s)!==!1&&(n._pt=l=new pn(n._pt,r,e,0,1,o.render,o,0,o.priority),n!==_a))for(c=n._ptLookup[n._targets.indexOf(r)],u=o._props.length;u--;)c[o._props[u]]=l;return o},Kr,k3=function a(e,t){var n=e.vars,i=n.ease,r=n.startAt,s=n.immediateRender,o=n.lazy,l=n.onUpdate,c=n.onUpdateParams,u=n.callbackScope,f=n.runBackwards,h=n.yoyoEase,d=n.keyframes,p=n.autoRevert,m=e._dur,v=e._startAt,x=e._targets,g=e.parent,y=g&&g.data==="nested"?g.parent._targets:x,_=e._overwrite==="auto"&&!Hp,w=e.timeline,b,S,M,T,E,A,I,C,R,D,F,O,U;if(w&&(!d||!i)&&(i="none"),e._ease=Ma(i,ga.ease),e._yEase=h?cw(Ma(h===!0?i:h,ga.ease)):0,h&&e._yoyo&&!e._repeat&&(h=e._yEase,e._yEase=e._ease,e._ease=h),e._from=!w&&!!n.runBackwards,!w){if(C=x[0]?Jr(x[0]).harness:0,O=C&&n[C.prop],b=nm(n,Jp),v&&v.render(-1,!0).kill(),r)if($r(e._startAt=kt.set(x,Yn({data:"isStart",overwrite:!1,parent:g,immediateRender:!0,lazy:yn(o),startAt:null,delay:0,onUpdate:l,onUpdateParams:c,callbackScope:u,stagger:0},r))),t<0&&!s&&!p&&e._startAt.render(-1,!0),s){if(t>0&&!p&&(e._startAt=0),m&&t<=0){t&&(e._zTime=t);return}}else p===!1&&(e._startAt=0);else if(f&&m){if(v)!p&&(e._startAt=0);else if(t&&(s=!1),M=Yn({overwrite:!1,data:"isFromStart",lazy:s&&yn(o),immediateRender:s,stagger:0,parent:g},b),O&&(M[C.prop]=O),$r(e._startAt=kt.set(x,M)),t<0&&e._startAt.render(-1,!0),!s)a(e._startAt,st);else if(!t)return}for(e._pt=0,o=m&&yn(o)||o&&!m,S=0;S<x.length;S++){if(E=x[S],I=E._gsap||em(x)[S]._gsap,e._ptLookup[S]=D={},$p[I.id]&&Zr.length&&yu(),F=y===x?S:y.indexOf(E),C&&(R=new C).init(E,O||b,e,F,y)!==!1&&(e._pt=T=new pn(e._pt,E,R.name,0,1,R.render,R,0,R.priority),R._props.forEach(function(j){D[j]=T}),R.priority&&(A=1)),!C||O)for(M in b)wn[M]&&(R=dm(M,b,e,F,E,y))?R.priority&&(A=1):D[M]=T=fm.call(e,E,M,"get",b[M],F,y,0,n.stringFilter);e._op&&e._op[S]&&e.kill(E,e._op[S]),_&&e._pt&&(Kr=e,wt.killTweensOf(E,D,e.globalTime(0)),U=!e.parent,Kr=0),e._pt&&o&&($p[I.id]=1)}A&&xm(e),e._onInit&&e._onInit(e)}e._onUpdate=l,e._initted=(!e._op||e._pt)&&!U},z3=function(e,t){var n=e[0]?Jr(e[0]).harness:0,i=n&&n.aliases,r,s,o,l;if(!i)return t;r=va({},t);for(s in i)if(s in r)for(l=i[s].split(","),o=l.length;o--;)r[l[o]]=r[s];return r},ql=function(e,t,n,i,r){return Xt(e)?e.call(t,n,i,r):$t(e)&&~e.indexOf("random(")?Gl(e):e},fw=Kp+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase",U3=(fw+",id,stagger,delay,duration,paused,scrollTrigger").split(","),kt=function(a){R1(e,a);function e(n,i,r,s){var o;typeof i=="number"&&(r.duration=i,i=r,r=null),o=a.call(this,s?i:wu(i))||this;var l=o.vars,c=l.duration,u=l.delay,f=l.immediateRender,h=l.stagger,d=l.overwrite,p=l.keyframes,m=l.defaults,v=l.scrollTrigger,x=l.yoyoEase,g=i.parent||wt,y=(In(n)||B1(n)?cr(n[0]):"length"in i)?[n]:Jn(n),_,w,b,S,M,T,E,A;if(o._targets=y.length?em(y):xu("GSAP target "+n+" not found. https://greensock.com",!dn.nullTargetWarn)||[],o._ptLookup=[],o._overwrite=d,p||h||F1(c)||F1(u)){if(i=o.vars,_=o.timeline=new an({data:"nested",defaults:m||{}}),_.kill(),_.parent=_._dp=lr(o),_._start=0,p)Yn(_.vars.defaults,{ease:"none"}),h?y.forEach(function(I,C){return p.forEach(function(R,D){return _.to(I,R,D?">":C*h)})}):p.forEach(function(I){return _.to(y,I,">")});else{if(S=y.length,E=h?ew(h):xa,hr(h))for(M in h)~fw.indexOf(M)&&(A||(A={}),A[M]=h[M]);for(w=0;w<S;w++){b={};for(M in i)U3.indexOf(M)<0&&(b[M]=i[M]);b.stagger=0,x&&(b.yoyoEase=x),A&&va(b,A),T=y[w],b.duration=+ql(c,lr(o),w,T,y),b.delay=(+ql(u,lr(o),w,T,y)||0)-o._delay,!h&&S===1&&b.delay&&(o._delay=u=b.delay,o._start+=u,b.delay=0),_.to(T,b,E(w,T,y))}_.duration()?c=u=0:o.timeline=0}c||o.duration(c=_.duration())}else o.timeline=0;return d===!0&&!Hp&&(Kr=lr(o),wt.killTweensOf(y),Kr=0),Ni(g,lr(o),r),i.reversed&&o.reverse(),i.paused&&o.paused(!0),(f||!c&&!p&&o._start===je(g._time)&&yn(f)&&m3(lr(o))&&g.data!=="nested")&&(o._tTime=-st,o.render(Math.max(0,-u))),v&&Z1(lr(o),v),o}var t=e.prototype;return t.render=function(i,r,s){var o=this._time,l=this._tDur,c=this._dur,u=i>l-st&&i>=0?l:i<st?0:i,f,h,d,p,m,v,x,g,y;if(!c)x3(this,i,r,s);else if(u!==this._tTime||!i||s||!this._initted&&this._tTime||this._startAt&&this._zTime<0!=i<0){if(f=u,g=this.timeline,this._repeat){if(p=c+this._rDelay,this._repeat<-1&&i<0)return this.totalTime(p*100+i,r,s);if(f=je(u%p),u===l?(d=this._repeat,f=c):(d=~~(u/p),d&&d===u/p&&(f=c,d--),f>c&&(f=c)),v=this._yoyo&&d&1,v&&(y=this._yEase,f=c-f),m=ya(this._tTime,p),f===o&&!s&&this._initted)return this;d!==m&&(g&&this._yEase&&hw(g,v),this.vars.repeatRefresh&&!v&&!this._lock&&(this._lock=s=1,this.render(je(p*d),!0).invalidate()._lock=0))}if(!this._initted){if(J1(this,i<0?i:f,s,r))return this._tTime=0,this;if(c!==this._dur)return this.render(i,r,s)}if(this._tTime=u,this._time=f,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=x=(y||this._ease)(f/c),this._from&&(this.ratio=x=1-x),f&&!o&&!r&&($n(this,"onStart"),this._tTime!==u))return this;for(h=this._pt;h;)h.r(x,h.d),h=h._next;g&&g.render(i<0?i:!f&&v?-st:g._dur*x,r,s)||this._startAt&&(this._zTime=i),this._onUpdate&&!r&&(i<0&&this._startAt&&this._startAt.render(i,!0,s),$n(this,"onUpdate")),this._repeat&&d!==m&&this.vars.onRepeat&&!r&&this.parent&&$n(this,"onRepeat"),(u===this._tDur||!u)&&this._tTime===u&&(i<0&&this._startAt&&!this._onUpdate&&this._startAt.render(i,!0,!0),(i||!c)&&(u===this._tDur&&this._ts>0||!u&&this._ts<0)&&$r(this,1),!r&&!(i<0&&!o)&&(u||o)&&($n(this,u===l?"onComplete":"onReverseComplete",!0),this._prom&&!(u<l&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(){return this._pt=this._op=this._startAt=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(),a.prototype.invalidate.call(this)},t.kill=function(i,r){if(r===void 0&&(r="all"),!i&&(!r||r==="all"))return this._lazy=this._pt=0,this.parent?Wl(this):this;if(this.timeline){var s=this.timeline.totalDuration();return this.timeline.killTweensOf(i,r,Kr&&Kr.vars.overwrite!==!0)._first||Wl(this),this.parent&&s!==this.timeline.totalDuration()&&wa(this,this._dur*this.timeline._tDur/s,0,1),this}var o=this._targets,l=i?Jn(i):o,c=this._ptLookup,u=this._pt,f,h,d,p,m,v,x;if((!r||r==="all")&&f3(o,l))return r==="all"&&(this._pt=0),Wl(this);for(f=this._op=this._op||[],r!=="all"&&($t(r)&&(m={},_n(r,function(g){return m[g]=1}),r=m),r=z3(o,r)),x=o.length;x--;)if(~l.indexOf(o[x])){h=c[x],r==="all"?(f[x]=r,p=h,d={}):(d=f[x]=f[x]||{},p=r);for(m in p)v=h&&h[m],v&&((!("kill"in v.d)||v.d.kill(m)===!0)&&_u(this,v,"_pt"),delete h[m]),d!=="all"&&(d[m]=1)}return this._initted&&!this._pt&&u&&Wl(this),this},e.to=function(i,r){return new e(i,r,arguments[2])},e.from=function(i,r){return Vl(1,arguments)},e.delayedCall=function(i,r,s,o){return new e(r,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:i,onComplete:r,onReverseComplete:r,onCompleteParams:s,onReverseCompleteParams:s,callbackScope:o})},e.fromTo=function(i,r,s){return Vl(2,arguments)},e.set=function(i,r){return r.duration=0,r.repeatDelay||(r.repeat=0),new e(i,r)},e.killTweensOf=function(i,r,s){return wt.killTweensOf(i,r,s)},e}(jl);Yn(kt.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});_n("staggerTo,staggerFrom,staggerFromTo",function(a){kt[a]=function(){var e=new an,t=sm.call(arguments,0);return t.splice(a==="staggerFromTo"?5:4,0,0),e[a].apply(e,t)}});var pm=function(e,t,n){return e[t]=n},dw=function(e,t,n){return e[t](n)},V3=function(e,t,n,i){return e[t](i.fp,n)},H3=function(e,t,n){return e.setAttribute(t,n)},Su=function(e,t){return Xt(e[t])?dw:pu(e[t])&&e.setAttribute?H3:pm},pw=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},G3=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},mm=function(e,t){var n=t._pt,i="";if(!e&&t.b)i=t.b;else if(e===1&&t.e)i=t.e;else{for(;n;)i=n.p+(n.m?n.m(n.s+n.c*e):Math.round((n.s+n.c*e)*1e4)/1e4)+i,n=n._next;i+=t.c}t.set(t.t,t.p,i,t)},gm=function(e,t){for(var n=t._pt;n;)n.r(e,n.d),n=n._next},W3=function(e,t,n,i){for(var r=this._pt,s;r;)s=r._next,r.p===i&&r.modifier(e,t,n),r=s},X3=function(e){for(var t=this._pt,n,i;t;)i=t._next,t.p===e&&!t.op||t.op===e?_u(this,t,"_pt"):t.dep||(n=1),t=i;return!n},j3=function(e,t,n,i){i.mSet(e,t,i.m.call(i.tween,n,i.mt),i)},xm=function(e){for(var t=e._pt,n,i,r,s;t;){for(n=t._next,i=r;i&&i.pr>t.pr;)i=i._next;(t._prev=i?i._prev:s)?t._prev._next=t:r=t,(t._next=i)?i._prev=t:s=t,t=n}e._pt=r},pn=function(){function a(t,n,i,r,s,o,l,c,u){this.t=n,this.s=r,this.c=s,this.p=i,this.r=o||pw,this.d=l||this,this.set=c||pm,this.pr=u||0,this._next=t,t&&(t._prev=this)}var e=a.prototype;return e.modifier=function(n,i,r){this.mSet=this.mSet||this.set,this.set=j3,this.m=n,this.mt=r,this.tween=i},a}();_n(Kp+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(a){return Jp[a]=1});Dn.TweenMax=Dn.TweenLite=kt;Dn.TimelineLite=Dn.TimelineMax=an;wt=new an({sortChildren:!1,defaults:ga,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});dn.stringFilter=lm;var Tu={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(function(i){return C3(i)})},timeline:function(e){return new an(e)},getTweensOf:function(e,t){return wt.getTweensOf(e,t)},getProperty:function(e,t,n,i){$t(e)&&(e=Jn(e)[0]);var r=Jr(e||{}).get,s=n?W1:G1;return n==="native"&&(n=""),e&&(t?s((wn[t]&&wn[t].get||r)(e,t,n,i)):function(o,l,c){return s((wn[o]&&wn[o].get||r)(e,o,l,c))})},quickSetter:function(e,t,n){if(e=Jn(e),e.length>1){var i=e.map(function(u){return Qn.quickSetter(u,t,n)}),r=i.length;return function(u){for(var f=r;f--;)i[f](u)}}e=e[0]||{};var s=wn[t],o=Jr(e),l=o.harness&&(o.harness.aliases||{})[t]||t,c=s?function(u){var f=new s;_a._pt=0,f.init(e,n?u+n:u,_a,0,[e]),f.render(1,f),_a._pt&&gm(1,_a)}:o.set(e,l);return s?c:function(u){return c(e,l,n?u+n:u,o,1)}},isTweening:function(e){return wt.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=Ma(e.ease,ga.ease)),X1(ga,e||{})},config:function(e){return X1(dn,e||{})},registerEffect:function(e){var t=e.name,n=e.effect,i=e.plugins,r=e.defaults,s=e.extendTimeline;(i||"").split(",").forEach(function(o){return o&&!wn[o]&&!Dn[o]&&xu(t+" effect requires "+o+" plugin.")}),Qp[t]=function(o,l,c){return n(Jn(o),Yn(l||{},r),c)},s&&(an.prototype[t]=function(o,l,c){return this.add(Qp[t](o,hr(l)?l:(c=l)&&{},this),c)})},registerEase:function(e,t){Ze[e]=Ma(t)},parseEase:function(e,t){return arguments.length?Ma(e,t):Ze},getById:function(e){return wt.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var n=new an(e),i,r;for(n.smoothChildTiming=yn(e.smoothChildTiming),wt.remove(n),n._dp=0,n._time=n._tTime=wt._time,i=wt._first;i;)r=i._next,(t||!(!i._dur&&i instanceof kt&&i.vars.onComplete===i._targets[0]))&&Ni(n,i,i._start-i._delay),i=r;return Ni(wt,n,0),n},utils:{wrap:E3,wrapYoyo:A3,distribute:ew,random:nw,snap:tw,normalize:T3,getUnit:bn,clamp:w3,splitColor:ow,toArray:Jn,selector:b3,mapRange:rw,pipe:M3,unitize:S3,interpolate:P3,shuffle:K1},install:k1,effects:Qp,ticker:Fn,updateRoot:an.updateRoot,plugins:wn,globalTimeline:wt,core:{PropTween:pn,globals:z1,Tween:kt,Timeline:an,Animation:jl,getCache:Jr,_removeLinkedListItem:_u,suppressOverwrites:function(e){return Hp=e}}};_n("to,from,fromTo,delayedCall,set,killTweensOf",function(a){return Tu[a]=kt[a]});Fn.add(an.updateRoot);_a=Tu.to({},{duration:0});var q3=function(e,t){for(var n=e._pt;n&&n.p!==t&&n.op!==t&&n.fp!==t;)n=n._next;return n},Y3=function(e,t){var n=e._targets,i,r,s;for(i in t)for(r=n.length;r--;)s=e._ptLookup[r][i],s&&(s=s.d)&&(s._pt&&(s=q3(s,i)),s&&s.modifier&&s.modifier(t[i],e,n[r],i))},vm=function(e,t){return{name:e,rawVars:1,init:function(i,r,s){s._onInit=function(o){var l,c;if($t(r)&&(l={},_n(r,function(u){return l[u]=1}),r=l),t){l={};for(c in r)l[c]=t(r[c]);r=l}Y3(o,r)}}}},Qn=Tu.registerPlugin({name:"attr",init:function(e,t,n,i,r){var s,o;for(s in t)o=this.add(e,"setAttribute",(e.getAttribute(s)||0)+"",t[s],i,r,0,0,s),o&&(o.op=s),this._props.push(s)}},{name:"endArray",init:function(e,t){for(var n=t.length;n--;)this.add(e,n,e[n]||0,t[n])}},vm("roundProps",om),vm("modifiers"),vm("snap",tw))||Tu;kt.version=an.version=Qn.version="3.7.1";O1=1;D1()&&ba();var Z3=Ze.Power0,J3=Ze.Power1,$3=Ze.Power2,Q3=Ze.Power3,K3=Ze.Power4,eP=Ze.Linear,tP=Ze.Quad,nP=Ze.Cubic,iP=Ze.Quart,rP=Ze.Quint,sP=Ze.Strong,oP=Ze.Elastic,aP=Ze.Back,lP=Ze.SteppedEase,cP=Ze.Bounce,hP=Ze.Sine,uP=Ze.Expo,fP=Ze.Circ;var mw,es,Sa,ym,qs,dP,gw,pP=function(){return typeof window!="undefined"},ts={},Ys=180/Math.PI,Ta=Math.PI/180,Ea=Math.atan2,xw=1e8,vw=/([A-Z])/g,mP=/(?:left|right|width|margin|padding|x)/i,gP=/[\s,\(]\S/,ns={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},yw=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},xP=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},vP=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},yP=function(e,t){var n=t.s+t.c*e;t.set(t.t,t.p,~~(n+(n<0?-.5:.5))+t.u,t)},ww=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},_w=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},wP=function(e,t,n){return e.style[t]=n},_P=function(e,t,n){return e.style.setProperty(t,n)},bP=function(e,t,n){return e._gsap[t]=n},MP=function(e,t,n){return e._gsap.scaleX=e._gsap.scaleY=n},SP=function(e,t,n,i,r){var s=e._gsap;s.scaleX=s.scaleY=n,s.renderTransform(r,s)},TP=function(e,t,n,i,r){var s=e._gsap;s[t]=n,s.renderTransform(r,s)},Qt="transform",is=Qt+"Origin",bw,wm=function(e,t){var n=es.createElementNS?es.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):es.createElement(e);return n.style?n:es.createElement(e)},fr=function a(e,t,n){var i=getComputedStyle(e);return i[t]||i.getPropertyValue(t.replace(vw,"-$1").toLowerCase())||i.getPropertyValue(t)||!n&&a(e,Aa(t)||t,1)||""},Mw="O,Moz,ms,Ms,Webkit".split(","),Aa=function(e,t,n){var i=t||qs,r=i.style,s=5;if(e in r&&!n)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);s--&&!(Mw[s]+e in r););return s<0?null:(s===3?"ms":s>=0?Mw[s]:"")+e},_m=function(){pP()&&window.document&&(mw=window,es=mw.document,Sa=es.documentElement,qs=wm("div")||{style:{}},dP=wm("div"),Qt=Aa(Qt),is=Qt+"Origin",qs.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",bw=!!Aa("perspective"),ym=1)},bm=function a(e){var t=wm("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),n=this.parentNode,i=this.nextSibling,r=this.style.cssText,s;if(Sa.appendChild(t),t.appendChild(this),this.style.display="block",e)try{s=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=a}catch(o){}else this._gsapBBox&&(s=this._gsapBBox());return n&&(i?n.insertBefore(this,i):n.appendChild(this)),Sa.removeChild(t),this.style.cssText=r,s},Sw=function(e,t){for(var n=t.length;n--;)if(e.hasAttribute(t[n]))return e.getAttribute(t[n])},Tw=function(e){var t;try{t=e.getBBox()}catch(n){t=bm.call(e,!0)}return t&&(t.width||t.height)||e.getBBox===bm||(t=bm.call(e,!0)),t&&!t.width&&!t.x&&!t.y?{x:+Sw(e,["x","cx","x1"])||0,y:+Sw(e,["y","cy","y1"])||0,width:0,height:0}:t},Ew=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&Tw(e))},Yl=function(e,t){if(t){var n=e.style;t in ts&&t!==is&&(t=Qt),n.removeProperty?((t.substr(0,2)==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),n.removeProperty(t.replace(vw,"-$1").toLowerCase())):n.removeAttribute(t)}},rs=function(e,t,n,i,r,s){var o=new pn(e._pt,t,n,0,1,s?_w:ww);return e._pt=o,o.b=i,o.e=r,e._props.push(n),o},Aw={deg:1,rad:1,turn:1},ss=function a(e,t,n,i){var r=parseFloat(n)||0,s=(n+"").trim().substr((r+"").length)||"px",o=qs.style,l=mP.test(t),c=e.tagName.toLowerCase()==="svg",u=(c?"client":"offset")+(l?"Width":"Height"),f=100,h=i==="px",d=i==="%",p,m,v,x;return i===s||!r||Aw[i]||Aw[s]?r:(s!=="px"&&!h&&(r=a(e,t,n,"px")),x=e.getCTM&&Ew(e),(d||s==="%")&&(ts[t]||~t.indexOf("adius"))?(p=x?e.getBBox()[l?"width":"height"]:e[u],je(d?r/p*f:r/100*p)):(o[l?"width":"height"]=f+(h?s:i),m=~t.indexOf("adius")||i==="em"&&e.appendChild&&!c?e:e.parentNode,x&&(m=(e.ownerSVGElement||{}).parentNode),(!m||m===es||!m.appendChild)&&(m=es.body),v=m._gsap,v&&d&&v.width&&l&&v.time===Fn.time?je(r/v.width*f):((d||s==="%")&&(o.position=fr(e,"position")),m===e&&(o.position="static"),m.appendChild(qs),p=qs[u],m.removeChild(qs),o.position="absolute",l&&d&&(v=Jr(m),v.time=Fn.time,v.width=m[u]),je(h?p*r/f:p&&r?f/p*r:0))))},Pa=function(e,t,n,i){var r;return ym||_m(),t in ns&&t!=="transform"&&(t=ns[t],~t.indexOf(",")&&(t=t.split(",")[0])),ts[t]&&t!=="transform"?(r=Jl(e,i),r=t!=="transformOrigin"?r[t]:r.svg?r.origin:Au(fr(e,is))+" "+r.zOrigin+"px"):(r=e.style[t],(!r||r==="auto"||i||~(r+"").indexOf("calc("))&&(r=Eu[t]&&Eu[t](e,t,n)||fr(e,t)||tm(e,t)||(t==="opacity"?1:0))),n&&!~(r+"").trim().indexOf(" ")?ss(e,t,r,n)+n:r},EP=function(e,t,n,i){if(!n||n==="none"){var r=Aa(t,e,1),s=r&&fr(e,r,1);s&&s!==n?(t=r,n=s):t==="borderColor"&&(n=fr(e,"borderTopColor"))}var o=new pn(this._pt,e.style,t,0,1,mm),l=0,c=0,u,f,h,d,p,m,v,x,g,y,_,w,b;if(o.b=n,o.e=i,n+="",i+="",i==="auto"&&(e.style[t]=i,i=fr(e,t)||i,e.style[t]=n),u=[n,i],lm(u),n=u[0],i=u[1],h=n.match(Ws)||[],b=i.match(Ws)||[],b.length){for(;f=Ws.exec(i);)v=f[0],g=i.substring(l,f.index),p?p=(p+1)%5:(g.substr(-5)==="rgba("||g.substr(-5)==="hsla(")&&(p=1),v!==(m=h[c++]||"")&&(d=parseFloat(m)||0,_=m.substr((d+"").length),w=v.charAt(1)==="="?+(v.charAt(0)+"1"):0,w&&(v=v.substr(2)),x=parseFloat(v),y=v.substr((x+"").length),l=Ws.lastIndex-y.length,y||(y=y||dn.units[t]||_,l===i.length&&(i+=y,o.e+=y)),_!==y&&(d=ss(e,t,m,y)||0),o._pt={_next:o._pt,p:g||c===1?g:",",s:d,c:w?w*x:x-d,m:p&&p<4||t==="zIndex"?Math.round:0});o.c=l<i.length?i.substring(l,i.length):""}else o.r=t==="display"&&i==="none"?_w:ww;return qp.test(i)&&(o.e=0),this._pt=o,o},Pw={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},AP=function(e){var t=e.split(" "),n=t[0],i=t[1]||"50%";return(n==="top"||n==="bottom"||i==="left"||i==="right")&&(e=n,n=i,i=e),t[0]=Pw[n]||n,t[1]=Pw[i]||i,t.join(" ")},PP=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var n=t.t,i=n.style,r=t.u,s=n._gsap,o,l,c;if(r==="all"||r===!0)i.cssText="",l=1;else for(r=r.split(","),c=r.length;--c>-1;)o=r[c],ts[o]&&(l=1,o=o==="transformOrigin"?is:Qt),Yl(n,o);l&&(Yl(n,Qt),s&&(s.svg&&n.removeAttribute("transform"),Jl(n,1),s.uncache=1))}},Eu={clearProps:function(e,t,n,i,r){if(r.data!=="isFromStart"){var s=e._pt=new pn(e._pt,t,n,0,0,PP);return s.u=i,s.pr=-10,s.tween=r,e._props.push(n),1}}},Zl=[1,0,0,1,0,0],Cw={},Lw=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},Rw=function(e){var t=fr(e,Qt);return Lw(t)?Zl:t.substr(7).match(Xp).map(je)},Mm=function(e,t){var n=e._gsap||Jr(e),i=e.style,r=Rw(e),s,o,l,c;return n.svg&&e.getAttribute("transform")?(l=e.transform.baseVal.consolidate().matrix,r=[l.a,l.b,l.c,l.d,l.e,l.f],r.join(",")==="1,0,0,1,0,0"?Zl:r):(r===Zl&&!e.offsetParent&&e!==Sa&&!n.svg&&(l=i.display,i.display="block",s=e.parentNode,(!s||!e.offsetParent)&&(c=1,o=e.nextSibling,Sa.appendChild(e)),r=Rw(e),l?i.display=l:Yl(e,"display"),c&&(o?s.insertBefore(e,o):s?s.appendChild(e):Sa.removeChild(e))),t&&r.length>6?[r[0],r[1],r[4],r[5],r[12],r[13]]:r)},Sm=function(e,t,n,i,r,s){var o=e._gsap,l=r||Mm(e,!0),c=o.xOrigin||0,u=o.yOrigin||0,f=o.xOffset||0,h=o.yOffset||0,d=l[0],p=l[1],m=l[2],v=l[3],x=l[4],g=l[5],y=t.split(" "),_=parseFloat(y[0])||0,w=parseFloat(y[1])||0,b,S,M,T;n?l!==Zl&&(S=d*v-p*m)&&(M=_*(v/S)+w*(-m/S)+(m*g-v*x)/S,T=_*(-p/S)+w*(d/S)-(d*g-p*x)/S,_=M,w=T):(b=Tw(e),_=b.x+(~y[0].indexOf("%")?_/100*b.width:_),w=b.y+(~(y[1]||y[0]).indexOf("%")?w/100*b.height:w)),i||i!==!1&&o.smooth?(x=_-c,g=w-u,o.xOffset=f+(x*d+g*m)-x,o.yOffset=h+(x*p+g*v)-g):o.xOffset=o.yOffset=0,o.xOrigin=_,o.yOrigin=w,o.smooth=!!i,o.origin=t,o.originIsAbsolute=!!n,e.style[is]="0px 0px",s&&(rs(s,o,"xOrigin",c,_),rs(s,o,"yOrigin",u,w),rs(s,o,"xOffset",f,o.xOffset),rs(s,o,"yOffset",h,o.yOffset)),e.setAttribute("data-svg-origin",_+" "+w)},Jl=function(e,t){var n=e._gsap||new um(e);if("x"in n&&!t&&!n.uncache)return n;var i=e.style,r=n.scaleX<0,s="px",o="deg",l=fr(e,is)||"0",c,u,f,h,d,p,m,v,x,g,y,_,w,b,S,M,T,E,A,I,C,R,D,F,O,U,j,Z,K,G,k,B;return c=u=f=p=m=v=x=g=y=0,h=d=1,n.svg=!!(e.getCTM&&Ew(e)),b=Mm(e,n.svg),n.svg&&(F=(!n.uncache||l==="0px 0px")&&!t&&e.getAttribute("data-svg-origin"),Sm(e,F||l,!!F||n.originIsAbsolute,n.smooth!==!1,b)),_=n.xOrigin||0,w=n.yOrigin||0,b!==Zl&&(E=b[0],A=b[1],I=b[2],C=b[3],c=R=b[4],u=D=b[5],b.length===6?(h=Math.sqrt(E*E+A*A),d=Math.sqrt(C*C+I*I),p=E||A?Ea(A,E)*Ys:0,x=I||C?Ea(I,C)*Ys+p:0,x&&(d*=Math.abs(Math.cos(x*Ta))),n.svg&&(c-=_-(_*E+w*I),u-=w-(_*A+w*C))):(B=b[6],G=b[7],j=b[8],Z=b[9],K=b[10],k=b[11],c=b[12],u=b[13],f=b[14],S=Ea(B,K),m=S*Ys,S&&(M=Math.cos(-S),T=Math.sin(-S),F=R*M+j*T,O=D*M+Z*T,U=B*M+K*T,j=R*-T+j*M,Z=D*-T+Z*M,K=B*-T+K*M,k=G*-T+k*M,R=F,D=O,B=U),S=Ea(-I,K),v=S*Ys,S&&(M=Math.cos(-S),T=Math.sin(-S),F=E*M-j*T,O=A*M-Z*T,U=I*M-K*T,k=C*T+k*M,E=F,A=O,I=U),S=Ea(A,E),p=S*Ys,S&&(M=Math.cos(S),T=Math.sin(S),F=E*M+A*T,O=R*M+D*T,A=A*M-E*T,D=D*M-R*T,E=F,R=O),m&&Math.abs(m)+Math.abs(p)>359.9&&(m=p=0,v=180-v),h=je(Math.sqrt(E*E+A*A+I*I)),d=je(Math.sqrt(D*D+B*B)),S=Ea(R,D),x=Math.abs(S)>2e-4?S*Ys:0,y=k?1/(k<0?-k:k):0),n.svg&&(F=e.getAttribute("transform"),n.forceCSS=e.setAttribute("transform","")||!Lw(fr(e,Qt)),F&&e.setAttribute("transform",F))),Math.abs(x)>90&&Math.abs(x)<270&&(r?(h*=-1,x+=p<=0?180:-180,p+=p<=0?180:-180):(d*=-1,x+=x<=0?180:-180)),n.x=c-((n.xPercent=c&&(n.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-c)?-50:0)))?e.offsetWidth*n.xPercent/100:0)+s,n.y=u-((n.yPercent=u&&(n.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-u)?-50:0)))?e.offsetHeight*n.yPercent/100:0)+s,n.z=f+s,n.scaleX=je(h),n.scaleY=je(d),n.rotation=je(p)+o,n.rotationX=je(m)+o,n.rotationY=je(v)+o,n.skewX=x+o,n.skewY=g+o,n.transformPerspective=y+s,(n.zOrigin=parseFloat(l.split(" ")[2])||0)&&(i[is]=Au(l)),n.xOffset=n.yOffset=0,n.force3D=dn.force3D,n.renderTransform=n.svg?LP:bw?Iw:CP,n.uncache=0,n},Au=function(e){return(e=e.split(" "))[0]+" "+e[1]},Tm=function(e,t,n){var i=bn(t);return je(parseFloat(t)+parseFloat(ss(e,"x",n+"px",i)))+i},CP=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,Iw(e,t)},Zs="0deg",$l="0px",Js=") ",Iw=function(e,t){var n=t||this,i=n.xPercent,r=n.yPercent,s=n.x,o=n.y,l=n.z,c=n.rotation,u=n.rotationY,f=n.rotationX,h=n.skewX,d=n.skewY,p=n.scaleX,m=n.scaleY,v=n.transformPerspective,x=n.force3D,g=n.target,y=n.zOrigin,_="",w=x==="auto"&&e&&e!==1||x===!0;if(y&&(f!==Zs||u!==Zs)){var b=parseFloat(u)*Ta,S=Math.sin(b),M=Math.cos(b),T;b=parseFloat(f)*Ta,T=Math.cos(b),s=Tm(g,s,S*T*-y),o=Tm(g,o,-Math.sin(b)*-y),l=Tm(g,l,M*T*-y+y)}v!==$l&&(_+="perspective("+v+Js),(i||r)&&(_+="translate("+i+"%, "+r+"%) "),(w||s!==$l||o!==$l||l!==$l)&&(_+=l!==$l||w?"translate3d("+s+", "+o+", "+l+") ":"translate("+s+", "+o+Js),c!==Zs&&(_+="rotate("+c+Js),u!==Zs&&(_+="rotateY("+u+Js),f!==Zs&&(_+="rotateX("+f+Js),(h!==Zs||d!==Zs)&&(_+="skew("+h+", "+d+Js),(p!==1||m!==1)&&(_+="scale("+p+", "+m+Js),g.style[Qt]=_||"translate(0, 0)"},LP=function(e,t){var n=t||this,i=n.xPercent,r=n.yPercent,s=n.x,o=n.y,l=n.rotation,c=n.skewX,u=n.skewY,f=n.scaleX,h=n.scaleY,d=n.target,p=n.xOrigin,m=n.yOrigin,v=n.xOffset,x=n.yOffset,g=n.forceCSS,y=parseFloat(s),_=parseFloat(o),w,b,S,M,T;l=parseFloat(l),c=parseFloat(c),u=parseFloat(u),u&&(u=parseFloat(u),c+=u,l+=u),l||c?(l*=Ta,c*=Ta,w=Math.cos(l)*f,b=Math.sin(l)*f,S=Math.sin(l-c)*-h,M=Math.cos(l-c)*h,c&&(u*=Ta,T=Math.tan(c-u),T=Math.sqrt(1+T*T),S*=T,M*=T,u&&(T=Math.tan(u),T=Math.sqrt(1+T*T),w*=T,b*=T)),w=je(w),b=je(b),S=je(S),M=je(M)):(w=f,M=h,b=S=0),(y&&!~(s+"").indexOf("px")||_&&!~(o+"").indexOf("px"))&&(y=ss(d,"x",s,"px"),_=ss(d,"y",o,"px")),(p||m||v||x)&&(y=je(y+p-(p*w+m*S)+v),_=je(_+m-(p*b+m*M)+x)),(i||r)&&(T=d.getBBox(),y=je(y+i/100*T.width),_=je(_+r/100*T.height)),T="matrix("+w+","+b+","+S+","+M+","+y+","+_+")",d.setAttribute("transform",T),g&&(d.style[Qt]=T)},RP=function(e,t,n,i,r,s){var o=360,l=$t(r),c=parseFloat(r)*(l&&~r.indexOf("rad")?Ys:1),u=s?c*s:c-i,f=i+u+"deg",h,d;return l&&(h=r.split("_")[1],h==="short"&&(u%=o,u!==u%(o/2)&&(u+=u<0?o:-o)),h==="cw"&&u<0?u=(u+o*xw)%o-~~(u/o)*o:h==="ccw"&&u>0&&(u=(u-o*xw)%o-~~(u/o)*o)),e._pt=d=new pn(e._pt,t,n,i,u,xP),d.e=f,d.u="deg",e._props.push(n),d},Dw=function(e,t){for(var n in t)e[n]=t[n];return e},IP=function(e,t,n){var i=Dw({},n._gsap),r="perspective,force3D,transformOrigin,svgOrigin",s=n.style,o,l,c,u,f,h,d,p;i.svg?(c=n.getAttribute("transform"),n.setAttribute("transform",""),s[Qt]=t,o=Jl(n,1),Yl(n,Qt),n.setAttribute("transform",c)):(c=getComputedStyle(n)[Qt],s[Qt]=t,o=Jl(n,1),s[Qt]=c);for(l in ts)c=i[l],u=o[l],c!==u&&r.indexOf(l)<0&&(d=bn(c),p=bn(u),f=d!==p?ss(n,l,c,p):parseFloat(c),h=parseFloat(u),e._pt=new pn(e._pt,o,l,f,h-f,yw),e._pt.u=p||0,e._props.push(l));Dw(o,i)};_n("padding,margin,Width,Radius",function(a,e){var t="Top",n="Right",i="Bottom",r="Left",s=(e<3?[t,n,i,r]:[t+r,t+n,i+n,i+r]).map(function(o){return e<2?a+o:"border"+o+a});Eu[e>1?"border"+a:a]=function(o,l,c,u,f){var h,d;if(arguments.length<4)return h=s.map(function(p){return Pa(o,p,c)}),d=h.join(" "),d.split(h[0]).length===5?h[0]:d;h=(u+"").split(" "),d={},s.forEach(function(p,m){return d[p]=h[m]=h[m]||h[(m-1)/2|0]}),o.init(l,d,f)}});var Em={name:"css",register:_m,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,n,i,r){var s=this._props,o=e.style,l=n.vars.startAt,c,u,f,h,d,p,m,v,x,g,y,_,w,b,S;ym||_m();for(m in t)if(m!=="autoRound"&&(u=t[m],!(wn[m]&&dm(m,t,n,i,e,r)))){if(d=typeof u,p=Eu[m],d==="function"&&(u=u.call(n,i,e,r),d=typeof u),d==="string"&&~u.indexOf("random(")&&(u=Gl(u)),p)p(this,e,m,u,n)&&(S=1);else if(m.substr(0,2)==="--")c=(getComputedStyle(e).getPropertyValue(m)+"").trim(),u+="",ur.lastIndex=0,ur.test(c)||(v=bn(c),x=bn(u)),x?v!==x&&(c=ss(e,m,c,x)+x):v&&(u+=v),this.add(o,"setProperty",c,u,i,r,0,0,m),s.push(m);else if(d!=="undefined"){if(l&&m in l?(c=typeof l[m]=="function"?l[m].call(n,i,e,r):l[m],m in dn.units&&!bn(c)&&(c+=dn.units[m]),(c+"").charAt(1)==="="&&(c=Pa(e,m))):c=Pa(e,m),h=parseFloat(c),g=d==="string"&&u.charAt(1)==="="?+(u.charAt(0)+"1"):0,g&&(u=u.substr(2)),f=parseFloat(u),m in ns&&(m==="autoAlpha"&&(h===1&&Pa(e,"visibility")==="hidden"&&f&&(h=0),rs(this,o,"visibility",h?"inherit":"hidden",f?"inherit":"hidden",!f)),m!=="scale"&&m!=="transform"&&(m=ns[m],~m.indexOf(",")&&(m=m.split(",")[0]))),y=m in ts,y){if(_||(w=e._gsap,w.renderTransform&&!t.parseTransform||Jl(e,t.parseTransform),b=t.smoothOrigin!==!1&&w.smooth,_=this._pt=new pn(this._pt,o,Qt,0,1,w.renderTransform,w,0,-1),_.dep=1),m==="scale")this._pt=new pn(this._pt,w,"scaleY",w.scaleY,(g?g*f:f-w.scaleY)||0),s.push("scaleY",m),m+="X";else if(m==="transformOrigin"){u=AP(u),w.svg?Sm(e,u,0,b,0,this):(x=parseFloat(u.split(" ")[2])||0,x!==w.zOrigin&&rs(this,w,"zOrigin",w.zOrigin,x),rs(this,o,m,Au(c),Au(u)));continue}else if(m==="svgOrigin"){Sm(e,u,1,b,0,this);continue}else if(m in Cw){RP(this,w,m,h,u,g);continue}else if(m==="smoothOrigin"){rs(this,w,"smooth",w.smooth,u);continue}else if(m==="force3D"){w[m]=u;continue}else if(m==="transform"){IP(this,u,e);continue}}else m in o||(m=Aa(m)||m);if(y||(f||f===0)&&(h||h===0)&&!gP.test(u)&&m in o)v=(c+"").substr((h+"").length),f||(f=0),x=bn(u)||(m in dn.units?dn.units[m]:v),v!==x&&(h=ss(e,m,c,x)),this._pt=new pn(this._pt,y?w:o,m,h,g?g*f:f-h,!y&&(x==="px"||m==="zIndex")&&t.autoRound!==!1?yP:yw),this._pt.u=x||0,v!==x&&(this._pt.b=c,this._pt.r=vP);else if(m in o)EP.call(this,e,m,c,u);else if(m in e)this.add(e,m,c||e[m],u,i,r);else{gu(m,u);continue}s.push(m)}}S&&xm(this)},get:Pa,aliases:ns,getSetter:function(e,t,n){var i=ns[t];return i&&i.indexOf(",")<0&&(t=i),t in ts&&t!==is&&(e._gsap.x||Pa(e,"x"))?n&&gw===n?t==="scale"?MP:bP:(gw=n||{})&&(t==="scale"?SP:TP):e.style&&!pu(e.style[t])?wP:~t.indexOf("-")?_P:Su(e,t)},core:{_removeProperty:Yl,_getMatrix:Mm}};Qn.utils.checkPrefix=Aa;(function(a,e,t,n){var i=_n(a+","+e+","+t,function(r){ts[r]=1});_n(e,function(r){dn.units[r]="deg",Cw[r]=1}),ns[i[13]]=a+","+e,_n(n,function(r){var s=r.split(":");ns[s[1]]=i[s[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");_n("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(a){dn.units[a]="px"});Qn.registerPlugin(Em);var Oi=Qn.registerPlugin(Em)||Qn,OF=Oi.core.Tween;var DP=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function FP(a,e){return e={exports:{}},a(e,e.exports),e.exports}var Nw=FP(function(a){(function(e,t){var n=Math.pow(2,-24),i=Math.pow(2,32),r=Math.pow(2,53);function s(c){var u=new ArrayBuffer(256),f=new DataView(u),h,d=0;function p(A){for(var I=u.byteLength,C=d+A;I<C;)I*=2;if(I!==u.byteLength){var R=f;u=new ArrayBuffer(I),f=new DataView(u);for(var D=d+3>>2,F=0;F<D;++F)f.setUint32(F*4,R.getUint32(F*4))}return h=A,f}function m(){d+=h}function v(A){m(p(8).setFloat64(d,A))}function x(A){m(p(1).setUint8(d,A))}function g(A){for(var I=p(A.length),C=0;C<A.length;++C)I.setUint8(d+C,A[C]);m()}function y(A){m(p(2).setUint16(d,A))}function _(A){m(p(4).setUint32(d,A))}function w(A){var I=A%i,C=(A-I)/i,R=p(8);R.setUint32(d,C),R.setUint32(d+4,I),m()}function b(A,I){I<24?x(A<<5|I):I<256?(x(A<<5|24),x(I)):I<65536?(x(A<<5|25),y(I)):I<4294967296?(x(A<<5|26),_(I)):(x(A<<5|27),w(I))}function S(A){var I;if(A===!1)return x(244);if(A===!0)return x(245);if(A===null)return x(246);if(A===t)return x(247);switch(typeof A){case"number":if(Math.floor(A)===A){if(0<=A&&A<=r)return b(0,A);if(-r<=A&&A<0)return b(1,-(A+1))}return x(251),v(A);case"string":var C=[];for(I=0;I<A.length;++I){var R=A.charCodeAt(I);R<128?C.push(R):R<2048?(C.push(192|R>>6),C.push(128|R&63)):R<55296?(C.push(224|R>>12),C.push(128|R>>6&63),C.push(128|R&63)):(R=(R&1023)<<10,R|=A.charCodeAt(++I)&1023,R+=65536,C.push(240|R>>18),C.push(128|R>>12&63),C.push(128|R>>6&63),C.push(128|R&63))}return b(3,C.length),g(C);default:var D;if(Array.isArray(A))for(D=A.length,b(4,D),I=0;I<D;++I)S(A[I]);else if(A instanceof Uint8Array)b(2,A.length),g(A);else{var F=Object.keys(A);for(D=F.length,b(5,D),I=0;I<D;++I){var O=F[I];S(O),S(A[O])}}}}if(S(c),"slice"in u)return u.slice(0,d);for(var M=new ArrayBuffer(d),T=new DataView(M),E=0;E<d;++E)T.setUint8(E,f.getUint8(E));return M}function o(c,u,f){var h=new DataView(c),d=0;typeof u!="function"&&(u=function(C){return C}),typeof f!="function"&&(f=function(){return t});function p(C,R){return d+=R,C}function m(C){return p(new Uint8Array(c,d,C),C)}function v(){var C=new ArrayBuffer(4),R=new DataView(C),D=_(),F=D&32768,O=D&31744,U=D&1023;if(O===31744)O=255<<10;else if(O!==0)O+=127-15<<10;else if(U!==0)return U*n;return R.setUint32(0,F<<16|O<<13|U<<13),R.getFloat32(0)}function x(){return p(h.getFloat32(d),4)}function g(){return p(h.getFloat64(d),8)}function y(){return p(h.getUint8(d),1)}function _(){return p(h.getUint16(d),2)}function w(){return p(h.getUint32(d),4)}function b(){return w()*i+w()}function S(){return h.getUint8(d)!==255?!1:(d+=1,!0)}function M(C){if(C<24)return C;if(C===24)return y();if(C===25)return _();if(C===26)return w();if(C===27)return b();if(C===31)return-1;throw"Invalid length encoding"}function T(C){var R=y();if(R===255)return-1;var D=M(R&31);if(D<0||R>>5!==C)throw"Invalid indefinite length element";return D}function E(C,R){for(var D=0;D<R;++D){var F=y();F&128&&(F<224?(F=(F&31)<<6|y()&63,R-=1):F<240?(F=(F&15)<<12|(y()&63)<<6|y()&63,R-=2):(F=(F&15)<<18|(y()&63)<<12|(y()&63)<<6|y()&63,R-=3)),F<65536?C.push(F):(F-=65536,C.push(55296|F>>10),C.push(56320|F&1023))}}function A(){var C=y(),R=C>>5,D=C&31,F,O;if(R===7)switch(D){case 25:return v();case 26:return x();case 27:return g()}if(O=M(D),O<0&&(R<2||6<R))throw"Invalid length";switch(R){case 0:return O;case 1:return-1-O;case 2:if(O<0){for(var U=[],j=0;(O=T(R))>=0;)j+=O,U.push(m(O));var Z=new Uint8Array(j),K=0;for(F=0;F<U.length;++F)Z.set(U[F],K),K+=U[F].length;return Z}return m(O);case 3:var G=[];if(O<0)for(;(O=T(R))>=0;)E(G,O);else E(G,O);return String.fromCharCode.apply(null,G);case 4:var k;if(O<0)for(k=[];!S();)k.push(A());else for(k=new Array(O),F=0;F<O;++F)k[F]=A();return k;case 5:var B={};for(F=0;F<O||O<0&&!S();++F){var H=A();B[H]=A()}return B;case 6:return u(A(),O);case 7:switch(O){case 20:return!1;case 21:return!0;case 22:return null;case 23:return t;default:return f(O)}}}var I=A();if(d!==c.byteLength)throw"Remaining bytes";return I}var l={encode:s,decode:o};typeof t=="function"&&t.amd?t("cbor/cbor",l):a.exports?a.exports=l:e.CBOR||(e.CBOR=l)})(DP)});var BP=typeof window=="undefined"?Bw():window.WebSocket,Ow=class{constructor(e,t,n,i=!1,r,s,o){this.reqs=[],this.reps=[],this.requestId=this.getRequestId(),this.debug=i,this.isGreedy=s,this.errCallback=t,this.closeCallback=n,this.alwaysdebug=!1,this.isConnected=!1;let l=null;r||s||o?l=new kw(r,s,o,this.debug):(i&&(this.alwaysdebug=!0),typeof e=="function"&&(l=new zw)),this.openWebsocket(l,e)}sendMessage(e,t=60){this.alwaysdebug&&(e.cmd.debug=!0);let n=e.toCbor();return this.sendRequestObj(n,t)}disconnect(){this.ws.close()}openWebsocket(e=null,t=null){this.ws=new BP("ws://localhost:11222/driver",["rep.sp.nanomsg.org"]),this.ws.parent=this,this.ws.binaryType="arraybuffer",this.ws.onmessage=this.messageHandler,this.ws.onopen=()=>{this.isConnected=!0,this.debug&&console.log("socket open"),e!=null&&this.sendMessage(e).then(t)},this.ws.onerror=this.onSocketError,this.ws.onclose=this.onClose}sendRequestObj(e,t){return new Promise((n,i)=>{let r={id:this.requestId++,parent:this,payload:e,success:n,error:i,send:function(){this.debug&&console.log("attemtping to send request with ID "+this.id),this.timeout=setTimeout(r.send.bind(this),t*1e3);let s=new Uint8Array(e.byteLength+4);new DataView(s.buffer).setUint32(0,this.id),s.set(new Uint8Array(this.payload),4),this.parent.ws.send(s.buffer)}};this.reqs.push(r),r.send()})}messageHandler(e){console.log("message");let t=e.data;if(t.byteLength<4)return;let i=new DataView(t).getUint32(0);if(i<2147483648){this.parent.err("bad nng header");return}let r=this.parent.findReqIndex(i);if(r==-1){this.parent.err("got reply that doesn't match known request!");return}let s={id:i,payload:Nw.decode(t.slice(4))};s.payload.error==0?this.parent.reqs[r].success(s.payload):this.parent.reqs[r].error(s.payload),clearTimeout(this.parent.reqs[r].timeout),this.parent.reqs.splice(r,1),this.parent.reps.push(s),this.debug&&console.log(s.payload)}getRequestId(){return Math.floor(this.prng()*2147483647)+2147483648}onClose(e){this.parent.isConnected=!1,this.parent.debug&&console.log("socket closed"),typeof this.parent.closeCallback=="function"&&this.parent.closeCallback(e)}onSocketError(e){this.parent.debug&&console.log(e),typeof this.parent.errCallback=="function"&&this.parent.errCallback(e)}err(e){this.debug&&console.log("[DRIVER ERROR]"+e)}findReqIndex(e){let t=0;for(;t<this.reqs.length;t++)if(this.reqs[t].id==e)return t;return-1}prng(){return this.rng==null&&(this.rng=NP()),this.rng()}},Am=class{constructor(e,t){this.cmd=e,this.bin=t}toCbor(){return Nw.encode(this)}},kw=class extends Am{constructor(e="",t=!1,n="",i=!1){let r={init:{}};e!=""&&(r.init.appid=e),n!=""&&(r.init.onclose=n),t&&(r.init.greedy=!0),i&&(r.init.debug=!0);super(r,null)}},zw=class extends Am{constructor(){let e={info:{}};super(e,null)}};function NP(){function a(i){for(var r=0,s=1779033703^i.length;r<i.length;r++)s=Math.imul(s^i.charCodeAt(r),3432918353),s=s<<13|s>>>19;return function(){return s=Math.imul(s^s>>>16,2246822507),s=Math.imul(s^s>>>13,3266489909),(s^=s>>>16)>>>0}}function e(i,r,s,o){return()=>{var l=r<<9,c=i*5;return c=(c<<7|c>>>25)*9,s^=i,o^=r,r^=s,i^=o,s^=l,o=o<<11|o>>>21,(c>>>0)/4294967296}}var t=Date.now(),n=a(t.toString());return e(n(),n(),n(),n())}var OP={configVersion:"1.0",serial:"00000",pitch:{value:47.556365966796875},slope:{value:-5.488804340362549},center:{value:.15815216302871704},viewCone:{value:40},invView:{value:1},verticalAngle:{value:0},DPI:{value:338},screenW:{value:2560},screenH:{value:1600},flipImageX:{value:0},flipImageY:{value:0},flipSubp:{value:0}};function kP(){confirm("HoloPlayService not detected! Click OK to download. If you have it already installed, please make sure it is running.")&&(window.location.href="http://look.glass/holoplayservice")}var Pm=null;function zP(){return Pm||(Pm=new Promise((a,e)=>{new Ow(t=>{t.devices.length==0&&alert("No Looking Glass detected. Please make sure your Looking Glass is plugged in."),a(t.devices)},t=>{console.error("error loading calibration",t),kP(),e(t)},console.log)})),Pm}function Cm(){return zP().then(a=>{if(a.length==0)throw new Error("no devices");return a[0]})}function Uw(){return Cm().then(a=>a.calibration).catch(a=>(console.error("no devices connected. using default calibration."),OP))}var Vw={standard:{quiltResolution:4096,tileCount:new THREE.Vector2(5,9),viewCone:35,fov:12.5},large:{quiltResolution:4096,tileCount:new THREE.Vector2(5,9),viewCone:35,fov:12.5},pro:{quiltResolution:4096,tileCount:new THREE.Vector2(5,9),viewCone:35,fov:12.5},"8k":{quiltResolution:8192,tileCount:new THREE.Vector2(5,9),viewCone:35,fov:12.5},default:{quiltResolution:2048,tileCount:new THREE.Vector2(4,8),viewCone:35,fov:12.5}};function Pu(a){return Cm().then(e=>Vw[e.hardwareVersion][a]).catch(e=>Vw.default[a])}function UP(){return Pu("quiltResolution")}function VP(){return Pu("tileCount")}function HP(){return Pu("viewCone")}function Hw(){return Pu("fov")}var GP=`
  varying vec2 iUv;

  void main() {
    iUv = uv;
    vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);
    gl_Position = projectionMatrix * modelViewPosition;
  }
`,WP=`
  uniform sampler2D quiltTexture;
  uniform float pitch;
  uniform float tilt;
  uniform float center;
  uniform float invView; 
  uniform float flipX; 
  uniform float flipY; 
  uniform float subp; 
  uniform float tilesX;
  uniform float tilesY;
  uniform vec2 quiltViewPortion;
  varying vec2 iUv;

  vec2 texArr(vec3 uvz) {
    float z = floor(uvz.z * tilesX * tilesY);
    float x = (mod(z, tilesX) + uvz.x) / tilesX;
    float y = (floor(z / tilesX) + uvz.y) / tilesY;
    return vec2(x, y) * quiltViewPortion;
  }

  float remap(float value, float from1, float to1, float from2, float to2) {
   return (value - from1) / (to1 - from1) * (to2 - from2) + from2;
  }

  void main() {
    vec4 rgb[3];
    vec3 nuv = vec3(iUv.xy, 0.0);

    // Flip UVs if necessary
    nuv.x = (1.0 - flipX) * nuv.x + flipX * (1.0 - nuv.x);
    nuv.y = (1.0 - flipY) * nuv.y + flipY * (1.0 - nuv.y);

    for (int i = 0; i < 3; i++) {
      nuv.z = (iUv.x + float(i) * subp + iUv.y * tilt) * pitch - center;
      nuv.z = mod(nuv.z + ceil(abs(nuv.z)), 1.0);
      nuv.z = (1.0 - invView) * nuv.z + invView * (1.0 - nuv.z); 
      rgb[i] = texture2D(quiltTexture, texArr(vec3(iUv.x, iUv.y, nuv.z)));
    }

    gl_FragColor = vec4(rgb[0].r, rgb[1].g, rgb[2].b, 1);
  }
`,XP={uniforms:{quiltTexture:{value:null},pitch:{value:0},tilt:{value:0},center:{value:0},invView:{value:0},flipX:{value:0},flipY:{value:0},subp:{value:0},tilesX:{value:0},tilesY:{value:0},screenW:{value:0},screenH:{value:0},quiltViewPortion:{value:new THREE.Vector2(1,1)}},vertexShader:GP,fragmentShader:WP},Gw=class{constructor(e,t){Uw().then(r=>{this.calibrationData=r,this.updateCalibration()}),this.tileCount=e,this.scene=new THREE.Scene;let n=new THREE.PlaneGeometry(1,1),i=new THREE.ShaderMaterial(XP);this.quiltPlane=new THREE.Mesh(n,i),this.scene.add(this.quiltPlane),this.camera=new THREE.OrthographicCamera(-.5,.5,.5,-.5,0),this.renderer=t||new THREE.WebGLRenderer,this.renderSize=new THREE.Vector2(window.innerWidth,window.innerHeight),this.domElement=this.renderer.domElement,this.domElement.style.position="absolute"}render(){this.renderer.setSize(this.renderSize.x,this.renderSize.y),this.negateWindowZoomAndOffset(),this.renderer.render(this.scene,this.camera)}update(e,t){this.tileCount.copy(t),this.quiltPlane.material.uniforms.tilesX.value=this.tileCount.x,this.quiltPlane.material.uniforms.tilesY.value=this.tileCount.y,this.quiltPlane.material.uniforms.quiltViewPortion.value.set(Math.floor(e/this.tileCount.x)*this.tileCount.x/e,Math.floor(e/this.tileCount.y)*this.tileCount.y/e)}negateWindowZoomAndOffset(){let e=window.outerWidth/document.body.getBoundingClientRect().width,t=window.outerHeight-window.innerHeight;this.domElement.style.width=`${this.domElement.width/e}px`,this.domElement.style.height=`${this.domElement.height/e}px`,this.domElement.style.left=`${(window.screen.availLeft-window.screenLeft)/e}px`,this.domElement.style.top=`${-(window.screenTop+t)/e}px`}setQuiltImageURL(e){let t=new Image;t.src=e,this.setQuiltImage(t)}setQuiltImage(e){let t=new THREE.Texture;t.image=e,t.minFilter=THREE.NearestFilter,t.magFilter=THREE.NearestFilter,this.setQuiltTexture(t),e.addEventListener("load",()=>{t.needsUpdate=!0,this.render()}),e.complete&&e.load()}setQuiltTexture(e){this.quiltPlane.material.uniforms.quiltTexture.value=e}updateCalibration(){if(!this.calibrationData)return;this.renderSize.set(this.calibrationData.screenW.value,this.calibrationData.screenH.value);let e=this.quiltPlane.material,t=this.calibrationData.screenW.value/this.calibrationData.DPI.value,n=this.calibrationData.pitch.value*t;n*=Math.cos(Math.atan(1/this.calibrationData.slope.value)),e.uniforms.pitch.value=n;let i=this.calibrationData.screenH.value/(this.calibrationData.screenW.value*this.calibrationData.slope.value);this.calibrationData.flipImageX.value==1&&(i*=-1),e.uniforms.tilt.value=i,e.uniforms.center.value=this.calibrationData.center.value,e.uniforms.invView.value=this.calibrationData.invView.value,e.uniforms.flipX.value=this.calibrationData.flipImageX.value,e.uniforms.flipY.value=this.calibrationData.flipImageY.value,e.uniforms.subp.value=1/(this.calibrationData.screenW.value*3),e.uniforms.tilesX.value=this.tileCount.x,e.uniforms.tilesY.value=this.tileCount.y}};var Lm={};try{Lm.EventTarget=new EventTarget().constructor}catch(a){(function(e,t){var n=e.create,i=e.defineProperty,r=s.prototype;o(r,"addEventListener",function(c,u,f){for(var h=t.get(this),d=h[c]||(h[c]=[]),p=0,m=d.length;p<m;p++)if(d[p].listener===u)return;d.push({target:this,listener:u,options:f})}),o(r,"dispatchEvent",function(c){var u=t.get(this),f=u[c.type];return f&&(o(c,"target",this),o(c,"currentTarget",this),f.slice(0).forEach(l,c),delete c.currentTarget,delete c.target),!0}),o(r,"removeEventListener",function(c,u){for(var f=t.get(this),h=f[c]||(f[c]=[]),d=0,p=h.length;d<p;d++)if(h[d].listener===u){h.splice(d,1);return}}),Lm.EventTarget=s;function s(){t.set(this,n(null))}function o(c,u,f){i(c,u,{configurable:!0,writable:!0,value:f})}function l(c){var u=c.options;u&&u.once&&c.target.removeEventListener(this.type,c.listener),typeof c.listener=="function"?c.listener.call(c.target,this):c.listener.handleEvent(this)}})(Object,new WeakMap)}var UF=Lm.EventTarget;var Rm=class extends THREE.ArrayCamera{constructor(){super();this.tileCount=new THREE.Vector2,this.target=new THREE.Vector3(0,0,0),this.position.set(0,0,1),this.fov=12.5,this.aspect=2560/1600,this.viewCone=35,HP().then(e=>{this.viewCone=e}),Hw().then(e=>{this.fov=50,this.cameras.forEach(t=>{t.fov=this.fov,t.updateProjectionMatrix()})}),Uw().then(e=>{this.aspect=e.screenW.value/e.screenH.value,this.cameras.forEach(t=>{t.aspect=this.aspect,t.updateProjectionMatrix()})})}update(e,t){if(this.tileCount.x!=t.x||this.tileCount.y!=t.y){this.cameras=[];for(let i=0;i<t.x*t.y;i++){let r=new THREE.PerspectiveCamera(this.fov,this.aspect);r.viewport=new THREE.Vector4,this.cameras.push(r)}this.tileCount.copy(t)}let n=new THREE.Vector2(Math.floor(e/t.x),Math.floor(e/t.y));for(let i=0;i<this.cameras.length;i++){let r=this.cameras[i];r.rotation.copy(this.rotation);let s=new THREE.Vector2(i%t.x,Math.floor(i/t.x));r.viewport.set(s.x*n.x,s.y*n.y,n.x,n.y);let o=this.position.distanceTo(this.target),l=THREE.Math.degToRad(THREE.Math.lerp(-this.viewCone/2,this.viewCone/2,i/(this.cameras.length-1))),c=o*Math.tan(l);r.position.copy(this.localToWorld(new THREE.Vector3(c,0,0))),r.updateMatrixWorld(),r.projectionMatrix.elements[8]=-2*c/(2*o*Math.tan(.5*THREE.Math.degToRad(r.fov))*r.aspect)}}lookAt(e){super.lookAt(e),this.target.copy(e)}};var VF=function(){var a=["fullscreen","fullscreenEnabled","fullscreenElement","fullscreenchange","fullscreenerror","exitFullscreen","requestFullscreen"],e=["webkitIsFullScreen","webkitFullscreenEnabled","webkitFullscreenElement","webkitfullscreenchange","webkitfullscreenerror","webkitExitFullscreen","webkitRequestFullscreen"],t=["mozFullScreen","mozFullScreenEnabled","mozFullScreenElement","mozfullscreenchange","mozfullscreenerror","mozCancelFullScreen","mozRequestFullScreen"],n=["","msFullscreenEnabled","msFullscreenElement","MSFullscreenChange","MSFullscreenError","msExitFullscreen","msRequestFullscreen"];document||(document={});var i,r=(i=[a[1],e[1],t[1],n[1]].find(function(o){return document[o]}),[a,e,t,n].find(function(o){return o.find(function(l){return l===i})})||[]);function s(o,l){document[a[0]]=document[r[0]]||!!document[r[2]]||!1,document[a[1]]=document[r[1]]||!1,document[a[2]]=document[r[2]]||null,document.dispatchEvent(new Event(o),l.target)}return document[a[1]]?{}:(document[a[0]]=document[r[0]]||!!document[r[2]]||!1,document[a[1]]=document[r[1]]||!1,document[a[2]]=document[r[2]]||null,document.addEventListener(r[3],s.bind(document,a[3]),!1),document.addEventListener(r[4],s.bind(document,a[4]),!1),document[a[5]]=function(){return document[r[5]]()},void(Element.prototype[a[6]]=function(){return this[r[6]].apply(this,arguments)}))}(),Ww=class{constructor(e){this.renderer=e,this.lkgDevice=null,Cm().then(t=>{this.lkgDevice=t,this.isOnLkg()?(this.renderer.render2d=!1,this.moveWarning.style.display="none"):(this.renderer.render2d=!0,this.moveWarning.style.display=""),requestAnimationFrame(this.update.bind(this))}),this.onLkg=null,this.moveWarning=this.makeMoveWarning(),document.body.appendChild(this.moveWarning),this.fullscreenButton=this.makeFullscreenButton(),document.body.appendChild(this.fullscreenButton)}isOnLkg(){let e=window.screen.width==this.lkgDevice.calibration.screenW.value&&window.screen.height==this.lkgDevice.calibration.screenH.value,t=window.screen.availLeft==this.lkgDevice.windowCoords[0];return e&&t}update(){requestAnimationFrame(this.update.bind(this));let e=this.isOnLkg();e&&!this.onLkg?(this.renderer.render2d=!1,this.moveWarning.style.display="none"):!e&&this.onLkg&&(this.renderer.render2d=!0,this.moveWarning.style.display=""),this.onLkg=e,this.onLkg&&!document.fullscreen?(document.hasFocus()?this.fullscreenButton.innerText="click to go fullscreen":this.fullscreenButton.innerText="click to focus window",this.fullscreenButton.style.display=""):this.fullscreenButton.style.display="none"}makeMoveWarning(){let e=document.createElement("div");return e.innerText="drag this window to the Looking Glass",e.style.cssText=`
      background: white;
      border-radius: 8px;
      bottom: 0px;
      display: none;
      font-family: sans-serif;
      font-size: 6em;
      left: 0px;
      margin: 16px;
      opacity: 0.5;
      padding: 8px;
      position: absolute;
      z-index: ${Number.MAX_SAFE_INTEGER};
    `,e}makeFullscreenButton(){let e=document.createElement("div");return e.innerText="go fullscreen",e.style.cssText=`
      background: white;
      border-radius: 8px;
      bottom: 0px;
      display: none;
      font-family: sans-serif;
      font-size: 6em;
      font-weight: bold;
      left: 0px;
      margin: 16px;
      opacity: 0.75;
      padding: 8px;
      pointer-events: none;
      position: absolute;
      z-index: ${Number.MAX_SAFE_INTEGER};
    `,window.addEventListener("click",()=>{this.renderer.domElement.requestFullscreen()}),e}},Im=class{constructor(e){this.enforceMandatoryDocumentStyle();let t=e||{};this.quiltResolution=t.quiltResolution||4096,this.tileCount=t.tileCount||new THREE.Vector2(5,9),this.render2d=t.render2d||!1,this.renderQuilt=t.render2d||!1,this.fullscreenHelper=null,t.disableFullscreenUi||(this.fullscreenHelper=new Ww(this)),this.webglRenderer=new THREE.WebGLRenderer,this.domElement=this.webglRenderer.domElement,this.quiltRenderTarget=new THREE.WebGLRenderTarget(this.quiltResolution,this.quiltResolution,{format:THREE.RGBFormat}),this.quiltRenderer=new Gw(this.tileCount,this.webglRenderer),this.quiltRenderer.setQuiltTexture(this.quiltRenderTarget.texture),t.quiltResolution||UP().then(n=>{this.quiltResolution=n}),t.tileCount||VP().then(n=>{this.tileCount.copy(n)}),this.debug2dCamera=new THREE.PerspectiveCamera,Hw().then(n=>{this.debug2dCamera.fov=50,this.debug2dCamera.updateProjectionMatrix()})}enforceMandatoryDocumentStyle(){document.body.style.margin="0px",document.body.style.overflow="hidden"}render(e,t){if(this.enforceMandatoryDocumentStyle(),this.render2d){this.debug2dCamera.position.copy(t.position),this.debug2dCamera.rotation.copy(t.rotation);let n=window.innerWidth/window.innerHeight;n!=this.debug2dCamera.aspect&&(this.debug2dCamera.aspect=n,this.debug2dCamera.updateProjectionMatrix()),this.webglRenderer.domElement.style.top=this.webglRenderer.domElement.style.left="0px",this.webglRenderer.setSize(window.innerWidth,window.innerHeight),this.webglRenderer.render(e,this.debug2dCamera)}else if(this.renderQuilt){t.update(this.quiltResolution,this.tileCount);let n=Math.min(window.innerWidth,window.innerHeight);this.webglRenderer.domElement.style.width=this.webglRenderer.domElement.style.height=`${n}px`,this.webglRenderer.domElement.style.top=this.webglRenderer.domElement.style.left="0px",this.webglRenderer.setRenderTarget(null),this.webglRenderer.setSize(this.quiltResolution,this.quiltResolution,!1),this.webglRenderer.render(e,t)}else this.quiltRenderTarget.setSize(this.quiltResolution,this.quiltResolution),t.update(this.quiltResolution,this.tileCount),this.webglRenderer.setRenderTarget(this.quiltRenderTarget),this.webglRenderer.setSize(this.quiltResolution,this.quiltResolution,!1),this.webglRenderer.render(e,t),this.webglRenderer.setRenderTarget(null),this.quiltRenderer.update(this.quiltResolution,this.tileCount),this.quiltRenderer.render()}};var jw=new URLSearchParams(location.search);function qw(a,e,t,n,i){return(a-e)/(t-e)*(i-n)+n}function Yw(a,e=.1){let t=Math.sign(a),n=Math.abs(a);return a=n<e?e:n,t*qw(a,e,1,0,1)}function dr(a,e){return Math.random()*(e-a)+a}var os={dynamic:0,static:1,kinematic:2,ghost:4},Zw=(()=>{let a=new Lt.TextureLoader;return e=>a.load(e)})(),Dm=(()=>{let a=new Bs;return e=>new Promise(t=>{a.load(e,n=>{if(n.animations?.length){let i=new Lt.AnimationMixer(n.scene);n.scene.userData.mixer=i,n.scene.userData.action=i.clipAction(n.animations[0])}t(n.scene)})})})();function jP(a){let e=navigator.getGamepads();if(e.length&&e[a])return e[a]}var Jw=new C1;document.body.append(Jw.dom);var $w=3.32,Fm=4,Bm=20,qP=Bm*Fm,Qw=class extends qh{async preload(){this.assets={textures:{grain:Zw("grain.png"),cube:Zw("cube.png")},models:{sphere:await Dm("sphere.glb"),tree:await Dm("tree.glb"),arrow:await Dm("arrow.glb")}}}async init(){this.state=window.state=Object.preventExtensions({player:null,sphere:null,tree:null,arrow:null,marchingCubes:null,spheres:[],directionalLight:null,sources:[],currentSourceIndex:0,collecting:!0,gameOver:!1,treePhase:0,children:[],storm:null,stormEnabled:!0,setNear:!1})}addChild(e,t,n,i){let r=this.assets.models.sphere.getObjectByProperty("type","Mesh").clone();return r.castShadow=r.receiveShadow=!0,r.frustumCulled=!1,r.material=r.material.clone(),r.material.metalness=.9,r.material.roughness=0,r.position.set(t,n,i),r.material.color.setHSL(e/8,1,.5),r.scale.setScalar(.001),this.scene.add(r),Oi.to(r.scale,{x:.3,y:.3,z:.3}).then(()=>{this.physics.addExisting(r,{shape:"sphere",mass:.01}),r.body.setDamping(.5,.3),this.state.children.push(r)}),r}makePlayer(){let e=-3,t=new Lt.Object3D;t.position.y=e;let n=this.assets.models.sphere.getObjectByProperty("type","Mesh").clone();return n.castShadow=!0,n.receiveShadow=!0,n.material.metalness=.9,n.material.roughness=0,n.material.color.setStyle("white"),n.position.y=e,this.physics.addExisting(n,{collisionFlags:os.kinematic,shape:"concave",collisionGroup:8,collisionMask:8}),this.scene.add(n),this.state.sphere=n,this.state.sphere.body.setFriction(0),this.physics.addExisting(t,{shape:"sphere",radius:1,collisionFlags:os.dynamic}),t.body.setDamping(.9,.3),this.state.marchingCubes=new fu(16,new Lt.MeshStandardMaterial({color:"white",roughness:0,metalness:1}),!1,!1),this.state.marchingCubes.scale.multiplyScalar(1.3),n.add(this.state.marchingCubes),this.scene.add(t),t}addSphere(){let e=this.state.player.position,t=this.physics.add.sphere({radius:.19,x:e.x,y:e.y,z:e.z,widthSegments:4,heightSegments:4,mass:1e-4,collisionGroup:8,collisionMask:8},{lambert:{color:"red",visible:!1}});t.body.setDamping(.9,.9),t.body.setFriction(0),t.body.setRestitution(0),this.state.spheres.push(t)}async create(){this.scene.environment=this.assets.textures.cube,this.scene.environment.encoding=Lt.LinearEncoding,this.scene.environment.mapping=Lt.CubeUVReflectionMapping,this.scene.environment.magFilter=Lt.NearestFilter,this.scene.environment.minFilter=Lt.NearestFilter,this.scene.environment.generateMipmaps=!1;let e=await this.warpSpeed("-ground","-orbitControls");this.state.directionalLight=e.lights.directionalLight,this.scene.fog=new Lt.Fog(15916977,30,40),window.scene=this;let t=this.add.box({y:-60,height:100,width:100,depth:100},{basic:{color:15916977,side:Lt.BackSide}});t.castShadow=!1,this.physics.add.box({collisionFlags:os.static,width:100,height:10,z:-50,y:-5},{lambert:{visible:!1}}),this.physics.add.box({collisionFlags:os.static,width:100,height:10,z:50,y:-5},{lambert:{visible:!1}}),this.physics.add.box({collisionFlags:os.static,depth:100,height:10,x:-50,y:-5},{lambert:{visible:!1}}),this.physics.add.box({collisionFlags:os.static,depth:100,height:10,x:50,y:-5},{lambert:{visible:!1}});let n=this.assets.models.tree,i=n.getObjectByProperty("type","SkinnedMesh");i.pose(),i.castShadow=!0,i.frustumCulled=!1,n.position.y=-5,this.state.tree=n,this.scene.add(n),n.userData.action.play(),n.userData.mixer.update(0),this.physics.add.cylinder({collisionFlags:os.static,y:-3,height:5,radiusTop:.2,radiusBottom:.2},{lambert:{visible:!1}}),this.state.player=this.makePlayer(),this.state.directionalLight.target=this.state.player,this.state.arrow=this.assets.models.arrow,this.scene.add(this.state.arrow);let r=new Xw.default("seeds"),s=document.createElement("canvas");s.width=s.height=64;let o=s.getContext("2d"),l=o.getImageData(0,0,s.width,s.height),c=1/16;for(let d=0;d<s.width;d++)for(let p=0;p<s.height;p++){let m=(r.noise2D(d*c,p*c)+1)/2*64;l.data[p*s.width*4+d*4+0]=m,l.data[p*s.width*4+d*4+1]=m,l.data[p*s.width*4+d*4+2]=m,l.data[p*s.width*4+d*4+3]=255}o.putImageData(l,0,0);let u=this.heightMap.add(new Lt.CanvasTexture(s));u.scale.multiplyScalar(10),u.castShadow=!1,u.receiveShadow=!0,u.material.color.setHex(15916977),u.material.map=this.assets.textures.grain,u.material.map.wrapS=u.material.map.wrapT=Lt.RepeatWrapping,u.material.map.repeat.setScalar(20),u.position.y=-10,this.physics.add.existing(u,{collisionFlags:os.static});let f=[[16,16],[48,16],[16,48],[48,48]];for(let d=0;d<Fm;d++){let p=Math.floor(f[d][0]+dr(-6,6)),m=Math.floor(f[d][1]+dr(-6,6)),v=l.data[m*s.width*4+p*4]/16-6,x=this.make.sphere({x:(p-s.width/2)*1.57+.5,y:v,z:(m-s.width/2)*1.57+.5},{standard:{roughness:0,metalness:1}});x.frustumCulled=!1,d!==0&&x.scale.setScalar(.001),this.scene.add(x),this.state.sources.push(x)}this.state.storm=new Lt.Points,this.state.storm.material.size=2,this.state.storm.material.sizeAttenuation=!1,this.state.storm.material.color.setStyle("brown"),this.state.storm.material.color.offsetHSL(0,-.3,-.1);let h=[];for(let d=0;d<1e4;d++)h.push(dr(-50,50),dr(-10,10),dr(-50,50));this.state.storm.geometry.setAttribute("position",new Lt.BufferAttribute(new Float32Array(h),3)),this.scene.add(this.state.storm)}update=(()=>{let e=new Lt.Vector3,t=new Lt.Vector3(0,1,0),n=0;return(i,r)=>{Jw.update();let s=r/1e3,o=this.state.player.position;this.state.sphere.position.copy(o),this.state.sphere.quaternion.copy(this.state.player.quaternion),this.state.sphere.body.needUpdate=!0,this.camera.position.copy(o),e.set(0,6,15),this.camera.position.add(e),this.camera.lookAt(o);let l=this.state.sources[this.state.currentSourceIndex];this.state.arrow.position.copy(o),this.state.arrow.position.y+=2;let c=this.state.collecting?l.position:this.state.tree.position;this.state.arrow.lookAt(c);let u=o.distanceTo(c);this.state.arrow.children[0].material.opacity=qw(u,4,32,0,.5),this.state.directionalLight.position.copy(o),e.set(100,50,50),this.state.directionalLight.position.add(e);let f=jP(0);if(f){let h=Yw(f.axes[0]),d=Yw(f.axes[1]),p=20;if(this.state.player.body.applyCentralForce(p*h,0,p*d),f.buttons[0].pressed&&u<6&&i-n>.1){if(this.state.collecting){this.addSphere();let m=this.state.spheres.length,v=Math.max(1e-5,1-m/Bm);Oi.to(l.scale,{x:v,y:v,z:v,duration:.2}),m===Bm&&(l.visible=!1,this.state.collecting=!1,Oi.fromTo(this.state.arrow.scale,{x:1e-4,y:1e-4,z:1e-4},{x:1,y:1,z:1,duration:.5})),n=i}else if(this.state.spheres.length){let m=this.state.spheres.pop();this.physics.destroy(m),this.state.treePhase+=1/qP*$w,n=i}else if(this.state.currentSourceIndex!==Fm-1){this.state.currentSourceIndex++;let m=this.state.sources[this.state.currentSourceIndex];Oi.to(m.scale,{x:1,y:1,z:1,duration:.5}),Oi.fromTo(this.state.arrow.scale,{x:1e-4,y:1e-4,z:1e-4},{x:1,y:1,z:1,duration:.5}),this.state.collecting=!0}}}if(this.state.tree.userData.action.time<this.state.treePhase&&this.state.tree.userData.mixer.update(s/2),Math.abs(this.state.tree.userData.action.time-$w)<.1&&!this.state.gameOver){this.state.gameOver=!0,Oi.to(this.scene.fog,{near:100,far:110,duration:10}),Oi.to(this.state.arrow.scale,{x:1e-4,y:1e-4,z:1e-4,duration:.1}),this.state.storm.material.transparent=!0,Oi.to(this.state.storm.material,{opacity:0,duration:.5}).then(()=>{this.state.storm.visible=!1,this.state.stormEnabled=!1});let h=[[-.7,1.3,.2],[-2,.8,-.9],[-.5,1.2,-1.9],[0,-.2,1.5],[-.13,-1.11,-1.25],[-.5,-2.12,1.33],[1.06,-1.47,-.86],[-1.53,-2.29,-.6]];for(let d=0;d<h.length;d++){let[p,m,v]=h[d];setTimeout(()=>this.addChild(d,p,m,v),dr(1,2)*1e3)}}for(let h of this.state.children)e.copy(o),e.sub(h.position),e.normalize(),e.multiplyScalar(.15),e.applyAxisAngle(t,15*Math.PI/180),h.body.applyCentralForce(e.x,0,e.z);this.state.marchingCubes.reset();for(let h of this.state.spheres)e.copy(h.position),this.state.marchingCubes.worldToLocal(e),e.addScalar(1.1),e.multiplyScalar(.45),this.state.marchingCubes.addBall(e.x,e.y,e.z,.5,12);if(this.state.stormEnabled){let h=this.state.storm.geometry.attributes.position;for(let d=0;d<h.array.length;d+=3)h.array[d]+=dr(.4,.6),h.array[d+1]+=dr(-.1,.1),h.array[d+2]+=dr(-.1,.1),h.array[d]>50&&(h.array[d]=-50),h.array[d+1]>10&&(h.array[d+1]=-10),h.array[d+1]<-10&&(h.array[d+1]=10),h.array[d+2]>50&&(h.array[d+2]=-50),h.array[d+2]<-50&&(h.array[d+2]=50);h.needsUpdate=!0}if(!Ql.userData.nearApplied){if(this.state.setNear){for(let h of Ql.cameras)h.near=10,h.updateProjectionMatrix();Ql.userData.nearApplied=!0}Bt.quiltRenderer?.calibrationData&&Ql.cameras?.length&&(this.state.setNear=!0)}}})()},Bt=window.renderer=new Im({disableFullscreenUi:jw.has("2d")});Bt.renderQuilt=!1;Bt.render2d=jw.has("2d");Bt.setSize=(a,e)=>Bt.webglRenderer.setSize(a,e);Bt.setPixelRatio=a=>Bt.webglRenderer.setPixelRatio(a);Bt.setAnimationLoop=a=>Bt.webglRenderer.setAnimationLoop(a);Bt.compile=(a,e)=>Bt.webglRenderer.compile(a,e);Bt.getClearColor=a=>Bt.webglRenderer.getClearColor(a);Bt.getRenderTarget=()=>Bt.webglRenderer.getRenderTarget();Bt.setRenderTarget=(a,e,t)=>Bt.webglRenderer.setRenderTarget(a,e,t);Object.defineProperty(Bt,"shadowMap",{get(){return Bt.webglRenderer.shadowMap}});var Ql=window.camera=new Rm;kl("lib",()=>new uu({renderer:Bt,camera:Ql,gravity:{x:0,y:-9.8,z:0},scenes:[Qw]}));})();
/*!
 * CSSPlugin 3.7.1
 * https://greensock.com
 *
 * Copyright 2008-2021, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/
/*!
 * GSAP 3.7.1
 * https://greensock.com
 *
 * @license Copyright 2008-2021, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/
/*!
 * fullscreen-polyfill
 * 1.0.2 - 5/23/2018
 * https://github.com/nguyenj/fullscreen-polyfill#readme
 * (c) John Nguyen; MIT License
 */
/*!
 * matter-js 0.17.1 by @liabru
 * http://brm.io/matter-js/
 * License MIT
 * 
 * The MIT License (MIT)
 * 
 * Copyright (c) Liam Brummitt and contributors.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/
/*! (c) Andrea Giammarchi - ISC */
/**
 * @author       Evan Wallace (http://madebyevan.com/))
 * @copyright    Copyright (c) 2011 Evan Wallace
 * @license      MIT license
 *
 * @author       manthrax (https://github.com/manthrax)
 *
 * @author       Jiro-Digital (https://github.com/Jiro-Digital)
 * @copyright    Copyright (c) 2020 Jiro Digital Ltd
 * @license      {@link https://github.com/Jiro-Digital/three-csg-ts/blob/master/LICENSE|MIT}
 *
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
/**
 * @author       Kevin Lee (https://github.com/InfiniteLee)
 * @copyright    Copyright (c) 2019 Kevin Lee; Project Url: https://github.com/InfiniteLee/ammo-debug-drawer
 * @license      {@link https://github.com/InfiniteLee/ammo-debug-drawer/blob/master/LICENSE|MPL-2.0}
 */
/**
 * @author       Kevin Lee (https://github.com/InfiniteLee)
 * @copyright    Copyright (c) 2020 Kevin Lee; Project Url: https://github.com/InfiniteLee/three-to-ammo
 * @license      {@link https://github.com/InfiniteLee/three-to-ammo/blob/master/LICENSE|MPL-2.0}
 */
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
/**
 * @description  This code has originally been copied from Sketchbook
 *
 * @author       swift502 <blaha.j502@gmail.com> (http://jblaha.art/)
 * @copyright    Copyright (c) 2018 swift502; Project Url: https://github.com/swift502/Sketchbook
 * @license      {@link https://github.com/swift502/Sketchbook/blob/master/LICENSE GPL-3.0}
 *
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d
 * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE GNU GPLv3}
 */
/**
 * @license
 * Copyright 2010-2021 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
/**
 * @package      npmjs.com/package/@yandeu/events (events.min.js)
 *
 * @author       Arnout Kazemier (https://github.com/3rd-Eden)
 * @copyright    Copyright (c) 2014 Arnout Kazemier
 * @license      {@link https://github.com/primus/eventemitter3/blob/master/LICENSE|MIT}
 *
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/yandeu/events
 * @license      {@link https://github.com/yandeu/events/blob/master/LICENSE|MIT}
 */
/**
 * @package      npmjs.com/package/@yandeu/tap (tap.min.js)
 *
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2021 Yannick Deubel; Project Url: https://github.com/yandeu/tap
 * @license      {@link https://github.com/yandeu/tap/blob/master/LICENSE|MIT}
 * @description  Inspired by tapjs (https://www.npmjs.com/package/tapjs)
 */
/**
 * This files defines the HoloPlayClient class and Message class.
 *
 * Copyright (c) [2019] [Looking Glass Factory]
 *
 * @link    https://lookingglassfactory.com/
 * @file    This files defines the HoloPlayClient class and Message class.
 * @author  Looking Glass Factory.
 * @version 0.0.8
 * @license SEE LICENSE IN LICENSE.md
 */
//# sourceMappingURL=bundle.js.map
